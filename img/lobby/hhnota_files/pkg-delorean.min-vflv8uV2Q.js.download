define("modules/clean/react/delorean/components/folder_history/folder_history",["require","exports","tslib","react","modules/clean/react/delorean/components/folder_history/folder_history_header","modules/core/i18n","modules/clean/react/delorean/components/folder_history/folder_history_card","modules/clean/react/delorean/util","external/classnames","modules/clean/react/delorean/data/types","modules/clean/static_urls","modules/clean/react/delorean/components/folder_history/folder_history_skeleton","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky","spectrum/icon_arrow","spectrum/tertiary_link","modules/clean/components/loading_indicator","react-dom","modules/clean/react/delorean/data/reducer_helpers"],function(e,t,a,r,n,o,s,i,d,l,p,c,u,h,g,f,v,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),d=a.__importDefault(d),m=a.__importDefault(m);var y=function(e){var t=e.cursor,a=e.direction,n=function(){e.onShowMore(t)};return r.default.createElement("div",{className:d.default({"folder-history-show-more-card":!0,"folder-history-show-more-card--future":a===l.PaginationDirection.future,"folder-history-show-more-card--past":a===l.PaginationDirection.past})},r.default.createElement(f.TertiaryLink,{onClick:n},r.default.createElement("div",{className:"folder-history-show-more-card--arrow-container"},r.default.createElement(g.IconArrow,{className:"arrow",name:"right"})),r.default.createElement("div",{className:"folder-history-show-more-card--text"},e.direction===l.PaginationDirection.future?o._("Show newer changes",{project:"folder-history"}):o._("Show older changes",{project:"folder-history"}))))},w=(function(e){function t(t){var a=e.call(this,t)||this;return a.previousTopOfListRef=null,a.topOfListRef=null,a.selectedDateOnGraphRef=null,a.onMouseOverEvent=function(e,t){if(a.props.events.type===l.RewindEventState.hasContent){var r=a.getProcessedEvents(a.props.events.processedEvents),n=i.findIndex(r,function(t){return t.type===l.DeloreanEventType.event&&t.uid===e.uid});if(void 0===n)return;1===n&&"top"===t&&(t="bottom"),n===r.length-1&&"bottom"===t&&(t="top");var o=void 0,s=void 0;if("top"===t){s=r[n];for(var d=n-1;d>=0;d--){var p=r[d];if(p.type===l.DeloreanEventType.event){o=p;break}}}if("bottom"===t){o=r[n];for(var d=n+1;d<r.length;d++){var p=r[d];if(p.type===l.DeloreanEventType.event){s=p;break}}}o&&s?a.setState({hoveredEvents:{topEvent:o,botEvent:s}}):a.setState({hoveredEvents:void 0})}},a.handleClick=function(e){a.props.isForARewind&&a.setState({selectedEvents:a.state.hoveredEvents}),a.state.hoveredEvents&&a.props.onClickEvent(a.state.hoveredEvents)},a.eventRef=function(e){e!==a.topOfListRef&&null!==e&&(a.previousTopOfListRef=a.topOfListRef,a.topOfListRef=m.default.findDOMNode(e))},a.setSelectedDateOnGraphRef=function(e){if(null===e)return void(a.selectedDateOnGraphRef=null);a.selectedDateOnGraphRef=m.default.findDOMNode(e)},a.setContainerRef=function(e){a.containerRef=e},a.hoverOut=function(){a.setState({hoveredEvents:void 0})},a.state={hoveredEvents:void 0,selectedEvents:void 0},a}return a.__extends(t,e),t.prototype.componentDidUpdate=function(e){if((this.topOfListRef&&!document.body.contains(this.topOfListRef)||this.previousTopOfListRef&&!document.body.contains(this.previousTopOfListRef))&&(this.topOfListRef=null,this.previousTopOfListRef=null,this.selectedDateOnGraphRef=null),this.props.events.type===l.RewindEventState.hasContent&&this.props.pagesLoaded!==e.pagesLoaded&&this.props.pagesLoaded)if(2===this.props.pagesLoaded)this.selectedDateOnGraphRef&&this.selectedDateOnGraphRef.scrollIntoView(!0);else if(this.props.pagesLoaded>2&&this.containerRef&&this.previousTopOfListRef&&this.topOfListRef){var t=this.containerRef,a=this.previousTopOfListRef.offsetTop-this.topOfListRef.offsetTop;t.scrollBy(0,a)}},t.prototype.getProcessedEvents=function(e){if(this.props.selectedDateTsInMs){var t=i.floorDate(new Date(this.props.selectedDateTsInMs));if(!(e.filter(function(e){return e.type===l.DeloreanEventType.dateBanner&&e.date.getTime()===t.getTime()}).length>0)){var a=_.createDateBanner(t),r=_.createEmptyDay(t);if(e[0].date<t)e=this.props.events.type===l.RewindEventState.hasContent&&"reached-end"===this.props.events.cursorFuture.type?[a].concat(e):[a,r].concat(e);else if(e[e.length-1].date>t)e=this.props.events.type===l.RewindEventState.hasContent&&"reached-end"===this.props.events.cursorPast.type?e.concat([a]):e.concat([a,r]);else for(var n=0;n<e.length-1;n++)if(e[n].date>t&&e[n+1].date<t){e.splice(n+1,0,a,r);break}}}return e},t.prototype.renderNeverLoaded=function(){return null},t.prototype.renderLoading=function(){return r.default.createElement(c.FolderHistoryEventCardsSkeleton,{animated:!0})},t.prototype.renderEvents=function(e){var t,a,n=this;t=e.loadingPastPage?r.default.createElement("div",{className:"folder-history-show-more-card"},r.default.createElement(v.LoadingIndicator,{style:"blue_spinner"})):"reached-end"===e.cursorPast.type?r.default.createElement("div",{className:"folder-history-empty-event-card"},o._("That’s as far back as it goes",{project:"folder-history"})):r.default.createElement(y,{cursor:e.cursorPast,direction:l.PaginationDirection.past,onShowMore:this.props.onShowMorePast}),a=e.loadingFuturePage?r.default.createElement("div",{className:"folder-history-show-more-card"},r.default.createElement(v.LoadingIndicator,{style:"blue_spinner"})):"reached-end"===e.cursorFuture.type?r.default.createElement("div",{className:"folder-history-empty-event-card"},o._("No newer activity.",{project:"folder-history"})):r.default.createElement(y,{cursor:e.cursorFuture,direction:l.PaginationDirection.future,onShowMore:this.props.onShowMoreFuture});var s=this.getProcessedEvents(e.processedEvents),d=this.state.hoveredEvents?i.findIndex(s,function(e){return e.type===l.DeloreanEventType.event&&e.uid===n.state.hoveredEvents.topEvent.uid}):void 0,p=this.state.selectedEvents?i.findIndex(s,function(e){return e.type===l.DeloreanEventType.event&&e.uid===n.state.selectedEvents.topEvent.uid}):void 0,c=s[0],h=s.slice(1);return r.default.createElement(u.StickyContainer,null,this.renderEvent({event:c,willRewindEvent:!1,isTopmostEvent:!1,isAnythingInListSelectedOrHovered:void 0!==this.state.selectedEvents}),a,h.map(function(e,t){var a=!1;return n.props.isForARewind&&(n.state.selectedEvents&&void 0!==p&&t<p&&(a=!0),!n.state.selectedEvents&&void 0!==d&&t<d&&(a=!0),e.type===l.DeloreanEventType.emptyDay&&(n.state.selectedEvents?e.date<n.state.selectedEvents.topEvent.date&&e.date>n.state.selectedEvents.botEvent.date&&(a=!0):n.state.hoveredEvents&&e.date<n.state.hoveredEvents.topEvent.date&&e.date>n.state.hoveredEvents.botEvent.date&&(a=!0)),void 0===d&&void 0===p&&(a=!0)),n.renderEvent({event:e,willRewindEvent:a,isTopmostEvent:0===t,isAnythingInListSelectedOrHovered:!!n.state.selectedEvents||!!n.state.hoveredEvents})}),t)},t.prototype.renderEvent=function(e){var t=e.event,a=e.willRewindEvent,p=e.isTopmostEvent,c=e.isAnythingInListSelectedOrHovered;if(t.type===l.DeloreanEventType.event){var u={top:{style:"none",position:"top",text:""},bottom:{style:"none",position:"bottom",text:""}};return this.props.isForARewind&&(this.state.hoveredEvents&&this.state.hoveredEvents.botEvent.uid===t.uid&&(u.top={position:"top",style:"dashed",text:o._("Choose what to keep",{project:"folder-history",comment:"The user is being asked to choose which activities they want to keep in a list. Try to keep this short."})}),this.state.selectedEvents&&this.state.selectedEvents.botEvent.uid===t.uid&&(u.top={position:"top",style:"solid",text:this.state.selectedEvents.botEvent.confirmationCardDate}),c||(u.top={position:"top",style:"pulsing",text:""})),r.default.createElement(s.FolderHistoryEventCard,{key:t.uid,ref:p?this.eventRef:void 0,rewindMode:this.props.isForARewind,onClick:this.handleClick,onMouseOver:this.onMouseOverEvent,onMouseOut:i.noop,event:t,willRewindEvent:a,isFaded:a&&!!this.state.hoveredEvents,isSelected:!1,isLink:this.props.shouldEventsLinkToBrowse,dividerLineStateTop:u.top,dividerLineStateBottom:u.bottom})}return t.type===l.DeloreanEventType.dateBanner?r.default.createElement(h.Sticky,{ref:this.props.selectedDateTsInMs&&i.roundDate(t.date)===i.roundDate(new Date(this.props.selectedDateTsInMs))?this.setSelectedDateOnGraphRef:void 0,className:"folder-history-sticky-header",offsetHeight:32},r.default.createElement(n.FolderHistoryEventHeader,{segmentName:t.eventCardDate})):t.type===l.DeloreanEventType.emptyDay?r.default.createElement("div",{className:d.default({"folder-history-empty-event-card":!0,"folder-history-empty-event-card__include-in-rewind":!a})},o._("Nothing happened on this day",{project:"folder-history"})):i.assertNever(t)},t.prototype.renderEmptyList=function(){return this.props.events.type!==l.RewindEventState.hasContent?null:r.default.createElement("div",null,r.default.createElement(n.FolderHistoryEventHeader,{segmentName:o._("Today",{project:"folder-history"})}),r.default.createElement("img",{alt:"",className:"folder-history-event-list__empty-img",src:p.static_url("/static/images/delorean/illo-no-activity-vflHN_Psx.png")}),r.default.createElement("div",{className:"folder-history-event-list__empty-text"},o._("Sorry, there’s no content here!",{project:"folder-history"})))},t.prototype.render=function(){var e;return this.props.events.type===l.RewindEventState.loadingEntirePanel||this.props.pagesLoaded&&this.props.pagesLoaded<2?e=this.renderLoading():this.props.events.type===l.RewindEventState.hasContent?e=0===this.props.events.processedEvents.length?this.renderEmptyList():this.renderEvents(this.props.events):(i.assertNever(this.props.events),e=null),r.default.createElement("div",{onMouseLeave:this.hoverOut,ref:this.setContainerRef,className:"folder-history-event-list"},e)},t})(r.default.PureComponent);t.FolderHistory=w}),define("modules/clean/react/delorean/components/folder_history/folder_history_card",["require","exports","tslib","react","modules/core/user_i18n","modules/clean/react_format","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","external/classnames"],function(e,t,a,r,n,o,s,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importStar(n),s=a.__importDefault(s),d=a.__importDefault(d),t.CardAvatar=function(e){var t=e.actor,a=e.toBeRolledBack;if(!t)return null;var o=t.photo_url?t.photo_url:void 0,l=d.default({"folder-history-event-card__avatar":!0,"folder-history-event-card__avatar--to-be-rolled-back":a});return r.default.createElement("div",{className:"folder-history-event-card__avatar-container"},r.default.createElement(s.default,{optionalClass:l,dimension:24,shape:"CIRCLE",photoUrl:o,defaultAvatar:r.default.createElement(i.InitialsAvatarWithColorDerivedFromName,{optionalClass:l,dimension:24,shape:"CIRCLE",initials:n.getInitials(t.display_name),name:t.display_name})}))},t.CardCircle=function(e){var t=e.hovered;return r.default.createElement("div",{className:d.default({"folder-history-event-card__circle":!0,"folder-history-event-card__circle--hovered":t})})},t.CardDividerLine=function(e){var t=e.style;return r.default.createElement("div",{className:"folder-history-event-card__line-container"},r.default.createElement("div",{className:d.default({"folder-history-event-card__line":!0,"folder-history-event-card__line--pulse":"pulsing"===t,"folder-history-event-card__line--normal":"default"===t,"folder-history-event-card__line--hovered":"dashed"===t,"folder-history-event-card__line--selected":"solid"===t,"folder-history-event-card__line--invisible":"none"===t})}),e.text&&r.default.createElement("div",{className:"folder-history-event-card__line__text"},e.text))};var l=function(e){return r.default.createElement("div",{className:"folder-history-event-card__card-heading"},o.reactFormat(e.event.eventHeadline,{strong:r.default.createElement("strong",null)}))},p=function(e){return r.default.createElement("div",{className:"folder-history-event-card__card-subheading"},e.event.timeAgo,e.event.cardSubheading?r.default.createElement("span",null," • ",e.event.cardSubheading):void 0)},c=(function(e){function n(t){var a=e.call(this,t)||this;return a.handleMouseOver=function(e){var t=e.currentTarget.getBoundingClientRect();a.props.onMouseOver(a.props.event,(e.clientY-t.top)/t.height>.5?"bottom":"top")},a.handleMouseOut=function(){a.props.onMouseOut(a.props.event)},a.onClickOnEvent=function(){a.props.onClick(a.props.event)},a}return a.__extends(n,e),n.prototype.render=function(){var e=this.props,n=e.event,o=e.rewindMode,s=e.dividerLineStateTop,i=e.dividerLineStateBottom,c=r.default.createElement("div",{className:d.default({"folder-history-event-card__card-text":!0})},r.default.createElement(l,{event:n}),r.default.createElement(p,{event:n})),u=r.default.createElement("div",{className:"folder-history-event-card__border"},r.default.createElement(t.CardAvatar,{actor:n.actor,toBeRolledBack:this.props.willRewindEvent}),c);return u=this.props.isLink?r.default.createElement("a",{onClick:this.onClickOnEvent,href:this.props.event.browseHref.toString()},u):r.default.createElement("button",{className:d.default({"include-in-rewind":!this.props.willRewindEvent,"event-text-faded":this.props.isFaded}),onClick:this.onClickOnEvent},u),r.default.createElement("div",{onMouseOver:this.handleMouseOver,onMouseLeave:this.handleMouseOut,className:d.default({"folder-history-event-card":!0,"folder-history-event-card-border-hover":!o,"folder-history-event-card-show-border":this.props.isSelected&&!o})},r.default.createElement(t.CardDividerLine,a.__assign({},s)),u,r.default.createElement(t.CardDividerLine,a.__assign({},i)))},n})(r.default.Component);t.FolderHistoryEventCard=c}),define("modules/clean/react/delorean/components/folder_history/folder_history_header",["require","exports","tslib","react"],function(e,t,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),t.FolderHistoryEventHeader=function(e){return r.default.createElement("div",{className:"folder-history-event-header"},r.default.createElement("div",null,e.segmentName))}}),define("modules/clean/react/delorean/components/folder_history/folder_history_skeleton",["require","exports","tslib","react","external/classnames","modules/clean/react/delorean/constants"],function(e,t,a,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importDefault(n);var s;(function(e){e[e.Avatar=0]="Avatar",e[e.Heading=1]="Heading",e[e.Subheading=2]="Subheading"})(s||(s={}));var i=function(e){var t=e.type,a=e.animated,o=a&&t!==s.Avatar,i=n.default({"folder-history-skeleton__skeleton-card":!0,"folder-history-skeleton__avatar":t===s.Avatar,"folder-history-skeleton__heading":t===s.Heading,"folder-history-skeleton__subheading":t===s.Subheading});return r.default.createElement("div",{className:i},o&&r.default.createElement("div",{className:"folder-history-skeleton__glint"}))},d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return r.default.createElement("div",{className:"folder-history-event-card folder-history-event-skeleton"},r.default.createElement("div",{className:"folder-history-event-card__border"},r.default.createElement("div",{className:"folder-history-event-card__avatar-container"},r.default.createElement(i,{type:s.Avatar,animated:this.props.animated})),r.default.createElement("div",{className:"folder-history-event-card__card-text"},r.default.createElement("div",{className:"folder-history-event-card__card-heading"},r.default.createElement(i,{type:s.Heading,animated:this.props.animated})),r.default.createElement("div",{className:"folder-history-event-card__card-subheading"},r.default.createElement(i,{type:s.Subheading,animated:this.props.animated})))))},t})(r.default.PureComponent),l=(function(e){function t(t){var a=e.call(this,t)||this;return a.setRef=function(e){a.element=e},a.state={height:o.SKELETON.DEFAULT_HEIGHT},a}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.setState({height:this.element&&this.element.clientHeight||o.SKELETON.DEFAULT_HEIGHT})},t.prototype.render=function(){for(var e=o.SKELETON.CARD_HEIGHT,t=Math.ceil(this.state.height/e),a=[],n=0;n<t;n++)a.push(r.default.createElement(d,{animated:this.props.animated}));return r.default.createElement("div",{className:"folder-history-skeleton",ref:this.setRef},a)},t})(r.default.PureComponent);t.FolderHistoryEventCardsSkeleton=l}),define("modules/clean/react/delorean/components/rewind",["require","exports","tslib","react","modules/clean/react/delorean/components/rewind_nux","modules/clean/react/delorean/data/types","modules/clean/react/delorean/components/rewind_graph_page","modules/clean/react/delorean/components/rewind_confirmation_page","modules/clean/react/delorean/components/rewind_started","modules/clean/react/delorean/components/rewind_activity_list_page","modules/clean/react/delorean/components/rewind_upsell_page"],function(e,t,a,r,n,o,s,i,d,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r);var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.renderNUXPage=function(){return r.default.createElement(n.RewindNUX,{versionHistoryLength:this.props.userVersionHistoryLength,user:this.props.user,restoreId:this.props.restorationsLoggingId,dispatch:this.props.dispatch,expRewindUpsell:o.UpsellVariant.OFF})},t.prototype.renderGraphPage=function(e){return r.default.createElement(s.RewindGraphPage,{user:this.props.user,fqpath:this.props.fqpath,page:e,dispatch:this.props.dispatch,events:this.props.events,restoreId:this.props.restorationsLoggingId})},t.prototype.renderConfirmationPage=function(e){if(e.eventBelowDivider&&e.eventAboveDivider){var t=void 0;return t="loaded"===this.props.graphPage.contents.type?this.props.graphPage.contents.data:[],r.default.createElement(i.RewindConfirmationPage,{user:this.props.user,fqpath:this.props.fqpath,eventToDisplay:e.eventBelowDivider,eventToRewindTo:e.eventAboveDivider,folderName:this.props.folderName,dispatch:this.props.dispatch,page:e,graphPage:this.props.graphPage,restoreId:this.props.restorationsLoggingId,eventCounts:t})}return null},t.prototype.renderStartedPage=function(e){return r.default.createElement(d.RewindStarted,{user:this.props.user,folderName:this.props.folderName,page:e,dispatch:this.props.dispatch,rewindState:e.rewindState,restoreId:this.props.restorationsLoggingId,closePanel:this.props.closePanel})},t.prototype.renderActivityListPage=function(e){return r.default.createElement(l.RewindActivityListPage,{dispatch:this.props.dispatch,user:this.props.user,fqpath:this.props.fqpath,browseContext:this.props.browseContext,events:this.props.events,pageData:e,restoreId:this.props.restorationsLoggingId})},t.prototype.renderUpsellPage=function(e){return r.default.createElement(p.RewindUpsellPage,{user:this.props.user,restoreId:this.props.restorationsLoggingId})},t.prototype.render=function(){switch(this.props.data.page){case o.RewindFlowPage.notVisible:return null;case o.RewindFlowPage.NUXPage:return this.renderNUXPage();case o.RewindFlowPage.confirmationPage:return this.renderConfirmationPage(this.props.data);case o.RewindFlowPage.graphPage:return this.renderGraphPage(this.props.data);case o.RewindFlowPage.activityListPage:return this.renderActivityListPage(this.props.data);case o.RewindFlowPage.startedPage:return this.renderStartedPage(this.props.data);case o.RewindFlowPage.upsellPage:return this.renderUpsellPage(this.props.data)}},t})(r.default.PureComponent);t.Rewind=c}),define("modules/clean/react/delorean/components/rewind_graph/graph",["require","exports","tslib","modules/clean/react/delorean/util","modules/clean/react/delorean/constants","external/lodash"],function(e,t,a,r,n,o){"use strict";function s(e,t,a){var r=parseInt(e.replace(/#/g,""),16),n=parseInt(t.replace(/#/g,""),16),o=r>>16,s=n>>16,i=r>>8&255,d=n>>8&255,l=255&r;return"#"+((1<<24)+(o+a*(s-o)<<16)+(i+a*(d-i)<<8)+(l+a*((255&n)-l))|0).toString(16).slice(1)}Object.defineProperty(t,"__esModule",{value:!0}),o=a.__importStar(o),t.lerpColor=s;var i=(function(){function e(e){var t=this;this.disposed=!1,this.shapes=[],this.animationTick=0,this.addLine=function(e){return t.shapes.push(e),e},this.addSpline=function(e){return t.shapes.push(e),e},this.addGradient=function(e){return t.shapes.push(e),e},this.renderCanvas=function(){if(window.requestAnimationFrame(t.renderCanvas),!t.invisible){t.context.save(),t.animationTick++,t.context.clearRect(0,0,t.width,t.height);for(var e=0,a=t.shapes;e<a.length;e++){var r=a[e];if(!r.invisible){if(t.context.save(),r.clip){var n=r.clip,o=n.topLeft,s=n.size;t.context.beginPath(),t.context.rect(o.x,o.y,s.x,s.y),t.context.clip()}t.renderShape(r),t.context.restore()}}t.context.restore()}},this.renderShape=function(e){return"line"===e.type?t.renderLine(e):"spline"===e.type?t.renderSpline(e):"gradient"===e.type?t.renderGradient(e):r.assertNever(e)},this.getColorValue=function(e){return"solid"===e.type?e.value:"pulse"===e.type?s(e.start,e.end,(Math.sin(t.animationTick/20)+1)/2):r.assertNever(e)},this.renderLine=function(e){if(t.context.beginPath(),t.context.strokeStyle=t.getColorValue(e.color),t.context.lineWidth=n.DEFAULT_GRAPH_LINE_WIDTH,e.dashed)if("pulsing"===e.dashed){var a=5*((Math.sin(t.animationTick/20)+1)/2);t.context.lineDashOffset=a,t.context.setLineDash([10-a,a])}else"solid"===e.dashed?t.context.setLineDash([4,4]):r.assertNever(e.dashed);t.context.moveTo(e.start.x,e.start.y),t.context.lineTo(e.end.x,e.end.y),t.context.stroke()},this.renderSpline=function(e){var a=n.DEFAULT_GRAPH_LINE_WIDTH;t.context.beginPath(),t.addGraphPathToContext(e.points,a),t.context.strokeStyle=t.getColorValue(e.color),t.context.lineWidth=a,t.context.stroke()},this.renderGradient=function(e){var a=n.DEFAULT_GRAPH_LINE_WIDTH;t.context.beginPath(),t.context.moveTo(0,t.height),t.addGraphPathToContext(e.points,a),t.context.lineTo(t.width,t.height),t.context.closePath(),t.context.clip();var r=t.context.createLinearGradient(0,0,0,t.height);!!window.MSInputMethodContext&&!!document.documentMode||(r.addColorStop(0,t.getColorValue(e.startColor)),r.addColorStop(1,t.getColorValue(e.endColor)),t.context.fillStyle=r,t.context.fillRect(0,0,t.width,t.height))},this.dispose=function(){t.disposed=!0,t.shapes=[]};var a=e.width,o=e.height,i=e.canvas,d=e.invisible;this.canvas=i,this.context=i.getContext("2d"),this.width=a,this.height=o,this.invisible=d,this.context&&(this.context.translate(.5,.5),i.style.width=a+"px",i.style.height=o+"px",i.width=a*window.devicePixelRatio,i.height=o*window.devicePixelRatio,this.context.scale(window.devicePixelRatio,window.devicePixelRatio),window.requestAnimationFrame(this.renderCanvas))}return e.prototype.addGraphPathToContext=function(e,t){var a=[];e=[e[0],e[0]].concat(e,[e[e.length-1]]);for(var r=o.maxBy(e,function(e){return e.y}).y,n=o.minBy(e,function(e){return e.y}).y+t,s=2;s<e.length-2;s++)for(var i=0;i<=16;i++){var d=.5*(e[s+1].x-e[s-1].x),l=.5*(e[s+2].x-e[s].x),p=.5*(e[s+1].y-e[s-1].y),c=.5*(e[s+2].y-e[s].y),u=i/16,h=2*Math.pow(u,3)-3*Math.pow(u,2)+1,g=-(2*Math.pow(u,3))+3*Math.pow(u,2),f=Math.pow(u,3)-2*Math.pow(u,2)+u,v=Math.pow(u,3)-Math.pow(u,2),m=h*e[s].x+g*e[s+1].x+f*d+v*l,_=h*e[s].y+g*e[s+1].y+f*p+v*c;_>r&&(_=r),_<n&&(_=n),a.push({x:m,y:_})}for(var s=1;s<a.length;s++)this.context.lineTo(a[s].x,a[s].y)},e})();t.Graph=i}),define("modules/clean/react/delorean/components/rewind_graph/rewind_graph_buttons",["require","exports","tslib","react","spectrum/button","modules/clean/components/loading_indicator","modules/core/i18n","modules/clean/react/delorean/util","modules/clean/datetime"],function(e,t,a,r,n,o,s,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),t.GraphForwardButton=function(e){var t=e.canNavigate,a=e.daysForward,l=e.loading,p=e.onNavigateOneWeekForward,c=e.disabled;return t?r.default.createElement(n.Button,{"aria-label":s._("Go forward one week"),variant:"borderless",className:"rewind-graph-nav__btn",disabled:c,onClick:c?void 0:p},l&&r.default.createElement(o.LoadingIndicator,{style:"blue_spinner"}),i.formatWithShortDateName(d.increment_date(new Date,0,0,1-a))," ›"):r.default.createElement(n.Button,{disabled:!0,variant:"borderless"},s._("Today"))},t.GraphBackwardButton=function(e){var t=e.canNavigate,a=e.daysBackward,l=e.loading,p=e.onNavigateOneWeekBack,c=e.disabled;return t?r.default.createElement(n.Button,{"aria-label":s._("Go back one week"),variant:"borderless",className:"rewind-graph-nav__btn",disabled:c,onClick:c?void 0:p},"‹ ",i.formatWithShortDateName(d.increment_date(new Date,0,0,-a)),l&&r.default.createElement(o.LoadingIndicator,{style:"blue_spinner"})):r.default.createElement("span",null," ")}}),define("modules/clean/react/delorean/components/rewind_graph/rewind_graph_component",["require","exports","tslib","external/lodash","external/classnames","react","modules/clean/react/delorean/constants","modules/clean/react/delorean/components/rewind_graph/graph","modules/clean/react/delorean/components/rewind_graph/rewind_graph_buttons","modules/clean/react/delorean/components/rewind_graph/rewind_graph_fallback"],function(e,t,a,r,n,o,s,i,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),n=a.__importDefault(n),o=a.__importDefault(o);var p={BLUE:"#0070e0",GRAY:"#ddddfe1",MEDIUM_GRAY:"#d2d2d2",LIGHT_GRAY:"#e6e8eb",DATE_LINE_GRAY:"#eeeeee",DATE_LINE_BLUE:"#97caff"},c={start:"#eeeeee",end:"#97caff",type:"pulse"},u=function(e){return"before graph"!==e&&"after graph"!==e&&void 0!==e},h=(function(e){function t(t){var a=e.call(this,t)||this;return a.dateLines=[],a.createGraph=function(){a.graph&&a.graph.dispose(),a.graph=new i.Graph({width:a.props.width,height:a.props.height,canvas:a.canvasRef,invisible:!a.props.hasData}),a.graph.addLine({type:"line",start:{x:0,y:a.props.height},end:{x:a.props.width,y:a.props.height},color:{value:p.LIGHT_GRAY,type:"solid"}}),a.graph.addLine({type:"line",start:{x:0,y:0},end:{x:a.props.width,y:0},color:{value:p.LIGHT_GRAY,type:"solid"}});var e=a.getNormalizedPoints(a.props.data);a.blueGradient=a.graph.addGradient({type:"gradient",points:e,startColor:{value:"rgba(0, 119, 237, 0.16",type:"solid"},endColor:{value:"rgba(0, 121, 242, 0.04",type:"solid"}}),a.grayGradient=a.graph.addGradient({type:"gradient",points:e,startColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"},endColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"}}),a.dateLines=e.map(function(e){var t=e.x;return a.graph.addLine({type:"line",start:{x:t,y:0},end:{x:t,y:a.props.height},color:{value:p.LIGHT_GRAY,type:"solid"},dashed:"solid"})}),a.blueSpline=a.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:p.BLUE}}),a.graySpline=a.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:p.LIGHT_GRAY}}),a.selectedLine=a.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:a.props.height},color:{type:"solid",value:p.BLUE},invisible:!0}),a.hoveredLine=a.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:a.props.height},color:{type:"solid",value:p.BLUE},dashed:"pulsing",invisible:!0})},a.createEmptyGraph=function(){a.emptyGraph&&a.emptyGraph.dispose(),a.emptyGraph=new i.Graph({width:a.props.width,height:a.props.height,canvas:a.canvasRef,invisible:a.props.hasData}),a.emptyGraph.addLine({type:"line",start:{x:0,y:a.props.height},end:{x:a.props.width,y:a.props.height},color:{value:p.LIGHT_GRAY,type:"solid"}}),a.emptyGraph.addLine({type:"line",start:{x:0,y:0},end:{x:a.props.width,y:0},color:{value:p.LIGHT_GRAY,type:"solid"}})},a.updateGraph=function(){var e=a.getSelectedPoint();if(a.graph&&a.emptyGraph&&(a.graph.invisible=!a.props.hasData,a.emptyGraph.invisible=a.props.hasData,a.props.hasData)){for(var t=!a.state.isHovered&&void 0!==e&&"before graph"!==e&&"after graph"!==e,r=0,n=a.dateLines;r<n.length;r++){var o=n[r];a.state.isHovered||void 0!==e?o.color={type:"solid",value:p.LIGHT_GRAY}:o.color=c,o.invisible=t}var s,i=a.getSelectedPoint()||a.state.hoveredPoint;s="after graph"===i?a.props.width:void 0===i||"before graph"===i?0:i.x;var d={topLeft:{x:0,y:0},size:{x:s,y:a.props.height}},l={topLeft:{x:s,y:0},size:{x:a.props.width,y:a.props.height}};a.blueGradient.clip=d,a.blueSpline.clip=d,a.grayGradient.clip=l,a.graySpline.clip=l;var h=a.state.hoveredPoint;a.hoveredLine.invisible=!h,h&&(a.hoveredLine.start.x=h.x,a.hoveredLine.end.x=h.x),a.selectedLine.invisible=!u(e),e&&u(e)&&(a.selectedLine.start.x=e.x,a.selectedLine.end.x=e.x)}},a.updateRef=function(e){e&&(a.canvasRef=e,a.createGraph(),a.createEmptyGraph())},a.onMouseMove=function(e){var t=e.currentTarget.getBoundingClientRect(),n=e.clientX-t.left,o=r.minBy(a.getNormalizedPoints(a.props.data),function(e){return Math.abs(e.x-n)});a.setState({hoveredPoint:o})},a.setDateRef=function(e){a.dateRef=e},a.onClick=function(){a.state.hoveredPoint&&a.props.onSelectDate(a.state.hoveredPoint.event.dateTsInMs,a.state.hoveredPoint.event.dateString)},a.onMouseOver=function(){a.setState({isHovered:!0}),a.props.onHover(!0)},a.onMouseOut=function(e){a.setState({isHovered:!1,hoveredPoint:void 0}),a.props.onHover(!1)},a.navigateOneWeekBack=function(){a.props.onNavigateOneWeekBack()},a.navigateOneWeekForward=function(){a.props.onNavigateOneWeekForward()},a.state={hoveredPoint:void 0,isHovered:!1},a}return a.__extends(t,e),t.prototype.componentWillUpdate=function(e){var t=this.getNormalizedPoints(e.data);this.blueSpline.points=t,this.graySpline.points=t,this.blueGradient.points=t,this.grayGradient.points=t},t.prototype.getSelectedPoint=function(){var e=this,t=this.getNormalizedPoints(this.props.data);if(void 0!==this.props.selectedPointMs){var a=this.getNormalizedPoints(this.props.data).find(function(t){return t.event.dateTsInMs===e.props.selectedPointMs});return a?a:this.props.selectedPointMs<t[0].event.dateTsInMs?"before graph":this.props.selectedPointMs>t[t.length-1].event.dateTsInMs?"after graph":void 0}},t.prototype.getNormalizedPoints=function(e){var t=this,a=e.map(function(e,t){return{eventCount:e,x:t,y:e.count}}),n=r.minBy(a,function(e){return e.x}).x,o=r.maxBy(a,function(e){return e.x}).x,i=r.minBy(a,function(e){return e.y}).y,d=r.maxBy(a,function(e){return e.y}).y;return 0===o&&(o=1),0===d&&(d=1),a.map(function(e){var a=e.x,r=e.y,l=e.eventCount,p=(a-n)/o,c=(r-i)/d;return{x:p*t.props.width,y:t.props.height-Math.max(s.GRAPH_BOTTOM_PADDING,c*t.props.height),event:l}})},t.prototype.render=function(){var e=this.state.hoveredPoint?this.state.hoveredPoint.event.dateString:"";this.updateGraph();var t=0;return this.state.hoveredPoint&&(t=this.state.hoveredPoint.x-s.DATE_LABEL_WIDTH/2,t<0&&(t=0),t>this.props.width-s.DATE_LABEL_WIDTH&&(t=this.props.width-s.DATE_LABEL_WIDTH)),o.default.createElement("div",null,o.default.createElement("div",{style:{paddingLeft:t+"px"}},this.props.hasData?o.default.createElement("div",{ref:this.setDateRef,className:"rewind-graph-date-label"},e):o.default.createElement("div",{className:"rewind-graph-date-label-spacer"})),o.default.createElement("canvas",{width:this.props.width,height:this.props.height,className:n.default({"rewind-graph-canvas":!0,"no-data":!this.props.hasData}),ref:this.updateRef,onMouseMove:this.props.hasData?this.onMouseMove:void 0,onClick:this.props.hasData?this.onClick:void 0,onMouseOver:this.props.hasData?this.onMouseOver:void 0,onMouseOut:this.props.hasData?this.onMouseOut:void 0},o.default.createElement(l.RewindGraphAccessibilityText,{data:this.props.data,onSelectDate:this.props.onSelectDate})),o.default.createElement("div",{className:"rewind-graph-nav"},o.default.createElement(d.GraphBackwardButton,{daysBackward:this.props.graphStartOffset,canNavigate:this.props.canNavigateBackward,onNavigateOneWeekBack:this.navigateOneWeekBack,loading:this.props.loadingPreviousWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek}),o.default.createElement(d.GraphForwardButton,{daysForward:this.props.graphEndOffset,canNavigate:this.props.canNavigateForward,
onNavigateOneWeekForward:this.navigateOneWeekForward,loading:this.props.loadingNextWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek})))},t})(o.default.PureComponent);t.RewindGraphComponent=h}),define("modules/clean/react/delorean/components/rewind_graph_page",["require","exports","tslib","react","modules/core/i18n","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/actions","modules/clean/react/delorean/components/rewind_graph/rewind_graph_component","modules/clean/react/delorean/constants","modules/clean/react/delorean/util","modules/clean/react/delorean/components/rewind_step_header","modules/clean/react/delorean/components/rewind_continue_widget","modules/clean/components/loading_indicator","modules/clean/react/delorean/logging","modules/core/browser","external/classnames"],function(e,t,a,r,n,o,s,i,d,l,p,c,u,h,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),h=a.__importStar(h),g=a.__importStar(g),f=a.__importDefault(f);var v=(function(e){function t(t){var a=e.call(this,t)||this;return a.isContinueWidgetVisible=function(){return"loaded"===a.props.page.contents.type&&void 0!==a.props.page.contents.selectedDateTsInMs},a.onSelectDate=function(e,t){var r=a.props,n=r.user,s=r.restoreId;a.props.dispatch({type:o.DeloreanActionType.setRewindPanelSelectedDate,selectedDateString:t,selectedDateTsInMs:e}),h.clickDayGraphDate({user:n,restoreId:s,selectedDateTsInMs:e})},a.onContinue=function(){var e=a.props,t=e.user,r=e.restoreId,n=a.props.page;if("loaded"===n.contents.type&&n.contents.selectedDateString&&n.contents.selectedDateTsInMs){var s=n.contents,i=s.selectedDateString,d=s.selectedDateTsInMs;h.clickDayGraphNext({user:t,restoreId:r,selectedDateTsInMs:d}),a.props.dispatch({type:o.DeloreanActionType.changeRewindPageToActivityListPage,selectedDateTsInMs:d,selectedDateString:i})}},a.navigateOneWeekBack=function(){a.props.dispatch(s.fetchEventCountsAction({user:a.props.user,fqpath:a.props.fqpath,startDaysBack:a.props.page.graphStartOffset+d.REWIND_GRAPH_DAY_STEP,endDaysBack:a.props.page.graphEndOffset+d.REWIND_GRAPH_DAY_STEP,graphPositionChange:"backward"}))},a.navigateOneWeekForward=function(){a.props.dispatch(s.fetchEventCountsAction({user:a.props.user,fqpath:a.props.fqpath,startDaysBack:a.props.page.graphStartOffset-d.REWIND_GRAPH_DAY_STEP,endDaysBack:a.props.page.graphEndOffset-d.REWIND_GRAPH_DAY_STEP,graphPositionChange:"forward"}))},a.onHover=function(e){a.setState({isHovering:e})},a.onContactSupport=function(){g.open_tab("https://www.dropbox.com/support")},a.startedLoadingTimestamp=Date.now(),a.state={isHovering:!1},a}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.props.dispatch(s.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset,endDaysBack:this.props.page.graphEndOffset,graphPositionChange:"none"}))},t.prototype.componentDidUpdate=function(e){var t=this.props,a=t.user,r=t.restoreId,n=this.startedLoadingTimestamp;if("loaded"!==e.page.contents.type&&"loaded"===this.props.page.contents.type){var o=this.props.page.contents.namespaceCount;h.loadDayGraph({user:a,restoreId:r,startedLoadingTimestamp:n,namespaceCount:o})}"error"!==e.page.contents.type&&"error"===this.props.page.contents.type&&h.loadDayGraph({user:a,restoreId:r,startedLoadingTimestamp:n,namespaceCount:0,errorString:this.props.page.contents.errorString})},t.prototype.renderGraphSection=function(){if("initial-load"===this.props.page.contents.type)return r.default.createElement("div",{className:"rewind-graph-panel-container"},r.default.createElement("div",{className:"folder-history-event-list__empty-text"},r.default.createElement(u.LoadingIndicator,{className:"rewind-started-spinner",style:"blue_spinner"})," ",n._("Just a sec…",{project:"folder-history"})));if("error"===this.props.page.contents.type)return r.default.createElement("div",{className:"rewind-graph-panel-container"},r.default.createElement("div",{className:"folder-history-event-list__empty-text"},n._("There were too many changes for us to display, but we can still help you rewind.",{project:"folder-history"})," ",r.default.createElement("a",{href:"#",onClick:this.onContactSupport},n._("Contact support"))));if("loaded"===this.props.page.contents.type){var e=this.props.page,t=e.contents.data,a=e.graphStartOffset,o=e.graphEndOffset,s=t.slice(t.length-a,t.length-o),p=this.props.page.contents.data.length-1-(this.props.page.graphStartOffset-1),c=!this.props.page.contents.data[p].outsideHistoryCutoff,h=this.props.page.graphEndOffset>0,g=this.props.page.contents.hasDataThisWeek;return r.default.createElement("div",{className:"rewind-graph-panel-container"},g?r.default.createElement("span",null):r.default.createElement("div",{className:"rewind-graph-no-activity"},r.default.createElement("div",{className:"rewind-graph-no-activity__text"},n._("No activity for the selected week"))),r.default.createElement("div",{className:f.default({"rewind-graph-canvas-and-button":!0,"no-data":!g})},r.default.createElement(i.RewindGraphComponent,{onSelectDate:this.onSelectDate,selectedPointMs:this.props.page.contents.selectedDateTsInMs,data:s,hasData:g,width:d.GRAPH_WIDTH,height:d.GRAPH_HEIGHT,onNavigateOneWeekBack:this.navigateOneWeekBack,onNavigateOneWeekForward:this.navigateOneWeekForward,canNavigateForward:h,canNavigateBackward:c,graphStartOffset:this.props.page.graphStartOffset,graphEndOffset:this.props.page.graphEndOffset,loadingNextWeek:this.props.page.contents.loadingNextWeek,loadingPreviousWeek:this.props.page.contents.loadingPreviousWeek,onHover:this.onHover})))}return l.assertNever(this.props.page.contents)},t.prototype.getGraphTitle=function(){if("loaded"===this.props.page.contents.type&&!this.props.page.contents.selectedDateTsInMs&&this.state.isHovering)return n._("Right before a spike is a good place to start",{project:"folder-history",comment:"Spike refers to the top of a graph. Keep in mind space is tight here."});var e=Math.floor(this.props.page.graphEndOffset/7);return 0===e?n._("Activity: this week",{project:"folder-history"}):1===e?n._("Activity: last week",{project:"folder-history"}):n.ungettext("Activity: %(weeks)d weeks ago","Activity: %(weeks)d weeks ago",e,{project:"folder-history"}).format({weeks:e})},t.prototype.render=function(){return r.default.createElement("div",{className:"folder-history-ie11fix"},r.default.createElement("div",{className:"rewind-graph-panel"},r.default.createElement(p.RewindStepHeader,{currentStep:1,maxStep:d.NUM_REWIND_STEPS,instructions:n._("Pick a day to get started",{project:"folder-history"}),onGoBack:l.noop}),r.default.createElement("div",{className:"rewind-graph-desc"},this.getGraphTitle()),this.renderGraphSection(),r.default.createElement(c.RewindContinueWidget,{onContinue:this.onContinue,visible:this.isContinueWidgetVisible(),text:n._("Now, let’s zoom in",{project:"folder-history",comment:"Try to keep it short"})})))},t})(r.default.PureComponent);t.RewindGraphPage=v}),define("modules/clean/react/delorean/components/rewind_nux",["require","exports","tslib","react","modules/core/browser","modules/core/i18n","modules/clean/static_urls","spectrum/button","modules/clean/react/delorean/logging","modules/clean/react/delorean/data/actions","modules/clean/react/trash/restorations_education"],function(e,t,a,r,n,o,s,i,d,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importStar(n),d=a.__importStar(d);var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.goToHelpCenter=function(){var e=t.props,a=e.user,r=e.restoreId;d.clickNUXHelp({user:a,restoreId:r}),n.unsafe_open_tab("https://help.dropbox.com/security/rewind")},t.onDismiss=function(){var e=t.props,a=e.user,r=e.restoreId;d.clickNUXNext({user:a,restoreId:r}),t.props.dispatch(l.dismissNUXAction())},t}return a.__extends(t,e),t.prototype.render=function(){var e;return e=this.props.versionHistoryLength?o._("When a lot went wrong, undo everything by going back to any time in the last %(version_history_length)d days.",{project:"folder-history"}).format({version_history_length:this.props.versionHistoryLength}):o._("When a lot went wrong, undo everything by going back to any time in the past.",{project:"folder-history"}),r.default.createElement("div",{className:"rewind-nux"},r.default.createElement("div",{className:"rewind-text"},r.default.createElement("div",{className:"rewind-text__image"},r.default.createElement("img",{alt:"",src:s.static_url("/static/images/delorean/illo-folders@2x-vflmf44mp.png")})),r.default.createElement("div",{className:"rewind-text__title rewind-nux__title"},o._("Rewind to a previous time",{project:"folder-history",comment:"Rewind is used as a verb"})),r.default.createElement("div",{className:"rewind-text__text"},e),r.default.createElement(i.Button,{className:"rewind-text__button",onClick:this.onDismiss},o._("Get started",{project:"folder-history"})),r.default.createElement("a",{href:"#",className:"rewind-text__centered-link",onClick:this.goToHelpCenter},o._("How Rewind works",{project:"folder-history"}))),r.default.createElement(p.RestorationOptions,{deletedFile:!0,olderFileVersion:!0,expRewindUpsell:this.props.expRewindUpsell,user:this.props.user}))},t})(r.default.Component);t.RewindNUX=c}),define("modules/clean/react/delorean/components/rewind_title",["require","exports","tslib","react","modules/clean/react/sprite","modules/clean/react/delorean/constants","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,a,r,n,o,s,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r);var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clickClosePanel=function(){t.props.closePanel({closedByClick:!0})},t}return a.__extends(t,e),t.prototype.getTitle=function(){var e=this.props,t=e.expFolderHistoryRollbacks,a=e.expTimeline,r=e.context;return!t&&a?i._("Folder history",{project:"folder-history"}):r.isCurrentlyInRoot?i._("Rewind Dropbox",{project:"folder-history"}):i._("Rewind %(folder)s",{project:"folder-history"}).format({folder:this.props.folderDisplayName})},t.prototype.render=function(){return r.default.createElement("section",{className:"rewind-title"},r.default.createElement("div",{className:"rewind-title__header"},r.default.createElement("div",{className:"rewind-title__header-text"},this.getTitle()),r.default.createElement(s.TitleBubble,{content:i._("Close",{project:"folder-history"}),position:s.TitleBubble.POSITIONS.LEFT,distanceFromTarget:o.BUBBLE_DISTANCE},r.default.createElement(n.Sprite,{onClick:this.clickClosePanel,className:"rewind-title__back",group:"web",name:"s_sidebar_hide",alt:i._("Close Sidebar",{project:"folder-history"})}))))},t})(r.default.Component);t.RewindTitle=d}),define("modules/clean/react/delorean/components/rewind_upsell_page",["require","exports","tslib","react","modules/core/browser","modules/core/i18n","modules/clean/static_urls","spectrum/button","modules/clean/react/delorean/logging"],function(e,t,a,r,n,o,s,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importStar(n),d=a.__importStar(d);var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){d.clickUpsell({user:t.props.user,restoreId:t.props.restoreId}),n.open_tab("https://www.dropbox.com/upgrade?_tk=rewind_panel_upgrade")},t.goToHelpCenter=function(){d.clickUpsellHelp({user:t.props.user,restoreId:t.props.restoreId}),n.open_tab("https://help.dropbox.com/security/rewind")},t}return a.__extends(t,e),t.prototype.render=function(){return r.default.createElement("div",{className:"rewind-upsell"},r.default.createElement("div",{className:"rewind-text"},r.default.createElement("div",{className:"rewind-upsell__image"},r.default.createElement("img",{alt:"",src:s.static_url("/static/images/delorean/illo-upsell@1x-vflKV6aIU.png")})),r.default.createElement("div",{className:"rewind-text__title rewind-upsell__title"},o._("Rewind to a previous time",{project:"folder-history"})),r.default.createElement("div",{className:"rewind-text__text"},o._("When a lot goes wrong, Dropbox Rewind can help you undo it all. That way you can get back to the way things were.",{project:"folder-history",comment:"Dropbox Rewind is the proper noun product name"})),r.default.createElement(i.Button,{variant:"primary",className:"rewind-upsell__button",onClick:this.onClick},o._("Get Rewind",{project:"folder-history",comment:"Takes user to an upgrade page, which shows different plans and also provides some information about what Rewind is."})),r.default.createElement("a",{href:"#",className:"rewind-text__centered-link",onClick:this.goToHelpCenter},o._("How Rewind works",{project:"folder-history",comment:"Takes user to a help page which explains how to use Rewind."}))))},t})(r.default.PureComponent);t.RewindUpsellPage=l}),define("modules/clean/react/delorean/constants",["require","exports","modules/clean/react/browse/constants"],function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUBBLE_DISTANCE=10,t.API_TIMESTAMP_NOW=0,t.SKELETON={CARD_HEIGHT:91,DEFAULT_HEIGHT:500},t.FOLDER_HISTORY_SKELETON_DEFAULT_HEIGHT=500,t.FolderHistoryEventHeaderHeight=32,t.GRAPH_WIDTH=315,t.GRAPH_HEIGHT=192,t.DEFAULT_GRAPH_LINE_WIDTH=2,t.GRAPH_BOTTOM_PADDING=20,t.DATE_LABEL_WIDTH=80,t.SECRET_OPTIN_NUMBER="-446774400",t.REWIND_GRAPH_DAY_STEP=7,t.API_VERSION=2,t.ONE_DAY_MS=864e5,t.TEMPORARY_UVH_LENGTH=180,t.LOADING_PAGE_POLLING_LENGTH_MS=5e3,t.NUM_REWIND_STEPS=3,t.FOLDER_HISTORY_QUERY_PARAM=a.BrowseQueryArg.activity,t.REWIND_QUERY_PARAM=a.BrowseQueryArg.rewind}),define("modules/clean/react/delorean/data/actions",["require","exports","tslib","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/api","modules/clean/viewer","modules/clean/react/delorean/data/selectors","modules/clean/react/delorean/util","modules/clean/react/delorean/constants"],function(e,t,a,r,n,o,s,i,d){"use strict";function l(){var e=this;return function(t){return a.__awaiter(e,void 0,void 0,function(){return a.__generator(this,function(e){return t({type:r.DeloreanActionType.dismissNUX}),t({type:r.DeloreanActionType.changeRewindPageToGraphPage}),[2]})})}}function p(e){var t=this;return function(o,s){return a.__awaiter(t,void 0,void 0,function(){var t,s,l,p,c,u,h,g,f,v,m,_,y,w,P,D,E,R,b,T,x,N,S,C,k;return a.__generator(this,function(a){switch(a.label){case 0:t=e.startDaysBack,s=e.endDaysBack,l=e.user,p=e.fqpath,c=e.graphPositionChange,u=new Date,h=new Date,h.setDate(h.getDate()-t-1),h.setHours(0,0,0,0),u.setDate(u.getDate()+1-s),u.setHours(0,0,0,0),"none"!==c&&o({type:r.DeloreanActionType.setLoadingGraphWeek,graphPositionChange:c}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n.fetchEventCounts({user:l,fqpath:p,startDate:h,endDate:u,aggregation:"daily"})];case 2:return g=a.sent(),[3,4];case 3:return f=a.sent(),o({type:r.DeloreanActionType.setRewindEventCountsError,errorString:f.toString()}),[2];case 4:for(v=[],m=new Date,_=0,y=g.counts;_<y.length;_++)w=y[_],P=w.count,D=w.start_ts,E=w.outside_history_cutoff,R=1e3*D,b=new Date(R),T=i.formatWithShortDateName(b),b>m||v.push({dateString:T,count:P,dateTsInMs:R,outsideHistoryCutoff:E});return o({type:r.DeloreanActionType.loadEventCounts,eventCounts:v,namespaceCount:g.namespace_count||0,changedNamespaceCount:g.changed_namespace_count||0}),"forward"===c?(x=d.REWIND_GRAPH_DAY_STEP,N=i.floorDate(new Date),S=i.findIndex(v,function(e){return i.floorDate(new Date(e.dateTsInMs))>=N}),void 0!==S&&(x=Math.max(S-1,0)),o({type:r.DeloreanActionType.setGraphRangeForward,length:x})):"backward"===c?(C=i.findLastIndex(v,function(e){return e.outsideHistoryCutoff}),k=d.REWIND_GRAPH_DAY_STEP,void 0!==C&&(k=v.length-C),o({type:r.DeloreanActionType.setGraphRangeBack,length:k})):"none"===c||i.assertNever(c),o({type:r.DeloreanActionType.setGraphLoadFinished}),[2]}})})}}function c(e){var t=this;return function(o,s){return a.__awaiter(t,void 0,void 0,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return[4,n.fetchEventsApi(e)];case 1:return t=a.sent(),o({type:r.DeloreanActionType.setEventsLoaded,events:t.events||[],user:e.user,direction:e.direction,cursor:t.cursor?{type:"has-cursor",cursor:t.cursor}:{type:"reached-end"},hasMore:t.has_more||!1}),e.done&&e.done(),[2]}})})}}function u(e){var t=e.browseContext,a=e.user,n=e.openToRewind;return{type:r.DeloreanActionType.initialize,browseContext:t,user:a,openToRewind:n,viewer:o.Viewer.get_viewer()}}function h(e){var t=this,o=e.direction;return function(i,d){return a.__awaiter(t,void 0,void 0,function(){var t,l,p;return a.__generator(this,function(a){switch(a.label){case 0:return i({type:r.DeloreanActionType.setFolderHistoryPaginationLoading,direction:e.direction}),t=s.getEvents(d()),"processedEvents"in t?(l=t.processedEvents[t.processedEvents.length-1],l.type!==r.DeloreanEventType.event?[2]:[4,n.fetchMoreEventsApi({userId:e.user.id,fqpath:e.fqpath,cursorObj:e.direction===r.PaginationDirection.future?e.futureCursor:e.pastCursor,direction:o})]):[2];case 1:return p=a.sent(),i({type:r.DeloreanActionType.setFolderHistoryPaginationLoaded,user:e.user,events:p.events||[],cursor:p.has_more?{type:"has-cursor",cursor:p.cursor}:{type:"reached-end"},hasMore:p.has_more||!1,direction:o}),e.done&&e.done(p.events?p.events.length:0),[2]}})})}}Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),t.dismissNUXAction=l,t.fetchEventCountsAction=p,t.fetchEventsAction=c,t.initializeDeloreanAction=u,t.showMoreAction=h}),define("modules/clean/react/delorean/data/api",["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/react/delorean/util","modules/clean/react/delorean/data/types","modules/clean/react/delorean/constants","modules/clean/react/snackbar","modules/core/i18n"],function(e,t,a,r,n,o,s,i,d){"use strict";function l(e){return a.__awaiter(this,void 0,Promise,function(){var t,n;return a.__generator(this,function(a){switch(a.label){case 0:t={path:e.fqpath,version:s.API_VERSION,direction:e.direction===o.PaginationDirection.future?{".tag":"future"}:{".tag":"past"},timestamp:e.timestampInSeconds?e.timestampInSeconds:s.API_TIMESTAMP_NOW,filter:{only_rewindable:e.onlyRewindableEvents}},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(new r.UserApiV2Client).ns("chronicle").rpc("list_events",t,{subjectUserId:e.user.id})];case 2:return[2,a.sent()];case 3:throw n=a.sent(),f(n),n;case 4:return[2]}})})}function p(e){return a.__awaiter(this,void 0,Promise,function(){var t,n,i,d;return a.__generator(this,function(a){t=e.cursorObj,n=e.fqpath,i=e.direction,d={cursor:t.cursor,path:n,direction:i===o.PaginationDirection.future?{".tag":"future"}:{".tag":"past"},version:s.API_VERSION};try{return[2,(new r.UserApiV2Client).ns("chronicle").rpc("list_events",d,{subjectUserId:e.userId})]}catch(e){throw f(e),e}return[2]})})}function c(e){var t={path:""===e.path?"/":e.path,target_ts_microseconds:e.targetTsMicroseconds,type:{".tag":"individual"},logging_restore_id:e.restorationsLoggingId.value};return(new r.UserApiV2Client).ns("restorations").rpc("rewinds/start",t,{subjectUserId:e.user.id})}function u(e){return a.__awaiter(this,void 0,Promise,function(){return a.__generator(this,function(t){switch(t.label){case 0:return[4,(new r.UserApiV2Client).ns("restorations").rpc("rewinds/opt_in",void 0,{subjectUserId:e.user.id})];case 1:return[2,t.sent()]}})})}function h(e){return a.__awaiter(this,void 0,Promise,function(){var t;return a.__generator(this,function(a){switch(a.label){case 0:return t={id:e.id},[4,(new r.UserApiV2Client).ns("restorations").rpc("rewinds/status",t,{subjectUserId:e.user.id})];case 1:return[2,a.sent()]}})})}function g(e){return a.__awaiter(this,void 0,Promise,function(){var t,o,i,d,l,p;return a.__generator(this,function(a){switch(a.label){case 0:if(t=e.startDate,o=e.endDate,d=Math.floor(t.getTime()/1e3),l=Math.floor(o.getTime()/1e3),d>l)throw new Error("startTs must come before endTs.");if("hourly"===e.aggregation)i={".tag":"hourly"};else{if("daily"!==e.aggregation)return[2,n.assertNever(e.aggregation)];i={".tag":"daily"}}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(new r.UserApiV2Client).ns("chronicle").rpc("get_event_counts",{path:e.fqpath,start_ts:d,end_ts:l,aggregation:i,version:s.API_VERSION},{subjectUserId:e.user.id})];case 2:return[2,a.sent()];case 3:throw p=a.sent(),f(p),p;case 4:return[2]}})})}function f(e){"unsupported_version"===(e&&e.error&&e.error.err&&e.error.err[".tag"])&&i.Snackbar.fail(d._("Dropbox is out of date. Please refresh your browser.",{project:"folder-history"}),"delorean-unsupported-version")}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchEventsApi=l,t.fetchMoreEventsApi=p,t.beginRewind=c,t.optIn=u,t.getRewindStatus=h,t.fetchEventCounts=g}),define("modules/clean/react/delorean/data/reducers",["require","exports","tslib","modules/clean/filepath","modules/clean/react/delorean/util","modules/clean/react/delorean/util","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/reducer_helpers"],function(e,t,a,r,n,o,s,i){"use strict";function d(e,n){var o=n.browseContext,d=n.user,l=n.viewer,p=n.openToRewind,c=r.normalize(o.currentFQPath),u=i.getRootFolderName(d,l),h="";h=""===c?u:r.child_dir(c);var g=t.defaultDeloreanState;return a.__assign({},g,{folderDisplayName:h,rootDisplayName:u,folderName:r.child_dir(c),fqpath:c,activePage:p?s.RewindFlowPage.NUXPage:s.RewindFlowPage.notVisible})}function l(e,t){return a.__assign({},e,{hasDismissedNUX:!0})}function p(e,t){return e.events.type===s.RewindEventState.hasContent?a.__assign({},e,{events:a.__assign({},e.events,{loadingPastPage:t.direction===s.PaginationDirection.past,loadingFuturePage:t.direction===s.PaginationDirection.future})}):e}function c(e,t){var r,d=e.events.type===s.RewindEventState.hasContent?e.events.processedEvents:[],l=t.events.map(function(a){return i.getProcessedEvent({event:a,path:e.fqpath,currentFolder:e.folderName,user:t.user})}),p=e.events.type===s.RewindEventState.hasContent?e.events.cursorFuture:{type:"never-fetched"},c=e.events.type===s.RewindEventState.hasContent?e.events.cursorPast:{type:"never-fetched"};t.direction===s.PaginationDirection.future?(r=o.filterType(l.concat(d),function(e){return e.type===s.DeloreanEventType.event}),p=t.hasMore?t.cursor:{type:"reached-end"}):(r=o.filterType(d.concat(l),function(e){return e.type===s.DeloreanEventType.event}),c=t.hasMore?t.cursor:{type:"reached-end"}),r=r.sort(function(e,t){return t.timestamp-e.timestamp});for(var u=[],h=void 0,g=0,f=r;g<f.length;g++){var v=f[g];h&&v.eventCardDate===h.eventCardDate||u.push({type:s.DeloreanEventType.dateBanner,eventCardDate:v.eventCardDate,date:n.floorDate(new Date(v.timestamp))}),u.push(v),h=v}var m=!1,_=!1;return e.events.type===s.RewindEventState.hasContent&&(m=t.direction!==s.PaginationDirection.past&&e.events.loadingPastPage,_=t.direction!==s.PaginationDirection.future&&e.events.loadingFuturePage),a.__assign({},e,{events:{type:s.RewindEventState.hasContent,loadingPastPage:m,loadingFuturePage:_,processedEvents:u,cursorFuture:p,cursorPast:c}})}function u(e,t){return a.__assign({},e,{hasDismissedNUX:t.hasDismissedNUX})}function h(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.notVisible})}function g(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.graphPage})}function f(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.NUXPage})}function v(e,t){var r;return a.__assign({},e,{activePage:s.RewindFlowPage.startedPage,pageData:a.__assign({},e.pageData,(r={},r[s.RewindFlowPage.startedPage]={page:s.RewindFlowPage.startedPage,selectedEvent:t.event,rewindId:t.rewindId,rewindState:s.RewindState.InProgress},r))})}function m(e,t){return e.hasDismissedNUX?a.__assign({},e,{activePage:s.RewindFlowPage.graphPage}):a.__assign({},e,{activePage:s.RewindFlowPage.NUXPage})}function _(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.confirmationPage,pageData:a.__assign({},e.pageData,{confirmationPage:{page:s.RewindFlowPage.confirmationPage,eventAboveDivider:t.eventAboveDivider,eventBelowDivider:t.eventBelowDivider}})})}function y(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.graphPage})}function w(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.upsellPage})}function P(e,t){for(var r=e.pageData.graphPage.contents,n="loaded"===r.type?r.data:[],o=t.eventCounts,d=n.concat(o),l={},p=0,c=d;p<c.length;p++){var u=c[p];l[u.dateTsInMs]=u}var h=Object.keys(l).map(function(e){return l[Number(e)]}).sort(function(e,t){return e.dateTsInMs-t.dateTsInMs}),g="loaded"===r.type?r.selectedDateTsInMs:void 0,f="loaded"===r.type?r.selectedDateString:void 0;return a.__assign({},e,{activePage:s.RewindFlowPage.graphPage,pageData:a.__assign({},e.pageData,{graphPage:{page:s.RewindFlowPage.graphPage,graphStartOffset:e.pageData.graphPage.graphStartOffset,graphEndOffset:e.pageData.graphPage.graphEndOffset,contents:{type:"loaded",data:h,hasDataThisWeek:i.checkHasDataThisWeek(h,e.pageData.graphPage.graphStartOffset,e.pageData.graphPage.graphEndOffset),selectedDateTsInMs:g,selectedDateString:f,loadingNextWeek:!1,loadingPreviousWeek:!1,namespaceCount:t.namespaceCount,changedNamespaceCount:t.changedNamespaceCount}}})})}function D(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.graphPage,pageData:a.__assign({},e.pageData,{graphPage:{page:s.RewindFlowPage.graphPage,graphStartOffset:e.pageData.graphPage.graphStartOffset,graphEndOffset:e.pageData.graphPage.graphEndOffset,contents:{type:"error",errorString:t.errorString}}})})}function E(e,t){return e.activePage!==s.RewindFlowPage.graphPage||"loaded"!==e.pageData.graphPage.contents.type?e:a.__assign({},e,{activePage:s.RewindFlowPage.graphPage,pageData:a.__assign({},e.pageData,{graphPage:{page:s.RewindFlowPage.graphPage,graphStartOffset:e.pageData.graphPage.graphStartOffset,graphEndOffset:e.pageData.graphPage.graphEndOffset,contents:a.__assign({},e.pageData.graphPage.contents,{selectedDateTsInMs:t.selectedDateTsInMs,selectedDateString:t.selectedDateString})}})})}function R(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.activityListPage,pageData:a.__assign({},e.pageData,{activityListPage:{page:s.RewindFlowPage.activityListPage,selectedDateTsInMs:t.selectedDateTsInMs,selectedDateString:t.selectedDateString}})})}function b(e,t){return a.__assign({},e,{events:{type:s.RewindEventState.loadingEntirePanel}})}function T(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.graphPage})}function x(e,t){return a.__assign({},e,{activePage:s.RewindFlowPage.activityListPage})}function N(e,t){var r;if("loaded"!==e.pageData.graphPage.contents.type)return e;var n=t.type===s.DeloreanActionType.setGraphRangeBack,o=e.pageData.graphPage.graphStartOffset+(n?t.length:-t.length),d=e.pageData.graphPage.graphEndOffset+(n?t.length:-t.length);return a.__assign({},e,{pageData:a.__assign({},e.pageData,(r={},r[s.RewindFlowPage.graphPage]=a.__assign({},e.pageData.graphPage,{graphStartOffset:o,graphEndOffset:d,contents:a.__assign({},e.pageData.graphPage.contents,{type:"loaded",hasDataThisWeek:i.checkHasDataThisWeek(e.pageData.graphPage.contents.data,o,d)})}),r))})}function S(e,t){var r;return a.__assign({},e,{pageData:a.__assign({},e.pageData,(r={},r[s.RewindFlowPage.startedPage]=a.__assign({},e.pageData.startedPage,{rewindState:s.RewindState.Done}),r))})}function C(e,t){var r;return a.__assign({},e,{pageData:a.__assign({},e.pageData,(r={},r[s.RewindFlowPage.startedPage]=a.__assign({},e.pageData.startedPage,{rewindState:s.RewindState.InProgress}),r))})}function k(e,t){var r;return"loaded"!==e.pageData.graphPage.contents.type?e:a.__assign({},e,{pageData:a.__assign({},e.pageData,(r={},r[s.RewindFlowPage.graphPage]=a.__assign({},e.pageData.graphPage,{contents:a.__assign({},e.pageData.graphPage.contents,{loadingNextWeek:"forward"===t.graphPositionChange,loadingPreviousWeek:"backward"===t.graphPositionChange})}),r))})}function A(e,t){var r;return"loaded"!==e.pageData.graphPage.contents.type?e:a.__assign({},e,{pageData:a.__assign({},e.pageData,(r={},r[s.RewindFlowPage.graphPage]=a.__assign({},e.pageData.graphPage,{contents:a.__assign({},e.pageData.graphPage.contents,{loadingNextWeek:!1,loadingPreviousWeek:!1})}),r))})}function I(e,a){switch(void 0===e&&(e=t.defaultDeloreanState),a.type){case s.DeloreanActionType.initialize:return d(e,a);case s.DeloreanActionType.dismissNUX:return l(e,a);case s.DeloreanActionType.setFolderHistoryPaginationLoading:return p(e,a);case s.DeloreanActionType.setEventsLoaded:return c(e,a);case s.DeloreanActionType.setFolderHistoryPaginationLoaded:return c(e,a);case s.DeloreanActionType.setHasDismissedNUX:return u(e,a);case s.DeloreanActionType.changeRewindPageToNone:return h(e,a);case s.DeloreanActionType.changeRewindPageToGraphPage:return g(e,a);case s.DeloreanActionType.changeRewindPageToNUX:return f(e,a);case s.DeloreanActionType.changeRewindPageToRewindStarted:return v(e,a);case s.DeloreanActionType.changeRewindPageToNUXOrDayResolution:return m(e,a);case s.DeloreanActionType.changeRewindPageToConfirmationPage:return _(e,a);case s.DeloreanActionType.changeRewindPageFromConfirmationPageToGraphPage:return y(e,a);case s.DeloreanActionType.changeRewindPageToUpsell:return w(e,a);case s.DeloreanActionType.loadEventCounts:return P(e,a);case s.DeloreanActionType.setRewindEventCountsError:return D(e,a);case s.DeloreanActionType.setRewindPanelSelectedDate:return E(e,a);case s.DeloreanActionType.changeRewindPageToActivityListPage:return R(e,a);case s.DeloreanActionType.clearEventList:return b(e,a);case s.DeloreanActionType.goBackFromActivityListPage:return T(e,a);case s.DeloreanActionType.goBackFromConfirmationPage:return x(e,a);case s.DeloreanActionType.setGraphRangeBack:return N(e,a);case s.DeloreanActionType.setGraphRangeForward:return N(e,a);case s.DeloreanActionType.setRewindComplete:return S(e,a);case s.DeloreanActionType.setRewindInProgress:return C(e,a);case s.DeloreanActionType.setLoadingGraphWeek:return k(e,a);case s.DeloreanActionType.setGraphLoadFinished:return A(e,a);default:return o.assertNever(a),e}}var L;Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),n=a.__importStar(n),t.defaultDeloreanState={hasDismissedNUX:!1,pageData:(L={},L[s.RewindFlowPage.notVisible]={page:s.RewindFlowPage.notVisible},L[s.RewindFlowPage.NUXPage]={page:s.RewindFlowPage.NUXPage},L[s.RewindFlowPage.graphPage]={page:s.RewindFlowPage.graphPage,contents:{type:"initial-load"},graphStartOffset:7,graphEndOffset:0},L[s.RewindFlowPage.confirmationPage]={page:s.RewindFlowPage.confirmationPage,eventAboveDivider:void 0,eventBelowDivider:void 0},L[s.RewindFlowPage.activityListPage]={page:s.RewindFlowPage.activityListPage,selectedDateTsInMs:0,selectedDateString:""},L[s.RewindFlowPage.startedPage]={page:s.RewindFlowPage.startedPage,rewindState:s.RewindState.InProgress,rewindId:"",selectedEvent:void 0},L[s.RewindFlowPage.upsellPage]={page:s.RewindFlowPage.upsellPage},L),activePage:s.RewindFlowPage.notVisible,folderDisplayName:"",rootDisplayName:"",folderName:"",fqpath:"",events:{type:s.RewindEventState.loadingEntirePanel}},t.reducer=I}),define("modules/clean/react/delorean/data/selectors",["require","exports","modules/clean/redux/namespaces","modules/clean/redux/selectors"],function(e,t,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeloreanState=function(e){return r.getStateAtNamespace(e,a.DELOREAN_NAMESPACE_KEY)},t.getHasDismissedNUX=function(e){return t.getDeloreanState(e).hasDismissedNUX},t.getEvents=function(e){return t.getDeloreanState(e).events},t.getFolderDisplayName=function(e){return t.getDeloreanState(e).folderDisplayName},t.getFQPath=function(e){return t.getDeloreanState(e).fqpath},t.getActivePage=function(e){return t.getDeloreanState(e).activePage},t.getAllPageData=function(e){return t.getDeloreanState(e).pageData}}),
define("modules/clean/react/delorean/data/store",["require","exports","tslib","external/lodash","modules/clean/react/delorean/data/reducers","modules/clean/redux/store","modules/clean/redux/namespaces"],function(e,t,a,r,n,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),t.getDeloreanStore=r.once(function(){var e;return o.getStoreAndRegisterReducers((e={},e[s.DELOREAN_NAMESPACE_KEY]=n.reducer,e))})}),define("modules/clean/react/delorean/delorean",["require","exports","tslib","react","modules/clean/filepath","external/classnames","modules/clean/history","external/react-redux","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/selectors","modules/clean/react/css_timing","modules/clean/react/delorean/components/rewind_title","modules/clean/react/delorean/data/actions","modules/core/i18n","modules/clean/react/delorean/components/folder_history/folder_history","modules/clean/react/delorean/data/store","modules/clean/analytics","spectrum/tabbed_header","modules/clean/react/delorean/util","modules/clean/react/delorean/components/rewind","modules/clean/react/delorean/components/rewind_started","modules/clean/react/delorean/constants","modules/clean/react/delorean/components/rewind_optin_modal","modules/clean/react/delorean/data/api","modules/clean/react/delorean/logging","modules/clean/react/delorean/logging","modules/clean/react/delorean/components/rewind_upsell_page","modules/clean/react/delorean/data/types"],function(e,t,a,r,n,o,s,i,d,l,p,c,u,h,g,f,v,m,_,y,w,P,D,E,R,b,T,x){"use strict";function N(e){return{hasDismissedNUX:l.getHasDismissedNUX(e),events:l.getEvents(e),folderDisplayName:l.getFolderDisplayName(e),activePage:l.getActivePage(e),allPageData:l.getAllPageData(e),fqpath:l.getFQPath(e)}}function S(e){return e!==x.UpsellVariant.CONTROL&&e!==x.UpsellVariant.OFF&&void 0!==e&&(e===x.UpsellVariant.V1||e===x.UpsellVariant.V2||e===x.UpsellVariant.V3||_.assertNever(e))}Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importStar(n),o=a.__importDefault(o),s=a.__importDefault(s),E=a.__importStar(E),R=a.__importStar(R);var C=(function(e){function t(t){var r=e.call(this,t)||this;return r.closeDrawer=function(e){var t=e.closedByClick,a=void 0!==t&&t,n=r.props,o=n.activePage,i=n.allPageData,l=n.user,p=r.state.restoreId;r.props.closePanel(),a&&!r.haveLoggedCloseReason&&(R.exitDrawer({reason:b.DeloreanCloseReason.click_close,activePage:o,allPageData:i,restoreId:p,user:l}),r.haveLoggedCloseReason=!0),r.props.activePage===d.RewindFlowPage.notVisible?s.default.remove_query_param(P.FOLDER_HISTORY_QUERY_PARAM):s.default.remove_query_param(P.REWIND_QUERY_PARAM)},r.initialize=function(){var e=r.props,t=e.user,a=e.expFolderHistoryRollbacks,n=e.showRewindTab,o=a||n;r.haveLoggedCloseReason=!1,r.props.dispatch(u.initializeDeloreanAction({browseContext:r.props.browseContext,user:r.props.user,openToRewind:o})),R.openActivityList({user:t,restoreId:r.state.restoreId}),r.props.expTimeline&&r.props.dispatch(u.fetchEventsAction({user:r.props.user,fqpath:r.props.browseContext.currentFQPath,direction:d.PaginationDirection.past,timestampInSeconds:0,onlyRewindableEvents:!1})),S(r.props.expRewindUpsell)&&!r.props.expFolderHistoryRollbacks&&r.props.dispatch({type:d.DeloreanActionType.changeRewindPageToUpsell})},r.onClickOnEvent=function(){var e=r.props.user,t=r.state.restoreId;R.clickOnActivityList({user:e,restoreId:t})},r.showMoreFuture=function(e){r.props.dispatch(u.showMoreAction({user:r.props.user,fqpath:r.props.browseContext.currentFQPath,futureCursor:e,direction:d.PaginationDirection.future}))},r.showMorePast=function(e){r.props.dispatch(u.showMoreAction({user:r.props.user,fqpath:r.props.browseContext.currentFQPath,pastCursor:e,direction:d.PaginationDirection.past}))},r.updateActiveTabId=function(e){"View"===e?r.props.dispatch({type:d.DeloreanActionType.changeRewindPageToNone}):r.props.dispatch({type:d.DeloreanActionType.changeRewindPageToNUXOrDayResolution})},r.acceptOptIn=function(){return a.__awaiter(r,void 0,void 0,function(){return a.__generator(this,function(e){switch(e.label){case 0:return this.props.onOptIn(),this.setState({showOptinModal:!1}),[4,E.optIn({user:this.props.user})];case 1:return e.sent(),[2]}})})},r.rejectOptIn=function(){r.setState({showOptinModal:!1})},r.state={restoreId:v.RestorationStepsLogger.generate_restore_id(t.user.id),showOptinModal:r.props.rewindOptin===P.SECRET_OPTIN_NUMBER},r.haveLoggedCloseReason=!0,r.propsUpdated(a.__assign({},t,{isVisible:!1})),r}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;window.addEventListener("beforeunload",function(t){var a=e.props,r=a.activePage,n=a.allPageData,o=a.user,s=e.state.restoreId;e.props.isVisible&&!e.haveLoggedCloseReason&&(R.exitDrawer({reason:b.DeloreanCloseReason.page_exit,activePage:r,allPageData:n,restoreId:s,user:o}),e.haveLoggedCloseReason=!0)})},t.prototype.componentDidUpdate=function(e,t){this.propsUpdated(e)},t.prototype.propsUpdated=function(e){var t=this.props,a=t.activePage,r=t.allPageData,o=t.user,i=t.browseContext,d=t.clickBrowseButtonTimestampMs,l=t.fromDesktopClient,p=t.isVisible,c=t.fqpath,u=this.state.restoreId,h=p&&!e.isVisible,g=!p&&e.isVisible,f=n.normalize(c)!==n.normalize(i.currentFQPath);(h||p&&f)&&this.initialize(),h&&d&&(this.props.expFolderHistoryRollbacks?R.loadNUX({browseContext:i,user:o,restoreId:u,clickBrowseButtonTimestampMs:d,fromDesktopClient:l}):this.props.expRewindUpsell&&R.loadUpsell({browseContext:i,user:o,restoreId:u,clickBrowseButtonTimestampMs:d,fromDesktopClient:l})),g&&(this.haveLoggedCloseReason||(R.exitDrawer({reason:s.default.get_url().startsWith("/home")?b.DeloreanCloseReason.browse_folder:b.DeloreanCloseReason.page_exit,activePage:a,allPageData:r,restoreId:u,user:o}),this.haveLoggedCloseReason=!0),this.setState({restoreId:v.RestorationStepsLogger.generate_restore_id(o.id)}))},t.prototype.renderActiveTab=function(){return this.props.activePage===d.RewindFlowPage.notVisible||!S(this.props.expRewindUpsell)&&!this.props.expFolderHistoryRollbacks?r.default.createElement(g.FolderHistory,{dispatch:this.props.dispatch,onClickEvent:this.onClickOnEvent,events:this.props.events,isForARewind:!1,onShowMoreFuture:this.showMoreFuture,onShowMorePast:this.showMorePast,shouldEventsLinkToBrowse:!0,selectedDateTsInMs:void 0}):this.props.activePage===d.RewindFlowPage.graphPage||this.props.activePage===d.RewindFlowPage.NUXPage||this.props.activePage===d.RewindFlowPage.activityListPage||this.props.activePage===d.RewindFlowPage.confirmationPage?r.default.createElement(y.Rewind,{events:this.props.events,fqpath:this.props.fqpath,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,data:this.props.allPageData[this.props.activePage],graphPage:this.props.allPageData.graphPage,browseContext:this.props.browseContext,restorationsLoggingId:this.state.restoreId,closePanel:this.closeDrawer,userVersionHistoryLength:this.props.userVersionHistoryLength}):this.props.activePage===d.RewindFlowPage.startedPage?r.default.createElement(w.RewindStarted,{page:this.props.allPageData.startedPage,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,rewindState:this.props.allPageData.startedPage.rewindState,restoreId:this.state.restoreId,closePanel:this.closeDrawer}):this.props.activePage===d.RewindFlowPage.upsellPage?r.default.createElement(T.RewindUpsellPage,{user:this.props.user,restoreId:this.state.restoreId}):_.assertNever(this.props.activePage)},t.prototype.getActiveTabName=function(){switch(this.props.activePage){case d.RewindFlowPage.notVisible:return"View";case d.RewindFlowPage.graphPage:case d.RewindFlowPage.activityListPage:case d.RewindFlowPage.NUXPage:case d.RewindFlowPage.confirmationPage:case d.RewindFlowPage.startedPage:case d.RewindFlowPage.upsellPage:return"Change";default:return _.assertNever(this.props.activePage)}},t.prototype.renderTabHeader=function(){if(this.props.expFolderHistoryRollbacks&&this.props.expTimeline){var e=this.getActiveTabName();return r.default.createElement(m.TabbedHeader,{className:"delorean-tabbed-header",activeTabId:e,onSelection:this.updateActiveTabId,key:e},r.default.createElement(m.Tab,{active:"View"===e,id:"View"},h._("View",{project:"folder-history",comment:"This is the tab panel which will display a list of events in the folder history panel."})),r.default.createElement(m.Tab,{active:"Change"===e,id:"Change"},h._("Change",{project:"folder-history",comment:"This is the tab panel which will allow you to change your folder history by rolling back events."})))}return null},t.prototype.render=function(){var e=o.default({delorean:!0,"delorean--visible":this.props.isVisible,"delorean--hidden":!this.props.isVisible});return r.default.createElement("div",{"aria-hidden":this.props.isVisible?"false":"true",className:e},r.default.createElement(c.RewindTitle,{folderDisplayName:this.props.folderDisplayName,expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,expTimeline:this.props.expTimeline,closePanel:this.closeDrawer,context:this.props.browseContext}),this.renderTabHeader(),this.renderActiveTab(),this.state.showOptinModal&&r.default.createElement(D.RewindOptinModal,{user:this.props.user,onAcceptOptIn:this.acceptOptIn,onRefuseOptIn:this.rejectOptIn}))},t})(r.default.Component);t.DeloreanInnerUnconnected=C;var k=i.connect(N)(C);t.DeloreanInnerWithCss=p.requireCssWithComponent(k,["/static/css/delorean/delorean-vflo4p-a-.css"]);var A=f.getDeloreanStore(),I=(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(n,e),n.prototype.render=function(){return r.default.createElement(i.Provider,{store:A},r.default.createElement(t.DeloreanInnerWithCss,{fromDesktopClient:this.props.fromDesktopClient,showRewindTab:this.props.showRewindTab,userVersionHistoryLength:this.props.userVersionHistoryLength,onOptIn:this.props.onOptIn,user:this.props.user,closePanel:this.props.close,browseContext:this.props.browseContext,isVisible:this.props.isVisible,expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,expTimeline:this.props.expTimeline,expRewindUpsell:this.props.expRewindUpsell,rewindOptin:this.props.rewindOptin,clickBrowseButtonTimestampMs:this.props.clickBrowseButtonTimestampMs}))},n})(r.default.Component);t.Delorean=I}),define("modules/clean/react/delorean/util",["require","exports","tslib","modules/clean/filepath","modules/core/i18n","modules/clean/datetime"],function(e,t,a,r,n,o){"use strict";function s(e){return e}function i(e,t){return e[".tag"]===t}function d(e,t){return e[".tag"]===t}function l(e){return d(e,"add")?"added":d(e,"delete")?"deleted":d(e,"edit")?"edited":d(e,"lost_access")?"lost access":d(e,"mount")?"mounted":d(e,"move")?"moved":d(e,"move_in")?"moved in":d(e,"move_out")?"moved out":d(e,"rename")?"renamed":d(e,"restore")?"restore":d(e,"restore_version")?"restore_version":d(e,"rollback")?"rollback":d(e,"share")?"shared":d(e,"unmount")?"unmounted":d(e,"unshare")?"unshared":d(e,"other")||d(e,"unknown")?"error":s(e)}function p(e){return i(e,"multi_object_metadata")||i(e,"single_object_metadata")||i(e,"edit_metadata")||i(e,"rename_metadata")||i(e,"rollback_metadata")?r.normalize(e.containing_path):i(e,"move_metadata")?r.normalize(e.to_containing_path):i(e,"move_in_metadata")?r.normalize(e.to_containing_path):i(e,"move_out_metadata")?r.normalize(e.from_containing_path):i(e,"other")?"":s(e)}function c(e){return i(e,"single_object_metadata")||i(e,"move_metadata")||i(e,"move_in_metadata")||i(e,"move_out_metadata")||i(e,"rollback_metadata")||i(e,"edit_metadata")?e.name:i(e,"rename_metadata")?e.to_name:i(e,"other")||i(e,"multi_object_metadata")?"":s(e)}function u(){return String(++y)}function h(e,t){return e.filter(t)}function g(e,t){for(var a=0;a<e.length;a++)if(t(e[a]))return a}function f(e,t){for(var a=e.length-1;a>=0;a--)if(t(e[a]))return a}function v(e){return n._("%(date_name)s, %(month_name)s %(date_number)d").format({date_name:t.dateNames[e.getDay()],month_name:o.month_name(e.getMonth(),!0),date_number:e.getDate()})}function m(e){var t=new Date(e.getTime());return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}function _(e){var t=new Date(e.getTime()),a=m(t),r=m(t);return r.setDate(r.getDate()+1),Math.abs(t.getTime()-a.getTime())<Math.abs(t.getTime()-r.getTime())?a.getTime():r.getTime()}Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),t.assertNever=s,t.isMetadataType=i,t.isOpType=d,t.getNameOfOpType=l,t.getLocationOfMetadata=p,t.getRepresentativeNameOfMetadata=c;var y=0;t.getUid=u,t.filterType=h,t.findIndex=g,t.findLastIndex=f,t.noop=function(){},t.dateNames=[n._("Sun"),n._("Mon"),n._("Tue"),n._("Wed"),n._("Thu"),n._("Fri"),n._("Sat")],t.formatWithShortDateName=v,t.floorDate=m,t.roundDate=_});
//# sourceMappingURL=pkg-delorean.min.js-vfl0XoPmX.map