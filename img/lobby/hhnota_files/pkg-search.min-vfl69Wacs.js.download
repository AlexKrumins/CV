define("modules/clean/logging/hive/schemas/search-web_search_activity",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e){this.category="search-web_search_activity",this.active_user_id=null,this.anon_ip=null,this.authed_user_ids=null,this.country=null,this.identity_gid=null,this.locale_browser_header=null,this.locale_user_selected=null,this.referrer=null,this.session_id=null,this.team_id=null,this.team_type=null,this.ua_browser_name=null,this.ua_browser_version=null,this.ua_dist_name=null,this.ua_dist_version=null,this.ua_os_name=null,this.ua_os_version=null,this.user_agent=null,this.user_id=null,e.hasOwnProperty("action_type")&&void 0!==e.action_type&&(this.action_type=e.action_type),e.hasOwnProperty("active_user_id")&&void 0!==e.active_user_id&&(this.active_user_id=e.active_user_id),e.hasOwnProperty("anon_ip")&&void 0!==e.anon_ip&&(this.anon_ip=e.anon_ip),e.hasOwnProperty("authed_user_ids")&&void 0!==e.authed_user_ids&&(this.authed_user_ids=e.authed_user_ids),e.hasOwnProperty("country")&&void 0!==e.country&&(this.country=e.country),e.hasOwnProperty("deleted_filter")&&void 0!==e.deleted_filter&&(this.deleted_filter=e.deleted_filter),e.hasOwnProperty("deleted")&&void 0!==e.deleted&&(this.deleted=e.deleted),e.hasOwnProperty("event_name")&&void 0!==e.event_name&&(this.event_name=e.event_name),e.hasOwnProperty("extra")&&void 0!==e.extra&&(this.extra=e.extra),e.hasOwnProperty("failure_type")&&void 0!==e.failure_type&&(this.failure_type=e.failure_type),e.hasOwnProperty("file_extension")&&void 0!==e.file_extension&&(this.file_extension=e.file_extension),e.hasOwnProperty("file_is_shared")&&void 0!==e.file_is_shared&&(this.file_is_shared=e.file_is_shared),e.hasOwnProperty("file_last_edited")&&void 0!==e.file_last_edited&&(this.file_last_edited=e.file_last_edited),e.hasOwnProperty("file_name")&&void 0!==e.file_name&&(this.file_name=e.file_name),e.hasOwnProperty("file_nsid")&&void 0!==e.file_nsid&&(this.file_nsid=e.file_nsid),e.hasOwnProperty("file_path")&&void 0!==e.file_path&&(this.file_path=e.file_path),e.hasOwnProperty("file_size")&&void 0!==e.file_size&&(this.file_size=e.file_size),e.hasOwnProperty("file_sjid")&&void 0!==e.file_sjid&&(this.file_sjid=e.file_sjid),e.hasOwnProperty("file_type_filters")&&void 0!==e.file_type_filters&&(this.file_type_filters=e.file_type_filters),e.hasOwnProperty("identity_gid")&&void 0!==e.identity_gid&&(this.identity_gid=e.identity_gid),e.hasOwnProperty("latency")&&void 0!==e.latency&&(this.latency=null!==e.latency?e.latency.toString():null),e.hasOwnProperty("locale_browser_header")&&void 0!==e.locale_browser_header&&(this.locale_browser_header=e.locale_browser_header),e.hasOwnProperty("locale_user_selected")&&void 0!==e.locale_user_selected&&(this.locale_user_selected=e.locale_user_selected),e.hasOwnProperty("match_type")&&void 0!==e.match_type&&(this.match_type=e.match_type),e.hasOwnProperty("paper_folder_id")&&void 0!==e.paper_folder_id&&(this.paper_folder_id=e.paper_folder_id),e.hasOwnProperty("paper_pad_id")&&void 0!==e.paper_pad_id&&(this.paper_pad_id=e.paper_pad_id),e.hasOwnProperty("path_scoped")&&void 0!==e.path_scoped&&(this.path_scoped=null!==e.path_scoped?e.path_scoped.toString():null),e.hasOwnProperty("position")&&void 0!==e.position&&(this.position=null===e.position?null:e.position.toString()),e.hasOwnProperty("preview_request_id")&&void 0!==e.preview_request_id&&(this.preview_request_id=e.preview_request_id),e.hasOwnProperty("query_string")&&void 0!==e.query_string&&(this.query_string=e.query_string),e.hasOwnProperty("query_suggestion_count")&&void 0!==e.query_suggestion_count&&(this.query_suggestion_count=e.query_suggestion_count),e.hasOwnProperty("query_suggestion_strings")&&void 0!==e.query_suggestion_strings&&(this.query_suggestion_strings=e.query_suggestion_strings),e.hasOwnProperty("recent_history_map")&&void 0!==e.recent_history_map&&(this.recent_history_map=e.recent_history_map),e.hasOwnProperty("referrer")&&void 0!==e.referrer&&(this.referrer=e.referrer),e.hasOwnProperty("request_id")&&void 0!==e.request_id&&(this.request_id=e.request_id),e.hasOwnProperty("result_count")&&void 0!==e.result_count&&(this.result_count=null!==e.result_count?e.result_count.toString():null),e.hasOwnProperty("result_id")&&void 0!==e.result_id&&(this.result_id=e.result_id),e.hasOwnProperty("session_id")&&void 0!==e.session_id&&(this.session_id=e.session_id),e.hasOwnProperty("source")&&void 0!==e.source&&(this.source=e.source),e.hasOwnProperty("start")&&void 0!==e.start&&(this.start=null!==e.start?e.start.toString():null),e.hasOwnProperty("team_id")&&void 0!==e.team_id&&(this.team_id=e.team_id),e.hasOwnProperty("team_type")&&void 0!==e.team_type&&(this.team_type=e.team_type),e.hasOwnProperty("timestamp")&&void 0!==e.timestamp&&(this.timestamp=e.timestamp),e.hasOwnProperty("timezone_offset")&&void 0!==e.timezone_offset&&(this.timezone_offset=e.timezone_offset),e.hasOwnProperty("type")&&void 0!==e.type&&(this.type=e.type),e.hasOwnProperty("typeahead_session_id")&&void 0!==e.typeahead_session_id&&(this.typeahead_session_id=e.typeahead_session_id),e.hasOwnProperty("ua_browser_name")&&void 0!==e.ua_browser_name&&(this.ua_browser_name=e.ua_browser_name),e.hasOwnProperty("ua_browser_version")&&void 0!==e.ua_browser_version&&(this.ua_browser_version=e.ua_browser_version),e.hasOwnProperty("ua_dist_name")&&void 0!==e.ua_dist_name&&(this.ua_dist_name=e.ua_dist_name),e.hasOwnProperty("ua_dist_version")&&void 0!==e.ua_dist_version&&(this.ua_dist_version=e.ua_dist_version),e.hasOwnProperty("ua_os_name")&&void 0!==e.ua_os_name&&(this.ua_os_name=e.ua_os_name),e.hasOwnProperty("ua_os_version")&&void 0!==e.ua_os_version&&(this.ua_os_version=e.ua_os_version),e.hasOwnProperty("user_agent")&&void 0!==e.user_agent&&(this.user_agent=e.user_agent),e.hasOwnProperty("user_id")&&void 0!==e.user_id&&(this.user_id=e.user_id),e.hasOwnProperty("view_type")&&void 0!==e.view_type&&(this.view_type=e.view_type),e.hasOwnProperty("viewport")&&void 0!==e.viewport&&(this.viewport=e.viewport),e.hasOwnProperty("search_scoped_to_account_id")&&void 0!==e.search_scoped_to_account_id&&(this.search_scoped_to_account_id=e.search_scoped_to_account_id),e.hasOwnProperty("action_source")&&void 0!==e.action_source&&(this.action_source=e.action_source),Object.seal(this)}return e})();t.SearchWebSearchActivityRow=r}),define("modules/clean/react/starred/browse_exports",["require","exports","modules/clean/react/home/resource_id_types","modules/clean/react/starred/actions","modules/clean/react/starred/browse_update","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/star","modules/clean/react/starred/store"],function(e,t,r,n,s,a,i,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_RESOURCE_ID_TYPE=r.HOME_RESOURCE_ID_TYPE,t.StarredActions=n.StarredActions,t.checkForMissingStarredData=s.checkForMissingStarredData,t.StarredSource=a.StarredSource,t.idTypePairFromStarrableItem=i.idTypePairFromStarrableItem,t.Star=o.Star,t.StarredStore=l.StarredStore}),define("modules/clean/react/starred/browse_update",["require","exports","modules/clean/react/starred/actions","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/store"],function(e,t,r,n,s){"use strict";function a(e){var t=e.items,a=e.isNonUserRelativeContext,i=e.user;if(!a){var o=t.map(n.idTypePairFromStarrableItem).filter(function(e){return!(!e.id||s.StarredStore.hasIdTypePair(e))});o.length&&r.StarredActions.fetchStatuses(i.role,o)}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkForMissingStarredData=a}),define("modules/clean/search/search_bar/query_suggestions_table",["require","exports","tslib","external/classnames","react","spectrum/icon_global","modules/clean/keycode","modules/core/i18n"],function(e,t,r,n,s,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),s=r.__importDefault(s);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.querySuggestions,r=e.indexOffset,n=e.highlightedRow,a=e.onQuerySuggestionsClick,i=e.onHighlightDropdownItem,l=e.showHeader,u=o._("Suggested searches");return s.default.createElement("div",{className:"search__query-suggestions"},l&&s.default.createElement("div",{className:"search__query-suggestion-header"},u),t.map(function(e,t){return s.default.createElement(c,{key:"query-suggestion-"+t,querySuggestion:e,index:t,indexOffset:r,isHighlighted:void 0!==n&&t===n-r,onQuerySuggestionsClick:a,onHighlightDropdownItem:i,showHeader:l})}))},t})(s.default.PureComponent);t.QuerySuggestionsTable=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.onQuerySuggestionsClick(t.props.querySuggestion,t.props.index)},t.handleKeyPress=function(e){switch(e.which){case i.KeyCode.ENTER:case i.KeyCode.SPACE:t.props.onQuerySuggestionsClick(t.props.querySuggestion,t.props.index),e.preventDefault()}},t.handleHighlight=function(){var e=t.props.onHighlightDropdownItem;e&&e(t.props.index+t.props.indexOffset)},t.getAriaLabel=function(){return o._("Search for %(query)s").format({query:t.props.querySuggestion.text})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.isHighlighted,r=e.showHeader,i=e.querySuggestion,o=e.index,l=n.default({"search__query-suggestion-item":!0,"search__query-suggestion-item-highlighted":t,"search__query-suggestion-item-reduced-height":!r});return s.default.createElement("li",{className:l,role:"option","aria-label":this.getAriaLabel(),"aria-selected":t,tabIndex:0,onClick:this.handleClick,onMouseEnter:this.handleHighlight,onKeyPress:this.handleKeyPress},s.default.createElement("div",{className:"mc-media-cell-icon search__query-suggestion-icon"},s.default.createElement(a.IconGlobal,{name:"search-small"})),s.default.createElement("div",{className:"mc-media-cell-text search__query-suggestion-text"},s.default.createElement(u,{querySuggestion:i,showHeader:r,keyName:"query-suggestion-"+o})))},t})(s.default.PureComponent);t.QuerySuggestionRow=c;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.showHeader,r=e.querySuggestion,n=e.keyName;return!t&&r.highlight_spans&&r.highlight_spans.length?r.highlight_spans.filter(function(e){return void 0!==e.highlight_str&&void 0!==e.is_highlighted}).map(function(e,t){return e.is_highlighted?s.default.createElement("span",{key:n+"-"+t},e.highlight_str):s.default.createElement("b",{key:n+"-"+t},e.highlight_str)}):r.text},t})(s.default.PureComponent);t.QuerySuggestionRowText=u}),define("modules/clean/search/search_bar/recent_files_table",["require","exports","tslib","react","spectrum/dimensions","spectrum/icon_content","spectrum/icon_global","spectrum/media_table","spectrum/table","spectrum/table/table_head_cell","modules/clean/browse_interface","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/filetypes","modules/clean/search/models","modules/clean/react/icon/file_folder_icon","modules/clean/react/title_bubble","modules/clean/search/types","modules/clean/search/search_helpers","modules/core/i18n","modules/clean/search/constants","spectrum/tooltip","modules/clean/keycode"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E,v,w,T){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),h=r.__importStar(h),y=r.__importStar(y);var C=(function(e){function t(t){var r=e.call(this,t)||this;return r.renderRecentFilesTable=function(){return n.default.createElement(l.Table,{className:"brws-files-view-list","aria-rowcount":r.props.recentItems.size},n.default.createElement(l.TableHead,{className:"brws-column-header"},n.default.createElement(c.TableHeadCell,{className:"brws-column-header-table-cell search-bar__align-center search__recent-header",role:"columnheader",scope:"col"},n.default.createElement("span",null,E._("Recent")," "),n.default.createElement(w.Tooltip,{tooltipContent:E._("Based on previous activity"),positioning:"above"},n.default.createElement(i.IconGlobal,{className:"search-bar__dropdown-recent-files-help-icon",name:"help",tabIndex:0}))),n.default.createElement(c.TableHeadCell,{className:"brws-column-header-table-cell",role:"columnheader",scope:"col"},n.default.createElement("span",null,r.props.expRecentFiles===S.RecentFilesVariants.ON_VIEWED_DATE?E._("Viewed"):E._("Modified")))),n.default.createElement(l.TableBody,null,r.renderTableBody()))},r.renderTableBody=function(){var e=[];return r.props.recentItems.forEach(function(t){e.push(t)}),e.map(function(e,t){var s=function(n){n.stopPropagation(),n.preventDefault();var s=r.props.onRecentItemClick;s&&s(e,t)},a=function(e){e.keyCode!==T.KeyCode.ENTER&&e.keyCode!==T.KeyCode.SPACE||s(e)};return n.default.createElement(o.MediaRow,{className:"brws-file-row search__recent-item",onClick:s,key:"fileRow"+t,tabIndex:0,onKeyDown:a},function(n){var a=n.isHovered;return[r.renderNameCell(e,t,a,s),r.renderDateCell(e)]})})},r.renderNameCell=function(e,t,a,i){return n.default.createElement(o.MediaCell,{highlight:a,icon:r.renderNameCellIcon(e,i),key:"fileName"},n.default.createElement(s.Dimensions,{className:"brws-file-name-container"},function(s){var l=s.width;return n.default.createElement("div",{className:"brws-file-name-cell-text brws-vertically-center"},n.default.createElement(o.MediaCellText,{highlight:a},r.renderNameCellTitle(e,i,l)),n.default.createElement(o.MediaCellText,{highlight:a,variant:"subtitle"},r.renderNameCellSubtitle(e,t,l)))}))},r.renderNameCellTitle=function(e,t,s){if(e instanceof g.RecentFile){var a=h.filename(e.fq_path),i=r._truncateTextInNameCell(a,v.FILE_NAME_FONT_SIZE,v.FILE_NAME_CONST_CELL_BUFFER_EM,s),o=n.default.createElement("a",{className:"brws-file-name-cell-filename",href:u.browse_uri_for_fq_path(r.props.user,e.fq_path).toString(),onClick:t},n.default.createElement("span",null,i));if(a!==i){var l=a.length<=v.FILE_NAME_TOOLTIP_MAX_LINE_LENGTH?a:n.default.createElement("div",{className:"brws-file-name-cell-tooltip"},a);o=n.default.createElement(f.TitleBubble,{content:l,position:f.TitleBubble.POSITIONS.BOTTOM,className:"list-label__title-bubble"},o)}return o}var c=e instanceof g.RecentPaper?e.title:e.name,d=y.buildPaperUrl(e),i=r._truncateTextInNameCell(c,v.FILE_NAME_FONT_SIZE,v.FILE_NAME_CONST_CELL_BUFFER_EM,s);return n.default.createElement("a",{className:"brws-paper-doc-name-cell-title",href:d,onClick:t},n.default.createElement("span",null,i))},r.renderNameCellSubtitle=function(e,t,s){if(e instanceof g.RecentFile){var a=r.props.user,i=h.parent_dir(e.fq_path),o="/"===i?u.get_browse_root_name(r.props.user):i.slice(1),l=E._("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:o}),c=r._truncateTextInNameCell(l,v.FILE_LOCATION_FONT_SIZE,v.FILE_LOCATION_CONST_CELL_BUFFER_EM,s),d=u.browse_uri_for_fq_path(a,i),p=function(e){e.stopPropagation(),e.preventDefault();var n=r.props.onRecentFileLocationClick;n&&n(i,t)};return n.default.createElement("a",{className:"brws-file-name-cell-location",href:d.toString(),onClick:p},c)}return n.default.createElement("span",null,E._("in Paper",{comment:"The Dropbox Paper page"}))},r.renderNameCellIcon=function(e,t){if(e instanceof g.RecentFile){var r=e.is_dir?_.FileTypes.FOLDER:_.FileTypes.FILE;return n.default.createElement(m.FileOrFolderIcon,{className:"brws-file-name-cell-icon",file:{type:r,icon:"",fq_path:e.fq_path,thumbnail_url_tmpl:e.thumbnail_url_tmpl},showPreview:!0,variant:"small",onClick:t})}return e instanceof g.RecentPaper?n.default.createElement(a.IconContent,{className:"brws-file-name-cell-icon",name:"paper-small"}):n.default.createElement(a.IconContent,{className:"brws-file-name-cell-icon",name:"folder-small"})},r.renderDateCell=function(e){var t=r.props.expRecentFiles,s=n.default.createElement("span",{"aria-hidden":!0},"--"),a=t===S.RecentFilesVariants.ON_VIEWED_DATE?e.last_viewed_date:e.last_modified_date,i=null!==a&&void 0!==a?d.getActingTimeWithAgoEnabled(a,!1,!0,0,!0,!0,!0):s,l=t===S.RecentFilesVariants.ON_MODIFIED_DATE&&e.last_modified_name?E._("by %(modified_by)s",{comment:"name of the person that modified the file"}).format({modified_by:e.last_modified_name}):void 0;return n.default.createElement(o.MediaCell,{className:"brws-file-modified-at-cell",title:i,subtitle:l,key:"fileDate"})},r}return r.__extends(t,e),t.prototype._truncateTextInNameCell=function(e,t,r,n){if(n){var s=n/t,a=Math.max(r,s-r);return p.Emstring.em_snippet(e,Math.floor(a),.5)}return e},t.prototype.render=function(){return this.props.recentItems.size>0?this.renderRecentFilesTable():null},t})(n.default.Component);t.RecentFilesTable=C}),define("modules/clean/search/search_results/search_filters",["require","exports","tslib","external/classnames","react","spectrum/checkbox","spectrum/icon_arrow","spectrum/icon_content","spectrum/label","spectrum/radio_button","spectrum/tertiary_link","spectrum/tooltip","modules/clean/filepath","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/folder_dialog/async","modules/clean/react/path_filter_button","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/search/types","modules/core/i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),s=r.__importDefault(s),p=r.__importStar(p);var v=(function(e){function t(v){var w,T=e.call(this,v)||this;T.showFolderFilterModal=function(){var e=T.props,t=e.user,r=e.path,n=e.onFiltersChanged;_.showFolderDialog({ariaLabel:E._("Folder selector"),canSelectReadonly:!0,initialPath:r,modalName:h.ModalName.SEARCH_FILTER,primaryActionLabel:E._("Select"),title:E._("Select a folder"),user:t,onSuccess:function(e){n({path:e})}})},T.resetFilters=function(){var e=T.props,t=e.searchBarExperiments,n=e.onFiltersChanged,s={};f.isInDeletedFilterRightRailExperiment(t)&&(s.deletedFiles=!1),s.path="/",S.isInFileTypeFilterExperiment(t)&&(s.fileCategories=r.__assign({},m.FILE_CATEGORIES_UNCHECKED)),n(s)},T.shouldRenderResetButton=function(){var e=T.props,t=e.path,r=e.deletedFiles,n=e.fileCategories,s=e.searchBarExperiments,a=S.fileCategoriesSet(n,s,T.props.isPaperEnabled);return!p.paths_are_equal(t,"/")||!!r||a},T.renderResetButton=function(){return s.default.createElement(u.TertiaryLink,{onClick:T.resetFilters,className:"search-filters__reset"},E._("Reset filters"))},T.renderPathFilter=function(){var e=T.props.path;return s.default.createElement("div",{className:"filter-item__row"},s.default.createElement("div",{className:"filter-item__column"},s.default.createElement("div",{className:"filter-item__desc"},E._("By folder")),s.default.createElement(g.PathFilterButton,{path:e,defaultText:E._("Any folder"),dropdownClasses:"filter-item__filter",onClick:T.showFolderFilterModal})))},T.handleDeletedFilesAll=function(){T.props.onFiltersChanged({deletedFiles:!1})},T.handleDeletedFilesDeleted=function(){T.props.onFiltersChanged({deletedFiles:!0})},T.handleFileTypeChanged=function(e,t,n){var s,a=n.target.name;T.props.onFiltersChanged({fileCategories:r.__assign({},T.props.fileCategories,(s={},s[a]=e,s))})},T.handleChangeFileTypeFiltersView=function(){T.setState({showAllFilters:!T.state.showAllFilters})},T.handleClearOrSelectAll=function(){var e;S.allCategoriesChecked(T.props.fileCategories,T.props.isPaperEnabled)?T.props.onFiltersChanged({fileCategories:r.__assign({},m.FILE_CATEGORIES_UNCHECKED)}):(T.props.onFiltersChanged({fileCategories:r.__assign({},m.FILE_CATEGORIES_CHECKED,(e={},e[y.FileCategory.PAPER]=T.props.isPaperEnabled?"checked":"unchecked",e))}),T.setState({showAllFilters:!0}))},T.renderDeletedFilter=function(){var e=T.props.deletedFiles;return s.default.createElement("div",{className:"filter-item__row"},s.default.createElement("div",{className:"filter-item__column"},s.default.createElement("div",{className:"filter-item__desc"},E._("By status")),s.default.createElement("div",null,s.default.createElement(l.Label,{htmlFor:"filter-type-all"},s.default.createElement(c.RadioButton,{"aria-checked":!0,checked:!e,id:"filter-type-all",value:"all",onChange:T.handleDeletedFilesAll}),E._("Available"))),s.default.createElement("div",null,s.default.createElement(l.Label,{htmlFor:"filter-type-deleted"},s.default.createElement(c.RadioButton,{"aria-checked":!0,checked:e,id:"filter-type-deleted",value:"deleted",onChange:T.handleDeletedFilesDeleted}),E._("Deleted")))))},T.renderFileTypeFilter=function(){var e=T.renderFileTypeFilterCheckboxes(),t=T.state.showAllFilters?"up":"down",r=T.state.showAllFilters?E._("Show Less"):E._("Show More"),n=S.allCategoriesChecked(T.props.fileCategories,T.props.isPaperEnabled),a=n?E._("Clear all"):E._("Select all");return s.default.createElement("div",{className:"filter-item__row"},s.default.createElement("div",{className:"filter-item__column"},s.default.createElement("div",{className:"filter-item__desc"},E._("By type"),s.default.createElement(u.TertiaryLink,{onClick:T.handleClearOrSelectAll,className:"filter-type-file-select-or-clear-all-button"},a)),e,s.default.createElement("button",{className:"show-more-filters",onClick:T.handleChangeFileTypeFiltersView},s.default.createElement("div",{className:"show-more-filters__arrow show-more-filters__arrow-"+t},s.default.createElement(i.IconArrow,{name:"right"})),r)))},T.renderFileTypeFilterCheckboxes=function(){var e=[],r=0;return Object.keys(t.FileCategoryData).forEach(function(t){(T.props.isPaperEnabled||t!==y.FileCategory.PAPER)&&(e.push(T.createCheckBox(t,r>=m.NUMBER_FILE_TYPE_CHECKBOXES_ALWAYS_SHOWN)),r++)}),e},T.createCheckBox=function(e,r){var i=t.FileCategoryData[e].label,c=t.FileCategoryData[e].icon,u=t.FileCategoryData[e].tooltip,p="filter-type-file-"+e,h=T.state.showAllFilters?"":n.default({"filter-type-file-checkbox__hidden":r}),_=s.default.createElement("div",{className:"filter-type-file-icon-wrapper"},s.default.createElement(d.Tooltip,{tooltipContent:u,positioning:"left"},s.default.createElement(o.IconContent,{className:"filter-type-file-icon",name:c})));return s.default.createElement("div",{key:p,className:"filter-type-file-checkbox-wrapper "+h},s.default.createElement(l.Label,{htmlFor:p,className:"filter-type-file-label filter-type-file-label__full-width"},s.default.createElement(a.Checkbox,{name:e,"aria-checked":!0,checked:T.props.fileCategories[e],id:p,onChange:T.handleFileTypeChanged,className:"filter-type-file-checkbox"}),i,_))},T.handleClick=function(e){e.stopPropagation()};var C=T.props.searchBarExperiments,F=S.fileCategoriesToString(T.props.fileCategories);return f.isInDeletedFilterRightRailExperiment(C)?T.state={showAllFilters:!!F}:T.state={showAllFilters:!0},T.props.fileTypeFilterEnabled&&S.isInFileTypeFilterExperiment(C)&&void 0===t.FileCategoryData&&(t.FileCategoryData=(w={},w[y.FileCategory.IMAGE]={label:E._("Images"),tooltip:E._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},w[y.FileCategory.DOCUMENT]={label:E._("Documents"),tooltip:E._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"txt-small"},w[y.FileCategory.PDF]={label:E._("PDFs"),tooltip:E._("PDF"),icon:"pdf-small"},w[y.FileCategory.SPREADSHEET]={label:E._("Spreadsheets"),tooltip:E._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"numbers-small"},w[y.FileCategory.PRESENTATION]={label:E._("Presentations"),tooltip:E._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"keynote-small"},w[y.FileCategory.AUDIO]={label:E._("Audio"),tooltip:E._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},w[y.FileCategory.VIDEO]={label:E._("Video"),tooltip:E._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},w[y.FileCategory.FOLDER]={label:E._("Folders"),tooltip:E._("Dropbox folders"),icon:"folder-small"},w[y.FileCategory.PAPER]={label:E._("Paper docs"),tooltip:E._("Dropbox Paper docs"),icon:"paper-small"},w[y.FileCategory.OTHER]={label:E._("Other"),tooltip:E._("Other file types"),icon:"unknown-small"},w)),T}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.fileCategories;e.fileTypeFilterEnabled||S.allCategoriesUnchecked(t)||this.props.onFiltersChanged({fileCategories:r.__assign({},m.FILE_CATEGORIES_UNCHECKED)}),_.prewarmFolderDialog()},t.prototype.render=function(){var e=this.props.searchBarExperiments;return s.default.createElement("div",{onClick:this.handleClick},s.default.createElement("div",{className:"filter-header"},s.default.createElement("h3",null,E._("Filter")),this.shouldRenderResetButton()&&this.renderResetButton()),s.default.createElement("div",{className:"filter-item"},this.renderPathFilter()),s.default.createElement("div",{className:"filter-item"},this.props.fileTypeFilterEnabled&&S.isInFileTypeFilterExperiment(e)&&this.props.searchType!==m.SearchType.IMAGE&&this.renderFileTypeFilter()),s.default.createElement("div",{className:"filter-item"},f.isInDeletedFilterRightRailExperiment(e)&&this.renderDeletedFilter()))},t})(s.default.Component);t.SearchFilters=v}),define("modules/clean/search/search_results/sidebar_view",["require","exports","tslib","external/react-redux","react","modules/clean/react/app_actions_view","modules/clean/react/browse/models","modules/clean/react/browse/selection_preview_pane","modules/clean/react/browse/util","modules/clean/react/extensions/data/selectors","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/types","modules/clean/react/folder_overview/sidebar_connected","modules/clean/react/folder_overview/utils","modules/clean/search/search_results/search_filters","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/types","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),c=r.__importStar(c),u=r.__importStar(u),g=r.__importStar(g),m=r.__importStar(m);var v=function(e,t){return{path:m.path(e),user:m.user(e),selectedFiles:m.selectedFiles(e),searchBarExperiments:g.searchBarExperiments(e),context:m.context(e),fileCategories:m.fileCategories(e),isNautilusEnabled:m.isNautilusEnabled(e),isPaperEnabled:m.isPaperEnabled(e),searchType:m.searchType(e),viewType:u.viewType(e),extensionsFeatureFlags:c.getFeatureFlags(e),sharingServiceInfo:c.sharingServiceInfo(e),shouldShowSelectionPreviewPane:g.shouldShowSelectionPreviewPane(e,t),shouldShowFolderOverview:g.shouldShowFolderOverview(e,t),shouldRenderFilters:!g.areInlineSearchFiltersEnabled(e),isFolderOverviewEnabled:g.isFolderOverviewEnabled(e),browsePostTTIExperiments:g.browsePostTTIExperiments(e),shouldEnableButtonExperiment:g.browseExperiments(e).expPrimaryButtonColor===f.ButtonColorVariants.SAPPHIRE}},w=(function(t){function n(e){var r=t.call(this,e)||this;return r.state={},r}return r.__extends(n,t),n.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var t;return r.__generator(this,function(n){switch(n.label){case 0:return[4,S.waitForTTI()];case 1:return n.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar)];case 2:return t=n.sent(),this.setState({fileActionsModule:t}),[2]}})})},n.prototype.render=function(){var e=this.props,t=e.context,r=e.selectedFiles,n=e.browsePostTTIExperiments,c=e.user,u=e.path,g=e.actionHandlers,m=e.searchBarExperiments,S=e.viewType,v=e.responsive,w=e.onSearchFiltersChanged,T=e.fileCategories,C=e.isNautilusEnabled,F=e.isPaperEnabled,R=e.extensionsFeatureFlags,I=e.sharingServiceInfo,b=e.searchType,A=e.shouldRenderFilters,x=e.onContextMenuClick,L=e.shouldShowSelectionPreviewPane,D=e.shouldShowFolderOverview,P=e.shouldEnableButtonExperiment,O=m.expSearchSuccessBanner,N=m.expSearchDetailsPaneVariants;if(!c)return null;if(r.size){var k=[];if(this.state.fileActionsModule&&(k=this.state.fileActionsModule.getActionsForFileCollection({files:r,context:t,user:c,viewType:S,extensionsFeatureFlags:R,sharingServiceInfo:I,actionHandlers:g,isSearchMode:!0,responsive:v,useSearchSuccessBanner:!!O,isSidebar:!0,expDeleteUseApiV2:!!n.expDeleteUseApiV2,expCopyUseApiV2:!!n.expCopyUseApiV2,expMoveUseApiV2:!!n.expMoveUseApiV2})),k.length){y.assert("function"!=typeof k[0],"The first primary menu item for AppActionsView must be a BrowseAppActionLink");var q=k[0],M=[{displayName:q.label,handleClick:q.performAction,iconName:q.iconName,className:q.className,disabled:q.disabled}],Q=[];k.slice(1).forEach(function(e,t){"function"==typeof e?N===f.DetailsPaneVariants.FOLDER_OVERVIEW||N===f.DetailsPaneVariants.CONTENT_SCROLL?M.push(e):Q.push(e):Q.push({displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled,key:e.key})});var H=l.getSelectedFilesText(r,t),V=r&&0!==r.size&&(N===f.DetailsPaneVariants.FOLDER_OVERVIEW||N===f.DetailsPaneVariants.CONTENT_SCROLL);return s.default.createElement(s.default.Fragment,null,L&&s.default.createElement(o.SelectionPreviewPane,{selectedFiles:r}),s.default.createElement(a.AppActionsView,{headerText:H,popoverTriggerLabel:E._("Actions"),primaryMenuItems:M,secondaryMenuItems:Q,responsive:v,hideHeaderText:!!L,shouldCollapseActions:V,onContextMenuClick:x,shouldEnableButtonExperiment:P}),D&&s.default.createElement(p.SidebarFolderOverview,{path:r.first().fq_path,nsId:r.first().target_ns?"ns:"+r.first().target_ns+"/":"ns:"+r.first().ns_id+"/"+r.first().ns_path,browseLoadingState:d.LoadingState.LOADED,componentNamespace:"search-sidebar",isReadOnly:!h.canEditOverviewForFile(r.first()),onlyRenderExistingFolderOverviews:!this.props.isFolderOverviewEnabled,canShareFolder:!i.File.isNoAccessSharedFolder(r.first())}))}return L&&s.default.createElement(o.SelectionPreviewPane,{selectedFiles:r})}return A&&s.default.createElement(_.SearchFilters,{user:c,searchBarExperiments:m,path:u,onFiltersChanged:w,fileCategories:T,fileTypeFilterEnabled:C,isPaperEnabled:F,searchType:b})},n})(s.default.PureComponent);t.SearchResultsSidebarViewComponent=w,t.SearchResultsSidebarView=n.connect(v)(w)}),define("modules/clean/search/search_results/view",["require","exports","tslib","classnames","external/immutable","external/lodash","react","spectrum/dimensions","spectrum/media_table","spectrum/snackbar","spectrum/tabbed_header","spectrum/table","spectrum/tip_card","modules/clean/analytics","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/react/async/loadable","modules/clean/react/badge","modules/clean/react/browse/models","modules/clean/react/files_view/column_helpers","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/types","modules/clean/react/files_view/util","modules/clean/react/image","modules/clean/react/snackbar","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky","modules/clean/react_format","modules/clean/search/api_helpers","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/static_urls","modules/core/i18n","modules/core/uri"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E,v,w,T,C,F,R,I,b,A,x,L,D,P,O,N,k,q){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),
s=r.__importStar(s),a=r.__importStar(a),i=r.__importDefault(i),g=r.__importStar(g),m=r.__importDefault(m),D=r.__importStar(D),O=r.__importStar(O);var M=f.Loadable({loader:function(){return new Promise(function(t,r){e(["modules/clean/react/retrieval_success_banner/search_feedback_banner"],t,r)}).then(r.__importStar).then(function(e){return e.SearchFeedbackBanner})}}),Q=f.Loadable({loader:function(){return new Promise(function(t,r){e(["modules/clean/react/retrieval_success_banner/search_satisfaction_banner"],t,r)}).then(r.__importStar).then(function(e){return e.SearchSatisfactionBanner})}}),H="imageSuggestionSnackBar",V=(function(e){function t(t){var s=e.call(this,t)||this;return s._handleScroll=function(){s.props.onScroll()},s._ensureFileViewerClosedIfNotPreviewing=function(){var e=m.default.deconstruct_url().qargs;s.props.ensureFileViewerClosedIfNotPreviewing(e)},s._handleFullSearchOnClick=function(e){e.preventDefault(),s.props.onSearch(s.props.latestQuery,"/")},s._handleEmptyFolderViewTTI=function(){s.props.handleComponentTTI("FilesViewController")},s._logHelpSearchClick=function(){var e=s.props,t=e.searchSessionId,r=e.user,n=e.viewType,a={search_type:"full_page",viewport:"full-view",search_session_id:t,view_type:n,timezone_offset:L.getCurrentTimezoneOffset()};h.SearchClientActivityLogger.log("help_center_link_clicked",r.id,a)},s._handleSearchAllFiles=function(e){e.preventDefault();var t=s.props.path;s.props.onSearchFiltersChanged({path:t,deletedFiles:!1})},s._handleSearchDeletedFiles=function(e){e.preventDefault();var t=s.props.path;s.props.onSearchFiltersChanged({path:t,deletedFiles:!0})},s._handleRemoveAllFilters=function(e){e.preventDefault();var t=s.props.shouldShowDeletedFiles;s.props.onSearchFiltersChanged({path:"/",deletedFiles:t,fileCategories:r.__assign({},D.FILE_CATEGORIES_UNCHECKED)})},s._getEmptyFolderViewUrl=function(e,t){var r=s.props,n=r.user,a=r.latestQuery,i=r.searchSessionId;return O.buildSearchURL({user:n,searchPath:e,normalizedQuery:a,searchSessionId:i,searchToken:O.getSearchCsrfToken(),qargs:{d:t?"1":void 0}}).toString()},s._getRemoveAllFiltersViewUrl=function(e){var t=s.props,r=t.user,n=t.latestQuery,a=t.searchSessionId;return O.buildSearchURL({user:r,searchPath:"/",normalizedQuery:n,searchSessionId:a,searchToken:O.getSearchCsrfToken(),qargs:{d:e?"1":void 0,file_categories:void 0}}).toString()},s._renderEmptyFolderSubtitle=function(){var e=s.props,t=e.path,r=e.shouldShowDeletedFiles,n=e.searchBarExperiments,a=e.fileCategories;return g.paths_are_equal(t,"/")&&!O.fileCategoriesSet(a,n)?r?x.reactFormat(k._("Try different keywords or <Link>search files that aren’t deleted</Link>"),{Link:i.default.createElement("a",{href:s._getEmptyFolderViewUrl(t,!1),onClick:s._handleSearchAllFiles})}):P.isInDeletedFilterRightRailExperiment(n)?x.reactFormat(k._("Try different keywords or <Link>search deleted files</Link>"),{Link:i.default.createElement("a",{href:s._getEmptyFolderViewUrl(t,!0),onClick:s._handleSearchDeletedFiles})}):P.isInShowHelpLinkHelpCenterLinkExperiment(n)?i.default.createElement("ul",{className:"search-results__no-results-links"},i.default.createElement("li",null,k._("To try again, enter different search words")),i.default.createElement("li",null,x.reactFormat(k._("To get help, head to the <Link>Dropbox help center</Link>"),{Link:i.default.createElement("a",{href:"https://help.dropbox.com?utm_source=InProductSearch&utm_medium=Search",target:"_blank",rel:"noopener",onClick:s._logHelpSearchClick})}))):k._("Try different keywords"):r?x.reactFormat(k._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>files that aren’t deleted</LinkDeleted>"),{LinkScope:i.default.createElement("a",{href:s._getEmptyFolderViewUrl("/",r),onClick:s._handleRemoveAllFilters}),LinkDeleted:i.default.createElement("a",{href:s._getEmptyFolderViewUrl(t,!1),onClick:s._handleSearchAllFiles})}):P.isInDeletedFilterRightRailExperiment(n)?x.reactFormat(k._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>deleted files</LinkDeleted>"),{LinkScope:i.default.createElement("a",{href:s._getEmptyFolderViewUrl("/",r),onClick:s._handleRemoveAllFilters}),LinkDeleted:i.default.createElement("a",{href:s._getEmptyFolderViewUrl(t,!0),onClick:s._handleSearchDeletedFiles})}):P.isInShowHelpLinkHelpCenterLinkExperiment(n)?i.default.createElement("ul",{className:"search-results__no-results-links"},i.default.createElement("li",null,x.reactFormat(k._("To try again, enter different search words or <LinkScope>clear all filters</LinkScope>"),{LinkScope:i.default.createElement("a",{href:s._getRemoveAllFiltersViewUrl(),onClick:s._handleRemoveAllFilters})})),i.default.createElement("li",null,x.reactFormat(k._("To get help, head to the <Link>Dropbox help center</Link>"),{Link:i.default.createElement("a",{href:"https://help.dropbox.com?utm_source=InProductSearch&utm_medium=Search",target:"_blank",rel:"noopener",onClick:s._logHelpSearchClick})}))):x.reactFormat(k._("Try <LinkScope>resetting all filters</LinkScope>"),{LinkScope:i.default.createElement("a",{href:s._getRemoveAllFiltersViewUrl(),onClick:s._handleRemoveAllFilters})})},s._renderEmptyFolderView=function(e){var t=s.props.path,r=g.paths_are_equal(t,"/"),n=k._("No results found");if(s.shouldRenderNewEmptyState())return i.default.createElement("div",null,i.default.createElement("div",{className:"u-font-center u-pad-top-xl"},i.default.createElement(R.Image,{src:N.static_url("/static/images/empty_states/search-vflHMNVT9.png"),srcHiRes:N.static_url("/static/images/empty_states/search@2x-vfly2B3kk.png"),alt:""}),i.default.createElement("h2",{className:"u-font-strong empty-folder-table-title"},n),i.default.createElement("span",null,s._renderEmptyFolderSubtitle())));var a=r?k._("Please update your search and try again"):k._("Search all of my Dropbox instead"),o=r?void 0:s._getFullSearchLink(),l=r?void 0:s._handleFullSearchOnClick;return i.default.createElement(T.EmptyFolderTable,{title:n,subtitle:a,subtitleLink:o,subtitleOnClick:l,onTTI:s._handleEmptyFolderViewTTI})},s._renderDeletedFilesTipcard=function(){return P.isInDeletedFilterRightRailExperiment(s.props.searchBarExperiments)&&s.props.shouldShowDeletedFiles&&s.props.loadingState===D.SearchLoadingState.LOADED&&s.props.searchResults.count()>0?i.default.createElement(p.TipCard,{className:"mc-tip-card--deleted-files"},x.reactFormat(k._("Can’t find what you’re looking for? <a>View all deleted files</a>"),{a:i.default.createElement("a",{href:"/deleted_files"})})):null},s._renderFixedHeader=function(e){var t=s.props,r=t.hasMoreResults,n=t.searchResults,a=r||n.size>0,o=k._("Search results");if(s._shouldShowTabs()){o=s.props.searchType===D.SearchType.ALL?k._("Text search results"):k._("Image search results")}return a?i.default.createElement("div",{className:"search-results-header"},i.default.createElement("h1",{className:"search-results-title"},o),i.default.createElement("div",{className:"search-results-subtitle"},s._searchResultsTitle(e))):null},s._shouldShowTabs=function(){return s.props.searchResultsExperiments.expImageContentSearch&&!s.props.dontRenderHeader},s._shouldShowSearchFeedbackBanner=function(){return s.props.browseExperiments.expUniversalSinglePageSearch&&s.props.searchResultsExperiments.expImageFeedbackBanner&&s.props.searchType===D.SearchType.IMAGE},s._getTabNavHeight=function(){return s._shouldShowTabs()?40:0},s._renderTabNav=function(){var e=null;if(s._shouldShowTabs()){var t="search-type-tab-"+s.props.searchType,r=[{id:"search-type-tab-"+D.SearchType.ALL,label:k._("Text")},{id:"search-type-tab-"+D.SearchType.IMAGE,label:k._("Images")}].map(function(e){var r=e.id==="search-type-tab-"+D.SearchType.IMAGE,a=function(){s._toggleTab(e.id,"tab")};return i.default.createElement(u.Tab,{id:e.id,key:e.id,active:t===e.id,className:n.default(e.id,{"has-new-badge":r}),onClick:a},e.label,r?i.default.createElement(S.Badge,{variant:S.BadgeVariant.ALPHA}):null)});e=i.default.createElement(o.Dimensions,{tagName:"div",className:"search-results-tab-container"},function(e){var n=e.width;return i.default.createElement(b.StickyContainer,{offsetTop:s.props.pageHeaderHeight,useNativeSticky:!0,useWindowToDetermineBottom:!0},i.default.createElement(A.Sticky,{offsetHeight:s._getTabNavHeight(),allowStickyOnLoad:!0},i.default.createElement(u.TabbedHeader,{activeTabId:t,onSelection:s._toggleTab,style:{width:n}},r)))})}return e},s._manageImageSuggestionSnackBar=function(){var e=s.props,t=e.imageSuggestionQuery,r=e.numImageSuggestions,n=e.searchType,a=e.showImageSuggestionSnackbar,o=s.state,l=o.imageSuggestionsNumberInSnackbar,u=o.closedImageSuggestionsSnackbar,d=o.queryInSnackbar;if(s.props.searchResultsExperiments.expImageContentSearch&&a)if(n===D.SearchType.IMAGE)l>0&&I.Snackbar.close(H);else if(r>0){var p=l!==r,_=t!==d,g=s.props,m=g.searchSessionId,f=g.user,S=g.viewType,y=g.imageSuggestionRequestId,E={search_type:"full_page",viewport:"full-view",request_id:y,search_session_id:m,view_type:S,timezone_offset:L.getCurrentTimezoneOffset()};if(u||!p&&!_)return;var v=function(){s.setState({imageSuggestionsNumberInSnackbar:0,queryInSnackbar:void 0})},w=function(){s.setState({closedImageSuggestionsSnackbar:!0}),E.timezone_offset=L.getCurrentTimezoneOffset(),h.SearchClientActivityLogger.log("image_search_snackbar_closed",f.id,E)},T=function(){s._toggleTab("search-type-tab-"+D.SearchType.IMAGE,"snackbar")},C=i.default.createElement(I.Snackbar,{variant:"generic",title:s._getSnackbarText(t,r),closeButtonText:k._("Close"),onClosed:v,onCloseClick:w,id:H,isLowPriority:!0,accessibleAnnouncement:s._getRawSnackbarText(t,r)},i.default.createElement(c.SnackbarAction,{onClick:T},k._("View")));l>0?I.Snackbar.update(C):I.Snackbar.show(C),h.SearchClientActivityLogger.log("image_search_snackbar_shown",f.id,E),s.setState({imageSuggestionsNumberInSnackbar:r,queryInSnackbar:t})}else l>0&&I.Snackbar.close(H)},s._getSnackbarText=function(e,t){var r=_.Emstring.em_snippet(e,15,.6);return t>100?x.reactFormat(k._("100+ results for <strong>%(query)s</strong> in image search"),{query:r,strong:i.default.createElement("strong",null)}):x.reactFormat(k.ungettext("%(size)d result for <strong>%(query)s</strong> in image search","%(size)d results for <strong>%(query)s</strong> in image search",t).format({size:t,query:r}),{strong:i.default.createElement("strong",null)})},s._getRawSnackbarText=function(e,t){var r=_.Emstring.em_snippet(e,15,.6);return t>100?k._("100+ results for %(query)s in image search").format({query:r}).toString():k.ungettext("%(size)d result for %(query)s in image search","%(size)d results for %(query)s in image search",t).format({size:t,query:r}).toString()},s._renderSearchFeedbackBanner=function(){return s._shouldShowSearchFeedbackBanner()?s.props.searchResultsExperiments.expSatisfactionBanner?s.props.responsive.isMatchedMedium&&i.default.createElement(Q,null):i.default.createElement(M,null):null},s._toggleTab=function(e,t){var r=s.props,n=r.onSearchFiltersChanged,a=r.imageSuggestionRequestId,i=e.substr("search-type-tab-".length);if(i!==s.props.searchType){var o=s.props,l=o.searchSessionId,c=o.user,u=o.viewType,d={search_type:"full_page",viewport:"full-view",request_id:a,search_session_id:l,view_type:u,timezone_offset:L.getCurrentTimezoneOffset(),extra:{search_type:i,ref:t||"tab"}};h.SearchClientActivityLogger.log("switch_search_type",c.id,d),n({searchType:i})}},s.state={viewTypeColumns:s._generateViewTypeColumns(),searchResultsWithUserDefinedItem:s._generateSearchResultsWithUserDefinedItem(t.searchResults),imageSuggestionsNumberInSnackbar:0,closedImageSuggestionsSnackbar:!1},s}return r.__extends(t,e),t.prototype.componentWillMount=function(){this.props.browseExperiments.expUniversalSinglePageSearch||m.default.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidUpdate=function(){this._manageImageSuggestionSnackBar()},t.prototype.componentDidMount=function(){window.addEventListener("scroll",this._handleScroll)},t.prototype.componentWillReceiveProps=function(e){var t=this.props,r=t.currentSort,n=t.searchResults,s=e.viewType,a=e.currentSort,i=e.searchResults,o=this.state.viewTypeColumns;r&&a&&o&&!O.areSortOrdersEqual(r,a)&&this.setState({viewTypeColumns:this._updateViewTypeColumns(o,s,a)}),n!==i&&this.setState({searchResultsWithUserDefinedItem:this._generateSearchResultsWithUserDefinedItem(i)})},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this._handleScroll),m.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing),this.state.imageSuggestionsNumberInSnackbar>0&&I.Snackbar.close(H)},t.prototype._getFullSearchLink=function(){var e=this.props,t=e.latestQuery,r=e.searchSessionId,n=e.user;return q.URI.parse("/search/"+n.role).setQuery({path:"/",query:t,search_session_id:r}).toString()},t.prototype.shouldRenderNewEmptyState=function(){var e=this.props,t=e.searchBarExperiments;return e.browseExperiments.expUniversalSinglePageSearch||O.isInFileTypeFilterExperiment(t)||P.isInDeletedFilterRightRailExperiment(t)||P.isInSinglePageSearchExperiment(t)||P.isInShowHelpLinkHelpCenterLinkExperiment(t)},t.prototype._searchResultsTitle=function(e){var t=P.isInSinglePageSearchExperiment(this.props.searchBarExperiments)&&this.props.loadingState===D.SearchLoadingState.LOADING_FIRST_PAGE?this.props.queryForResultsTitle:this.props.latestQuery,r=this.props,n=r.searchResults,s=r.path,a=r.viewType,o=r.shouldShowDeletedFiles,l=n.size,c=g.paths_are_equal(s,"/"),u=this.props,d=u.loadingState,p=u.hasMoreResults;if(0===l||d===D.SearchLoadingState.LOADING_FIRST_PAGE)return"";if(!this.shouldRenderNewEmptyState()&&0===l)return"";var h,m=e.isMatchedMedium?e.isMatchedLarge?30:20:10;a===C.ViewType.List&&(m/=2);if(c){var f=_.Emstring.em_snippet(t,m,.6);h=o?x.reactFormat(k.ungettext("%(size)d deleted result for <strong>%(query)s</strong>","%(size)d deleted results for <strong>%(query)s</strong>",l).format({size:l,query:f}),{strong:i.default.createElement("strong",null)}):p?x.reactFormat(k._("%(size)s+ results for <strong>%(query)s</strong>"),{size:l,query:f,strong:i.default.createElement("strong",null)}):x.reactFormat(k.ungettext("%(size)d result for <strong>%(query)s</strong>","%(size)d results for <strong>%(query)s</strong>",l).format({size:l,query:f}),{strong:i.default.createElement("strong",null)})}else{var S=_.Emstring.em_snippet(g.filename(s),m/2,.6),f=_.Emstring.em_snippet(t,m/2,.6);h=o?x.reactFormat(k.ungettext("%(size)d deleted result for <strong>%(query)s</strong> in %(path)s","%(size)d deleted results for <strong>%(query)s</strong> in %(path)s",l).format({size:l,query:f,path:S}),{strong:i.default.createElement("strong",null)}):p?x.reactFormat(k._("%(size)s+ results for <strong>%(query)s</strong> in %(path)s"),{size:l,query:f,path:S,strong:i.default.createElement("strong",null)}):x.reactFormat(k.ungettext("%(size)d result for <strong>%(query)s</strong> in %(path)s","%(size)d results for <strong>%(query)s</strong> in %(path)s",l).format({size:l,query:f,path:S}),{strong:i.default.createElement("strong",null)})}return h},t.prototype._getLoadingState=function(){var e=this.props,t=e.searchResults,r=e.searchBarExperiments,n=e.loadingState;return P.isInSinglePageSearchExperiment(r)&&!t.isEmpty()?C.LoadingState.LOADED:n===D.SearchLoadingState.LOADING_FIRST_PAGE?C.LoadingState.LOADING_FIRST_PAGE:n===D.SearchLoadingState.LOADING_ADDITIONAL_PAGE?C.LoadingState.LOADING_REMAINING_PAGES:C.LoadingState.LOADED},t.prototype._renderSearchResultItems=function(e){var t=this.props,n=t.getOverflowMenuActions,s=t.onFocusSearchBar,o=t.onLocationLinkClick,l=t.onNavigateToFileOrFolder,c=t.onNavigateToParentFolder,u=t.onOpenFileSharedWithMe,d=t.onOpenPaper,p=t.context,h=t.fileRename,_=t.searchResults,g=t.getIsFileJumping,m=t.isFileViewerShown,f=t.arePostTTIModulesLoaded,S=t.handleComponentTTI,y=t.onSelectionChange,E=t.selectedFiles,T=t.selection,R=t.setFileUploaderPath,I=t.viewType,b=t.user,A=t.path,x=t.filesViewActionHandlers,L=t.renderSharedWithController,D=t.hrefForFile,P=t.starredState,O=t.pageHeaderHeight,N=t.onStarClick,k=t.extensionsFeatureFlags,q=t.sharingServiceInfo,M=t.currentSort,Q=t.onSortChange,H=t.onRangeInView,V=t.scrollContainer,U=t.filteredContactName,B=this.props.searchBarExperiments.expSearchSuccessBanner,W=this.state.viewTypeColumns,G=this.props.searchResultsExperiments.expHighlightedTruncatedString,z=this.props.searchResultsExperiments.expSnippets,Y=this.props.searchResultsExperiments.expSelectableFswm,K=F.getRedesignProps(this.props.browseExperiments.expBrowseWebFilesViewRedesignVariants),j=K.clickToSelect,Z=K.highDensitySearch;return i.default.createElement(w.FilesViewController,r.__assign({},x,{getOverflowMenuActions:n,onLocationLinkClick:o,onNavigateToFileOrFolder:l,onNavigateToParentFolder:c,onOpenFileSharedWithMe:u,onOpenPaper:d,context:p,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:C.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:h,getIsFileJumping:g,isFileViewerShown:m,isSearchMode:!0,arePostTTIModulesLoaded:f,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:S,onSelectionChange:y,onFocusSearchBar:s,path:A,selectedFiles:E,selection:T,setFileUploaderPath:R,showFileUploaderModal:a.noop,user:b,viewType:I,totalNumFiles:_.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:L,hrefForFile:D,viewTypes:v.AllViewTypes,viewTypeLabels:v.ViewTypeLabels,starredState:P,stickyOffsetTop:O+this._getTabNavHeight(),extensionsFeatureFlags:k,sharingServiceInfo:q,onStarClick:N,useSearchSuccessBanner:!!B,items:this._generateFilesViewItems(),isStickyColumnHeader:!0,viewTypeColumns:W,onColumnsChanged:a.noop,currentSort:M,onSortChange:Q,expHighlightedTruncatedString:G,expSnippets:z,expSelectableFswm:Y,selectionMethod:j?C.SelectionMethod.CLICK:C.SelectionMethod.CHECKBOX,highDensity:Z,onRangeInView:H,scrollContainer:V,filteredContactName:U}))},t.prototype._generateColumns=function(e){var t=this.props,r=t.shouldShowDeletedFiles,n=t.viewType,s=this.state.viewTypeColumns;return r?v.SEARCH_LIST_VIEW_COLUMNS_DELETED:s?s[n]:v.SEARCH_LIST_VIEW_COLUMNS},t.prototype._generateViewTypeColumns=function(){var e,t=this.props,r=t.viewType,n=t.currentSort,s=(e={},e[C.ViewType.List]=v.SEARCH_LIST_VIEW_SORT_ENABLED_COLUMNS,e[C.ViewType.Grid]=v.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS,e[C.ViewType.LargeGrid]=v.SEARCH_GRID_VIEW_SORT_ENABLED_COLUMNS,e);return n?this._updateViewTypeColumns(s,r,n):s},t.prototype._isDeletedFile=function(e){return e instanceof y.File&&e.isDeleted},t.prototype._generateSearchResultsWithUserDefinedItem=function(e){var t=this,r=e.filter(function(e){return t._isDeletedFile(e)});if(r.size>0){var n=e.filter(function(e){return!t._isDeletedFile(e)}),a=function(e){var t=e.rowIndex,r=e.topOffset;return i.default.createElement(l.CulledMediaRow,{"aria-rowindex":void 0!==t?t+1:void 0,className:"brws-user-defined-item-row",topOffset:r},i.default.createElement(d.TableCell,{key:"checkboxCell",className:"brws-checkbox-cell"}),i.default.createElement(d.TableCell,{className:"mc-media-cell"},i.default.createElement(p.TipCard,{className:"search-results__deleted-files-notice","non-dismissible":!0},k._("Deleted content isn’t sorted by last modified"))))},o=new y.UserDefinedItem({renderUserDefinedItemRow:a});return n.concat([o]).concat(r)}return s.List()},t.prototype._generateFilesViewItems=function(){var e=this,t=this.props,r=t.searchResults,n=t.viewType,s=t.currentSort,a=r.filter(function(t){return e._isDeletedFile(t)});return n===C.ViewType.List&&s&&s.sortField!==C.SortField.RELEVANCE&&a.size>0?this.state.searchResultsWithUserDefinedItem:r},t.prototype._updateViewTypeColumns=function(e,t,n){var s,a,i=e[t];if(t===C.ViewType.List)return r.__assign({},e,(s={},s[t]=E.swapColumns(i,i[1].sortField,n.sortField),s));var o=e[C.ViewType.List];return r.__assign({},e,(a={},a[t]=E.swapColumns(i,i[0].sortField,n.sortField),a[C.ViewType.List]=E.swapColumns(o,o[1].sortField,n.sortField),a))},t.prototype.render=function(){var e=this.props.responsive;return i.default.createElement("div",{className:"search-results"},this.props.dontRenderHeader?null:this._renderTabNav(),this.props.dontRenderHeader?null:this._renderFixedHeader(e),this._renderSearchFeedbackBanner(),this._renderSearchResultItems(e),this._renderDeletedFilesTipcard())},t})(i.default.Component);t.SearchResultsView=V}),define("modules/clean/search/single_page/api",["require","exports","modules/clean/contacts/data_v2"],function(e,t,r){"use strict";function n(e){return a||(a=new s(e)),a}Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=this;this.filterContact=function(e){return!e.group_id&&!!e.dbx_account_id},this.fetchContacts=function(e){return new Promise(function(r,n){""===e?t.dataSource.getAll(r):t.dataSource.search(e,r)})},this.dataSource=new r.ContactsDataSourceV2(e,this.filterContact)}return e})(),a=null;t.getContactApiClient=n}),define("modules/clean/search/single_page/data/action_creators",["require","exports","tslib","external/immutable","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/data/selectors","modules/clean/react/browse/models","modules/clean/react/extensions/data/store","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/file_actions/api_v2","modules/clean/react/files_view/file_actions/file_from_metadata","modules/clean/react/files_view/file_actions/snackbars","modules/clean/react/files_view/types","modules/clean/react/selection","modules/clean/react/snackbar","modules/clean/react/starred/browse_update","modules/clean/search/api","modules/clean/search/constants","modules/clean/search/models","modules/clean/search/search_bar/api","modules/clean/search/search_helpers","modules/clean/search/single_page/api","modules/clean/search/single_page/constants","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/types","modules/clean/search/single_page/logger","modules/clean/search/single_page/navigation","modules/clean/search/single_page/utils","modules/clean/search/store_helpers","modules/clean/search/types","modules/clean/storage","modules/clean/undo","modules/clean/web_timing_logger","modules/core/exception","modules/core/i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E,v,w,T,C,F,R,I,b,A,x,L,D,P,O,N,k,q,M,Q,H){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),s=r.__importStar(s),a=r.__importStar(a),i=r.__importStar(i),o=r.__importStar(o),c=r.__importStar(c),p=r.__importStar(p),h=r.__importStar(h),_=r.__importStar(_),m=r.__importStar(m),b=r.__importStar(b),A=r.__importStar(A),L=r.__importStar(L);var V=null,U=null;t.clear=function(){return function(e,t){var r="/";try{r=c.path(t())}catch(e){}null!==V&&clearTimeout(V),e({type:x.ActionTypes.SET_QUERY,payload:{query:""}}),e({type:x.ActionTypes.CLEAR_RESULTS}),e({type:x.ActionTypes.SET_PATH,payload:{path:r}}),e({type:x.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:w.FILE_CATEGORIES_UNCHECKED}}),e(Z({loadingState:w.SearchLoadingState.ZERO_QUERY})),e({type:x.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:void 0}})}},t.setUser=function(e){var t=e.user,r=e.options;return{type:x.ActionTypes.SET_USER,payload:{user:t,options:r}}},t.setExperiments=function(e){var t=e.experiments;return{type:x.ActionTypes.SET_EXPERIMENTS,payload:{experiments:t}}},t.setQuery=function(e){var r=e.query,n=e.skipSetUrl,s=e.alwaysTriggerSearch;return function(e,a){var i=O.normalize(r),o=i!==A.normalizedQuery(a()),l=""===A.normalizedQuery(a())&&o,c=P.shouldStartNewSearchSession(a(),{query:r}),u=b.isSearchAsYouTypeEnabled(a())||s,d=A.user(a());if(d&&(e({type:x.ActionTypes.SET_QUERY,payload:{query:r}}),o)){if(e(t.resetTTI()),""===i&&(e(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:i})),e(re({lastQueryWithPeopleSuggestionsLoaded:i}))),c&&e(t.setSessionId({sessionId:P.generateRandomId()})),u&&(l||c)&&e(Z({loadingState:w.SearchLoadingState.LOADING_FIRST_PAGE})),se(),!n&&u&&D.searchNavigationManager.set(A.searchUrl(a())),""===i&&!A.filteredAccountId(a())&&u)return e(K()),void e(Z({loadingState:w.SearchLoadingState.ZERO_QUERY}));if(b.isInPosteriorQuerySuggestionsExperiment(a())&&i){var p=b.searchBarExperiments(a()).expQuerySuggestions,h=p===N.QuerySuggestionsVariants.SUGGESTIONS_WITH_NAUTILUS?p:N.QuerySuggestionsVariants.PRIOR_AND_POSTERIOR_SUGGESTIONS;e(t.fetchQuerySuggestions({query:i,maxResults:I.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY,variant:h}))}b.isInPeopleFilterExperiment(a())&&!A.filteredAccountId(a())&&i&&e(t.fetchPeopleSuggestions({query:i,user:d})),u&&(V=setTimeout(function(){e($({loadingDeletedResults:!1})),t.fetchFirstPage(e,a),V=null},I.SEARCH_QUERY_DEBOUNCE))}}},t.setPath=function(e){var r=e.path,n=e.viewport;return function(e,s){a.paths_are_equal(r,A.path(s()))||(e({type:x.ActionTypes.SET_PATH,payload:{path:r}}),n&&L.logScopeChipChanged(r,n),t._performSearch(e,s))}},t.setFileCategories=function(e){var r=e.fileCategories;return function(e,n){F.fileCategoriesToString(r)!==A.fileCategoriesString(n())&&(e({type:x.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:r}}),D.searchNavigationManager.set(A.searchUrl(n()),!0),e(Z({loadingState:w.SearchLoadingState.LOADING_FIRST_PAGE})),t._performSearch(e,n))}},t.setSearchType=function(e){var r=e.searchType;return function(e,n){r!==A.searchType(n())&&(e(t.stopAndLogDwellTime()),e({type:x.ActionTypes.SET_SEARCH_TYPE,payload:{searchType:r}}),t._performSearch(e,n))}},t.setSortOrder=function(e){var r=e.sortOrder;return function(e,n){if(!ce(r,A.sortOrder(n()))){if(e({type:x.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:r}}),L.logSortOrderChanged(r),D.searchNavigationManager.set(A.searchUrl(n()),!0),ue(r.sortField,A.cachedFullResults(n()),A.cachedFullResultsSortField(n())))return e(t.sortCachedResults({sortOrder:r})),void window.scrollTo(0,0);e(Z({loadingState:w.SearchLoadingState.LOADING_FIRST_PAGE})),t._performSearch(e,n)}}},t.setFilteredAccountId=function(e){var r=e.filteredAccountId,n=e.skipSetUrl;return function(e,s){if(r!==A.filteredAccountId(s())){if(r||L.logPeopleFilterRemoved(),e({type:x.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:r}}),n||D.searchNavigationManager.set(A.searchUrl(s())),!r&&!A.normalizedQuery(s()))return e(K()),void e(Z({loadingState:w.SearchLoadingState.ZERO_QUERY}));n||t._performSearch(e,s)}}},t.fetchPeopleSuggestions=function(e){var t=e.user,n=e.query;return function(e,s){return r.__awaiter(this,void 0,void 0,function(){var a,i,o,l;return r.__generator(this,function(r){switch(r.label){case 0:if(a=O.normalize(n),i=A.peopleSuggestionsCache(s())[a]){if(o=i.loadingState,o===N.PeopleSuggestionsLoadingState.LOADING)return[2];if(o===N.PeopleSuggestionsLoadingState.LOADED)return e(re({lastQueryWithPeopleSuggestionsLoaded:a})),[2];if(o===N.PeopleSuggestionsLoadingState.DISMISSED)return e(te({normalizedQuery:a,peopleSuggestionsData:{loadingState:N.PeopleSuggestionsLoadingState.LOADED}})),e(re({lastQueryWithPeopleSuggestionsLoaded:a})),[2]}return e(te({normalizedQuery:a,peopleSuggestionsData:{contacts:[],loadingState:N.PeopleSuggestionsLoadingState.LOADING}})),[4,R.getContactApiClient(t).fetchContacts(a)];case 1:return l=r.sent(),L.logPeopleFilterResponse(l.length),e(te({normalizedQuery:a,peopleSuggestionsData:{contacts:l,loadingState:N.PeopleSuggestionsLoadingState.LOADED}})),e(re({lastQueryWithPeopleSuggestionsLoaded:a})),[2]}})})}},t.dismissPeopleSuggestions=function(e){var t=e.query;return function(e,r){var n=O.normalize(t),s=A.peopleSuggestionsCache(r())[n];s&&s.loadingState===N.PeopleSuggestionsLoadingState.LOADED&&e(te({normalizedQuery:n,peopleSuggestionsData:{loadingState:N.PeopleSuggestionsLoadingState.DISMISSED}}))}},t.updateFromUrl=function(e){var r=e.path,n=e.query,s=e.search_session_id,a=e.preview,i=e.file_categories,o=e.search_type,l=e.search_order_by,c=e.search_reverse_order,u=e.search_account_id,d=e.search_from;return function(e,p){var h=!1,_=!1,g=n||"";g!==A.query(p())&&(h=!0,e({type:x.ActionTypes.SET_QUERY,payload:{query:g}})),void 0!==r&&r!==A.path(p())&&(h=!0,e({type:x.ActionTypes.SET_PATH,payload:{path:r}})),i!==A.fileCategoriesString(p())&&(h=!0,e({type:x.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:F.fileCategoriesFromString(i||"")}})),void 0!==o&&o!==A.searchType(p())&&(h=!0,e({type:x.ActionTypes.SET_SEARCH_TYPE,payload:{searchType:o}}));var m=oe(d),f=ie(l),S=le(c),y={sortField:f,sortDirection:S};ce(y,A.sortOrder(p()))||(e({type:x.ActionTypes.SET_SORT_ORDER,payload:{sortOrder:y}}),L.logSortOrderChanged(y),ue(f,A.cachedFullResults(p()),A.cachedFullResultsSortField(p()))?_=!0:h=!0),u!==A.filteredAccountId(p())&&(h=!0,e({type:x.ActionTypes.SET_FILTERED_ACCOUNT_ID,payload:{filteredAccountId:u}})),void 0!==s&&s!==A.sessionId(p())&&(h=!0,e(t.setSessionId({sessionId:s}))),a!==A.previewFileId(p())&&e({type:x.ActionTypes.SET_PREVIEW_FILE_ID,payload:{previewFileId:""===a?void 0:a}}),h?""!==A.normalizedQuery(p())||A.filteredAccountId(p())?e(function(e,r){return t._performSearch(e,r,m)}):(e(K()),e(Z({loadingState:w.SearchLoadingState.ZERO_QUERY}))):_&&e(t.sortCachedResults({sortOrder:y}))}},t.fetchNextPage=function(){return function(e,n){var s=A.user(n()),a=A.path(n()),i=A.normalizedQuery(n()),o=A.loadingDeletedResults(n()),l=A.hasMoreResults(n()),c=A.searchType(n()),p=A.fileCategoriesString(n()),h=A.filteredAccountId(n());s&&(i||h)&&l&&(o&&(p.length||h)||(A.results(n()).size>0&&e(Z({loadingState:w.SearchLoadingState.LOADING_ADDITIONAL_PAGE})),v.searchApiClient.loadPartialResults(r.__assign({},ne(n()),{deleted:o,start:A.nextPageOffset(n()),maxResults:I.SEARCH_ADDITIONAL_PAGE_SIZE,onSuccess:function(r){var l=r.searchResults;P.hasSearchChanged(n(),{query:i,path:a,filteredAccountId:h,searchType:c,fileCategoriesString:p})||(e(Z({loadingState:w.SearchLoadingState.LOADED})),e(j({searchResults:l})),o?l.hasMore||(e(t.setCachedFullResultsSortField({cachedFullResultsSortField:A.sortOrder(n()).sortField})),e(t.setCachedFullResults({cachedFullResults:A.results(n())}))):(l.hasMore||c!==w.SearchType.ALL||0!==A.fileCategoriesArray(n()).length||e($({loadingDeletedResults:!0})),l.results.length&&d.initializeStore(s,l.results.filter(function(e){return e instanceof u.File})),E.checkForMissingStarredData({items:l.results,user:s})))},onError:function(e){Q.reportException({err:new Error(e),severity:"non-critical",tags:["js:search"]})}}))))}},t.setSelection=function(e){var t=e.selection;return{type:x.ActionTypes.SET_SELECTION,payload:{selection:t}}},t.setPreviewFile=function(e){var r=e.previewFileId;return function(e,n){e(void 0===r?t.startDwellTime():t.stopAndLogDwellTime()),e({type:x.ActionTypes.SET_PREVIEW_FILE_ID,payload:{previewFileId:r}}),D.searchNavigationManager.set(A.searchUrl(n()),!0)}},t.setSessionId=function(e){var t=e.sessionId;return{type:x.ActionTypes.SET_SESSION_ID,payload:{sessionId:t}}},t.performSearch=function(){return function(e,r){""!==A.normalizedQuery(r())||A.filteredAccountId(r())?(D.searchNavigationManager.set(A.searchUrl(r())),t._performSearch(e,r)):(e(K()),e(Z({loadingState:w.SearchLoadingState.ZERO_QUERY})),D.searchNavigationManager.set(A.searchUrl(r())))}},t.fetchRecentItems=function(){var e=this;return function(t,n){return r.__awaiter(e,void 0,void 0,function(){var e,s,a,i,o,l,c,u,d,p,h;return r.__generator(this,function(r){switch(r.label){case 0:if(e=A.user(n()),!e)return[2];s=b.experiments(n()).search_experiment_recent_files,t(z({recentItemsLoadingState:N.RecentItemsLoadingState.LOADING})),a=Date.now(),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,C.getRecents(e.id,w.SEARCH_RECENT_FILES_CAPACITY)];case 2:return i=r.sent().recent_events,o=i.map(F.recentItemFromServerObject),l=F.createRecentItemsMap(o),t(G({recentItems:l})),c=o.filter(function(e){return e instanceof T.RecentFile}),
u=o.filter(function(e){return e instanceof T.RecentPaper}),d=[],c.length>0&&d.push(B(c,e,t,n)),s===N.RecentFilesVariants.ON_MODIFIED_DATE&&u.length>0&&d.push.apply(d,u.map(function(r){return W(r,e,t,n)})),[4,Promise.all(d)];case 3:return r.sent(),t(z({recentItemsLoadingState:N.RecentItemsLoadingState.LOADED})),L.logRecentFilesFetched(l.size,Date.now()-a),[3,5];case 4:return p=r.sent(),h=p.raw?new Error(p.raw.responseBody):p,Q.reportException({err:h,tags:["search_bar","search_bar_recents"],severity:"non-critical"}),t(z({recentItemsLoadingState:N.RecentItemsLoadingState.FAILED})),L.logRecentFilesFailed(),[3,5];case 5:return[2]}})})}};var B=function(e,t,n,s){return r.__awaiter(this,void 0,void 0,function(){var a,i,o,l,c;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),a=e.map(function(e){return e.file_id}),[4,C.getFileMetadata(t,a)];case 1:return i=r.sent(),o=new Map,A.recentItems(s()).forEach(function(e,t){o.set(t,e)}),i.forEach(function(e){var t=e.file_metadata,r=t.file_id;if(o.has(r)){var n=o.get(r);o.set(r,n.merge({last_modified_date:t.ts?1e3*t.ts:t.ts,last_modified_name:t.last_modified_name,thumbnail_url_tmpl:t.thumbnail_url_tmpl}))}}),n(G({recentItems:o})),[3,3];case 2:return l=r.sent(),c=l.raw?new Error(l.raw.responseBody):l,Q.reportException({err:c,tags:["search_bar","search_bar_recents"],severity:"non-critical"}),n(z({recentItemsLoadingState:N.RecentItemsLoadingState.FAILED})),L.logRecentFilesFailed(),[3,3];case 3:return[2]}})})},W=function(e,t,n,s){return r.__awaiter(this,void 0,void 0,function(){var a,i,o,l,c,u,d,p;return r.__generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),a=e.pad_id,[4,C.getPaperMetadata(t.id,a)];case 1:return i=r.sent(),o=i.last_updated_date,l=i.last_editor,c=new Map,A.recentItems(s()).forEach(function(e,t){c.set(t,e)}),c.has(a)&&(u=c.get(a),c.set(a,u.merge({last_modified_date:Date.parse(o),last_modified_name:l}))),n(G({recentItems:c})),[3,3];case 2:return d=r.sent(),p=d.raw?new Error(d.raw.responseBody):d,Q.reportException({err:p,tags:["search_bar","search_bar_recents"],severity:"non-critical"}),n(z({recentItemsLoadingState:N.RecentItemsLoadingState.FAILED})),L.logRecentFilesFailed(),[3,3];case 3:return[2]}})})},G=function(e){var t=e.recentItems;return{type:x.ActionTypes.SET_RECENT_ITEMS,payload:{recentItems:t}}},z=function(e){var t=e.recentItemsLoadingState;return{type:x.ActionTypes.SET_RECENT_ITEMS_LOADING_STATE,payload:{recentItemsLoadingState:t}}};t._performSearch=function(e,r,n){void 0===n&&(n=w.SearchOriginPathway.WEB),(""!==A.normalizedQuery(r())||A.filteredAccountId(r()))&&(e(t.resetTTI()),D.searchNavigationManager.set(A.searchUrl(r())),e(Z({loadingState:w.SearchLoadingState.LOADING_FIRST_PAGE})),e($({loadingDeletedResults:!1})),e(t.setCachedFullResultsSortField({cachedFullResultsSortField:void 0})),e(t.setCachedFullResults({cachedFullResults:void 0})),null!==V&&clearTimeout(V),t.fetchFirstPage(e,r,n))},t.fetchFirstPage=function(e,n,s){void 0===s&&(s=w.SearchOriginPathway.WEB);var a=A.user(n()),i=A.path(n()),o=A.normalizedQuery(n()),l=A.loadingDeletedResults(n()),c=A.searchType(n()),p=A.fileCategoriesString(n()),h=b.isSearchAsYouTypeEnabled(n())?I.SEARCH_FIRST_PAGE_SIZE:I.SEARCH_ADDITIONAL_PAGE_SIZE,_=A.filteredAccountId(n());if(a&&(o||_)){var g=b.artificalLatency(n()),m=(new Date).getTime();l||(e(t.stopAndLogDwellTime()),L.logQueryStarted(s)),se(),v.searchApiClient.loadPartialResults(r.__assign({},ne(n()),{start:0,maxResults:h,includeBrowseContext:!0,artificialLatency:g,onSuccess:function(r){var h=r.searchResults,g=r.requestId,f=r.context;if(!P.hasSearchChanged(n(),{query:o,path:i,filteredAccountId:_,searchType:c,fileCategoriesString:p})){if(!l){var S=(new Date).getTime()-m;setTimeout(function(){L.logQueryCompleted(S,s)},5)}if(!(h.results.length||h.hasMore||A.loadingDeletedResults(n())||c!==w.SearchType.ALL||0!==A.fileCategoriesArray(n()).length||A.filteredAccountId(n())))return e($({loadingDeletedResults:!0})),e(t.fetchImageSuggestionCount()),void t.fetchFirstPage(e,n);e(t.setResults({searchResults:h,context:f,requestId:g})),e(t.handleComponentTTI({component:"results",query:o})),e(t.startDwellTime()),window.scrollTo(0,0),h.hasMore?e(Z({loadingState:w.SearchLoadingState.LOADING_ADDITIONAL_PAGE})):(e(Z({loadingState:w.SearchLoadingState.LOADED})),c===w.SearchType.ALL&&e($({loadingDeletedResults:!0}))),se(),U=setTimeout(function(){P.hasSearchChanged(n(),{query:o,path:i,filteredAccountId:_,searchType:c,fileCategoriesString:p})||(e(t.fetchNextPage()),e(t.fetchImageSuggestionCount()))},I.SEARCH_SECOND_PAGE_DEBOUNCE),!l&&h.results.length&&d.initializeStore(a,h.results.filter(function(e){return e instanceof u.File})),E.checkForMissingStarredData({items:h.results,user:a}),M.get_timer(I.SEARCH_WEB_TIMER).end()}},onError:function(t){var r=(new Date).getTime()-m;L.logQueryFailed(r,t,s),Q.reportException({err:new Error(t),severity:"non-critical",tags:["js:search"]}),e(Z({loadingState:w.SearchLoadingState.LOAD_ERROR}))}}))}},t.resetTTI=function(){return function(e,t){e(X()),M.get_timer(I.SEARCH_WEB_TIMER).restart(),M.get_timer(I.SEARCH_WEB_TIMER).initialize({requireTTI:!0,requireTTV:!1,url:I.SEARCH_WEB_TIMER})}},t.handleComponentTTI=function(e){var t=e.component,r=e.query;return function(e,n){A.ttiComponents(n()).has(t)||O.normalize(r)===A.normalizedQuery(n())&&("results"===t&&M.get_timer(I.SEARCH_WEB_TIMER).fetchedDataRequiredForTTI(),e(J({component:t})),A.ttiComponentsAllLoaded(n())&&M.get_timer(I.SEARCH_WEB_TIMER).markTimeToInteractive())}},t.fetchImageSuggestionCount=function(){return function(e,t){var n=A.user(t()),s=A.path(t()),a=A.query(t()),i=A.searchType(t()),o=b.searchResultsExperiments(t()),l=A.fileCategoriesString(t()),c=A.filteredAccountId(t()),u=!!o.expImageContentSearch&&i!==w.SearchType.IMAGE;n&&u&&v.searchApiClient.loadPartialResults(r.__assign({},ne(t()),{start:0,deleted:!1,includeBrowseContext:!1,maxResults:100,searchType:w.SearchType.IMAGE,skipLogging:!0,getSuggestion:!0,onSuccess:function(r){var n=r.searchResults,o=r.requestId;P.hasSearchChanged(t(),{query:a,path:s,filteredAccountId:c,fileCategoriesString:l,searchType:i})||e(ee({results:n.results,query:a,requestId:o}))}}))}},t.sortCachedResults=function(e){var t=e.sortOrder;return function(e,r){var s=A.cachedFullResults(r()),a=A.cachedFullResultsSortField(r());if(!s)return void Q.reportException({err:new Error("Cannot sort when search results are not fully loaded."),severity:Q.SEVERITY.NONCRITICAL,tags:["search"]});if(!(s.size<1)){var i=t.sortField,o=t.sortDirection,l=n.List();switch(i){case f.SortField.MODIFIED:var c=s.filter(function(e){return de(e)}).toList(),u=s.filter(function(e){return!de(e)}).toList();l=c.sort(function(e,t){return he(e,t,o)}).concat(u);break;case f.SortField.RELEVANCE:if(o===f.SortDirection.ASCENDING)return void Q.reportException({err:new Error("Cannot sort by relevance in ascending order."),severity:Q.SEVERITY.NONCRITICAL,tags:["search"]});if(a!==f.SortField.RELEVANCE)return void Q.reportException({err:new Error("Cannot sort by relevance when cached search results are not sorted by relevance."),severity:Q.SEVERITY.NONCRITICAL,tags:["search"]});l=s.toList();break;default:return void Q.reportException({err:new Error("Sort by "+i+" is not supported."),severity:Q.SEVERITY.NONCRITICAL,tags:["search"]})}e(K()),e(j({searchResults:{results:l.toArray(),hasMore:!1}}))}}},t.startDwellTime=function(e){var t=(void 0===e?{startTime:Date.now()}:e).startTime;return{type:x.ActionTypes.SET_DWELL_TIME,payload:{dwellStartTime:t}}},t.stopAndLogDwellTime=function(){return function(e,r){var n=r(),s=A.dwellStartTime(n);if(void 0!==s){var a=Date.now()-s;L.logDwellTime(a,h.viewType(n)),e(t.startDwellTime({startTime:void 0}))}}},t.loadHistory=function(){return function(e,t){var r=A.user(t());if(r){var n=k.UserLocalStorage.get(r.id,w.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[];e({type:x.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:n}})}}},t.addQueryToHistory=function(){return function(e,t){var r=A.user(t());if(r){var n=A.queryHistory(t()),s=A.resultQuery(t()),a=n.indexOf(n.find(function(e){return e.rawQuery===s})),i=[{rawQuery:s,normalizedQuery:s}].concat(n.filter(function(e){return e.rawQuery!==s})).slice(0,w.SEARCH_RECENT_HISTORY_CAPACITY);e({type:x.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:i}}),k.UserLocalStorage.set(r.id,w.SEARCH_RECENT_HISTORY_STORAGE_KEY,i),L.logHistoryAdded(a)}}},t.clearAllHistory=function(){return function(e,t){var r=A.user(t());r&&(e({type:x.ActionTypes.SET_QUERY_HISTORY,payload:{queryHistory:[]}}),k.UserLocalStorage.delete(r.id,w.SEARCH_RECENT_HISTORY_STORAGE_KEY),L.logHistoryCleared())}},t.fetchQuerySuggestions=function(e){var n=this,s=e.query,a=e.maxResults,i=e.variant;return function(e,o){return r.__awaiter(n,void 0,void 0,function(){var n,l,c,u,d,p,h,_,g,m,f;return r.__generator(this,function(r){switch(r.label){case 0:if(n=A.user(o()),!n)return[2];if(l=O.normalize(s),c=A.querySuggestionsCache(o())[l]){if(u=c.loadingState,u===N.QuerySuggestionsLoadingState.LOADING)return[2];if(c.lastFetched&&(d=Date.now()-c.lastFetched<w.TIME_TO_INVALIDATE_QUERY_SUGGESTIONS_CACHE)){if(u===N.QuerySuggestionsLoadingState.LOADED)return e(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:l})),[2];if(u===N.QuerySuggestionsLoadingState.DISMISSED)return e(Y({normalizedQuery:l,querySuggestionsData:{loadingState:N.QuerySuggestionsLoadingState.LOADED}})),e(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:l})),[2]}}p=A.sessionId(o()),e(Y({normalizedQuery:l,querySuggestionsData:{suggestions:[],loadingState:N.QuerySuggestionsLoadingState.LOADING}})),h=Date.now(),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,C.getQuerySuggestions(n.id,l,a,p,i)];case 2:return _=r.sent().query_suggestions,g=_?_:[],e(Y({normalizedQuery:l,querySuggestionsData:{suggestions:g.filter(function(e){return e.text!==l}),loadingState:N.QuerySuggestionsLoadingState.LOADED,lastFetched:Date.now()}})),e(t.setLastQueryWithQuerySuggestionsLoaded({lastQueryWithQuerySuggestionsLoaded:l})),L.logQuerySuggestionsFetched(l,g.length,Date.now()-h),[3,4];case 3:return m=r.sent(),f=m.raw?new Error(m.raw.responseBody):m,Q.reportException({err:f,tags:["search_bar","search_bar_query_suggestions"],severity:"non-critical"}),e(Y({normalizedQuery:l,querySuggestionsData:{loadingState:N.QuerySuggestionsLoadingState.FAILED,lastFetched:Date.now()}})),L.logQuerySuggestionsFailed(l),[3,4];case 4:return[2]}})})}},t.dismissQuerySuggestions=function(e){var t=e.query;return function(e,r){var n=O.normalize(t),s=A.querySuggestionsCache(r())[n];s&&s.loadingState===N.QuerySuggestionsLoadingState.LOADED&&(e(Y({normalizedQuery:n,querySuggestionsData:{loadingState:N.QuerySuggestionsLoadingState.DISMISSED}})),L.logQuerySuggestionsDismissed(t))}};var Y=function(e){var t=e.normalizedQuery,r=e.querySuggestionsData;return{type:x.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE,payload:{normalizedQuery:t,querySuggestionsData:r}}};t.setLastQueryWithQuerySuggestionsLoaded=function(e){var t=e.lastQueryWithQuerySuggestionsLoaded;return function(e,r){e({type:x.ActionTypes.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED,payload:{lastQueryWithQuerySuggestionsLoaded:t}})}},t.setResults=function(e){var t=e.searchResults,r=e.requestId,n=e.context;return{type:x.ActionTypes.SET_RESULTS,payload:{searchResults:t,requestId:r,context:n}}},t.updateResults=function(e){var t=e.results;return{type:x.ActionTypes.UPDATE_RESULTS,payload:{results:t}}},t.removeResults=function(e){var t=e.results;return{type:x.ActionTypes.REMOVE_RESULTS,payload:{results:t}}},t.renameFile=function(e){var s=e.file,a=e.name,o=e.checkFSWs;return function(e,l){return r.__awaiter(this,void 0,void 0,function(){var c,u,d,h;return r.__generator(this,function(E){switch(E.label){case 0:return a.indexOf("/")!==-1?(y.Snackbar.fail(H._("Name was invalid."),"browse-rename"),e(p.setFileRename({file:s,renameState:null})),[2]):(c=A.user(l()))?(e(p.setFileRename({file:s,renameState:f.RenameState.SAVING_INPUT})),y.Snackbar.sync(H._("Renaming"),!1,"browse-rename"),[4,_.renameFile(s,a,c,o)]):[2];case 1:return u=E.sent(),u.isError?"to"===u.error[".tag"]&&"file_system_warnings"===u.error.to[".tag"]?(y.Snackbar.close("browse-rename"),i.showFileSystemWarningsModal({fsws:u.error.to.details,onFinalAccept:function(){e(t.renameFile({file:s,name:a,checkFSWs:!1}))},onAbortAction:function(){e(p.setFileRename({file:s,renameState:null}))},confirmText:H._("Rename")})):(e(p.setFileRename({file:s,renameState:null})),m.renameError(u.error,s.fq_path)):(d=g.fileFromMetadata(s,u.result.metadata),e(t.setSelection({selection:new S.Selection({selected:n.OrderedSet(),anchor:null})})),e(t.updateResults({results:[d]})),e(p.setFileRename({file:s,renameState:null})),h=function(){return r.__awaiter(this,void 0,void 0,function(){var n;return r.__generator(this,function(r){switch(r.label){case 0:return y.Snackbar.sync(H._("Undoing"),!1,"browse-rename"),[4,_.undo(u.result.changeset_data,c)];case 1:return n=r.sent(),n.isError?y.Snackbar.fail(H._("Undo failed."),"browse-rename"):(y.Snackbar.complete(H._("Undo complete."),"browse-rename"),e(t.updateResults({results:[s]}))),[2]}})})},q.setHandleUndo(h),y.Snackbar.completeWithUndo(H._("Rename complete."),h,"browse-rename")),[2]}})})}},t.deleteFiles=function(e){var n=e.files,a=e.user,l=e.context;return function(e,c){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(c){return i.showDelete(a,n,l,"/",function(){o.deleteFiles({files:n,userId:a.id,onSuccess:function(i){var o=i.changesets,l=i.fileDeltas,c=l.filter(function(e){return e.before instanceof u.File}).map(function(e){return new u.File(e.before)}),d=c.map(function(e){return new u.File(r.__assign({},e,{isDeleted:!0}))});e(t.updateResults({results:d}));var p=function(){e(t.updateResults({results:c}))};q.setHandleUndo(p),s.notifyDeleteSuccess(n.length,a,o,p)}})}),[2]})})}},t.purgeFiles=function(n){var s=n.files,a=n.user,o=n.context;return function(n,l){return r.__awaiter(this,void 0,void 0,function(){var l;return r.__generator(this,function(c){switch(c.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/react/trash/actions"],t,r)}).then(r.__importStar)];case 1:return l=c.sent().purgeByPathBatch,i.showPurgeModal({userId:a.id,context:o,files:s,onPurge:function(){return l(a.id,s,function(e){n(t.removeResults({results:e}))})}}),[2]}})})}},t.restoreFiles=function(e){var n=e.files,a=e.user,l=e.context;return function(e,c){return r.__awaiter(this,void 0,void 0,function(){var d;return r.__generator(this,function(p){return d=function(n){var s=n.map(function(e){return e.fq_path}),a=A.results(c()),i=a.reduce(function(e,t){return t instanceof u.File&&s.includes(t.fq_path)?e.concat([new u.File(r.__assign({},t,{isDeleted:!1}))]):e},[]);e(t.updateResults({results:i}))},i.showUnifiedTrashModal({userId:a.id,context:l,files:n,onRestore:function(e,t){o.restoreFiles({files:t,userId:a.id,onSuccess:function(){s.notifyRestoreSuccess(t),d(t)},isSearchMode:!1})}}),[2]})})}};var K=function(){return{type:x.ActionTypes.CLEAR_RESULTS}},j=function(e){var t=e.searchResults;return{type:x.ActionTypes.APPEND_RESULTS,payload:{searchResults:t}}},Z=function(e){var t=e.loadingState;return{type:x.ActionTypes.SET_LOADING_STATE,payload:{loadingState:t}}},X=function(){return{type:x.ActionTypes.CLEAR_TTI_COMPONENTS}},J=function(e){var t=e.component;return{type:x.ActionTypes.ADD_TTI_COMPONENT,payload:{component:t}}},$=function(e){var t=e.loadingDeletedResults;return{type:x.ActionTypes.SET_LOADING_DELETED_RESULTS,payload:{loadingDeletedResults:t}}},ee=function(e){var t=e.results,r=e.query,n=e.requestId;return{type:x.ActionTypes.SET_IMAGE_SUGGESTION,payload:{results:t,query:r,requestId:n}}},te=function(e){var t=e.normalizedQuery,r=e.peopleSuggestionsData;return{type:x.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE,payload:{normalizedQuery:t,peopleSuggestionsData:r}}},re=function(e){var t=e.lastQueryWithPeopleSuggestionsLoaded;return{type:x.ActionTypes.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED,payload:{lastQueryWithPeopleSuggestionsLoaded:t}}};t.setCachedFullResults=function(e){var t=e.cachedFullResults;return{type:x.ActionTypes.SET_CACHED_FULL_RESULTS,payload:{cachedFullResults:t}}},t.setCachedFullResultsSortField=function(e){var t=e.cachedFullResultsSortField;return{type:x.ActionTypes.SET_CACHED_FULL_RESULTS_SORT_FIELD,payload:{cachedFullResultsSortField:t}}},t.setSuggestionHighlightRow=function(e){var t=e.index;return{type:x.ActionTypes.SET_SUGGESTION_HIGHLIGHT_ROW,payload:{index:t}}};var ne=function(e){return{user:A.user(e),path:A.path(e),query:A.normalizedQuery(e),searchSessionId:A.sessionId(e),deleted:A.loadingDeletedResults(e),includeBrowseContext:!1,searchResultsExperiments:b.searchResultsExperiments(e),searchType:A.searchType(e),skipLogging:!0,fileCategories:A.fileCategories(e),isPaperEnabled:A.isPaperEnabled(e),sortOrder:A.sortOrder(e),filteredAccountId:A.filteredAccountId(e)}},se=function(){V=ae(V),U=ae(U)},ae=function(e){return null!==e&&clearTimeout(e),null},ie=function(e){switch(e){case l.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME:return f.SortField.MODIFIED;case l.SEARCH_ORDER_BY_TYPE.RELEVANCE:default:return f.SortField.RELEVANCE}},oe=function(e){switch(e){case w.SearchOriginPathway.ASSISTANT:return w.SearchOriginPathway.ASSISTANT;case w.SearchOriginPathway.COLLAB_BROWSE:return w.SearchOriginPathway.COLLAB_BROWSE;default:return w.SearchOriginPathway.WEB}},le=function(e){switch(e){case l.SEARCH_REVERSE_ORDER_TYPE.TRUE:return f.SortDirection.ASCENDING;case l.SEARCH_REVERSE_ORDER_TYPE.FALSE:default:return f.SortDirection.DESCENDING}},ce=function(e,t){return!e&&!t||!(!e||!t)&&(e.sortField===t.sortField&&e.sortDirection===t.sortDirection)},ue=function(e,t,r){return t&&!(r!==f.SortField.RELEVANCE&&e===f.SortField.RELEVANCE)},de=function(e){return(e instanceof u.File&&!e.isDeleted||e instanceof u.Paper||e instanceof u.FileSharedWithMe)&&null!==e.ts&&void 0!==e.ts},pe=function(e){return e instanceof u.PaperFolder?(Q.assert(!1,"getLastModifiedTime: PaperFolder not expected in filtered search results",{tags:["search"]}),0):e instanceof u.File||e instanceof u.FileSharedWithMe?1e3*e.ts:new Date(e.ts).getTime()},he=function(e,t,r){var n=pe(e),s=pe(t);return r===f.SortDirection.DESCENDING?s-n:n-s};t.setFilters=function(e){var r=e.path,n=e.fileCategories,s=e.searchType,i=e.filteredAccountId;return function(e,o){var l=o();r&&!a.paths_are_equal(r,A.path(l))&&e(t.setPath({path:r,viewport:"view"})),n&&e(t.setFileCategories({fileCategories:n})),s&&e(t.setSearchType({searchType:s})),null===i&&e(t.setFilteredAccountId({filteredAccountId:void 0}))}},t.resetFilters=function(){return function(e){e(t.setFilters({path:"/",fileCategories:w.FILE_CATEGORIES_UNCHECKED,filteredAccountId:null})),L.logFiltersReset()}}}),define("modules/clean/search/single_page/data/reducer",["require","exports","tslib","external/immutable","modules/clean/react/browse/models","modules/clean/react/files_view/types","modules/clean/react/selection","modules/clean/search/constants","modules/clean/search/single_page/data/types","modules/clean/search/single_page/utils","modules/clean/search/store_helpers","modules/clean/search/types"],function(e,t,r,n,s,a,i,o,l,c,u,d){"use strict";function p(e,r){switch(void 0===e&&(e=t.defaultSearchState),r.type){case l.ActionTypes.SET_USER:return h(e,r.payload);case l.ActionTypes.SET_EXPERIMENTS:return _(e,r.payload);case l.ActionTypes.SET_PATH:return f(e,r.payload);case l.ActionTypes.SET_FILE_CATEGORIES:return S(e,r.payload);case l.ActionTypes.SET_LOADING_STATE:return g(e,r.payload);case l.ActionTypes.SET_QUERY:return m(e,r.payload);case l.ActionTypes.SET_RESULTS:return y(e,r.payload);case l.ActionTypes.CLEAR_RESULTS:return E(e);case l.ActionTypes.APPEND_RESULTS:return v(e,r.payload);case l.ActionTypes.SET_SESSION_ID:return w(e,r.payload);case l.ActionTypes.SET_REQUEST_ID:return T(e,r.payload);case l.ActionTypes.SET_SELECTION:return C(e,r.payload);case l.ActionTypes.SET_PREVIEW_FILE_ID:return F(e,r.payload);case l.ActionTypes.SET_SORT_ORDER:return R(e,r.payload);case l.ActionTypes.SET_CACHED_FULL_RESULTS:return I(e,r.payload);case l.ActionTypes.SET_CACHED_FULL_RESULTS_SORT_FIELD:return b(e,r.payload);case l.ActionTypes.ADD_TTI_COMPONENT:return A(e,r.payload);case l.ActionTypes.CLEAR_TTI_COMPONENTS:return x(e);case l.ActionTypes.SET_LOADING_DELETED_RESULTS:return L(e,r.payload);case l.ActionTypes.SET_SEARCH_TYPE:return D(e,r.payload);case l.ActionTypes.SET_IMAGE_SUGGESTION:return P(e,r.payload);case l.ActionTypes.SET_DWELL_TIME:return O(e,r.payload);case l.ActionTypes.UPDATE_RESULTS:return N(e,r.payload);case l.ActionTypes.REMOVE_RESULTS:return k(e,r.payload);case l.ActionTypes.SET_QUERY_HISTORY:return q(e,r.payload);case l.ActionTypes.UPDATE_QUERY_SUGGESTIONS_CACHE:return M(e,r.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_QUERY_SUGGESTIONS_LOADED:return Q(e,r.payload);case l.ActionTypes.SET_SUGGESTION_HIGHLIGHT_ROW:return H(e,r.payload);case l.ActionTypes.SET_FILTERED_ACCOUNT_ID:return V(e,r.payload);case l.ActionTypes.UPDATE_PEOPLE_SUGGESTIONS_CACHE:return U(e,r.payload);case l.ActionTypes.SET_LAST_QUERY_WITH_PEOPLE_SUGGESTIONS_LOADED:return B(e,r.payload);case l.ActionTypes.SET_RECENT_ITEMS:return W(e,r.payload);case l.ActionTypes.SET_RECENT_ITEMS_LOADING_STATE:return G(e,r.payload);default:return e}}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),t.defaultSearchState={loadingState:o.SearchLoadingState.ZERO_QUERY,results:n.OrderedMap(),query:"",resultQuery:"",path:"/",sessionId:"",selection:i.createSelection(),queryHistory:[],previewFileId:void 0,sortOrder:{sortField:a.SortField.RELEVANCE,sortDirection:a.SortDirection.DESCENDING},cachedFullResults:void 0,cachedFullResultsSortField:void 0,fileCategories:o.FILE_CATEGORIES_UNCHECKED,context:new s.BrowseContext,ttiComponents:n.Set(),loadingDeletedResults:!1,searchType:o.SearchType.ALL,imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0,imageSuggestionResults:n.OrderedMap(),filteredAccountId:void 0,peopleSuggestionsCache:{},lastQueryWithPeopleSuggestionsLoaded:void 0,querySuggestionsCache:{},recentItems:new Map,recentItemsLoadingState:d.RecentItemsLoadingState.NOT_LOADED};var h=function(e,t){return r.__assign({},e,{user:t.user,userOptions:t.options})},_=function(e,t){return r.__assign({},e,{experiments:t.experiments})},g=function(e,t){return r.__assign({},e,{loadingState:t.loadingState})},m=function(e,t){return r.__assign({},e,{query:t.query,suggestionHighlightRow:void 0})},f=function(e,t){return r.__assign({},e,{path:t.path})},S=function(e,t){return r.__assign({},e,{fileCategories:t.fileCategories})},y=function(e,t){var n=t.searchResults,s=t.requestId,a=t.context,i=r.__assign({},e,{context:a||e.context});return i=E(i),i=v(i,{searchResults:n}),i=T(i,{requestId:s})},E=function(e){return r.__assign({},e,{results:e.results.clear(),resultQuery:"",nextPageOffset:0,hasMoreResults:!0,selection:i.createSelection(),imageSuggestionCount:0,imageSuggestionQuery:"",imageSuggestionRequestId:void 0})},v=function(e,t){return r.__assign({},e,{results:e.results.concat(t.searchResults.results.map(function(e){return[c.getIdForSearchResult(e),e]})),nextPageOffset:t.searchResults.nextPageOffset,resultQuery:u.normalize(e.query),hasMoreResults:t.searchResults.hasMore})},w=function(e,t){return r.__assign({},e,{sessionId:t.sessionId})},T=function(e,t){return r.__assign({},e,{requestId:t.requestId})},C=function(e,t){return r.__assign({},e,{selection:t.selection})},F=function(e,t){return r.__assign({},e,{previewFileId:t.previewFileId})},R=function(e,t){return r.__assign({},e,{sortOrder:t.sortOrder})},I=function(e,t){return r.__assign({},e,{cachedFullResults:t.cachedFullResults})},b=function(e,t){return r.__assign({},e,{cachedFullResultsSortField:t.cachedFullResultsSortField})},A=function(e,t){return r.__assign({},e,{ttiComponents:e.ttiComponents.add(t.component)})},x=function(e){return r.__assign({},e,{ttiComponents:n.Set()})},L=function(e,t){return r.__assign({},e,{loadingDeletedResults:t.loadingDeletedResults,nextPageOffset:0,hasMoreResults:!0})},D=function(e,t){return r.__assign({},e,{searchType:t.searchType})},P=function(e,t){var n=e.imageSuggestionResults.clear();return r.__assign({},e,{imageSuggestionResults:n.concat(t.results.map(function(e){return[c.getIdForSearchResult(e),e]})),imageSuggestionCount:t.results.length,imageSuggestionQuery:t.query,imageSuggestionRequestId:t.requestId})},O=function(e,t){return r.__assign({},e,{dwellStartTime:t.dwellStartTime})},N=function(e,t){var n=e.results.map(function(e){var r=t.results.find(function(t){return c.getIdForSearchResult(e)===c.getIdForSearchResult(t)});return void 0===r?e:r});return r.__assign({},e,{results:n})},k=function(e,t){var n=t.results.map(function(e){return c.getIdForSearchResult(e)}),s=e.results.filter(function(e){return!n.includes(c.getIdForSearchResult(e))});return r.__assign({},e,{results:s})},q=function(e,t){var n=t.queryHistory;return r.__assign({},e,{queryHistory:n})},M=function(e,t){var n,s=t.normalizedQuery,a=t.querySuggestionsData;return r.__assign({},e,{querySuggestionsCache:r.__assign({},e.querySuggestionsCache,(n={},n[s]=r.__assign({},e.querySuggestionsCache[s],a),n))})},Q=function(e,t){var n=t.lastQueryWithQuerySuggestionsLoaded;return r.__assign({},e,{lastQueryWithQuerySuggestionsLoaded:n})},H=function(e,t){return r.__assign({},e,{suggestionHighlightRow:t.index})},V=function(e,t){return r.__assign({},e,{filteredAccountId:t.filteredAccountId})},U=function(e,t){var n,s=t.normalizedQuery,a=t.peopleSuggestionsData;return r.__assign({},e,{peopleSuggestionsCache:r.__assign({},e.peopleSuggestionsCache,(n={},n[s]=r.__assign({},e.peopleSuggestionsCache[s],a),n))})},B=function(e,t){return r.__assign({},e,{lastQueryWithPeopleSuggestionsLoaded:t.lastQueryWithPeopleSuggestionsLoaded})},W=function(e,t){var n=t.recentItems;return r.__assign({},e,{recentItems:n})},G=function(e,t){var n=t.recentItemsLoadingState;return r.__assign({},e,{recentItemsLoadingState:n})};t.searchReducer=p}),define("modules/clean/search/single_page/data/selectors/experiments",["require","exports","tslib","external/reselect","modules/clean/react/browse/models","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/types","modules/core/i18n","modules/clean/search/search_bar/experiments"],function(e,t,r,n,s,a,i,o,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),l=r.__importStar(l),c=r.__importStar(c);var h=function(e){return i.getStateAtNamespace(e,a.SEARCH_NAMESPACE_KEY)};t.experiments=function(e){return h(e).experiments||{}};var _=function(e,t){return e?e[t]||"OFF":"OFF"},g=function(e){return function(r){return t.experiments(r)[e]}},m=function(e){return n.createSelector(g(e),function(e){return e||"OFF"})},f=function(e,t){return!!e&&e[t]===!0};t.searchBarExperiments=n.createSelector(t.experiments,function(e){return{expRecentFiles:_(e,"search_experiment_recent_files"),expQuerySuggestions:_(e,"search_experiment_query_suggestions"),expFileTypeFilter:u.FileTypeFilterVariants.ON,expShowHelpLink:_(e,"search_show_help_link"),expPeopleFilter:_(e,"search_experiment_people_filter"),expSearchDetailsPaneVariants:_(e,"search_details_pane_variants"),expSearchSuccessBanner:f(e,"search_success_qualitative_metric")}}),t.searchResultsExperiments=n.createSelector(t.experiments,function(e){return{expImageContentSearch:f(e,"search_image_content"),expImageContentSearchDiscovery:_(e,"search_image_search_discovery"),expImageFeedbackBanner:f(e,"search_experiment_image_feedback_banner"),expSatisfactionBanner:f(e,"search_experiment_satisfaction_banner"),expFolderCalcSize:f(e,"search_experiment_folder_calc_size"),expHighlightedTruncatedString:f(e,"search_experiment_highlighted_truncated_string"),expSnippets:f(e,"search_experiment_snippets_web"),expSelectableFswm:f(e,"search_experiment_selectable_fswm"),expBrowseDeleteUseApiV2:f(e,"browse_delete_use_api_v2")}}),t.browseExperiments=n.createSelector(t.experiments,function(e){return{expUniversalSinglePageSearch:!0,expBrowseWebFilesViewRedesignVariants:_(e,"browse_web_files_view_redesign_variants"),expFolderHistoryRollbacks:f(e,"folder_history_rollbacks"),expPrimaryButtonColor:_(e,"browse_primary_button_color")}}),t.browsePostTTIExperiments=n.createSelector(t.experiments,function(e){return{expDeleteUseApiV2:f(e,"browse_delete_use_api_v2"),expRenameUseApiV2:f(e,"browse_rename_use_api_v2"),expMoveUseApiV2:f(e,"browse_move_use_api_v2"),expCopyUseApiV2:f(e,"browse_copy_use_api_v2"),expShowAddToShowcase:f(e,"paper_professional_sharing")}}),t.isInPeopleFilterExperiment=n.createSelector(t.searchBarExperiments,function(e){return e.expPeopleFilter===u.PeopleFilterVariants.ON}),t.isSearchAsYouTypeEnabled=n.createSelector(t.experiments,function(e){return"ON"!==e.search_experiment_disable_sayt&&"ON_WITH_SUGGESTIONS"!==e.search_experiment_disable_sayt}),t.isInPosteriorQuerySuggestionsExperiment=n.createSelector(t.searchBarExperiments,t.experiments,function(e,t){return l.isInPosteriorQuerySuggestionsExperiment(e)||"ON_WITH_SUGGESTIONS"===t.search_experiment_disable_sayt}),t.shouldRenderRecentItems=n.createSelector(c.loadingState,c.recentItems,c.recentItemsLoadingState,c.priorQuerySuggestionsLoadingState,t.searchBarExperiments,function(e,t,r,n,s){return!!l.isInRecentFilesExperiment(s)&&(e===o.SearchLoadingState.ZERO_QUERY&&(n!==u.QuerySuggestionsLoadingState.LOADING&&(r===u.RecentItemsLoadingState.LOADED&&0!==t.size)))}),t.shouldRenderPriorQuerySuggestions=n.createSelector(c.priorQuerySuggestions,t.searchBarExperiments,c.loadingState,function(e,t,r){return!!l.isInPriorQuerySuggestionsExperiment(t)&&(r===o.SearchLoadingState.ZERO_QUERY&&!(!e||!e.length))}),t.tabs=n.createSelector(t.experiments,c.imageSuggestionCount,function(e,t){var r=e.search_image_search_discovery===u.ImageSearchDiscoveryVariants.TAB,n=r&&t>0?d._("Images (%(count)d)").format({count:t}):d._("Images");return e.search_image_content?[{id:o.SearchType.ALL,label:d._("Text")},{id:o.SearchType.IMAGE,label:n}]:void 0}),t.shouldRenderTabs=n.createSelector(t.tabs,function(e){return!(!e||!e.length)}),t.shouldRenderHistory=n.createSelector(c.loadingState,t.shouldRenderPriorQuerySuggestions,t.shouldRenderRecentItems,c.queryHistory,function(e,t,r,n){return e===o.SearchLoadingState.ZERO_QUERY&&(!t&&(!r&&0!==n.length))}),t.shouldRenderEmptyZeroQueryView=n.createSelector(t.shouldRenderPriorQuerySuggestions,t.shouldRenderRecentItems,t.shouldRenderHistory,function(e,t,r){return!(e||t||r)}),t.shouldMainContentScroll=n.createSelector(t.experiments,function(e){return _(e,"search_details_pane_variants")===u.DetailsPaneVariants.CONTENT_SCROLL});var S=m("search_experiment_lockup_variants");t.areInlineSearchFiltersEnabled=n.createSelector(S,function(e){return e===u.SearchLockupVariants.A_V1}),t.shouldShowImagePanel=n.createSelector(t.searchResultsExperiments,t.areInlineSearchFiltersEnabled,function(e,t){return t&&e.expImageContentSearchDiscovery===u.ImageSearchDiscoveryVariants.IMAGE_PANEL});var y=function(e,t){var r=t.responsive;return!(!r||!r.isResponsive||r.isMatchedLarge)};t.shouldShowSelectionPreviewPane=n.createSelector(y,c.results,t.searchBarExperiments,function(e,t,r){var n=t.size,s=r.expSearchDetailsPaneVariants;return!!(!e&&n>0&&s&&s!==u.DetailsPaneVariants.CONTROL&&s!==u.DetailsPaneVariants.HOLDOUT&&s!==u.DetailsPaneVariants.OFF)}),t.isFolderOverviewEnabled=n.createSelector(t.experiments,function(e){return"V3"===e.browse_web_folder_overview}),t.shouldShowFolderOverview=n.createSelector(y,c.selectedFiles,t.experiments,function(e,t,r){return!e&&(r.search_details_pane_variants===u.DetailsPaneVariants.FOLDER_OVERVIEW||r.search_details_pane_variants===u.DetailsPaneVariants.CONTENT_SCROLL)&&1===t.size&&t.first().is_dir&&!s.File.isNoAccessSharedFolder(t.first())}),
t.artificalLatency=n.createSelector(t.experiments,function(e){switch(e.search_experiment_artificial_latency){case"ON_100":return 100;case"ON_250":return 250;case"ON_500":return 500;case"ON_1000":return 1e3;default:return 0}}),t.shouldRenderInlineSearchFilters=n.createSelector(t.areInlineSearchFiltersEnabled,c.hasResultQuery,c.filteredAccountId,function(e,t,r){return Boolean(e&&(t||r))}),t.hasSimplifiedLockup=n.createSelector(S,function(e){return[u.SearchLockupVariants.A_V1,u.SearchLockupVariants.A_V2].includes(e)}),t.getExpSearchSuccessBanner=function(e){return p.isInSearchSuccessBannerExperiment(t.searchBarExperiments(e))}}),define("modules/clean/search/single_page/data/selectors/index",["require","exports","tslib","external/immutable","external/reselect","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/files_view/types","modules/clean/redux/namespaces","modules/clean/redux/selectors","modules/clean/search/api_helpers","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/search/single_page/navigation","modules/clean/search/store_helpers","modules/clean/search/types","modules/clean/react/retrieval_success_banner/data/reducer"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a);var y=function(e){return d.getStateAtNamespace(e,u.SEARCH_NAMESPACE_KEY)},E=function(e){return d.getStateAtNamespace(e,u.RETRIEVAL_SUCCESS_BANNER_NAMESPACE_KEY)||S.defaultSuccessBannerState};t.user=function(e){return y(e).user},t.userOptions=function(e){return y(e).userOptions},t.loadingState=function(e){return y(e).loadingState},t.results=function(e){return y(e).results},t.query=function(e){return y(e).query},t.resultQuery=function(e){return y(e).resultQuery},t.hasResultQuery=function(e){return!!y(e).resultQuery},t.normalizedQuery=function(e){return m.normalize(y(e).query)},t.path=function(e){return y(e).path},t.sessionId=function(e){return y(e).sessionId},t.requestId=function(e){return y(e).requestId},t.selection=function(e){return y(e).selection},t.queryHistory=function(e){return y(e).queryHistory},t.nextPageOffset=function(e){return y(e).nextPageOffset},t.hasMoreResults=function(e){return y(e).hasMoreResults},t.previewFileId=function(e){return y(e).previewFileId},t.sortOrder=function(e){return y(e).sortOrder},t.cachedFullResults=function(e){return y(e).cachedFullResults},t.cachedFullResultsSortField=function(e){return y(e).cachedFullResultsSortField},t.fileCategories=function(e){return y(e).fileCategories},t.context=function(e){return y(e).context},t.ttiComponents=function(e){return y(e).ttiComponents},t.searchType=function(e){return y(e).searchType},t.imageSuggestionQuery=function(e){return y(e).imageSuggestionQuery},t.imageSuggestionCount=function(e){return y(e).imageSuggestionCount},t.imageSuggestionRequestId=function(e){return y(e).imageSuggestionRequestId},t.imageSuggestionResults=function(e){return y(e).imageSuggestionResults.toList()},t.suggestionHighlightRow=function(e){return y(e).suggestionHighlightRow},t.filteredAccountId=function(e){return y(e).filteredAccountId},t.peopleSuggestionsCache=function(e){return y(e).peopleSuggestionsCache},t.lastQueryWithPeopleSuggestionsLoaded=function(e){return y(e).lastQueryWithPeopleSuggestionsLoaded},t.dwellStartTime=function(e){return y(e).dwellStartTime},t.recentItems=function(e){return y(e).recentItems},t.recentItemsLoadingState=function(e){return y(e).recentItemsLoadingState},t.shoulShowRetrievalSuccessBrowseviewBanner=function(e){return E(e).searchSuccessBannerShouldShow||(E(e).searchResultActionClicked||E(e).searchBarAbandoned)&&!E(e).searchSuccessBannerDismissed};var v=function(){return _.getSearchCsrfToken()};t.resultsList=s.createSelector(t.results,function(e){return e.toList()}),t.isNautilusEnabled=s.createSelector(t.userOptions,function(e){return e&&e.nautilus_enabled}),t.isPaperEnabled=s.createSelector(t.userOptions,function(e){return e&&e.paper_enabled}),t.preferredEditors=s.createSelector(t.user,t.userOptions,function(e,t){var r,n;return e?t&&t.preferred_editors?(n={},n[e.id]=t.preferred_editors,n):(r={},r[e.id]={},r):{}}),t.fileCategoriesString=s.createSelector(t.fileCategories,function(e){return _.fileCategoriesToString(e)}),t.fileCategoriesArray=s.createSelector(t.fileCategories,function(e){return Object.keys(e).filter(function(t){return"checked"===e[t]})}),t.fileCategoriesLogValue=s.createSelector(t.fileCategories,t.isPaperEnabled,function(e,t){if(_.allCategoriesUnchecked(e,t))return["all_unchecked"];if(_.allCategoriesChecked(e,t))return["all_checked"];var r=[];return Object.keys(e).forEach(function(t){"checked"===e[t]&&r.push(t)}),r}),t.loadingDeletedResults=function(e){return y(e).loadingDeletedResults},t.selectedFiles=s.createSelector(t.results,t.selection,function(e,t){return n.OrderedMap(t.selected.toArray().filter(function(e){return!!e}).map(function(t){return[t,e.find(function(e){return"fq_path"in e?a.paths_are_equal(e.fq_path,t):e.file_id===t})]}).filter(function(e){e[0];return!!e[1]}))}),t.commonLogFields=s.createSelector(t.user,t.path,t.query,t.sessionId,t.requestId,t.resultsList,t.fileCategoriesLogValue,t.searchType,t.filteredAccountId,function(e,t,r,n,s,i,o,l,c){return e?{user_id:e.id,active_user_id:e.id,path_scoped:!a.paths_are_equal(t),type:l===h.SearchType.IMAGE?"image_search":"single-page",query_string:r,typeahead_session_id:n,timezone_offset:p.getCurrentTimezoneOffset(),request_id:s,result_count:i.size,file_type_filters:o,search_scoped_to_account_id:c,source:g.searchNavigationManager.source}:{}}),t.searchUrl=s.createSelector(t.user,v,t.normalizedQuery,t.path,t.sessionId,t.previewFileId,t.fileCategoriesString,t.searchType,t.sortOrder,t.filteredAccountId,function(e,t,r,n,s,a,o,u,d,p){if(e){var m=l.getQueryArgs().search_from;return _.buildSearchURL({user:e,searchPath:n,searchSessionId:s,searchToken:t,normalizedQuery:r,qargs:{search_from:m&&g.DESKTOP_FROM_PATHS.indexOf(m)===-1?m:void 0,preview:a,file_categories:o||void 0,search_type:u===h.SearchType.ALL?void 0:u,search_order_by:d.sortField===c.SortField.MODIFIED?i.SEARCH_ORDER_BY_TYPE.LAST_MODIFIED_TIME:void 0,search_reverse_order:d.sortDirection===c.SortDirection.ASCENDING?i.SEARCH_REVERSE_ORDER_TYPE.TRUE:void 0,search_account_id:p||void 0}}).toString()}}),t.searchUrlReset=s.createSelector(t.user,v,t.normalizedQuery,t.sessionId,t.searchType,function(e,t,r,n,s){if(e)return _.buildSearchURL({user:e,searchPath:"/",searchSessionId:n,searchToken:t,normalizedQuery:r,qargs:{search_from:l.getQueryArgs().search_from||void 0,search_type:s===h.SearchType.ALL?void 0:s}}).toString()}),t.previewFile=s.createSelector(t.previewFileId,t.results,function(e,t){return e?t.find(function(t){return t instanceof o.File&&t.file_id===e}):void 0}),t.previewableFiles=s.createSelector(t.resultsList,function(e){return e.filter(function(e){return e instanceof o.File&&!e.isDeleted&&!e.is_cloud_doc&&!e.is_dir}).toArray()}),t.ttiComponentsAllLoaded=s.createSelector(t.ttiComponents,function(e){return 3===e.size}),t.hasFiltersSelected=s.createSelector(t.path,t.fileCategoriesArray,function(e,t){return!(a.paths_are_equal(e,"/")&&0===t.length)}),t.querySuggestionsCache=function(e){return y(e).querySuggestionsCache},t.lastQueryWithQuerySuggestionsLoaded=function(e){return y(e).lastQueryWithQuerySuggestionsLoaded},t.querySuggestions=s.createSelector(t.querySuggestionsCache,t.normalizedQuery,t.lastQueryWithQuerySuggestionsLoaded,function(e,t,r){var n=e[t];return!r||n&&n.loadingState!==f.QuerySuggestionsLoadingState.LOADING?w(e,t):w(e,r)}),t.priorQuerySuggestions=s.createSelector(t.querySuggestionsCache,function(e){return w(e,"")});var w=function(e,t){var r=e[t];return r&&r.loadingState===f.QuerySuggestionsLoadingState.LOADED?r.suggestions:void 0};t.querySuggestionsLoadingState=s.createSelector(t.querySuggestionsCache,t.normalizedQuery,function(e,t){return T(e,t)}),t.priorQuerySuggestionsLoadingState=s.createSelector(t.querySuggestionsCache,function(e){return T(e,"")});var T=function(e,t){var r=e[t];return r?r.loadingState:void 0};t.filteredContact=s.createSelector(t.peopleSuggestionsCache,t.filteredAccountId,function(e,t){if(t){var r=e[""];return(r?r.contacts:[]).find(function(e){return e.dbx_account_id===t})}}),t.filteredContactName=s.createSelector(t.filteredContact,function(e){return e?e.name:void 0}),t.peopleSuggestions=s.createSelector(t.peopleSuggestionsCache,t.normalizedQuery,t.lastQueryWithPeopleSuggestionsLoaded,function(e,t,r){var n=e[t];return!r||n&&n.loadingState!==f.PeopleSuggestionsLoadingState.LOADING?C(e,t):C(e,r)});var C=function(e,t){var r=e[t];return r&&r.loadingState===f.PeopleSuggestionsLoadingState.LOADED?r.contacts.slice(0,Math.min(h.SEARCH_CONTACT_SUGGESTION_CAPACITY,r.contacts.length)):void 0};t.peopleSuggestionsLoadingState=s.createSelector(t.peopleSuggestionsCache,t.normalizedQuery,function(e,t){var r=e[t];return r?r.loadingState:void 0})}),define("modules/clean/search/single_page/data/store",["require","exports","modules/clean/react/files_view/data/store","modules/clean/redux/namespaces","modules/clean/redux/store","modules/clean/search/search_bar/data/store","modules/clean/react/extensions/data/store","modules/clean/react/retrieval_success_banner/data/store","modules/clean/search/single_page/data/reducer"],function(e,t,r,n,s,a,i,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c;t.getStoreForSearch=function(){var e;return c||(c=s.getStoreAndRegisterReducers((e={},e[n.SEARCH_NAMESPACE_KEY]=l.searchReducer,e))),r.getStoreForFilesView(),a.getStoreForSearchBar(),i.getStore(),o.getStoreForSuccessBanner(),c}}),define("modules/clean/search/single_page/filters",["require","exports","tslib","external/react-redux","react","retrieval-components/file-type-filter","modules/clean/logging/hive/schemas/web-modal-activity","modules/clean/react/folder_dialog/async","modules/clean/react/path_filter_button","modules/clean/search/constants","modules/clean/search/single_page/constants","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/clean/search/single_page/reset_filters","modules/core/i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),d=r.__importStar(d),p=r.__importStar(p),h=r.__importStar(h);var f=(function(e){function t(t){var n=e.call(this,t)||this;return n.handlePathFilterButtonClick=function(){var e=n.props,t=e.user,r=e.path,s=e.setFilters;t&&o.showFolderDialog({ariaLabel:m._("Folder selector"),canSelectReadonly:!0,initialPath:r,modalName:i.ModalName.SEARCH_FILTER,primaryActionLabel:m._("Select"),title:m._("Select a folder"),user:t,onSuccess:function(e){s({path:e||"/"})}})},n.handleFileTypeFilterChange=function(e){var t=r.__assign({},c.FILE_CATEGORIES_UNCHECKED);e.forEach(function(e){return t[e]="checked"}),n.props.setFilters({fileCategories:t}),_.logFileTypeFiltersChanged(e)},n.handleFileTypeFilterDropdownClicked=function(){n.setState({fileTypeFilterModalOpen:!0})},n.handleFileTypeFilterModalClose=function(){n.setState({fileTypeFilterModalOpen:!1})},n.state={fileTypeFilterModalOpen:!1},n}return r.__extends(t,e),t.prototype.componentDidMount=function(){o.prewarmFolderDialog()},Object.defineProperty(t.prototype,"fileTypeFilterEntries",{get:function(){return this.props.isPaperEnabled?u.FILE_CATEGORIES_PAPER:u.FILE_CATEGORIES_NO_PAPER},enumerable:!0,configurable:!0}),t.prototype.render=function(){return this.props.shouldRender?s.default.createElement("div",{className:"search__filters"},s.default.createElement("div",{className:"search__filter search__filter--path"},s.default.createElement(l.PathFilterButton,{path:this.props.path,onClick:this.handlePathFilterButtonClick,defaultText:m._("Any folder"),dropdownClasses:"search__filter-button"})),this.props.searchType!==c.SearchType.IMAGE?s.default.createElement("div",{className:"search__filter search__filter--file-type"},s.default.createElement(a.FileTypeFilterDropdown,{entries:this.fileTypeFilterEntries,className:"search__filter-button",checkedCategories:this.props.fileCategories,onChange:this.handleFileTypeFilterChange,strings:{byType:m._("By type"),selectAll:m._("Select all"),clearAll:m._("Clear all")},onClick:this.props.isScreenWidthMobile?this.handleFileTypeFilterDropdownClicked:void 0}),s.default.createElement(a.FileTypeFilterModal,{modalProps:{title:m._("Filter"),ariaLabel:m._("Filter"),open:this.state.fileTypeFilterModalOpen,onRequestClose:this.handleFileTypeFilterModalClose,shouldFocusAfterRender:!0},entries:this.fileTypeFilterEntries,checkedCategories:this.props.fileCategories,onChange:this.handleFileTypeFilterChange,strings:{byType:m._("By type"),selectAll:m._("Select all"),clearAll:m._("Clear all")}})):null,!this.props.hideReset&&s.default.createElement(g.ResetFilters,{className:"search__filter-reset"})):null},t})(s.default.PureComponent);t.SearchFiltersComponent=f;var S=function(e){return{shouldRender:p.shouldRenderInlineSearchFilters(e),user:h.user(e),path:h.path(e),fileCategories:h.fileCategoriesArray(e),searchType:h.searchType(e),isPaperEnabled:h.isPaperEnabled(e),hasFiltersSelected:h.hasFiltersSelected(e),hideReset:p.hasSimplifiedLockup(e)}},y={setFilters:d.setFilters};t.SearchFilters=n.connect(S,y)(f)}),define("modules/clean/search/single_page/header",["require","exports","tslib","external/react-redux","react","modules/clean/filepath","modules/clean/react_format","modules/clean/search/constants","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/core/accessible_announce","modules/core/i18n","modules/clean/search/single_page/reset_filters"],function(e,t,r,n,s,a,i,o,l,c,u,d,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),l=r.__importStar(l),c=r.__importStar(c),t.generateTitle=function(e){var t=e.searchType;if(!e.experiments.search_image_content)return d._("Search results");switch(t){case o.SearchType.IMAGE:return d._("Image search results");default:return d._("Text search results")}},t.generateSubtitle=function(e){var t=e.query,r=e.numResults,n=e.path,o=e.filteredAccountId;return t||o?r<=0?s.default.createElement("span",null,d._("No results found")):t?!n||a.paths_are_equal(n,"/")?i.reactFormat(d.ungettext("%(size)d result for <strong>%(query)s</strong>","%(size)d results for <strong>%(query)s</strong>",r).format({size:r,query:t}),{strong:s.default.createElement("strong",null)}):i.reactFormat(d.ungettext("%(size)d result for <strong>%(query)s</strong> in %(path)s","%(size)d results for <strong>%(query)s</strong> in %(path)s",r).format({size:r,query:t,path:a.filename(n)}),{strong:s.default.createElement("strong",null)}):s.default.createElement("span",null,d.ungettext("%(size)d result","%(size)d results",r).format({size:r})):s.default.createElement("span",null)},t.SimpleSearchHeaderComponent=function(e){var t=e.loadingState,r=e.numResults,n=e.showResetFilters;return s.default.createElement("header",{className:"search__header search__header--simplified"},s.default.createElement("h1",null,t===o.SearchLoadingState.LOADING_FIRST_PAGE?d._("Searching..."):t===o.SearchLoadingState.LOADING_ADDITIONAL_PAGE?d.ungettext("%(size)d+ results","%(size)d+ results",r,{comment:'The "+" is meant to indicate that more results are still loading'}).format({size:r}):d.ungettext("%(size)d result","%(size)d results",r).format({size:r})),n&&s.default.createElement(p.ResetFilters,null))},t.SimpleSearchHeader=n.connect(function(e){return{loadingState:c.loadingState(e),numResults:c.results(e).size,showResetFilters:l.areInlineSearchFiltersEnabled(e)}})(t.SimpleSearchHeaderComponent);var h=(function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(n,e),n.prototype.componentDidUpdate=function(e){var t=this.props,r=t.query,n=t.numResults,s=t.loadingState;s!==o.SearchLoadingState.LOADED&&e.loadingState===o.SearchLoadingState.LOADED&&u.AccessibleAnnounce.polite(d._("Loading results")),r&&s===o.SearchLoadingState.LOADED&&e.loadingState!==o.SearchLoadingState.LOADED&&(n<=0?u.AccessibleAnnounce.polite(d._("No results found")):u.AccessibleAnnounce.polite(d.ungettext("Found %(num)s result","Found %(num)s results",n).format({num:n})))},n.prototype.render=function(){var e=this.props,r=e.searchType,n=e.query,a=e.numResults,i=e.path,l=e.loadingState,c=e.experiments,u=e.filteredAccountId;return n||u?l===o.SearchLoadingState.LOADING_FIRST_PAGE?s.default.createElement("header",{className:"search__header search__header--ghost","aria-hidden":"true"},s.default.createElement("h1",null," "),s.default.createElement("p",null," ")):s.default.createElement("header",{className:"search__header"},s.default.createElement("h1",null,t.generateTitle({searchType:r,experiments:c})),s.default.createElement("p",null,t.generateSubtitle({query:n,numResults:a,path:i,filteredAccountId:u}))):null},n})(s.default.PureComponent);t.SearchHeaderComponent=h;var _=function(e){return{path:c.path(e),experiments:l.experiments(e),loadingState:c.loadingState(e),numResults:c.results(e).size,query:c.resultQuery(e),searchType:c.searchType(e),filteredAccountId:c.filteredAccountId(e)}};t.SearchHeader=n.connect(_)(h)}),define("modules/clean/search/single_page/input/chips",["require","exports","tslib","react","spectrum/button","spectrum/icon_action","spectrum/icon_content","spectrum/icon_form","retrieval-components/truncated-string","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/size","modules/clean/filepath","modules/core/i18n","modules/core/user_i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),c=r.__importDefault(c),p=r.__importStar(p);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handlePathChipCloseClick=function(){t.props.setPath({path:"/",viewport:"chip"})},t.handleDeletedChipCloseClick=function(){},t.handlePeopleFilterChipCloseClick=function(){var e=t.props.setFilteredAccountId;e&&e({filteredAccountId:void 0})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.path,r=e.user,s=e.deletedFiles,a=e.filteredContact;return n.createElement("span",{className:"search-chips"},p.paths_are_equal(t,"/")?null:n.createElement(f,{path:p.filename(t),isTeamMemberFolder:p.paths_are_equal(r&&r.cdm_tmf_path,t),onCloseClick:this.handlePathChipCloseClick}),s?n.createElement(S,{onCloseClick:this.handleDeletedChipCloseClick}):null,a?n.createElement(y,{filteredContact:a,onCloseClick:this.handlePeopleFilterChipCloseClick}):null)},t})(n.PureComponent);t.SearchChips=g;var m=function(e){var t=e.label,r=e.icon,a=e.onCloseClick;return n.createElement("span",{className:"search-chips__chip"},r,n.createElement("span",{className:"search-chips__chip-text"},t),n.createElement(s.Button,{onClick:a,variant:"styleless","aria-label":h._("Remove filter"),type:"button",tabIndex:-1},n.createElement(o.IconForm,{name:"cancel"})))},f=function(e){var t=e.path,r=e.isTeamMemberFolder,s=e.onCloseClick;return n.createElement(m,{label:n.createElement(l.TruncatedString,{text:t,variant:l.TruncatedStringVariant.TRUNCATED_STRING_END}),icon:n.createElement(i.IconContent,{className:"search-chips__chip-icon","aria-hidden":!0,name:r?"folder_team_member_child-small":"folder-small"}),onCloseClick:s})},S=function(e){var t=e.onCloseClick;return n.createElement(m,{label:h._("Deleted files"),icon:n.createElement(a.IconAction,{name:"delete",className:"search-chips__chip-icon search-chips__chip-icon--dark"}),onCloseClick:t})},y=function(e){var t=e.filteredContact,r=e.onCloseClick,s=n.createElement(u.InitialsAvatarWithColorDerivedFromName,{alt:h._("User"),dimension:d.AVATAR_DIMENSION_BY_SIZE.XSMALL,name:t.name,initials:_.getInitials(t.name),shape:"CIRCLE"});return n.createElement(m,{label:n.createElement(l.TruncatedString,{text:t.name,variant:l.TruncatedStringVariant.TRUNCATED_STRING_END}),icon:n.createElement(c.default,{alt:h._("User"),dimension:d.AVATAR_DIMENSION_BY_SIZE.XSMALL,photoUrl:t.photo_url,shape:"CIRCLE",defaultAvatar:s}),onCloseClick:r})}}),define("modules/clean/search/single_page/input/connected",["require","exports","tslib","external/react-redux","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/input/component"],function(e,t,r,n,s,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),a=r.__importStar(a);var l=function(e){return{query:a.query(e),path:a.path(e),querySuggestions:a.querySuggestions(e),suggestionHighlightRow:a.suggestionHighlightRow(e),filteredContact:a.filteredContact(e),peopleSuggestions:a.peopleSuggestions(e),expSearchSuccessBanner:i.getExpSearchSuccessBanner(e)}},c={setQuery:s.setQuery,setPath:s.setPath,clear:s.clear,dismissQuerySuggestions:s.dismissQuerySuggestions,setSuggestionHighlightRow:s.setSuggestionHighlightRow,setFilteredAccountId:s.setFilteredAccountId,dismissPeopleSuggestions:s.dismissPeopleSuggestions,onSearch:s.performSearch};t.ConnectedSearchInput=n.connect(l,c)(o.SearchInputComponent)}),define("modules/clean/search/single_page/input/people_suggestions",["require","exports","tslib","external/classnames","react","modules/clean/avatar/contact_avatar","modules/clean/avatar/size","modules/core/i18n"],function(e,t,r,n,s,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),s=r.__importDefault(s),a=r.__importDefault(a);var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.peopleSuggestions,r=e.indexOffset,a=e.highlightedRow,i=e.onPeopleSuggestionsClick,l=e.onHighlightDropdownItem,u=e.showHeader,d=o._("People"),p=n.default({"search__people-suggestion-header":!0,"search__people-suggestion-seperator":r&&r>0});return s.default.createElement("div",{className:"search__people-suggestions"},u&&s.default.createElement("div",{className:p},d),t.map(function(e,t){return s.default.createElement(c,{key:"people-suggestion-"+t,peopleSuggestion:e,index:t,indexOffset:r,isHighlighted:void 0!==a&&t===a-r,onPeopleSuggestionsClick:i,onHighlightDropdownItem:l})}))},t})(s.default.PureComponent);t.PeopleSuggestions=l;var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.onPeopleSuggestionsClick(t.props.peopleSuggestion,t.props.index)},t.handleHighlight=function(){var e=t.props.onHighlightDropdownItem;e&&e(t.props.index+t.props.indexOffset)},t.getAriaLabel=function(){return o._("Search for %(name)s").format({name:t.props.peopleSuggestion.name})},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.peopleSuggestion,r=e.isHighlighted,o=e.index,l=n.default({"search__people-suggestion-item":!0,"search__people-suggestion-item-highlighted":r});return s.default.createElement("li",{className:l,role:"option","aria-label":this.getAriaLabel(),"aria-selected":r,tabIndex:0,onClick:this.handleClick,onMouseEnter:this.handleHighlight},s.default.createElement("div",{className:"mc-media-cell-icon search__people-suggestion-icon"},s.default.createElement(a.default,{dimension:i.AVATAR_DIMENSION_BY_SIZE.SMALL,contact:t})),s.default.createElement("div",{className:"search__people-suggestion-text"},s.default.createElement("div",{className:"mc-media-cell-text search__people-suggestion-name"},s.default.createElement(u,{text:t.name,textMatch:t.nameMatch,keyName:"people-suggestion-"+o+"-name"})),s.default.createElement("div",{className:"search__people-suggestion-email"},s.default.createElement(u,{text:t.email,textMatch:t.emailMatch,keyName:"people-suggestion-"+o+"-email"}))))},t})(s.default.PureComponent);t.PeopleSuggestionRow=c;var u=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.text,r=e.textMatch,n=e.keyName;if(!t)return null;if(!r||!r.highlighted||!r.highlighted.length)return t;var a=[],i=0;return r.highlighted.forEach(function(e){e[0]!==i&&a.push(s.default.createElement("b",{key:n+"-"+i},t.substring(i,e[0])));var r=e[0]+e[1];a.push(s.default.createElement("span",{key:n+"-"+e[0]},t.substring(e[0],r))),i=r}),t.length!==i&&a.push(s.default.createElement("b",{key:n+"-"+i},t.substring(i,t.length))),a},t})(s.default.PureComponent);t.PeopleSuggestionRowText=u}),define("modules/clean/search/single_page/input/suggestions",["require","exports","tslib","external/react-redux","react","modules/clean/search/search_bar/query_suggestions_table","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/input/people_suggestions","modules/clean/search/single_page/logger","modules/clean/search/types"],function(e,t,r,n,s,a,i,o,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),i=r.__importStar(i),o=r.__importStar(o),c=r.__importStar(c);var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dismissSuggestions=function(){t.props.dismissQuerySuggestions({query:t.props.normalizedQuery}),t.props.dismissPeopleSuggestions({query:t.props.normalizedQuery}),t.props.setSuggestionHighlightRow({index:void 0}),t.props.onFocusInput()},t.handleQuerySuggestionClick=function(e,r){c.logQuerySuggestionClicked(r,t.props.querySuggestions),t.props.setQuery({query:e.text,alwaysTriggerSearch:!0}),t.dismissSuggestions()},t.handleContactSuggestionClick=function(e,r){c.logPeopleFilterClicked(r,t.props.peopleSuggestions.length),t.props.setFilteredAccountId({filteredAccountId:e.dbx_account_id}),t.props.setQuery({query:""}),t.dismissSuggestions()},t.handleHighlightDropdownItem=function(e){t.props.setSuggestionHighlightRow({index:e})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.shouldLogQuerySuggestionsShown()&&c.logQuerySuggestionsDisplayed(this.props.querySuggestions),this.shouldLogPeopleSuggestionsShown()&&c.logPeopleFilterShown(this.props.peopleSuggestions.length)},t.prototype.componentDidUpdate=function(e){!this.shouldLogQuerySuggestionsShown()||this.shouldLogQuerySuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||c.logQuerySuggestionsDisplayed(this.props.querySuggestions),!this.shouldLogPeopleSuggestionsShown()||this.shouldLogPeopleSuggestionsShown(e)&&this.props.normalizedQuery===e.normalizedQuery||c.logPeopleFilterShown(this.props.peopleSuggestions.length)},t.prototype.shouldLogQuerySuggestionsShown=function(e){return void 0===e&&(e=this.props),e.querySuggestionsLoadingState===u.QuerySuggestionsLoadingState.LOADED&&this.shouldShowQuerySuggestions(e)},t.prototype.shouldLogPeopleSuggestionsShown=function(e){return void 0===e&&(e=this.props),e.peopleSuggestionsLoadingState===u.PeopleSuggestionsLoadingState.LOADED&&this.shouldShowPeopleSuggestions(e)},t.prototype.shouldShowQuerySuggestions=function(e){var t=void 0===e?this.props:e,r=t.normalizedQuery,n=t.querySuggestions;return!!r&&!!n&&!!n.length},t.prototype.shouldShowPeopleSuggestions=function(e){var t=void 0===e?this.props:e,r=t.normalizedQuery,n=t.filteredAccountId,s=t.peopleSuggestions;return!(!r||n||!s||!s.length)},t.prototype.render=function(){var e=this.props,t=e.querySuggestions,r=e.peopleSuggestions,n=e.suggestionHighlightRow,i=this.shouldShowQuerySuggestions(),o=this.shouldShowPeopleSuggestions();return i||o?s.default.createElement("div",{className:"search__dropdown"},i&&s.default.createElement(a.QuerySuggestionsTable,{querySuggestions:t,onQuerySuggestionsClick:this.handleQuerySuggestionClick,highlightedRow:n,indexOffset:0,onHighlightDropdownItem:this.handleHighlightDropdownItem}),o&&s.default.createElement(l.PeopleSuggestions,{peopleSuggestions:r,onPeopleSuggestionsClick:this.handleContactSuggestionClick,highlightedRow:n,indexOffset:i?t.length:0,onHighlightDropdownItem:this.handleHighlightDropdownItem,showHeader:!0})):null},t})(s.default.PureComponent);t.SearchSuggestionsComponent=d;var p=function(e){return{querySuggestions:o.querySuggestions(e),normalizedQuery:o.normalizedQuery(e),user:o.user(e),suggestionHighlightRow:o.suggestionHighlightRow(e),querySuggestionsLoadingState:o.querySuggestionsLoadingState(e),peopleSuggestionsLoadingState:o.peopleSuggestionsLoadingState(e),filteredAccountId:o.filteredAccountId(e),peopleSuggestions:o.peopleSuggestions(e)}},h={setQuery:i.setQuery,dismissQuerySuggestions:i.dismissQuerySuggestions,setSuggestionHighlightRow:i.setSuggestionHighlightRow,dismissPeopleSuggestions:i.dismissPeopleSuggestions,setFilteredAccountId:i.setFilteredAccountId};t.ConnectedSearchSuggestions=n.connect(p,h)(d)}),define("modules/clean/search/single_page/logger",["require","exports","tslib","modules/clean/filepath","modules/clean/logging/hive/schemas/search-web_search_activity","modules/clean/logging/telemetry","modules/clean/react/browse/models","modules/clean/search/constants","modules/clean/search/logger","modules/clean/search/single_page/data/store","modules/clean/search/single_page/data/selectors/index"],function(e,t,r,n,s,a,i,o,l,c,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),u=r.__importStar(u),t.hiveLogger=new a.HiveLogger;var d=function(){return u.commonLogFields(c.getStoreForSearch().getState())},p=function(){return u.resultQuery(c.getStoreForSearch().getState())},h=function(e){return e!==o.SearchOriginPathway.WEB?{pathway:e}:void 0};t.logQueryStarted=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_started"},d(),{start:0,extra:h(e)})))},t.logQueryCompleted=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_completed"},d(),{latency:e,extra:h(n)})))},t.logQueryFailed=function(e,n,a){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_failed"},d(),{latency:e,failure_type:n,extra:h(a)})))},t.logResultAction=function(e,n,a,i,o){var l=r.__assign({event_name:"result_action"},d(),t.logFieldsFromResult(a),{action_type:e,position:n.indexOf(a),action_source:o});i&&(l.extra=r.__assign({},l.extra,{action_surface:i})),t.hiveLogger.log(new s.SearchWebSearchActivityRow(l))},t.logHistoryDisplayed=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_history_displayed"},d(),{recent_history_map:e.map(function(e){return e.rawQuery}).reduce(function(e,t,r){return e[r]=t,e},{})})))},t.logHistoryAdded=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_query_stored"},d(),{position:e})))},t.logHistoryClicked=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_query_selected"},d(),{query_string:e,position:n})))},t.logHistoryCleared=function(){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_history_cleared"},d())))},t.logScopeChipChanged=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"scope_chip_changed"},d(),{file_path:e,viewport:n})))},t.logSwitchSearchType=function(e,n,a){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"switch_search_type"},d(),{request_id:e,extra:{search_type:n,ref:a}})))},t.logImageSearchPromptShown=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"image_search_prompt_shown"},d(),{request_id:e,extra:{type:n}})))},t.logDwellTime=function(e,n){var a=p();t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"dwell_time"},d(),{query_string:a,view_type:n,extra:{dwell_time:e.toString()}
})))},t.logFileTypeFiltersChanged=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"file_type_filter_changed"},d(),{file_type_filters:e})))},t.logFiltersReset=function(){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"filters_reset"},d())))},t.logQuerySuggestionsDisplayed=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_suggestions_displayed"},d(),{result_count:e.length,query_suggestion_strings:e.map(function(e){return e.text?e.text:""})})))},t.logQuerySuggestionClicked=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_suggestions_clicked"},d(),{position:e,result_count:n.length,query_suggestion_strings:n.map(function(e){return e.text?e.text:""})})))},t.logQuerySuggestionsDismissed=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_suggestions_dismissed"},d(),{query_string:e})))},t.logQuerySuggestionsFetched=function(e,n,a){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_suggestions_fetched"},d(),{query_string:e,result_count:n,latency:a})))},t.logQuerySuggestionsFailed=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_suggestions_failed"},d(),{query_string:e})))},t.logFieldsFromResult=function(e){return e instanceof i.File?{deleted:e.isDeleted,file_extension:n.file_extension_for_logging(e.fq_path),file_last_edited:e.ts,file_name:n.filename(e.fq_path),file_nsid:""+e.ns_id,file_size:e.bytes,file_sjid:""+e.sjid,match_type:e.match_type,result_id:e.ns_id+":"+e.sjid}:e instanceof i.Paper?{paper_pad_id:e.pad_id,result_id:e.pad_id}:e instanceof i.PaperFolder?{paper_folder_id:e.folder_id,result_id:e.folder_id}:e instanceof i.FileSharedWithMe?{deleted:!1,file_extension:n.file_extension_for_logging(e.filename),file_last_edited:e.ts,file_name:n.filename(e.filename),file_size:e.bytes,match_type:e.match_type,result_id:e.file_id,extra:{result_type:e.is_cloud_doc?l.SearchLogResultType.SHARED_CLOUD_DOC:l.SearchLogResultType.SHARED_DOC}}:{}},t.logSortOrderChanged=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"sort_results"},d(),{extra:{sort_field:e.sortField,sort_direction:e.sortDirection}})))},t.logPeopleFilterResponse=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"people_filter_response"},d(),{result_count:e})))},t.logPeopleFilterShown=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"people_filter_shown"},d(),{result_count:e})))},t.logPeopleFilterClicked=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"people_filter_clicked"},d(),{position:e,result_count:n})))},t.logPeopleFilterRemoved=function(){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"people_filter_removed"},d())))},t.logContextMenuClick=function(){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"context_menu_click"},d())))},t.logRecentFilesFetched=function(e,n){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_files_fetched"},d(),{result_count:e,latency:n})))},t.logRecentFilesFailed=function(){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_files_failed"},d())))},t.logRecentItemsDisplayed=function(){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_files_displayed"},d()))),t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_started"},d()))),t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"query_completed"},d())))},t.logRecentItemClicked=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_files_clicked"},d(),{position:e}))),t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"result_action"},d(),{position:e})))},t.logRecentItemLocationClicked=function(e){t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"recent_files_location_clicked"},d(),{position:e}))),t.hiveLogger.log(new s.SearchWebSearchActivityRow(r.__assign({event_name:"result_action"},d(),{position:e})))}}),define("modules/clean/search/single_page/preview",["require","exports","tslib","external/react-redux","react","modules/clean/react/browse/constants","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/index","modules/constants/python"],function(e,t,r,n,s,a,i,o,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),i=r.__importStar(i),o=r.__importStar(o);var c=(function(t){function n(){var s=null!==t&&t.apply(this,arguments)||this;return s.closeFileViewer=function(){new Promise(function(t,r){e(["modules/clean/react/file_viewer/controller"],t,r)}).then(r.__importStar).then(function(e){e.close()})},s.handleFlipNext=function(){var e=s.props,t=e.previewFile,r=e.previewableFiles,n=e.setPreviewFileId;if(t&&!(r.length<2)){var a=r.indexOf(t);a<0||(a+=1,a>=r.length&&(a=0),n({previewFileId:r[a].file_id}))}},s.handleFlipPrevious=function(){var e=s.props,t=e.previewFile,r=e.previewableFiles,n=e.setPreviewFileId;if(t&&!(r.length<2)){var a=r.indexOf(t);a<0||(a-=1,a<0&&(a=r.length-1),n({previewFileId:r[a].file_id}))}},s.showFileViewer=function(t){var a=s.props,i=a.user,o=a.previewableFiles,c=a.setPreviewFileId;i&&new Promise(function(t,r){e(["modules/clean/react/file_viewer/controller"],t,r)}).then(r.__importStar).then(function(e){e.open(o,o.indexOf(t),i,n.containerId,{fileViewAction:l.FileViewActionType.CLICK,fileViewOrigin:l.FileViewOriginType.SEARCH,fileViewTarget:l.FileViewTargetType.PRIVATE,skipOuterRouting:!0,disableRouting:!0,disableFlipping:!1,onCloseViewer:function(){c({previewFileId:void 0})},onFlipNext:s.handleFlipNext,onFlipPrevious:s.handleFlipPrevious})})},s}return r.__extends(n,t),n.prototype.componentDidMount=function(){this.props.previewFile&&this.showFileViewer(this.props.previewFile)},n.prototype.componentWillReceiveProps=function(e){return!e.previewFile&&this.props.previewFile?void this.closeFileViewer():e.previewFile&&!this.props.previewFile?void this.showFileViewer(e.previewFile):void(e.previewFile&&this.props.previewFile.file_id!==e.previewFile.file_id&&this.showFileViewer(e.previewFile))},Object.defineProperty(n,"containerId",{get:function(){return document.getElementById("react-file-viewer")?"react-file-viewer":a.BROWSE_FILE_VIEWER_ELEMENT_ID},enumerable:!0,configurable:!0}),n.prototype.render=function(){return null},n})(s.default.PureComponent);t.SearchPreviewComponent=c;var u=function(e){return{user:o.user(e),previewFile:o.previewFile(e),previewableFiles:o.previewableFiles(e)}},d={setPreviewFileId:i.setPreviewFile};t.SearchPreview=n.connect(u,d)(c)}),define("modules/clean/search/single_page/sidebar",["require","exports","tslib","external/react-redux","react","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/types","modules/clean/search/search_helpers","modules/clean/search/search_results/sidebar_view","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/store","modules/clean/search/single_page/image_panel","modules/clean/search/single_page/logger","modules/core/browser","modules/core/i18n","modules/core/notify"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),l=r.__importStar(l),p=r.__importStar(p),h=r.__importStar(h),_=r.__importStar(_),S=r.__importStar(S);var v=(function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.starredStoreRemoveListener=function(){},e.handleSearchFiltersChanged=function(t){var r=t.path,n=t.fileCategories,s=t.searchType;if(void 0===r||a.paths_are_equal(r,e.props.path)||e.props.setPath({path:r,viewport:"sidebar"}),n&&u.fileCategoriesToString(n)!==u.fileCategoriesToString(e.props.fileCategories)){e.props.setFileCategories({fileCategories:n});var i=Object.keys(n).filter(function(e){return"checked"===n[e]});f.logFileTypeFiltersChanged(i)}s&&e.props.setSearchType({searchType:s})},e.handleDelete=function(t){var r=e.props,n=r.deleteFiles,s=r.purgeFiles,a=r.user,o=r.context,l=t.some(i.File.isTeamSharedFolder),c=t.some(function(e){return e.read_only}),u=t.every(function(e){return e.isDeleted});!e.props.context.isCurrentPathWriteable()||l||c?l?E.Notify.error(y._("Team folders can’t be deleted.")):E.Notify.warning(y._("You don’t have permission to delete files in this folder.")):u?s({files:t,user:a,context:o}):n({files:t,user:a,context:o})},e.handlePermanentDelete=function(t){var r=e.props;(0,r.purgeFiles)({files:t,user:r.user,context:r.context})},e.handleRestore=function(t){var r=e.props;(0,r.restoreFiles)({files:t,user:r.user,context:r.context})},e.handlePreview=function(t){e.props.setPreviewFile({previewFileId:t.file_id})},e.handleContextMenuClick=function(){f.logContextMenuClick()},e}return r.__extends(n,t),n.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var t,n=this;return r.__generator(this,function(s){switch(s.label){case 0:return this.props.handleComponentTTI({component:"sidebar",query:this.props.resultQuery}),[4,new Promise(function(t,r){e(["modules/clean/react/starred/store"],t,r)}).then(r.__importStar)];case 1:return t=s.sent().StarredStore,this.starredStoreRemoveListener=t.addListener(function(){n.setState({starredState:t.getLoadingStates()})}),[2]}})})},n.prototype.componentWillUnmount=function(){this.starredStoreRemoveListener()},n.prototype.componentDidUpdate=function(){this.props.handleComponentTTI({component:"sidebar",query:this.props.resultQuery})},n.prototype.render=function(){var e=this,t=this.props,r=t.responsive,n=t.resultQuery,a=t.selectedFiles,o=t.searchType,l=t.shouldShowImagePanel,u=t.filteredAccountId;if(!n&&!u)return s.default.createElement("div",{className:"search__sidebar"});var p=l?s.default.createElement(m.ImagePanelView,{selectedFiles:a,responsive:r,searchType:o,onSearchFiltersChanged:this.handleSearchFiltersChanged,imageSuggestionQuery:this.props.imageSuggestionQuery,imageSuggestionResults:this.props.imageSuggestionResults,imageSuggestionRequestId:this.props.imageSuggestionRequestId}):null;return s.default.createElement("div",{id:"brws-sidebar-view",className:"search__sidebar","aria-live":"polite"},p,s.default.createElement(d.SearchResultsSidebarView,{actionHandlers:{onDelete:this.handleDelete,onPermanentDelete:this.handlePermanentDelete,onRestore:this.handleRestore,onShowComment:function(t){t instanceof i.FileSharedWithMe?S.redirect(t.href):e.handlePreview(t)},onShowRename:function(t){e.props.setFileRename({file:t,renameState:c.RenameState.PENDING_INPUT})}},responsive:r,onSearchFiltersChanged:this.handleSearchFiltersChanged,onContextMenuClick:this.handleContextMenuClick}))},n})(s.default.PureComponent);t.SearchSidebarComponent=v;var w=g.getStoreForSearch(),T=function(e){return{resultQuery:_.resultQuery(e),path:_.path(e),selectedFiles:_.selectedFiles(e),fileCategories:_.fileCategories(e),isNautilusEnabled:_.isNautilusEnabled(e),isPaperEnabled:_.isPaperEnabled(e),searchType:_.searchType(e),imageSuggestionCount:_.imageSuggestionCount(e),imageSuggestionQuery:_.imageSuggestionQuery(e),imageSuggestionResults:_.imageSuggestionResults(e),imageSuggestionRequestId:_.imageSuggestionRequestId(e),experiments:h.experiments(e),context:_.context(e),shouldShowImagePanel:!!h.shouldShowImagePanel(e),filteredAccountId:_.filteredAccountId(e)}},C={setPath:p.setPath,setFileCategories:p.setFileCategories,setSearchType:p.setSearchType,handleComponentTTI:p.handleComponentTTI,setPreviewFile:p.setPreviewFile,setFileRename:l.setFileRename,deleteFiles:p.deleteFiles,purgeFiles:p.purgeFiles,restoreFiles:p.restoreFiles},F=n.connect(T,C)(v),R=function(e){return s.default.createElement(n.Provider,{store:w},s.default.createElement(F,r.__assign({},e)))};t.SearchSidebar=o.requireCssWithComponent(R,["/static/css/search/search_results-vflAdqHkm.css"])}),define("modules/clean/search/single_page/tabs",["require","exports","tslib","external/react-redux","react","spectrum/tabbed_header","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/clean/search/types"],function(e,t,r,n,s,a,i,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),i=r.__importStar(i),o=r.__importStar(o),l=r.__importStar(l);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._tryLogImageSearchPromptShown=function(){var e=t.props,r=e.searchResultsExperiments,n=e.imageSuggestionCount,s=e.imageSuggestionRequestId;r.expImageContentSearchDiscovery===c.ImageSearchDiscoveryVariants.TAB&&n>0&&l.logImageSearchPromptShown(s||"","tab")},t}return r.__extends(t,e),t.prototype.componentDidUpdate=function(e){e.imageSuggestionRequestId!==this.props.imageSuggestionRequestId&&this._tryLogImageSearchPromptShown()},t.prototype.componentDidMount=function(){this._tryLogImageSearchPromptShown()},t.prototype.render=function(){var e=this.props,t=e.onSwitchTab,r=e.searchType,n=e.tabs;return n&&n.length?s.default.createElement(a.TabbedHeader,{activeTabId:r,onSelection:t,className:"search__tabs"},n.map(function(e){var n=e.id,i=e.label;return s.default.createElement(a.Tab,{id:n,key:n,active:n===r,onClick:function(){return t(n,"tab")},className:"search__tab"},s.default.createElement("span",{className:"search__tab--contents"},i))})):null},t})(s.default.PureComponent);t.SearchTabsComponent=u;var d=function(e){return{searchType:o.searchType(e),tabs:i.tabs(e),searchResultsExperiments:i.searchResultsExperiments(e),imageSuggestionCount:o.imageSuggestionCount(e),imageSuggestionRequestId:o.imageSuggestionRequestId(e)}},p={};t.SearchTabs=n.connect(d,p)(u)}),define("modules/clean/search/single_page/utils",["require","exports","tslib","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/search/single_page/data/selectors/index","modules/clean/search/store_helpers","modules/clean/search/single_page/constants"],function(e,t,r,n,s,a,i,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),a=r.__importStar(a),i=r.__importStar(i),t.hasSearchChanged=function(e,t){var r=t.path,s=t.query,o=t.filteredAccountId,l=t.fileCategoriesString,c=t.searchType;return!n.paths_are_equal(r,a.path(e))||(i.normalize(s)!==a.normalizedQuery(e)||(o!==a.filteredAccountId(e)||(l!==a.fileCategoriesString(e)||c!==a.searchType(e))))},t.shouldStartNewSearchSession=function(e,t){var r=t.query;return!a.sessionId(e)||(!(!a.normalizedQuery(e)||r)||a.normalizedQuery(e).length>=3&&1===r.length)},t.generateRandomId=i.generateRandomId,t.getIdForSearchResult=function(e){return e instanceof s.File?e.file_id||e.fq_path:e instanceof s.Paper?e.pad_id:e instanceof s.PaperFolder?e.folder_id:e instanceof s.FileSharedWithMe?e.file_id:""},t.responsiveHeaderHeight=function(e,t,r){var n=r?48:0;return e.isMatchedLarge?o.SEARCH_PAGE_HEADER_HEIGHT_DESKTOP-(t?20:0)+n:e.isMatchedMedium?o.SEARCH_PAGE_HEADER_HEIGHT_TABLET+n:o.SEARCH_PAGE_HEADER_HEIGHT_MOBILE+n}}),define("modules/clean/search/single_page/view",["require","exports","tslib","classnames","external/immutable","external/lodash","external/react-redux","react","modules/clean/browse_uri_interface","modules/clean/cloud_docs/open_with_utils","modules/clean/cloud_docs/preferred_editor_utils","modules/clean/cloud_docs/types","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/react/extensions/data/selectors","modules/clean/react/file_viewer/async_controller","modules/clean/react/files_view/constants","modules/clean/react/files_view/data/action_creators","modules/clean/react/files_view/data/selectors","modules/clean/react/files_view/types","modules/clean/react/image","modules/clean/upsell/top_notification_listener","modules/clean/react/retrieval_success_banner/constants","modules/clean/react/retrieval_success_banner/retrieval_success_browseview_banner","modules/clean/react/retrieval_success_banner/util","modules/clean/react_format","modules/clean/search/constants","modules/clean/search/search_results/view","modules/clean/search/single_page/constants","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/data/store","modules/clean/search/single_page/filters","modules/clean/search/single_page/header","modules/clean/search/single_page/logger","modules/clean/search/single_page/navigation","modules/clean/search/single_page/preview","modules/clean/search/single_page/tabs","modules/clean/search/single_page/utils","modules/clean/search/single_page/zero_query/index","modules/clean/search/types","modules/clean/sharing/browse_exports","modules/clean/static_urls","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/browser_detection","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_,g,m,f,S,y,E,v,w,T,C,F,R,I,b,A,x,L,D,P,O,N,k,q,M,Q,H,V,U,B,W,G,z,Y,K,j,Z,X,J){"use strict";function $(e){return function(t){t.preventDefault(),e()}}var ee=this;Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),s=r.__importStar(s),a=r.__importStar(a),o=r.__importDefault(o),p=r.__importStar(p),g=r.__importStar(g),S=r.__importStar(S),y=r.__importStar(y),x=r.__importStar(x),L=r.__importStar(L),D=r.__importStar(D),k=r.__importStar(k),K=r.__importStar(K);var te=(function(t){function i(e){var r=t.call(this,e)||this;return r.state={hasTopNotification:!1},r.starredStoreListenerUnsubscribe=function(){},r.scrollContainer=o.default.createRef(),r.canUseSticky=ce(),r.handlePreview=function(e){r.props.setPreviewFile({previewFileId:e.file_id})},r.handleDelete=function(e){var t=r.props,n=t.deleteFiles,s=t.purgeFiles,a=t.user,i=t.context,o=e.some(h.File.isTeamSharedFolder),l=e.some(function(e){return e.read_only}),c=e.every(function(e){return e.isDeleted});!r.props.context.isCurrentPathWriteable()||o||l?o?X.Notify.error(Z._("Team folders can’t be deleted.")):X.Notify.warning(Z._("You don’t have permission to delete files in this folder.")):c?s({files:e,user:a,context:i}):n({files:e,user:a,context:i})},r.handlePermanentDelete=function(e){var t=r.props;(0,t.purgeFiles)({files:e,user:t.user,context:t.context})},r.handleRestore=function(e){var t=r.props;(0,t.restoreFiles)({files:e,user:t.user,context:t.context})},r.actionHandlers={onDelete:r.handleDelete,onShowRename:function(e){r.props.setFileRename({file:e,renameState:E.RenameState.PENDING_INPUT})},onShowComment:function(e){e instanceof h.FileSharedWithMe?K.redirect(e.href):r.handlePreview(e)},onRestore:r.handleRestore,onPermanentDelete:r.handlePermanentDelete},r.handleGetOverflowMenuActions=function(e,t,n,a,i){var o=r.state.fileActionsModule,l=r.props,c=l.user,u=l.context,d=l.viewType,p=l.extensionsFeatureFlags,h=l.sharingServiceInfo,_=l.browsePostTTIExperiments,g=l.browseExperiments,m=l.searchBarExperiments;if(!o)return[];var f=o.getActionsForFileCollection({files:s.Set([e]),context:u,user:c,viewType:d,extensionsFeatureFlags:p,sharingServiceInfo:h,actionHandlers:r.actionHandlers,isQueryingFolderSizes:!1,skipSharing:!1,isSearchMode:!0,canShowUJPopup:a,isSidebar:i,responsive:n,isOverFreeQuota:!1,hasExcludedNsIds:!1,canDisplayFolderSizes:t,showAddToShowcase:!!_.expShowAddToShowcase,showAddFolderToShowcase:!!_.expShowAddFolderToShowcase,hasCreatedShowcase:!!_.expHasCreatedShowcase,hasShowcaseFreemium:!!_.expHasShowcaseFreemium,showShowcaseInterstitialExp:!!_.expShowShowcaseInterstitial,showFolderCalcSize:!1,useSearchSuccessBanner:!!m.expSearchSuccessBanner,expFolderHistoryRollbacks:!!g.expFolderHistoryRollbacks,expDeleteUseApiV2:!!_.expDeleteUseApiV2,expMoveUseApiV2:!!_.expMoveUseApiV2,expCopyUseApiV2:!!_.expCopyUseApiV2}),S=new Array;return f.forEach(function(e){"function"!=typeof e&&S.push(e)}),[S]},r.handleRenderSharedWithController=function(){return null},r.handleGetIsFileJumping=function(){return!1},r.handleIsFileViewerShown=function(){return!!r.props.previewFile},r.handleShowShare=function(e,t){k.logResultAction(z.WebUserActionLogEvent.SHARE,r.props.results,e),B.asyncShowShareModal(r.props.user,e,{browseContext:r.props.context,origin:t})},r.handleSwitchViewType=function(e){r.props.setViewType({viewType:e,user:r.props.user}),window.setTimeout(function(){var e=document.querySelector(".brws-view-type-column-header-menu-trigger");e&&e.focus()},0)},r.filesViewActionHandlers={onDelete:a.noop,onShowRename:function(e){r.props.setFileRename({file:e,renameState:E.RenameState.PENDING_INPUT})},onCopyToClipboard:a.noop,onPasteFromClipboard:a.noop,onNewFolderSubmit:a.noop,onNewFolderCancel:a.noop,onRenameSubmit:function(e,t){r.props.renameFile({file:e,name:t,checkFSWs:!0})},onRenameCancel:function(e){return r.props.setFileRename({file:e,renameState:null})},onSwitchViewType:r.handleSwitchViewType,onColumnsChanged:a.noop,onCanDisplayFolderSizesChanged:a.noop,onAddFileJumpKeyCode:a.noop,onResetFileJump:a.noop,onShowShare:r.handleShowShare,onPresentInZoom:function(e){m.asyncOpenPreview({containerId:M.SearchPreviewComponent.containerId,files:[e],indexOfPreviewFile:0,shouldFocusComment:!1,user:r.props.user,onFileViewerDidMount:function(){},onFileViewerUnmount:function(){},fileViewAction:Y.FileViewActionType.CLICK,fileViewOrigin:Y.FileViewOriginType.SEARCH,fileViewTarget:Y.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}},r.getPageHeaderHeight=function(){var e=r.props,t=e.shouldRenderInlineSearchFilters,n=e.hasSimplifiedLockup,s=0;return r.canUseSticky&&(n?(s+=33,t&&(s+=48),r.props.shouldRenderTabs&&(s+=44)):(t&&(s+=58),r.props.shouldRenderTabs&&(s+=38))),r.props.contentScroll?s-1:s+H.responsiveHeaderHeight(r.props.responsive,!!n,!!r.state.hasTopNotification)},r.updateViewTypeScope=function(e){r.props.setViewTypeScope({viewTypeScope:e===I.SearchType.IMAGE?f.VIEW_TYPE_SCOPE_IMAGE_SEARCH:f.VIEW_TYPE_GLOBAL_SCOPE}),e===I.SearchType.IMAGE&&r.props.viewType!==E.ViewType.LargeGrid&&r.props.setViewType({user:r.props.user,viewType:E.ViewType.LargeGrid})},r.logSelection=function(e){var t=r.props.results,n=e.selected.first(),s=function(e){return e instanceof h.File?e.fq_path===n:e instanceof h.FileSharedWithMe&&e.file_id===n},a=t.find(s);a&&k.logResultAction(z.WebUserActionLogEvent.SELECT_ROW,r.props.results,a)},r.handleSelectionChange=function(e){r.logSelection(e),r.props.setSelection({selection:e})},r.handleNavigateToFileOrFolder=function(e,t){void 0===t&&(t={});var n=t.actionSource;return r.addHistory(),r.props.stopAndLogDwellTime(),e.isDeleted?void r.handleRestore([e]):e.is_dir?(k.logResultAction(z.WebUserActionLogEvent.FOLDER_OPEN,r.props.results,e,void 0,n),void q.searchNavigationManager.set(l.href_for_file(r.props.user,e))):(k.logResultAction(z.WebUserActionLogEvent.FILE_VIEW,r.props.results,e,void 0,n),e.is_cloud_doc?void c.openCloudDoc(e,r.props.user,d.WebSearchSource):u.hasPreferredEditorSupport(e)?void u.openInPreferredEditor(r.props.user,e,r.props.preferredEditors,function(){r.handlePreviewFile(e)},{fileViewAction:Y.FileViewActionType.CLICK,fileViewOrigin:Y.FileViewOriginType.SEARCH}):void r.handlePreviewFile(e))},r.handlePreviewFile=function(e){r.props.setPreviewFile({previewFileId:e.file_id})},r.addHistory=function(){r.props.addHistory()},r.handleSearch=function(e,t,n){void 0===t||p.paths_are_equal(t,r.props.path)||r.props.setPath({path:t}),e!==r.props.normalizedQuery&&r.props.setQuery({query:e,alwaysTriggerSearch:!0})},r.handleLocationLinkClick=function(e,t){k.logResultAction(z.WebUserActionLogEvent.CLICK_PATH_LINK,r.props.results,e),t||q.searchNavigationManager.set(l.get_browse_root(r.props.user)+J.URI.encode_parts(p.parent_dir(e.fq_path)))},r.handleOpenPaper=function(e){k.logResultAction(z.WebUserActionLogEvent.PAPER_OPEN,r.props.results,e),K.redirect(e.url)},r.handleFileSharedWithMe=function(e){k.logResultAction(z.WebUserActionLogEvent.FILE_VIEW,r.props.results,e),K.redirect(e.href)},r.handleSwitchTab=function(e,t){if(e!==r.props.searchType){var n=r.props,s=n.imageSuggestionRequestId,a=n.requestId;k.logSwitchSearchType((e===I.SearchType.IMAGE?s:a)||"",e,t||"tab"),r.props.setFilters({searchType:e})}},r.handleRangeInView=function(e,t){r.props.loadingState===I.SearchLoadingState.LOADED&&r.props.hasMoreResults&&t===r.props.results.size-(r.props.viewType===E.ViewType.List?1:0)&&r.props.fetchNextPage()},r.handleSortOrderChanged=function(e,t){r.props.setSortOrder({sortOrder:{sortField:e,sortDirection:t}})},r.handleFocusSearchBar=function(){r.props.inputBox.current&&r.props.inputBox.current.focus()},r.handleStarClick=function(e,t){k.logResultAction(t?z.WebUserActionLogEvent.STAR:z.WebUserActionLogEvent.REMOVE_STAR,r.props.results,e),r.props.searchBarExperiments.expSearchSuccessBanner&&F.setSearchSuccessBannerVisible()},e.loadViewTypes({user:e.user}),e.loadHistory(),r}return r.__extends(i,t),i.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){var t,n,s,a=this;return r.__generator(this,function(i){switch(i.label){case 0:return this.props.handleComponentTTI({component:"view",query:this.props.resultQuery}),this.props.hasSimplifiedLockup&&this.props.onUpdate({chromeClass:"exp-simplified-lockup"}),[4,G.waitForTTI()];case 1:return i.sent(),[4,Promise.all([new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar)])];case 2:return t=i.sent(),n=t[0],s=t[1].StarredStore,this.starredStoreListenerUnsubscribe=s.addListener(function(){a.setState({starredState:s.getLoadingStates()})}),this.setState({fileActionsModule:n}),[2]}})})},i.prototype.componentWillMount=function(){var e=this;this.updateViewTypeScope(this.props.searchType),window.addEventListener("beforeunload",this.props.stopAndLogDwellTime),this.topNotificationListener=w.createTopNotificationListener(function(t){e.setState({hasTopNotification:t})})},i.prototype.componentDidUpdate=function(e){this.props.handleComponentTTI({component:"view",query:this.props.resultQuery}),e.searchType!==this.props.searchType&&this.updateViewTypeScope(this.props.searchType),this.props.hasSimplifiedLockup&&!e.hasSimplifiedLockup&&this.props.onUpdate({chromeClass:"exp-simplified-lockup"})},i.prototype.componentWillUnmount=function(){window.removeEventListener("beforeunload",this.props.stopAndLogDwellTime),this.starredStoreListenerUnsubscribe(),this.props.stopAndLogDwellTime(),this.topNotificationListener.unsubscribe()},i.prototype.render=function(){var e,t=this.props,r=t.user,s=t.responsive,i=t.results,c=t.context,u=t.loadingState,d=t.resultQuery,p=t.path,h=t.searchSessionId,_=t.viewType,g=t.selection,m=t.selectedFiles,f=t.searchType,S=t.imageSuggestionCount,y=t.imageSuggestionQuery,E=t.imageSuggestionRequestId,v=t.shouldRenderTabs,w=t.contentScroll,F=t.filteredContactName,R=t.searchBarExperiments,x=t.inputBox,L=t.hasSimplifiedLockup,D=this.state.hasTopNotification;if(u===I.SearchLoadingState.LOAD_ERROR)return o.default.createElement(o.default.Suspense,{fallback:o.default.createElement("div",null,Z._("Something went wrong on our end."))},o.default.createElement(le,null));if(u===I.SearchLoadingState.ZERO_QUERY)return o.default.createElement(V.ZeroQueryView,{inputBox:x});var P=!!this.props.resultQuery&&this.props.results.isEmpty()&&this.props.loadingState===I.SearchLoadingState.LOADED,k=this.props.searchResultsExperiments.expImageContentSearchDiscovery===U.ImageSearchDiscoveryVariants.SNACKBAR,q=n.default("search__view",(e={},e["maestro-content-scroll"]=w,e["search__view--simplified-lockup"]=L,e)),H=this.props.showRetrievalSuccessBrowseviewBanner?A.SEARCH_SUCCESS_BANNER_HEIGHT:0,B=o.default.createElement(C.RetrievalSuccessBrowseviewBanner,{user:r,displayContext:T.SearchSuccessDisplayContext.IN_USPS,expSearchSuccessBanner:!!R.expSearchSuccessBanner,isFilePreview:!1,isSearchMode:!0,inUniversalSinglePageSearch:!0}),W=o.default.createElement(Q.SearchTabs,{onSwitchTab:this.handleSwitchTab}),G=o.default.createElement(O.SearchFilters,{isScreenWidthMobile:!(this.props.responsive.isMatchedLarge||this.props.responsive.isMatchedMedium)}),z=L?o.default.createElement(oe,{responsive:s,offset:0,contentScroll:w,simplifiedLockup:!0,hasTopNotification:D},B,W,o.default.createElement(N.SimpleSearchHeader,null),G):o.default.createElement(o.default.Fragment,null,o.default.createElement(oe,{responsive:s,offset:0,contentScroll:w,position:1,hasTopNotification:D},B),o.default.createElement(oe,{responsive:s,offset:H,position:2,contentScroll:w,hasTopNotification:D},W),o.default.createElement(N.SearchHeader,null),o.default.createElement(oe,{responsive:s,offset:(v?A.SEARCH_TAB_HEIGHT:0)+H,position:3,contentScroll:w,hasTopNotification:D},G));return o.default.createElement(o.default.Fragment,null,o.default.createElement(M.SearchPreview,null),o.default.createElement("div",{className:q,ref:this.scrollContainer},z,P?o.default.createElement(ie,{hasFiltersSelected:this.props.hasFiltersSelected,resetFiltersUrl:this.props.searchUrlReset,onResetFilters:this.props.resetFilters}):o.default.createElement(b.SearchResultsView,{filesViewActionHandlers:this.filesViewActionHandlers,searchResultsExperiments:this.props.searchResultsExperiments,searchBarExperiments:this.props.searchBarExperiments,browseExperiments:this.props.browseExperiments,maestroSearchBarProps:{},onFocusSearchBar:this.handleFocusSearchBar,onSearch:this.handleSearch,onScroll:a.noop,setFileUploaderPath:a.noop,onSelectionChange:this.handleSelectionChange,path:p,user:r,handleComponentTTI:a.noop,ensureFileViewerClosedIfNotPreviewing:a.noop,getIsFileJumping:this.handleGetIsFileJumping,isFileViewerShown:this.handleIsFileViewerShown,fileRename:this.props.fileRename,arePostTTIModulesLoaded:!!this.state.fileActionsModule,getOverflowMenuActions:this.handleGetOverflowMenuActions,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.handleNavigateToFileOrFolder,onNavigateToParentFolder:a.noop,onOpenFileSharedWithMe:this.handleFileSharedWithMe,onOpenPaper:this.handleOpenPaper,context:c,hasMoreResults:!!this.props.hasMoreResults,loadingState:u,latestQuery:d,queryForResultsTitle:d,searchSessionId:h,searchResults:i,selection:g,selectedFiles:m,viewType:_,shouldShowDeletedFiles:!1,renderSharedWithController:this.handleRenderSharedWithController,hrefForFile:l.href_for_file,responsive:s,onSearchFiltersChanged:this.props.setFilters,starredState:this.state.starredState,fileCategories:this.props.fileCategories,pageHeaderHeight:this.getPageHeaderHeight()+H,onSortChange:this.handleSortOrderChanged,searchType:f,numImageSuggestions:S,imageSuggestionQuery:y,imageSuggestionRequestId:E||"",showImageSuggestionSnackbar:k,extensionsFeatureFlags:this.props.extensionsFeatureFlags,sharingServiceInfo:this.props.sharingServiceInfo,onRangeInView:this.handleRangeInView,dontRenderHeader:!0,currentSort:this.props.sortOrder,onStarClick:this.handleStarClick,scrollContainer:w?this.scrollContainer:void 0,filteredContactName:F})))},i})(o.default.PureComponent);t.SearchViewComponent=te;var re=P.getStoreForSearch(),ne=function(e){return{normalizedQuery:D.normalizedQuery(e),resultQuery:D.resultQuery(e),loadingState:D.loadingState(e),results:D.resultsList(e),path:D.path(e),searchSessionId:D.sessionId(e),requestId:D.requestId(e),viewType:y.viewType(e),selectedFiles:D.selectedFiles(e),selection:D.selection(e),history:D.queryHistory(e),
previewFile:D.previewFile(e),extensionsFeatureFlags:g.getFeatureFlags(e),sharingServiceInfo:g.sharingServiceInfo(e),fileCategories:D.fileCategories(e),context:D.context(e),fileRename:y.fileRename(e),hasMoreResults:D.hasMoreResults(e),searchType:D.searchType(e),imageSuggestionCount:D.imageSuggestionCount(e),imageSuggestionQuery:D.imageSuggestionQuery(e),imageSuggestionRequestId:D.imageSuggestionRequestId(e),imageSuggestionResults:D.imageSuggestionResults(e),sortOrder:D.sortOrder(e),searchResultsExperiments:L.searchResultsExperiments(e),searchBarExperiments:L.searchBarExperiments(e),browseExperiments:L.browseExperiments(e),browsePostTTIExperiments:L.browsePostTTIExperiments(e),hasFiltersSelected:D.hasFiltersSelected(e),searchUrlReset:D.searchUrlReset(e),preferredEditors:D.preferredEditors(e),experiments:L.experiments(e),shouldRenderTabs:L.shouldRenderTabs(e),contentScroll:L.shouldMainContentScroll(e),filteredContactName:D.filteredContactName(e),showRetrievalSuccessBrowseviewBanner:D.shoulShowRetrievalSuccessBrowseviewBanner(e),shouldRenderInlineSearchFilters:L.shouldRenderInlineSearchFilters(e),hasSimplifiedLockup:L.hasSimplifiedLockup(e)}},se={setPath:x.setPath,setQuery:x.setQuery,setFileCategories:x.setFileCategories,setViewType:S.setViewType,setViewTypeScope:S.setViewTypeScope,loadViewTypes:S.loadViewTypes,setSelection:x.setSelection,clearHistory:x.clearAllHistory,loadHistory:x.loadHistory,addHistory:x.addQueryToHistory,setPreviewFile:x.setPreviewFile,setFileRename:S.setFileRename,handleComponentTTI:x.handleComponentTTI,fetchNextPage:x.fetchNextPage,setSearchType:x.setSearchType,renameFile:x.renameFile,deleteFiles:x.deleteFiles,purgeFiles:x.purgeFiles,setSortOrder:x.setSortOrder,updateResults:x.updateResults,restoreFiles:x.restoreFiles,setFilteredAccountId:x.setFilteredAccountId,setFilters:x.setFilters,resetFilters:x.resetFilters,stopAndLogDwellTime:x.stopAndLogDwellTime},ae=i.connect(ne,se)(te);t.ConnectedSearchViewWithProvider=function(e){return o.default.createElement(i.Provider,{store:re},o.default.createElement(ae,r.__assign({},e)))},t.SearchView=_.requireCssWithComponent(t.ConnectedSearchViewWithProvider,["/static/css/search/view-vflXhYCwg.css","/static/css/browse/browse-vflvnPFg-.css","/static/css/browse/files_view-vfliP00vc.css","/static/css/search/search_results-vflAdqHkm.css"]);var ie=function(e){var t=e.hasFiltersSelected,r=e.resetFiltersUrl,n=e.onResetFilters;return o.default.createElement("div",{className:"search__view search__view--empty",id:"search-view"},o.default.createElement(v.Image,{src:W.static_url("/static/images/empty_states/search-vflHMNVT9.png"),srcHiRes:W.static_url("/static/images/empty_states/search@2x-vfly2B3kk.png")}),o.default.createElement("h2",null,Z._("No results found")),o.default.createElement("span",null,t?R.reactFormat(Z._("Try <LinkScope>resetting all filters</LinkScope>"),{LinkScope:o.default.createElement("a",{href:r,onClick:$(n)})}):Z._("Try different keywords")))},oe=function(e){var t=e.children,r=e.offset,n=e.responsive,s=e.position,a=void 0===s?0:s,i=e.contentScroll,l=e.simplifiedLockup,c=e.hasTopNotification;return o.default.createElement("div",{className:"search__sticky",style:{top:r+(i?0:H.responsiveHeaderHeight(n,!!l,c)),zIndex:10-a}},t)},le=o.default.lazy(function(){return r.__awaiter(ee,void 0,void 0,function(){var t;return r.__generator(this,function(n){switch(n.label){case 0:return[4,new Promise(function(t,r){e(["modules/clean/react/browse/components/post_tti/error"],t,r)}).then(r.__importStar)];case 1:return t=n.sent().ErrorComponent,[2,{default:t}]}})})}),ce=function(){try{return!("msie"===j.get_browser_info().browser&&parseFloat(j.get_browser_info().version)<=11)}catch(e){return!0}}}),define("modules/clean/search/single_page/zero_query/history",["require","exports","tslib","external/react-redux","react","spectrum/icon_global","spectrum/media_table","spectrum/table","spectrum/tertiary_link","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/core/i18n","modules/clean/keycode"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),c=r.__importStar(c),u=r.__importStar(u),d=r.__importStar(d),p=r.__importStar(p);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleHistoryClick=function(e,r){t.props.setQuery({query:e.normalizedQuery,alwaysTriggerSearch:!0}),t.focusInputBox(),p.logHistoryClicked(e.normalizedQuery,r)},t.handleClearClick=function(){t.props.user&&(t.props.clearHistory(),t.focusInputBox())},t.focusInputBox=function(){t.props.inputBox.current&&t.props.inputBox.current.focus()},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.shouldRenderHistory&&p.logHistoryDisplayed(this.props.history)},t.prototype.componentDidUpdate=function(e){this.props.shouldRenderHistory&&e.shouldRenderHistory&&p.logHistoryDisplayed(this.props.history)},t.prototype.render=function(){var e=this,t=this.props,r=t.history;return t.shouldRenderHistory?s.default.createElement(o.Table,{columnFlex:[10,"70px"],"aria-rowcount":r.length,"aria-describedby":"search__history-header"},s.default.createElement(o.TableHead,null,s.default.createElement(o.TableHeadCell,{id:"search__history-header"},h._("Recent searches")),s.default.createElement(o.TableHeadCell,{align:"right"},s.default.createElement(l.TertiaryLink,{onClick:this.handleClearClick,className:"search__history-clear"},h._("Clear all")))),s.default.createElement(o.TableBody,null,r.map(function(t,r){return s.default.createElement(m,{key:"history-"+r,history:t,index:r,onClick:e.handleHistoryClick})}))):null},t})(s.default.PureComponent);t.SearchHistoryComponent=g;var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){t.props.onClick(t.props.history,t.props.index)},t.handleKeyDown=function(e){switch(e.keyCode){case _.KeyCode.SPACE:case _.KeyCode.ENTER:t.props.onClick(t.props.history,t.props.index)}},t}return r.__extends(t,e),t.prototype.render=function(){var e=this;return s.default.createElement(i.MediaRow,{onClick:this.handleClick,className:"search__history-item",tabIndex:0,onKeyDown:this.handleKeyDown},function(t){var r=t.isHovered;return[s.default.createElement(i.MediaCell,{key:"text",icon:s.default.createElement(a.IconGlobal,{name:"search"}),title:e.props.history.rawQuery,highlight:r})]})},t})(s.default.PureComponent);t.SearchHistoryRow=m;var f=function(e){return{history:d.queryHistory(e),shouldRenderHistory:u.shouldRenderHistory(e),user:d.user(e)}},S={setQuery:c.setQuery,clearHistory:c.clearAllHistory};t.SearchHistoryView=n.connect(f,S)(g)}),define("modules/clean/search/single_page/zero_query/index",["require","exports","tslib","classnames","external/react-redux","react","modules/clean/keycode","modules/clean/react/image","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/zero_query/history","modules/clean/search/single_page/zero_query/query_suggestions","modules/clean/search/single_page/zero_query/recent_items","modules/clean/static_urls","modules/core/i18n"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),a=r.__importDefault(a),l=r.__importStar(l);var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleKeyDown=function(e){e.keyCode===i.KeyCode.ESC&&t.props.inputBox.current&&t.props.inputBox.current.focus()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.shouldRenderEmptyZeroQueryView,r=e.inputBox;return a.default.createElement("div",{className:n.default({search__view:!0,"search__view--empty":t}),id:"search-view",onKeyDown:this.handleKeyDown},a.default.createElement(u.QuerySuggestions,null),a.default.createElement(d.RecentItems,null),a.default.createElement(c.SearchHistoryView,{inputBox:r}),t&&a.default.createElement(a.default.Fragment,null,a.default.createElement(o.Image,{role:"presentation",src:p.static_url("/static/images/empty_states/search-vflHMNVT9.png"),srcHiRes:p.static_url("/static/images/empty_states/search@2x-vfly2B3kk.png")}),a.default.createElement("h2",null,h._("Begin typing to search")),a.default.createElement("span",null,h._("Search for files, folders, and content"))))},t})(a.default.PureComponent);t.ZeroQueryComponent=_;var g=function(e){return{shouldRenderEmptyZeroQueryView:l.shouldRenderEmptyZeroQueryView(e)}};t.ZeroQueryView=s.connect(g)(_)}),define("modules/clean/search/single_page/zero_query/query_suggestions",["require","exports","tslib","external/react-redux","react","modules/clean/search/search_bar/query_suggestions_table","modules/clean/search/single_page/data/action_creators","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger"],function(e,t,r,n,s,a,i,o,l,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),i=r.__importStar(i),o=r.__importStar(o),l=r.__importStar(l),c=r.__importStar(c);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleQuerySuggestionsClick=function(e,r){var n=t.props,s=n.setQuery,a=n.querySuggestions;c.logQuerySuggestionClicked(r,a),s({query:e.text,alwaysTriggerSearch:!0})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.shouldRenderPriorQuerySuggestions&&c.logQuerySuggestionsDisplayed(this.props.querySuggestions)},t.prototype.componentDidUpdate=function(e){this.props.shouldRenderPriorQuerySuggestions&&!e.shouldRenderPriorQuerySuggestions&&c.logQuerySuggestionsDisplayed(this.props.querySuggestions)},t.prototype.render=function(){return this.props.shouldRenderPriorQuerySuggestions?s.default.createElement(a.QuerySuggestionsTable,{querySuggestions:this.props.querySuggestions,onQuerySuggestionsClick:this.handleQuerySuggestionsClick,indexOffset:0,showHeader:!0}):null},t})(s.default.PureComponent);t.QuerySuggestionsComponent=u;var d=function(e){return{querySuggestions:l.priorQuerySuggestions(e),shouldRenderPriorQuerySuggestions:o.shouldRenderPriorQuerySuggestions(e)}},p={setQuery:i.setQuery};t.QuerySuggestions=n.connect(d,p)(u)}),define("modules/clean/search/single_page/zero_query/recent_items",["require","exports","tslib","external/react-redux","react","modules/clean/browse_uri_interface","modules/clean/search/models","modules/clean/search/search_bar/recent_files_table","modules/clean/search/search_helpers","modules/clean/search/single_page/data/selectors/experiments","modules/clean/search/single_page/data/selectors/index","modules/clean/search/single_page/logger","modules/clean/search/single_page/navigation","modules/core/browser"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),c=r.__importStar(c),u=r.__importStar(u),d=r.__importStar(d),h=r.__importStar(h);var _=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleRecentFileLocationClick=function(e,r){t.props.user&&(d.logRecentItemLocationClicked(r),p.searchNavigationManager.set(a.browse_uri_for_fq_path(t.props.user,e).getPath()))},t.handleRecentItemClick=function(e,r){t.props.user&&(d.logRecentItemClicked(r),e instanceof i.RecentFile?h.open_tab(a.browse_uri_for_fq_path(t.props.user,e.fq_path).toString()):h.open_tab(l.buildPaperUrl(e)))},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.props.shouldRenderRecentItems&&d.logRecentItemsDisplayed()},t.prototype.componentDidUpdate=function(e){this.props.shouldRenderRecentItems&&!e.shouldRenderRecentItems&&d.logRecentItemsDisplayed()},t.prototype.render=function(){var e=this.props,t=e.user,r=e.searchBarExperiments,n=e.recentItems;return e.shouldRenderRecentItems&&t?s.default.createElement(o.RecentFilesTable,{user:t,expRecentFiles:r.expRecentFiles,recentItems:n,onRecentFileLocationClick:this.handleRecentFileLocationClick,onRecentItemClick:this.handleRecentItemClick}):null},t})(s.default.PureComponent);t.RecentItemsComponent=_;var g=function(e){return{user:u.user(e),searchBarExperiments:c.searchBarExperiments(e),recentItems:u.recentItems(e),shouldRenderRecentItems:c.shouldRenderRecentItems(e)}};t.RecentItems=n.connect(g)(_)}),define("retrieval-components/file-type-filter",["require","exports","tslib","tslib","classnames","react","react-aria-menubutton","spectrum/button","spectrum/checkbox","spectrum/dropdown_menu","spectrum/icon_content","spectrum/label","spectrum/modal","spectrum/tooltip"],function(e,t,r,n,s,a,i,o,l,c,u,d,p,h){"use strict";function _(e,t){return e.every(function(e){return t.indexOf(e.category)>-1})}function g(e){return 0===e.length}function m(e){var t=new Set;e.forEach(function(e){return t.add(e)});var r=[];return t.forEach(function(e){return r.push(e)}),r}function f(e,t){function r(r){r.currentTarget.title=r.currentTarget.scrollWidth>r.currentTarget.clientWidth?t:"",e.props.onMouseEnter&&e.props.onMouseEnter(r)}return a.cloneElement(e,{onMouseEnter:r})}Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),s=r.__importDefault(s),a=r.__importStar(a);var S=function(){},y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSelectOrClearAll=function(){var e=t.props,r=e.entries,n=e.checkedCategories,s=e.onChange;if(_(r,n))s([]);else{s(m(r.map(function(e){return e.category})))}},t.handleChange=function(e,r){var n=t.props,s=n.checkedCategories,a=n.onChange,i=s.filter(function(e){return e!==r});e&&(i=i.concat([r])),a(m(i))},t}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,r=t.strings,s=t.entries,i=t.checkedCategories;return a.createElement("div",{className:"rc-ftf"},a.createElement("header",{className:"rc-ftf-header"},a.createElement("span",{className:"rc-ftf-header__label"},r.byType),a.createElement(o.Button,{variant:"borderless",className:"rc-ftf-header__button",onClick:this.handleSelectOrClearAll},_(s,i)?r.clearAll:r.selectAll)),a.createElement("ul",{className:"rc-ftf-list"},s.map(function(t){return a.createElement(E,n.__assign({key:t.label,category:t.category},t,{checked:i.indexOf(t.category)>-1,onChange:e.handleChange}))})))},t})(a.Component);t.FileTypeFilter=y;var E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleChange=function(e){var r=t.props;(0,r.onChange)("checked"===e,r.category)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.label,r=e.icon,n=e.checked,i=e.tooltip;return a.createElement("li",null,a.createElement(d.Label,{className:s.default({"rc-ftf-list__row":!0,"rc-ftf-list__row--checked":n}),"aria-label":t},a.createElement(l.Checkbox,{checked:n?"checked":"unchecked",onChange:this.handleChange,name:t,ariaLabel:t}),f(a.createElement("span",{className:"rc-ftf-list__row-name"},t),t),a.createElement(h.Tooltip,{positioning:"left",tooltipContent:i,wrapperClassName:"rc-ftf-list__row-icon"},"string"==typeof r?a.createElement(u.IconContent,{name:r,className:"rc-ftf-list__row-icon-content"}):r)))},t})(a.Component);t.FileTypeFilterRow=E;var v=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.modalProps,r=n.__rest(e,["modalProps"]),s=(t.ref,n.__rest(t,["ref"]));return a.createElement(p.Modal,n.__assign({overlayClickClose:!0,displayCloseButton:!0},s,{className:"rc-ftf-modal"}),a.createElement("div",{className:"rc-ftf-modal__header"},t.title),a.createElement("div",{className:"rc-ftf-modal__body"},a.createElement(y,n.__assign({},r))))},t})(a.Component);t.FileTypeFilterModal=v;var w=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.entries,r=e.checkedCategories,n=e.strings,s=t.filter(function(e){return r.indexOf(e.category)>-1}),i=s.length?s[0].label:n.byType,o=s.length>1?a.createElement("span",{className:"rc-ftf-dropdown__badge"},s.length):null;return a.createElement("span",{className:"rc-ftf-dropdown__button-content"},f(a.createElement("span",{className:"rc-ftf-dropdown__button-label"},i),i),o)},t})(a.Component);t.FileTypeFilterButtonContent=w;var T=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleOnMenuToggle=function(e){t.props.onMenuToggle&&t.props.onMenuToggle(e.isOpen)},t.handleKeyDown=function(e){switch(e.which){case 38:case 40:return e.preventDefault(),void e.stopPropagation();default:return}},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.onClick,r=e.className,s={className:r};return t&&(s.onClick=t),a.createElement(c.DropdownMenu,{onSelection:S,className:"rc-ftf-dropdown",onKeyDown:this.handleKeyDown},a.createElement(i.Wrapper,{onMenuToggle:this.handleOnMenuToggle},a.createElement(c.DropdownMenuButton,n.__assign({},s),a.createElement(w,n.__assign({},this.props))),a.createElement(c.Menu,{className:"rc-ftf-dropdown__menu"},a.createElement(y,n.__assign({},this.props)))))},t})(a.Component);t.FileTypeFilterDropdown=T,t.areAllEntriesChecked=_,t.areAllEntriesUnchecked=g});
//# sourceMappingURL=pkg-search.min.js-vflRDkUGk.map