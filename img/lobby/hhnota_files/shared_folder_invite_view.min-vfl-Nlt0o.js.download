define(["require","exports","tslib","react","modules/clean/datetime","spectrum/icon_inline","modules/clean/react/tooltip","modules/clean/sharing/shared_folder_invite/shared_folder_invite_modal","modules/core/user_i18n","modules/core/i18n","modules/clean/react/home/section_header","modules/clean/sharing/shared_folder_invite/shared_folder_invite_row","modules/clean/sharing/shared_folder_invite/shared_folder_invite_show_hide_link","modules/clean/sharing/shared_folder_invite/shared_folder_invite_tracker","modules/clean/react/modal","modules/clean/react/home/util/doc_with_avatar_icon","modules/clean/react/home/util/resource_icon","external/classnames"],function(e,t,o,n,r,i,a,s,d,l,h,p,c,u,v,f,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=o.__importDefault(n),d=o.__importStar(d),_=o.__importDefault(_);var I=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={showInvites:!0,isExpanded:!1,numInviteToShow:2},t.onCloseAddModal=function(){v.Modal.close()},t.toggleShowInvites=function(){t.state.showInvites?(t.props.track(u.SharedFolderInvitesEvents.HIDE),t.setState({showInvites:!1,numInviteToShow:0})):(t.props.track(u.SharedFolderInvitesEvents.SHOW),t.setState({showInvites:!0,numInviteToShow:2}))},t.renderShareFolderInvite=function(e,o){var r,i=e.invite_info;if(i&&(i.photo_url||i.display_name)){var a=i.display_name?i.display_name:"";r={avatarUrl:i.photo_url?i.photo_url:"",avatarInitials:d.getInitials(a)}}var s=t.renderFolderIcon(e.name,r),l=function(){return t.openAddModal(s,e)};return n.default.createElement(p.SharedFolderInviteRow,{key:o,header:t.getHeaderProps(e),user:t.props.user,folderInvite:e,folderIcon:s,loadFolderContent:t.props.loadFolderContent,openModal:l,mountFolder:t.props.mountFolder,unmountFolder:t.props.unmountFolder})},t.logHeaderTooltipView=function(){t.props.track(u.SharedFolderInvitesEvents.TOOLTIP_VIEW)},t.handleShowHideExpandClick=function(){t.props.track(u.SharedFolderInvitesEvents.EXPAND),t.setState({isExpanded:!0,numInviteToShow:t.state.numInviteToShow+10})},t.handleShowHideCollapseClick=function(){t.props.track(u.SharedFolderInvitesEvents.COLLAPSE),t.setState({isExpanded:!1,numInviteToShow:2})},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.props.track(u.SharedFolderInvitesEvents.VIEW),this.props.tracker.startTimer(u.SharedFolderInvitesEvents.GET_FOLDER_INVITES),this.props.getFolderInvites(this.props.user.id)},t.prototype.componentDidUpdate=function(e,t){!e.folderInvites&&this.props.folderInvites&&(this.props.track(u.SharedFolderInvitesEvents.GET_FOLDER_INVITES),this.props.onChangeHeight(this.calculateHeight())),t.numInviteToShow!==this.state.numInviteToShow&&this.props.onChangeHeight(this.calculateHeight())},t.prototype.calculateHeight=function(){var e=Math.min(this.state.numInviteToShow,this.props.folderInvites.size);if(e<=0)return 65;for(var t=0,o=0,n=0;n<e;n++){var r=this.props.folderInvites.get(n);r&&r.invite_info&&r.invite_info.message?t++:o++}return 121+88*o+93*t},t.prototype.getHeaderProps=function(e){var t,o,n,i=e.invite_info;e.time_invited&&(n=r.ago(e.time_invited.getTime())),i&&(t=l._("Shared by %(owner)s").format({owner:i.display_name}),o=i.message);var a=[t,n].filter(Boolean).join(" Â· ");return{heading:e.name,subheading:a,inviteMessage:o,fileName:e.name}},t.prototype.openAddModal=function(e,t){var o=n.default.createElement(s.SharedFolderInviteModal,{user:this.props.user,folderIcon:e,folderMetadata:t,onRequestClose:this.onCloseAddModal,mountFolder:this.props.mountFolder});v.Modal.showInstance(o)},t.prototype.renderFolderIcon=function(e,t){var o=_.default({"shared-folder-invite__folder-icon":!0,"shared-folder-invite__folder-icon--with-avatar":!!t});return t?n.default.createElement("span",{className:o},n.default.createElement(f.DocWithAvatarIcon,{avatarIconModel:t,displayType:"folder_shared-small",fileName:e||""})):n.default.createElement("span",{className:o},n.default.createElement(m.HomeResourceIcon,{displayType:"folder_shared-small",fileName:e||""}))},t.prototype.renderShareFolderInviteList=function(){var e=this.props,t=e.folderInvites,o=e.folderInvitesLoading;return this.state.showInvites&&!o&&t&&0!==t.size?n.default.createElement("div",{className:"shared-folder-invite-list"},t.slice(0,this.state.numInviteToShow).map(this.renderShareFolderInvite)):null},t.prototype.renderHeaderTooltipContents=function(){return n.default.createElement("div",{className:"shared-folder-invite-tooltip__text"},l._("Add to Dropbox and start working together."))},t.prototype.renderHeaderTooltip=function(){return n.default.createElement(a.Tooltip,{position:a.TooltipPosition.RIGHT,tooltip_classname:"shared-folder-invite-tooltip",tooltip_contents:this.renderHeaderTooltipContents(),on_show:this.logHeaderTooltipView},n.default.createElement(i.IconInline,{className:"shared-folder-invite-tooltip__icon",name:"info"}))},t.prototype.render=function(){if(!this.props.folderInvites||0===this.props.folderInvites.size)return null;var e=this.props.folderInvites.size-this.state.numInviteToShow>0;return n.default.createElement("div",{className:"shared-folder-invite-section"},n.default.createElement("div",{className:"shared-folder-invite-header"},n.default.createElement(h.SectionHeader,{title:l._("Pending shared folders"),ueName:"shared_folder_invite",buttonText:this.state.showInvites?l._("Hide"):l._("Show"),buttonAction:this.toggleShowInvites,infoIcon:this.renderHeaderTooltip()})),this.renderShareFolderInviteList(),this.state.showInvites&&n.default.createElement(c.SharedFolderInviteShowHideLink,{isExpanded:this.state.isExpanded,canShowMore:e,onExpandClick:this.handleShowHideExpandClick,onCollapseClick:this.handleShowHideCollapseClick}))},t})(n.default.Component);t.SharedFolderInviteViewComponent=I,t.SharedFolderInviteView=u.withSharedFolderInviteTracking(I)});
//# sourceMappingURL=shared_folder_invite_view.min.js-vfl0AOgkX.map