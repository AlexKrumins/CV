define("modules/clean/react/maestro/header",["require","exports","tslib","react","react-dom","modules/clean/react/maestro/top_menu_container","modules/clean/react/maestro_nav/shared_code/dropbox_logo","modules/clean/react/maestro/responsive","external/classnames","modules/clean/user_education/react/user_education_effect","modules/clean/react/css"],function(e,t,r,s,a,n,o,i,c,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),c=r.__importDefault(c);var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.useHeaderPortal,a=e.chromeClass,o=r.__rest(e,["useHeaderPortal","chromeClass"]),u=s.default.createElement("header",{className:"maestro-header page-header__shadow"},s.default.createElement(i.VerticallyFixedWrapper,{className:"page-header",responsive:this.props.responsive},s.default.createElement("div",{className:c.default("page-header__title",this.props.titleClass)},s.default.createElement(l.UserEducationEffect,{containerName:"PageletMaestroHeader",name:"Title",useSpan:!0},this.props.title)),s.default.createElement(n.TopMenuContainer,r.__assign({},o))));return t?s.default.createElement(_,{chromeClass:a},u):u},t.defaultProps={showSearchBar:!0,isSearchBarExpanded:!1},t})(s.default.Component);t.PageletMaestroHeaderWithoutCSS=p;var h=function(e){var t=e.children;return s.default.createElement("h1",{className:"page-header__heading"},t)};t.MaestroHeaderTitle=h;var d=function(){return s.default.createElement("a",{href:"/",className:"page-header__logo"},s.default.createElement(o.DropboxLogo,{alt:"Dropbox"}))};t.MaestroHeaderLogo=d;var _=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentWillMount=function(){if(this.portalEl=document.getElementById("maestro-header-portal"),!this.portalEl){var e=document.getElementById("pagelet-2");e&&(this.portalEl=document.createElement("div"),this.portalEl.setAttribute("id","maestro-header-portal"),e.parentNode.insertBefore(this.portalEl,e))}},t.prototype.render=function(){return this.portalEl?s.default.createElement(s.default.Fragment,null,s.default.createElement("div",{className:"maestro-header page-header__shadow"}),a.default.createPortal(s.default.createElement("div",{className:this.props.chromeClass},this.props.children),this.portalEl)):this.props.children},t})(s.default.Component);t.MaestroHeaderPortal=_;var m=u.requireCssWithComponent(p,["/static/css/maestro_layout-vflxK7EhW.css"]);t.PageletMaestroHeader=m}),define("modules/clean/react/maestro/layout",["require","exports","tslib","react","classnames","spectrum/match","modules/clean/react/maestro/header","modules/clean/react/maestro/secondary_sidebar","modules/clean/react/maestro/responsive"],function(e,t,r,s,a,n,o,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a);var l=(function(e){function t(t){var s=e.call(this,t)||this;s.isPageResponsive=function(){return!(!document||!document.documentElement)&&document.documentElement.classList.contains(c.RESPONSIVE_CLASS)},s.handleSetup=function(){s.setState({setupComplete:!0})},s.handleMatchMedium=function(){s.state.responsive.isMatchedMedium===!1&&s.setState(function(e){return{responsive:r.__assign({},e.responsive,{isMatchedMedium:!0})}})},s.handleUnmatchMedium=function(){s.state.responsive.isMatchedMedium===!0&&s.setState(function(e){return{responsive:r.__assign({},e.responsive,{isMatchedMedium:!1})}})},s.handleMatchLarge=function(){s.state.responsive.isMatchedLarge===!1&&s.setState(function(e){return{responsive:r.__assign({},e.responsive,{isMatchedLarge:!0})}})},s.handleUnmatchLarge=function(){s.state.responsive.isMatchedLarge===!0&&s.setState(function(e){return{responsive:r.__assign({},e.responsive,{isMatchedLarge:!1})}})};var a=s.isPageResponsive();return s.state={responsive:{isResponsive:a,isMatchedMedium:!a,isMatchedLarge:!a},setupComplete:!a},s}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.user,l=e.titleRegion,u=e.titleClass,p=e.chromeClass,h=e.embeddedAppRegion,d=e.actionSidebarRegion,_=e.searchBarProps,m=e.useHeaderPortal,S=this.state,f=S.setupComplete,g=S.responsive;return s.default.createElement("div",{className:a.default(["maestro-chrome",p])},g.isResponsive&&s.default.createElement(n.Match,{media:c.BREAKPOINT_LARGE,onSetup:this.handleSetup,onMatch:this.handleMatchLarge,onUnmatch:this.handleUnmatchLarge}),g.isResponsive&&s.default.createElement(n.Match,{media:c.BREAKPOINT_MEDIUM,onSetup:this.handleSetup,onMatch:this.handleMatchMedium,onUnmatch:this.handleUnmatchMedium}),f&&s.default.createElement(o.PageletMaestroHeader,r.__assign({user:t,title:l,titleClass:u,chromeClass:p,responsive:g,useHeaderPortal:m},_||{})),f&&s.default.createElement("div",{className:"maestro-app"},s.default.createElement("div",{className:"maestro-app-content"},"function"==typeof h?h(g):h),d&&s.default.createElement("div",{className:"maestro-secondary-sidebar__shadow",role:"complementary","aria-label":"sidebar"},s.default.createElement(i.MaestroSecondarySidebar,{responsive:g},"function"==typeof d?d(g):d))))},t})(s.default.PureComponent);t.MaestroChrome=l}),define("modules/clean/react/maestro/responsive",["require","exports","tslib","react","spectrum/vertically_fixed"],function(e,t,r,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.RESPONSIVE_CLASS="maestro--responsive",t.BREAKPOINT_MEDIUM="(min-width: 736px)",t.BREAKPOINT_LARGE="(min-width: 1025px)";var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.responsive,n=r.__rest(e,["responsive"]),o=t&&t.isResponsive?"div":a.VerticallyFixed;return s.default.createElement(o,n)},t.displayName="VerticallyFixedWrapper",t})(s.default.Component);t.VerticallyFixedWrapper=n}),define("modules/clean/react/maestro/secondary_sidebar",["require","exports","tslib","external/classnames","react","modules/clean/react/maestro/responsive","modules/clean/react/prompt/ha","modules/clean/upsell/prompt_event_emitter"],function(e,t,r,s,a,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a);var c=(function(e){function t(t){var r=e.call(this,t)||this;return r.state={},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;i.promptBufferedEventEmitter.on(i.Events.ON_HA_LOADED,function(t){t.campaign.renderOnTheLeft||e.setState({haProps:t})})},t.prototype.render=function(){var e=s.default({"maestro-secondary-sidebar":!0,"has-inline-ha":!!this.state.haProps});return a.default.createElement(n.VerticallyFixedWrapper,{responsive:this.props.responsive,className:e},this.props.children,a.default.createElement(o.MaestroHA,{haProps:this.state.haProps}))},t})(a.default.Component);t.MaestroSecondarySidebar=c}),define("modules/clean/react/maestro/top_menu_container",["require","exports","tslib","react","external/lodash","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/history","modules/clean/react/browse/models","modules/core/browser","modules/clean/search/search_bar/controller","modules/clean/search/search_bar/log_helper","modules/clean/search/search_helpers","modules/core/uri","modules/clean/web_user_action_events","modules/clean/search/constants","modules/clean/react/css","modules/clean/search/single_page/input/wrapper"],function(e,t,r,s,a,n,o,i,c,l,u,p,h,d,_,m,S,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),o=r.__importStar(o),i=r.__importDefault(i),l=r.__importStar(l),h=r.__importStar(h);var g=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onSearch=function(e){var s=e.query,a=e.searchToken,n=e.searchSessionId,o=e.searchPath,c=e.qargs,u=t.props.user;s&&l.redirect(h.buildSearchURL({user:u,searchPath:o,normalizedQuery:s,searchSessionId:n,searchToken:a,qargs:r.__assign({},c,{search_from:i.default.deconstruct_url().path})}).toString())},t.onSlimSearchResultOpen=function(e){var r=t.props.user;if(e instanceof c.Paper||e instanceof c.PaperFolder)l.open_tab(e.url);else{var s=e;if(s.is_dir){var a=new d.URI({path:"/"+r.role+s.fq_path});l.open_tab(a.toString())}else{var n=s.fq_path.substring(1),a=new d.URI({path:"/"+r.role}).updateQuery({preview:n});l.open_tab(a.toString())}}},t.logSearchResultOpen=function(e){var r=t.props.user;e instanceof c.File?p.logDropdownSearchAction({result:e,user:r,action_type:e.is_dir?_.WebUserActionLogEvent.FOLDER_OPEN:_.WebUserActionLogEvent.FILE_VIEW,viewport:"top-menu-dropdown-view"}):(e instanceof c.Paper||e instanceof c.PaperFolder)&&p.logDropdownSearchAction({result:e,user:r,action_type:_.WebUserActionLogEvent.PAPER_OPEN,viewport:"top-menu-dropdown-view"})},t.onResultObjectPathClick=function(e){var r=t.props.user;p.logDropdownSearchAction({result:e,user:r,action_type:_.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"});var s=o.parent_dir(e.fq_path),a=n.browse_uri_for_fq_path(r,s||"").toString();l.open_tab(a)},t}return r.__extends(t,e),t.prototype.renderSearchBar=function(){return this.props.showSearchBar&&this.props.user?this.props.overrideSearchBar?this.props.overrideSearchBar:this.props.expUniversalSinglePageSearch?s.default.createElement(f.SearchInput,{user:this.props.user,path:this.props.currentPath,isActive:!!this.props.isSearching,onSearchEnter:this.props.onSearchEnter,onSearchExit:this.props.onSearchExit,inputBoxRef:this.props.inputBoxRef}):s.default.createElement(u.SearchBarController,{user:this.props.user,currentPath:this.props.currentPath,isExpanded:this.props.isSearchBarExpanded,onSearch:this.props.onSearch||this.onSearch,onSearchResultOpen:this.props.onSearchResultOpen||this.logSearchResultOpen,onSlimSearchResultOpen:this.props.onSearchResultOpen?void 0:this.onSlimSearchResultOpen,onResultObjectPathClick:this.props.onResultObjectPathClick||this.onResultObjectPathClick,searchBarExperiments:this.props.searchBarExperiments||{},onSearchFiltersChanged:this.props.onSearchFiltersChanged||a.noop,fileCategories:this.props.fileCategories||m.FILE_CATEGORIES_UNCHECKED,searchFrom:this.props.searchFrom}):null},t.prototype.renderRightContent=function(){return this.props.rightContent?this.props.rightContent:s.default.createElement("div",{className:"top-menu-container--search-bar-empty-space"})},t.prototype.render=function(){return s.default.createElement("div",{className:"top-menu-container "+this.props.classNames},this.renderSearchBar(),this.renderRightContent())},t.defaultProps={showSearchBar:!0,isSearchBarExpanded:!1,classNames:"",currentPath:"/"},t})(s.default.Component);t.TopMenuContainer=S.requireCssWithComponent(g,["/static/css/pagelet-vflVkuuMY.css"],[u.SearchBarController])}),define("modules/clean/search/api_helpers",["require","exports"],function(e,t){"use strict";function r(){return(new Date).getTimezoneOffset()}Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTimezoneOffset=r}),define("modules/clean/search/logger",["require","exports","tslib","modules/clean/analytics","modules/clean/search/api_helpers","modules/clean/react/browse/logger_util"],function(e,t,r,s,a,n){"use strict";function o(e){var t=e.searchSessionId,o=e.result,i=e.user,c=e.action_type,l=e.search_type,u=e.viewport,p=void 0===u?"full-view":u,h=e.view_type,d=e.action_surface,_=a.getCurrentTimezoneOffset(),m={viewport:p,action_type:c,search_type:l,search_session_id:t,view_type:h,position:o.sort_rank,request_id:o.request_id,timezone_offset:_};if(n.isFile(o)){var S=o;m=r.__assign({},m,{file_nsid:S.ns_id,file_sjid:S.sjid,match_type:S.match_type})}else if(n.isPaper(o)){var f=o;m=r.__assign({},m,{paper_pad_id:f.pad_id})}else if(n.isPaperFolder(o)){var g=o;m=r.__assign({},m,{paper_folder_id:g.folder_id})}else{var S=o,v=S.is_cloud_doc?y.SHARED_CLOUD_DOC:y.SHARED_DOC;m=r.__assign({},m,{match_type:S.match_type,file_id:S.file_id,extra:{result_type:v}})}d&&(m.extra=r.__assign({},m.extra,{action_surface:d})),s.SearchClientActivityLogger.log("result_action",i.id,m)}function i(e){var t=e.searchSessionId,r=e.user,n=e.history,o=a.getCurrentTimezoneOffset(),i=n.map(function(e){return e.rawQuery}).reduce(function(e,t,r){return e[r]=t,e},{}),c={search_session_id:t,recent_history_map:JSON.stringify(i),timezone_offset:o,viewport:"dropdown-view"};s.SearchClientActivityLogger.log("recent_history_displayed",r.id,c)}function c(e){var t=e.searchSessionId,r=e.user,n=a.getCurrentTimezoneOffset(),o={search_session_id:t,timezone_offset:n,viewport:"dropdown-view"};s.SearchClientActivityLogger.log("recent_history_cleared",r.id,o)}function l(e){var t=e.searchSessionId,r=e.query,n=e.user,o=e.rank,i=e.action_type,c=a.getCurrentTimezoneOffset(),l={search_session_id:t,query_string:r.rawQuery,position:o,timezone_offset:c,viewport:"dropdown-view",action_type:i};s.SearchClientActivityLogger.log("recent_query_selected",n.id,l)}function u(e){var t=e.searchSessionId,r=e.requestId,n=e.query,o=e.user,i=e.previousPosition,c=e.viewport,l=void 0===c?"dropdown-view":c,u=a.getCurrentTimezoneOffset(),p={search_session_id:t,request_id:r,query_string:n.rawQuery,position:i,timezone_offset:u,viewport:l};s.SearchClientActivityLogger.log("recent_query_stored",o.id,p)}function p(e){var t=e.searchSessionId,r=e.user,n=e.chipAdded,o=e.filePath,i=e.searchType,c=e.viewport,l=a.getCurrentTimezoneOffset(),u={search_session_id:t,timezone_offset:l,path_scoped:n,file_path:o,viewport:c,search_type:i};s.SearchClientActivityLogger.log("scope_chip_changed",r.id,u)}function h(e){var t=e.searchSessionId,r=e.user,n=e.deletedFiles,o=e.searchType,i=e.viewport,c=a.getCurrentTimezoneOffset(),l={search_session_id:t,timezone_offset:c,deleted_filter:n,viewport:i,search_type:o};s.SearchClientActivityLogger.log("deleted_filter_changed",r.id,l)}function d(e){var t=e.searchSessionId,r=e.user,n=a.getCurrentTimezoneOffset(),o={search_session_id:t,timezone_offset:n};s.SearchClientActivityLogger.log("search_bar_focus_lost",r.id,o)}function _(e,t){var s=e;return r.__assign({},t,{file_nsid:s.ns_id,file_sjid:s.sjid,match_type:s.match_type||void 0})}function m(e){var t=e.searchSessionId,r=e.result,n=e.user,o=e.previewRequestId,i=e.viewport,c=void 0===i?"dropdown-view":i,l=a.getCurrentTimezoneOffset(),u={search_session_id:t,preview_request_id:o,timezone_offset:l,viewport:c};s.SearchClientActivityLogger.log("preview_started",n.id,_(r,u))}function S(e){var t=e.searchSessionId,r=e.result,n=e.user,o=e.previewRequestId,i=e.viewport,c=void 0===i?"dropdown-view":i,l=e.latency,u=e.displayed,p=a.getCurrentTimezoneOffset(),h={search_session_id:t,preview_request_id:o,timezone_offset:p,viewport:c,latency:l,displayed:u?"true":"false"};s.SearchClientActivityLogger.log("preview_completed",n.id,_(r,h))}function f(e){var t=e.searchSessionId,r=e.result,n=e.user,o=e.previewRequestId,i=e.viewport,c=void 0===i?"dropdown-view":i,l=e.failureType,u=a.getCurrentTimezoneOffset(),p={search_session_id:t,preview_request_id:o,timezone_offset:u,viewport:c,failure_type:l};s.SearchClientActivityLogger.log("preview_failed",n.id,_(r,p))}function g(e){var t=e.searchSessionId,r=e.user,a=e.action_type,n=e.search_type,o=e.sort_order,i=e.viewport,c=void 0===i?"full-view":i,l=e.view_type,u={sort_field:o.sortField,sort_direction:o.sortDirection},p={viewport:c,action_type:a,search_type:n,search_session_id:t,view_type:l,extra:u};s.SearchClientActivityLogger.log("sort_results",r.id,p)}Object.defineProperty(t,"__esModule",{value:!0});var y;(function(e){e.SHARED_DOC="shared_doc",e.SHARED_CLOUD_DOC="shared_cloud_doc"})(y=t.SearchLogResultType||(t.SearchLogResultType={})),t.logSearchAction=o,t.logRecentHistoryDisplayed=i,t.logRecentHistoryCleared=c,t.logRecentQuerySelected=l,t.logRecentQueryStored=u,t.logScopeChipChanged=p,t.logDeletedFilterChanged=h,t.logSearchBarFocusLost=d,t.logHoverPreviewStarted=m,t.logHoverPreviewCompleted=S,t.logHoverPreviewFailed=f,t.logSearchResultsSortOrderChange=g}),define("modules/clean/search/search_bar/api",["require","exports","tslib","modules/clean/ajax","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/search/constants","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/core/i18n"],function(e,t,r,s,a,n,o,i,c,l,u,p,h,d,_,m){"use strict";function S(e,t){return(new a.UserApiV2Client).ns("home").rpc("get_recents",{limit:t},{subjectUserId:e})}function f(e,t){return new Promise(function(r,a){var n=t.map(function(e){return{id:e,type:o.ENCODED_FILE_OBJ_ID}});s.WebRequest({url:o.GET_FILE_METADATA_ENDPOINT,data:{resources_json:JSON.stringify(n)},dataType:"json",subject_user:e,success:function(e,t,s){r(e)},error:function(e,t,r){a(new Error(r))}})})}function g(e,t){return(new a.UserApiV2Client).ns("paper").rpc("docs/get_metadata",{doc_id:t},{subjectUserId:e})}function y(e,t,r,s,n){var o=new a.UserApiV2Client,i=n?"search_experiment_query_suggestions:"+n:void 0;return o.ns("files").rpc("get_query_suggestions",{query:t,max_results:r,search_session_id:s,variants:i},{subjectUserId:e})}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),n=r.__importStar(n),o=r.__importStar(o);var v=(function(e){function t(t){var r=this.constructor,s=this,a=r.prototype;return s=e.call(this,t)||this,s.__proto__=a,s}return r.__extends(t,e),t})(Error);t.RequestAbortedError=v;var E=(function(){function e(){this._searchApiUrl="/search/dropdown_search",this._activeRequest=null}return e.prototype.getSearchApiUrl=function(){return this._searchApiUrl},e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype._extractSlimSearchResultsList=function(e){for(var t=[],r=0,s=e;r<s.length;r++){var a=s[r];switch(a.search_result_type){case l.SearchResultTypes.FILE:t.push(u.SlimFileSearchResult.fromServerObject(a));break;case l.SearchResultTypes.PAPER:t.push(c.Paper.fromServerObject(a));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(c.PaperFolder.fromServerObject(a))}}return t},e.prototype.loadSlimResults=function(e){var t=e.user,s=e.path,a=e.query,n=e.searchSessionId,o=e.experiments,i=e.webTimer,c=e.fileCategories,l=p.getCurrentTimezoneOffset(),u=c&&h.isInFileTypeFilterExperiment(o)?h.fileCategoriesToString(c):"",d=r.__assign({query:a,fq_path:s,timezone_offset:l,search_session_id:n},u&&{file_categories:u});return this._fetchSlimResults(d,t,n,o,i)},e.prototype.fetchAdditionalFileMetadata=function(e){var t=this,r=e.searchResults,a=e.user;return new Promise(function(e,n){var i=r.filter(function(e){return e instanceof u.SlimFileSearchResult}),c=i.map(function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]});c.length>0?s.WebRequest({url:o.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(c),includes:JSON.stringify([o.HREF])},dataType:"json",subject_user:a,success:function(s,a,n){var o=s.file_results;e(t._mergeFullResultsIntoSlimResults(o,r))},error:function(e,t,r){n("abort"===r?new v:new Error(r))}}):e(r)})},e.prototype.fetchFullSearchResult=function(e){var t=e.searchResult,r=e.user,s=e.onSuccess,a=e.onError;if(t instanceof u.SlimFileSearchResult){var n=d.searchResultForPath(_.getStoreForSearchBar().getState(),t.fq_path);n?s(n):this.fetchAdditionalFileMetadata({searchResults:[t],user:r}).then(function(e){if(e.length>0)s(e[0]);else if(a){var t=m._("There was a problem completing this request.");a(t)}}).catch(function(e){!a||e instanceof v||a(e.message)})}else(t instanceof c.Paper||t instanceof c.PaperFolder)&&s(t)},e.prototype._mergeFullResultsIntoSlimResults=function(e,t){for(var s=[],a=function(t){if(t instanceof u.SlimFileSearchResult){var a=e.find(function(e){return e.search_result_type===l.SearchResultTypes.FILE&&n.paths_are_equal(e.fq_path,t.fq_path)});a&&s.push(c.File.fromServerObject(r.__assign({},t,a)))}else(t instanceof c.Paper||t instanceof c.PaperFolder)&&s.push(t)},o=0,i=t;o<i.length;o++){a(i[o])}return s},e.prototype._fetchSlimResults=function(e,t,a,n,o){var c=this;return new Promise(function(l,p){var d;null!=c._activeRequest&&c._activeRequest.abort();var _=h.fileCategoryStringToLogValue(e.file_categories),m=r.__assign({path_scoped:"/"!==e.fq_path,search_type:"dropdown",query_string:e.query,search_session_id:a,timezone_offset:e.timezone_offset},h.isInFileTypeFilterExperiment(n)&&{file_type_filters:_});i.SearchClientActivityLogger.log("query_started",t.id,m);var S=(new Date).getTime();c._activeRequest=s.WebRequest({url:c._searchApiUrl,data:e,dataType:"json",subject_user:t,success:function(r,s,n){for(var p=u.extractBrowseContext(r),h=r.search_results,d=n.getResponseHeader("x-dropbox-request-id"),_=0,f=0,g=h;f<g.length;f++){var y=g[f];y.request_id=d,y.sort_rank||0===y.sort_rank||(y.sort_rank=_++)}var v={results:c._extractSlimSearchResultsList(h),hasMore:!!r.more,nextPageOffset:+r.next_offset||0},E=i.SearchClientActivityLogger.create_search_log_dict(m,d,S,e.query,v.results.length,null,a);i.SearchClientActivityLogger.log("query_completed",t.id,E),o&&o.end(d?d:void 0),l({context:p,searchResults:v,deleted:!1})},error:function(r,s,n){d=r.getResponseHeader("x-dropbox-request-id");var c=i.SearchClientActivityLogger.create_search_log_dict(m,d,S,e.query,null,s,a);i.SearchClientActivityLogger.log("query_failed",t.id,c),o&&o.abort(),p("abort"===n?new v:new Error(n))},complete:function(){this._activeRequest=null}})})},e})();t.SearchBarApiClient=E,t.searchBarApiClient=new E,t.getRecents=S,t.getFileMetadata=f,t.getPaperMetadata=g,t.getQuerySuggestions=y}),define("modules/clean/search/search_bar/controller",["require","exports","tslib","react","external/lodash","external/react-redux","modules/clean/keycode","modules/clean/react/browse/models","modules/clean/react/browse/uri_helper","modules/clean/react/retrieval_success_banner/util","modules/clean/search/logger","modules/clean/search/search_bar/api","modules/clean/search/search_bar/data/action_creators","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/log_helper","modules/clean/search/search_bar/view","modules/clean/search/search_helpers","modules/clean/search/search_bar/chips","modules/clean/storage","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/web_user_action_events","modules/core/notify","modules/clean/search/types","modules/clean/search/search_bar/experiments","modules/clean/react/css","modules/core/browser"],function(e,t,r,s,a,n,o,i,c,l,u,p,h,d,_,m,S,f,g,y,v,E,C,R,w,I,b,x){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),u=r.__importStar(u),h=r.__importStar(h),d=r.__importStar(d),f=r.__importStar(f),g=r.__importStar(g),E=r.__importStar(E),x=r.__importStar(x);var P=(function(e){function t(t){var s=e.call(this,t)||this;return s._searchBarWebTimer=null,s._selectFirstFile=a.noop,s._clearSelection=a.noop,s._logHistoryItemSelected=function(e,t,r){u.logRecentQuerySelected({searchSessionId:s.props.searchSessionId,query:e,user:s.props.user,rank:t-s.props.headerItems.length,action_type:r})},s._handleHistoryItemClick=function(e,t){s._logHistoryItemSelected(e,t),s._setSearchQuery(e.rawQuery)},s._handleRecentSearchContextMenuCapture=function(e,t){s._logHistoryItemSelected(e,t,C.WebUserActionLogEvent.CONTEXT_MENU)},s._handleInputChange=function(e){s._setSearchQuery(e)},s._handleCancelSearch=function(){s._setSearchQuery("")},s._handleScopeChipChange=function(e){u.logScopeChipChanged({searchSessionId:s.props.searchSessionId,user:s.props.user,chipAdded:e,searchType:"dropdown",filePath:e?s.props.browseScope:"/",viewport:s.props.isExpanded?"full-view":void 0}),e?s.props.setScopeChip({scopeChip:s.props.browseScope}):s.props.setScopeChip({}),s._setSearchQuery(s.props.rawQuery,!0)},s._handleDeletedChipChange=function(e){s.props.setDeletedChip({deletedChip:e}),s._setSearchQuery(s.props.rawQuery,!0)},s._onBrowseScopeChange=function(e){s.props.setScopeChip({scopeChip:g.isValidPathForChip(e)?e:void 0})},s._handleInputKeydown=function(e,t){if(e.keyCode===o.KeyCode.ESC)return void s._handleCancelSearch();if(e.keyCode===o.KeyCode.BACKSPACE&&0===t){if(!g.isScopeChipRoot(s.props.scopeChip))return void s._handleScopeChipChange(!1);if(s.props.deletedChip)return void s._handleDeletedChipChange(!1)}if(e.stopPropagation(),I.isInSinglePageSearchExperiment(s.props.searchBarExperiments)){if(e.keyCode===o.KeyCode.DOWN&&s.props.rawQuery)return e.preventDefault(),void s._selectFirstFile();e.keyCode===o.KeyCode.TAB&&s.props.blurSearchBar()}e.keyCode===o.KeyCode.UP?(e.preventDefault(),s.props.highlightPreviousRow()):e.keyCode===o.KeyCode.DOWN&&(e.preventDefault(),s.props.highlightNextRow())},s._handleSearch=function(e,t){var a=s.props.searchBarExperiments;a.expSearchSuccessBanner&&!I.isInSinglePageSearchExperiment(a)&&l.doSearchBarInteractionBroadcast(!1);var n=f.fileCategoriesToString(s.props.fileCategories);s.props.onSearch({query:e,searchToken:f.getSearchCsrfToken(),searchSessionId:s.props.searchSessionId,searchPath:t||s.props.scopeChip,qargs:r.__assign({d:I.isInDeletedFilterRightRailExperiment(s.props.searchBarExperiments)?s.props.deletedChip?"1":"0":void 0},n&&{file_categories:n},{search_order_by:c.getQueryArgs().search_order_by,search_reverse_order:c.getQueryArgs().search_reverse_order,search_type:c.getQueryArgs().search_type})})},s._navToSelection=function(e){var t=s.props.searchResults[e],r=s.props.slimSearchResults[e];t?(s._handleSlimSearchResultOpen(r),s._openSearchResult(t)):r&&s._handleSearchResultOpen(r)},s._handleInputSubmit=function(e,t){if(e.preventDefault(),!I.isInSinglePageSearchExperiment(s.props.searchBarExperiments)){var r=s.props.headerItems;if(t<r.length)switch(r[t]){case w.SearchBarDropdownHeaderItemType.SEARCH_ALL:s._handleSearch(s.props.normalizedQuery);break;case w.SearchBarDropdownHeaderItemType.SCOPE_CHIPS:var a=!g.isValidPathForChip(s.props.scopeChip);s._handleScopeChipChange(a)}else t-=r.length,s._navToSelection(t)}},s._handleContextMenuCapture=function(e){var t=s.props,r=t.user,a=t.searchSessionId;p.searchBarApiClient.fetchFullSearchResult({searchResult:e,user:r,onSuccess:function(e){s._dispatchSearchSuccessful(e.request_id||""),m.logDropdownSearchAction({result:e,user:r,action_type:e instanceof i.File?C.WebUserActionLogEvent.CONTEXT_MENU:C.WebUserActionLogEvent.PAPER_CONTEXT_MENU,viewport:"dropdown-view",searchSessionId:a})}})},s._handleSlimSearchResultOpen=function(e){var t=s.props,r=t.onSlimSearchResultOpen,a=t.searchBarExperiments,n=a.expSearchSuccessBanner;r&&(n&&"/h"===x.get_pathname()&&l.setSearchSuccessBannerVisibleFromHome(),r(e))},s._handleSearchResultOpen=function(e){var t=s.props,r=t.user;if(t.searchBarExperiments.expSearchSuccessBanner&&e&&e.fq_path&&(l.doSearchBarInteractionBroadcast(!1),l.doSearchResultActionClickBroadcast(!1),l.setSearchSuccessBannerVisible(),e.is_dir)){var a=e.fq_path;l.setFolderSearchResultData(a)}s._handleSlimSearchResultOpen(e),p.searchBarApiClient.fetchFullSearchResult({searchResult:e,user:r,onSuccess:function(e){s._openSearchResult(e)},onError:function(e){R.Notify.error(e)}})},s._handleResultObjectPathClick=function(e){s._dispatchSearchSuccessful(e.request_id||""),s.props.onResultObjectPathClick(e)},s._handleHighlightDropdownItem=function(e){s.props.setHighlightedRow({highlightedSearchRow:e})},s._handleSearchBarFocus=function(){var e=s.props,t=e.user,r=e.searchBarExperiments;I.isInSinglePageSearchExperiment(r)||s._setSearchQuery(s.props.normalizedQuery),r.expSearchSuccessBanner&&!I.isInSinglePageSearchExperiment(r)&&(l.resetSearchResultClickKey(),l.doSearchBarInteractionBroadcast(!1)),r.expBrowseSuccessBanner===w.BrowseSuccessBannerVariants.V1||r.expBrowseSuccessBanner===w.BrowseSuccessBannerVariants.V3?(l.clearBrowseSuccessBannerCounter(),l.clearBrowseSuccessBannerKey()):r.expBrowseSuccessBanner===w.BrowseSuccessBannerVariants.V2&&l.clearBSBExtraData(),s.props.focusSearchBar(),s.props.loadHistory({user:t}),I.isInSinglePageSearchExperiment(r)&&s._clearSelection()},s._handleSearchBarBlur=function(){var e=s.props,t=e.searchBarExperiments,r=e.searchBarLoading,a=e.slimSearchResults;!t.expSearchSuccessBanner||l.userIsOptedOutOfRetrievalSuccessBanner()||l.shouldShowSearchSuccessBanner()||r||!a.length||l.setSearchSuccessBannerVisible(),s.props.blurSearchBar()},s._dispatchSearchSuccessful=function(e){var t=s.props,r=t.user,a=t.rawQuery,n=t.normalizedQuery,o=t.searchSessionId;(0,t.addQueryToHistory)({user:r,query:{rawQuery:a,normalizedQuery:n},searchSessionId:o,requestId:e})},s._logSearchBarTTI=function(){s._searchBarWebTimer&&s._searchBarWebTimer.markTimeToInteractive()},s._handleHistoryClearAllClick=function(){var e=s.props,t=e.user;(0,e.clearAllHistory)({user:t})},t.setExperiments({experiments:t.searchBarExperiments}),s.props.setScopeChip({scopeChip:t.currentPath}),s}return r.__extends(t,e),t.prototype.componentWillMount=function(){var e=v.Viewer.get_viewer().get_users().map(function(e){return e.id});y.UserLocalStorage.clearOtherUsers(e)},t.prototype.componentWillUnmount=function(){this._logFocusLost(this.props.isFocused,!1)},t.prototype.componentWillReceiveProps=function(e){this.props.currentPath!==e.currentPath&&this._onBrowseScopeChange(e.currentPath||t.defaultProps.currentPath),this.props.searchBarExperiments!==e.searchBarExperiments&&this.props.setExperiments({experiments:e.searchBarExperiments})},t.prototype.componentDidUpdate=function(e){this._logFocusLost(e.isFocused,this.props.isFocused),this.props.currentPath===e.currentPath&&f.fileCategoriesToString(this.props.fileCategories)===f.fileCategoriesToString(e.fileCategories)||this.props.invalidateResults()},t.prototype._logFocusLost=function(e,t){e&&!t&&u.logSearchBarFocusLost({user:this.props.user,searchSessionId:this.props.searchSessionId})},t.prototype._setSearchQuery=function(e,t){var r=this;void 0===t&&(t=!1);var s=this.props,a=s.user,n=s.setSearchQueryAndFetchResults,o=s.searchBarExperiments;n({user:a,query:e,webTimer:I.isInSinglePageSearchExperiment(o)?void 0:this._startSearchBarTimer(),keepHighlightedRow:t}),I.isInSinglePageSearchExperiment(o)&&setTimeout(function(){r._handleSearch(e)})},t.prototype._openSearchResult=function(e){this._dispatchSearchSuccessful(e.request_id||""),this.props.onSearchResultOpen(e)},t.prototype._startSearchBarTimer=function(){return this._searchBarWebTimer?this._searchBarWebTimer.restart():(this._searchBarWebTimer=E.get_timer("search_bar"),this._searchBarWebTimer.initialize({requireTTI:!0,requireTTV:!1,url:p.searchBarApiClient.getSearchApiUrl()})),this._searchBarWebTimer},t.prototype.render=function(){var e=this.props,t=e.user,r=e.isExpanded,a=e.isFocused,n=e.isActive,o=e.rawQuery,i=e.normalizedQuery,c=e.slimSearchResults,l=e.searchBarLoading,u=e.searchSessionId,p=e.highlightedRow,h=e.searchHistory,d=e.scopeChip,_=e.deletedChip,m=e.searchPath,f=e.headerItems,g=e.searchBarExperiments,y=e.browseScope,v=e.placeholder,E=this.props.deletedChipEnabled&&I.isInDeletedFilterRightRailExperiment(g);return s.default.createElement(S.SearchBarView,{user:t,isExpanded:!!r,searchBarExperiments:g,isFocused:a,isActive:n,inputTextValue:o,normalizedQuery:i,searchResults:c,searchBarLoading:l,searchSessionId:u,highlightedRow:p,searchHistory:h,scopeChip:d,deletedChip:_,enableDeletedChip:E,browseScope:y,searchPath:m,dropdownHeaderItems:f,placeholder:v,onSearch:this._handleSearch,onHistoryClearAllClick:this._handleHistoryClearAllClick,onHistoryItemClick:this._handleHistoryItemClick,onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchResultOpen:this._handleSearchResultOpen,onContextMenuCapture:this._handleContextMenuCapture,onRecentSearchContextMenuCapture:this._handleRecentSearchContextMenuCapture,
onResultObjectPathClick:this._handleResultObjectPathClick,onSearchBarFocus:this._handleSearchBarFocus,onSearchBarBlur:this._handleSearchBarBlur,onHighlightDropdownItem:this._handleHighlightDropdownItem,onSearchChipInteraction:this._handleScopeChipChange,onDeletedChipInteraction:this._handleDeletedChipChange,onDropdownTTI:this._logSearchBarTTI})},t.defaultProps={currentPath:"/",isExpanded:!1},t})(s.default.PureComponent);t.SearchBarControllerElement=P;var T=_.getStoreForSearchBar(),A=function(e){var t=d.isSearchBarFocused,r=d.isSearchBarActive,s=d.rawQuery,a=d.normalizedQuery,n=d.searchResults,o=d.slimSearchResults,i=d.isSearchBarLoading,c=d.searchSessionId,l=d.highlightedSearchRow,u=d.searchHistory,p=d.scopeChip,h=d.deletedChip,_=d.deletedChipEnabled,m=d.searchPath,S=d.headerItems,f=d.browseScope,g=d.fileCategories,y=d.resultsInvalid;return{isFocused:t(e),isActive:r(e),rawQuery:s(e),normalizedQuery:a(e),searchResults:n(e),slimSearchResults:o(e),searchBarLoading:i(e),searchSessionId:c(e),highlightedRow:l(e),searchHistory:u(e),scopeChip:p(e),deletedChip:h(e),deletedChipEnabled:_(e),searchPath:m(e),headerItems:S(e),browseScope:f(e),fileCategories:g(e),resultsInvalid:y(e)}},B={blurSearchBar:h.blurSearchBar,focusSearchBar:h.focusSearchBar,loadHistory:h.loadHistory,highlightPreviousRow:h.highlightPreviousRow,highlightNextRow:h.highlightNextRow,setHighlightedRow:h.setHighlightedRow,addQueryToHistory:h.addQueryToHistory,setSearchQueryAndFetchResults:h.setSearchQueryAndFetchResults,clearAllHistory:h.clearAllHistory,setExperiments:h.setExperiments,setScopeChip:h.setScopeChip,setDeletedChip:h.setDeletedChip,invalidateResults:h.invalidateResults},O=n.connect(A,B)(P),H=function(e){return s.default.createElement(n.Provider,{store:T},s.default.createElement(O,r.__assign({},e)))};t.SearchBarController=b.requireCssWithComponent(H,["/static/css/search/search_bar_react-vflzxWM3D.css"])}),define("modules/clean/search/search_bar/data/action_creators",["require","exports","tslib","modules/clean/search/search_bar/api","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/types","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/history","modules/core/exception"],function(e,t,r,s,a,n,o,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a=r.__importStar(a),i=r.__importStar(i),c=r.__importStar(c),t.focusSearchBar=function(){return{type:n.ActionTypes.FOCUS}},t.blurSearchBar=function(){return{type:n.ActionTypes.BLUR}},t.clearSearchBar=function(){return{type:n.ActionTypes.CLEAR}},t.updateHistoryInternal=function(e){var t=e.searchHistory;return{type:n.ActionTypes.UPDATE_HISTORY,payload:{searchHistory:t}}},t.loadHistory=function(e){var r=e.user;return function(e){var s=i.getHistory(r);e(t.updateHistoryInternal({searchHistory:s}))}},t.addQueryToHistory=function(e){var r=e.user,s=e.query,a=e.searchSessionId,n=e.requestId,o=e.skipLogging;return function(e){var c=i.addQuery(r,s,a,n,o);e(t.updateHistoryInternal({searchHistory:c}))}},t.clearAllHistory=function(e){var r=e.user,s=e.skipLogging;return function(e,n){var o=i.clearAll(r,a.searchSessionId(n()),s);e(t.updateHistoryInternal({searchHistory:o}))}},t.setSearchQuery=function(e){var t=e.query,r=e.searchSessionId,s=e.keepHighlightedRow,a=e.searchPath;return{type:n.ActionTypes.SET_QUERY,payload:{query:t,searchSessionId:r,keepHighlightedRow:s,searchPath:a}}},t.setSearchResults=function(e){var t=e.searchResults;return{type:n.ActionTypes.SET_SEARCH_RESULTS,payload:{searchResults:t}}},t.setSlimSearchResults=function(e){var t=e.slimSearchResults;return{type:n.ActionTypes.SET_SLIM_SEARCH_RESULTS,payload:{slimSearchResults:t}}},t.setHighlightedRow=function(e){var t=e.highlightedSearchRow;return{type:n.ActionTypes.SET_HIGHLIGHTED_ROW,payload:{highlightedSearchRow:t}}},t.highlightPreviousRow=function(){return{type:n.ActionTypes.HIGHLIGHT_PREVIOUS_ROW}},t.highlightNextRow=function(){return{type:n.ActionTypes.HIGHLIGHT_NEXT_ROW}},t.setBrowseScope=function(e){var t=e.browseScope;return{type:n.ActionTypes.SET_BROWSE_SCOPE,payload:{browseScope:t}}},t.setScopeChip=function(e){var t=e.scopeChip;return{type:n.ActionTypes.SET_SCOPE_CHIP,payload:{scopeChip:t}}},t.setDeletedChip=function(e){var t=e.deletedChip;return{type:n.ActionTypes.SET_DELETED_CHIP,payload:{deletedChip:t}}},t.setDeletedChipEnabled=function(e){var t=e.enabled;return{type:n.ActionTypes.SET_DELETED_CHIP_ENABLED,payload:{enabled:t}}},t.setFileCategories=function(e){var t=e.fileCategories;return{type:n.ActionTypes.SET_FILE_CATEGORIES,payload:{fileCategories:t}}},t.invalidateResults=function(){return{type:n.ActionTypes.INVALIDATE_RESULTS}},t.setSearchQueryAndFetchResults=function(n){var i=this,l=n.user,u=n.query,p=n.webTimer,h=n.searchSessionId,d=n.keepHighlightedRow;return function(n,_){return r.__awaiter(i,void 0,void 0,function(){var i,m,S,f,g,y,v,E;return r.__generator(this,function(C){switch(C.label){case 0:if(i=a.scopeChip(_()),m=function(){return u===a.rawQuery(_())&&i===a.searchPath(_())},m()&&!a.resultsInvalid(_()))return[2];if(n(t.setSearchQuery({query:u,searchPath:i,searchSessionId:h,keepHighlightedRow:d})),a.deletedChip(_()))return n(t.setSearchResults({searchResults:{results:[],hasMore:!1}})),[2];if(o.isInSinglePageSearchExperiment(a.experiments(_())))return n(t.setSearchResults({searchResults:{results:[],hasMore:!1}})),[2];if(!a.isSearchBarLoading(_()))return[3,9];S=a.experiments(_()),C.label=1;case 1:return C.trys.push([1,8,,9]),[4,s.searchBarApiClient.loadSlimResults({user:l,path:i,query:a.normalizedQuery(_()),searchSessionId:a.searchSessionId(_()),experiments:S,webTimer:p,fileCategories:a.fileCategories(_())})];case 2:if(f=C.sent().searchResults,!m())return[2];C.label=3;case 3:return C.trys.push([3,5,,6]),[4,new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar)];case 4:return g=C.sent().checkForMissingStarredData,g({items:f.results,user:l}),[3,6];case 5:return y=C.sent(),c.reportException({err:y,severity:c.SEVERITY.NONCRITICAL,tags:["search_bar"]}),[3,6];case 6:return n(t.setSlimSearchResults({slimSearchResults:f})),[4,s.searchBarApiClient.fetchAdditionalFileMetadata({searchResults:f.results,user:l})];case 7:return v=C.sent(),m()?(n(t.setSearchResults({searchResults:{results:v,hasMore:!1}})),[3,9]):[2];case 8:if(E=C.sent(),!(E instanceof s.RequestAbortedError))throw E;return[3,9];case 9:return[2]}})})}},t.setExperiments=function(e){var t=e.experiments;return{type:n.ActionTypes.SET_EXPERIMENTS,payload:{experiments:t}}}}),define("modules/clean/search/search_bar/history",["require","exports","tslib","external/lodash","modules/clean/search/constants","modules/clean/storage","modules/clean/search/logger"],function(e,t,r,s,a,n,o){"use strict";function i(e){return n.UserLocalStorage.get(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY)||[]}function c(e,t,r,s,c){void 0===r&&(r=""),void 0===s&&(s=""),void 0===c&&(c=!1);var l=i(e);if(!t.normalizedQuery.length)return l;if(!c){var p=u(l,t);o.logRecentQueryStored({searchSessionId:r,requestId:s,query:t,user:e,previousPosition:p})}return l=l.filter(function(e){return!d(e,t)}),l=[t].concat(l).slice(0,a.SEARCH_RECENT_HISTORY_CAPACITY),n.UserLocalStorage.set(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY,l),l}function l(e,t,r){void 0===t&&(t=""),void 0===r&&(r=!1),r||o.logRecentHistoryCleared({searchSessionId:t,user:e});var s=[];return n.UserLocalStorage.set(e.id,a.SEARCH_RECENT_HISTORY_STORAGE_KEY,s),s}function u(e,t){return s.findIndex(e,function(e){return d(e,t)})}function p(){n.UserLocalStorage.clearOtherUsers([])}function h(){n.UserLocalStorage.clearOtherUsers([])}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),o=r.__importStar(o),t.getHistory=i;var d=function(e,t){return e.normalizedQuery===t.normalizedQuery};t.addQuery=c,t.clearAll=l,t.getPreviousPosition=u,t.testMockSetup=p,t.testMockTeardown=h}),define("modules/clean/search/search_bar/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors"],function(e,t,r,s,a,n){"use strict";function o(e){var t=e.result,r=e.user,o=e.action_type,i=e.viewport,c=e.view_type,l=e.searchSessionId;s.logSearchAction({searchSessionId:l||n.searchSessionId(a.getStoreForSearchBar().getState()),result:t,user:r,action_type:o,search_type:"dropdown",viewport:i,view_type:c})}Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),n=r.__importStar(n),t.logDropdownSearchAction=o}),define("modules/clean/search/search_bar/view",["require","exports","tslib","external/classnames","react","spectrum/icon_action","spectrum/icon_content","spectrum/icon_global","modules/clean/em_string","modules/clean/filepath","modules/clean/keycode","modules/clean/react/title_bubble","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/clean/search/types","modules/clean/web_timing_logger","modules/core/i18n"],function(e,t,r,s,a,n,o,i,c,l,u,p,h,d,_,m,S,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importDefault(a),l=r.__importStar(l),h=r.__importStar(h),_=r.__importStar(_),S=r.__importStar(S);var g=(function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderDropdown=function(){},e._handleNavigation=function(){e._searchBarInput.blurSearchBarTextInput()},e._onHistoryItemClick=function(t,r){e.props.onHistoryItemClick&&e.props.onHistoryItemClick(t,r)},e._onSearchResultOpen=function(t){e.props.onSearchResultOpen(t),e._handleNavigation()},e._onResultObjectPathClick=function(t){e.props.onResultObjectPathClick(t),e._handleNavigation()},e._onSearch=function(t){var r=e.props.onSearch;r&&r(t),e._handleNavigation()},e._setSearchBarInputRef=function(t){return e._searchBarInput=t},e._setSearchBarDropdownRef=function(t){e._searchBarDropdown=t},e}return r.__extends(n,t),n.prototype.getSearchBarInput=function(){return this._searchBarInput},n.prototype.getSearchBarDropdown=function(){return this._searchBarDropdown},n.prototype._shouldRenderDropdown=function(){var e=this.props,t=e.searchHistory,r=e.normalizedQuery,s=e.dropdownHeaderItems;return!!(t&&t.length||s&&(s.indexOf(m.SearchBarDropdownHeaderItemType.SCOPE_CHIPS)!==-1||s.indexOf(m.SearchBarDropdownHeaderItemType.DELETED_FILES)!==-1)||r&&r.length)},n.prototype.componentDidMount=function(){var t=this;S.waitForTTI().then(function(){Promise.all([new Promise(function(t,r){e(["modules/clean/search/search_bar/dropdown"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar)]).then(function(e){var r=e[0].SearchBarDropdown,s=e[1];s.Star,s.HOME_RESOURCE_ID_TYPE,s.StarredSource,s.checkForMissingStarredData;t._renderDropdown=function(){var e=t.props,s=e.browseScope,n=e.children,o=e.dropdownHeaderItems,i=e.highlightedRow,c=e.isFocused,l=e.normalizedQuery,u=e.onContextMenuCapture,p=e.onDropdownTTI,h=e.onHighlightDropdownItem,d=e.onHistoryClearAllClick,_=e.onRecentSearchContextMenuCapture,m=e.onSearchChipInteraction,S=e.scopeChip,f=e.onDeletedChipInteraction,g=e.deletedChip,y=e.enableDeletedChip,v=e.searchBarExperiments,E=e.searchBarLoading,C=e.searchHistory,R=e.searchPath,w=e.searchSessionId,I=e.showLinkToResultsPage,b=e.searchResults,x=e.user;return a.default.createElement(r,{browseScope:s,children:n,dropdownHeaderItems:o||[],highlightedRow:i,isOpen:c,normalizedQuery:l,onContextMenuCapture:u,onDropdownTTI:p,onHighlightDropdownItem:h,onHistoryClearAllClick:d,onHistoryItemClick:t._onHistoryItemClick,onRecentSearchContextMenuCapture:_,onResultObjectPathClick:t._onResultObjectPathClick,onSearch:t._onSearch,onSearchChipInteraction:m,onDeletedChipInteraction:f,onSearchResultOpen:t._onSearchResultOpen,ref:t._setSearchBarDropdownRef,scopeChip:S,deletedChip:g,enableDeletedChip:y,searchBarExperiments:v,searchBarLoading:E,searchHistory:C||[],searchPath:R,searchSessionId:w,showLinkToResultsPage:I,searchResults:b,user:x})},t._shouldRenderDropdown()&&t.forceUpdate()})})},n.prototype.render=function(){var e=this.props,t=e.isActive,n=e.isExpanded,o=e.isFocused,i=e.searchBarExperiments,c={"search-bar--container":!0,"u-l-fr":!0,"sps--search-bar--container":d.isInSinglePageSearchExperiment(i),"is-expanded":n,"is-focused":o},l={"is-active":t,"is-collapsed":!(n||o),"is-expanded":n,"is-focused":o,"search-bar":!0},u=this._shouldRenderDropdown();return a.default.createElement("div",{className:s.default(c)},a.default.createElement("div",{className:s.default(l)},a.default.createElement(y,r.__assign({},this.props,{shouldRenderDropdown:u,ref:this._setSearchBarInputRef})),u&&this._renderDropdown()))},n.defaultProps={inputTextValue:"",normalizedQuery:"",showLinkToResultsPage:!0},n})(a.default.Component);t.SearchBarView=g;var y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.focusSearchBarTextInput=function(){t.props.isFocused||t._searchBarTextInput.focus()},t._onKeyDown=function(e){var r=t.props,s=r.normalizedQuery,a=r.areQuerySuggestionsLoaded,n=s&&a;e.keyCode!==u.KeyCode.ESC||n||t.blurSearchBarTextInput(),t.props.onInputKeydown(e,t._getCursorPosition())},t._onSubmit=function(e){var r=t.props.highlightedRow,s=t.props.searchHistory||[],a=t.props,n=a.searchBarExperiments,o=a.recentItemsLoadingState,i=a.recentItems,c=!t.props.normalizedQuery&&s.length>0&&!_.areRecentItemsLoading(n,o)&&!_.areRecentItemsLoaded(n,o,i),l=t.props.dropdownHeaderItems||[],u=r-l.length;if(c&&u>=0){e.preventDefault();var p=s[u];return void(t.props.onHistoryItemClick&&t.props.onHistoryItemClick(p,u))}var h=t.props,d=h.normalizedQuery,S=h.areQuerySuggestionsLoaded,f=h.querySuggestions,g=h.onQuerySuggestionsClick,y=h.onQuerySuggestionsDismiss,v=d&&S,E=r-1;if(!(v&&f&&g&&y)){return r<l.length&&l[r]===m.SearchBarDropdownHeaderItemType.SCOPE_CHIPS||t.blurSearchBarTextInput(),t.props.onInputSubmit(e,r)}if(e.preventDefault(),E>=0){g(f[E],E)}else{var p=d||"";y(p)}},t._handleButtonMouseDown=function(e){t.props.inputTextValue&&t.props.inputTextValue.length&&(t._onSubmit(e),e.preventDefault())},t._handleInputChange=function(e){t.props.onInputChange(e.currentTarget.value)},t._setSearchBarTextInputRef=function(e){return t._searchBarTextInput=e},t}return r.__extends(t,e),t.prototype._getCursorPosition=function(){return this._searchBarTextInput.selectionEnd},t.prototype.getSearchBarTextInput=function(){return this._searchBarTextInput},t.prototype.blurSearchBarTextInput=function(){this._searchBarTextInput.blur(),this.props.onSearchBarBlur()},t.prototype.render=function(){var e=this.props,t=e.onSearchBarFocus,s=e.onSearchBarBlur,n=e.isFocused,o=e.highlightedRow,c=e.inputTextValue,l=e.shouldRenderDropdown,u=l?{"aria-expanded":n,"aria-activedescendant":"search-dropdown-item"+o,"aria-autocomplete":"list","aria-owns":"search-bar__dropdown-items",role:"combobox"}:void 0,p=this.props.placeholder||f._("Search");return a.default.createElement("form",{className:"search-bar__input",onSubmit:this._onSubmit},a.default.createElement("button",{"aria-label":p,className:"search-bar__button",type:"submit",onMouseDown:this._handleButtonMouseDown},a.default.createElement(i.IconGlobal,{name:"search-small"})),a.default.createElement(v,r.__assign({},this.props,{focusSearchInput:this.focusSearchBarTextInput})),a.default.createElement("input",r.__assign({"aria-label":p},u,{className:"search-bar__text-input",maxLength:1e3,onChange:this._handleInputChange,onFocus:t,onBlur:s,onKeyDown:this._onKeyDown,placeholder:p,ref:this._setSearchBarTextInputRef,value:c})))},t})(a.default.Component);t.SearchBarInput=y;var v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onScopeChipClosed=function(){t.props.onSearchChipInteraction&&t.props.onSearchChipInteraction(!1)},t._onDeletedChipClosed=function(){t.props.onDeletedChipInteraction&&t.props.onDeletedChipInteraction(!1)},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.scopeChip,r=e.user,s=e.isFocused,i=e.isExpanded;if(this.props.deletedChip&&d.isInDeletedFilterRightRailExperiment(this.props.searchBarExperiments))return a.default.createElement(E,{key:"deleted",isFocused:s,isExpanded:i,icon:a.default.createElement(n.IconAction,{name:"delete",className:"search-bar__chip-icon--dark"}),text:f._("Deleted files"),onClose:this._onDeletedChipClosed,onClick:this.props.focusSearchInput});if(t&&h.isValidPathForChip(t)){var c=r.cdm_tmf_path&&t&&l.paths_are_equal(r.cdm_tmf_path,t),u=c?"folder_team_member_child-small":"folder-small",p=l.child_dir(t);return a.default.createElement(E,{key:"scope",isFocused:s,isExpanded:i,icon:a.default.createElement(o.IconContent,{name:u,height:"18px",width:"18px"}),text:p,onClose:this._onScopeChipClosed,onClick:this.props.focusSearchInput})}return null},t})(a.default.Component),E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._onMouseDownOnChipItem=function(e){e.stopPropagation(),e.preventDefault()},t._onMouseDownClose=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClose()},t._onMouseDownOnChipButton=function(e){e.stopPropagation(),e.preventDefault(),t.props.onClick()},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.isFocused,r=e.isExpanded,s=e.text,n=e.icon;if(!s)return null;var o=c.Emstring.em_snippet(s,8,.6),i=a.default.createElement("span",{className:"search_bar__chip_text",key:"text"},o),l=o!==s;return r||t?a.default.createElement("span",{className:"search_bar__chip"},a.default.createElement("span",{className:"search_bar__chip_item",tabIndex:0,onMouseDown:this._onMouseDownOnChipItem,"data-chip":s},n,l?a.default.createElement(p.TitleBubble,{content:s,position:p.TitleBubble.POSITIONS.BOTTOM,key:"text"},i):i),a.default.createElement("button",{type:"button","aria-label":f._("Remove filter"),className:"search_bar__chip_close_button",key:"close",onMouseDown:this._onMouseDownClose})):a.default.createElement("span",{className:"search_bar__chip"},a.default.createElement("button",{type:"button","aria-label":f._("Search"),className:"search_bar__chip_button",onMouseDown:this._onMouseDownOnChipButton},n))},t})(a.default.PureComponent)}),define("modules/clean/search/single_page/constants",["require","exports","modules/clean/search/types","modules/core/i18n"],function(e,t,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SEARCH_QUERY_DEBOUNCE=50,t.SEARCH_FIRST_PAGE_SIZE=10,t.SEARCH_ADDITIONAL_PAGE_SIZE=50,t.SEARCH_SECOND_PAGE_DEBOUNCE=200,t.SEARCH_INPUT_ANIMATION_MS=200,t.SEARCH_URL_ROOT="/search",t.SEARCH_URL_REGEX=/^\/search\//,t.BROWSE_URL_REGEX=/^\/(home|personal|work)/,t.HOME_URL_REGEX=/^\/h([^\w]|$)/,t.SEARCH_HISTORY_DELAY=500,t.SEARCH_WEB_TIMER="single-page-search",t.SEARCH_TAB_HEIGHT=40,t.SEARCH_PAGE_HEADER_HEIGHT_DESKTOP=96,t.SEARCH_PAGE_HEADER_HEIGHT_TABLET=56,t.SEARCH_PAGE_HEADER_HEIGHT_MOBILE=80,t.SEARCH_SUCCESS_BANNER_HEIGHT=70,t.SEARCH_PRIOR_QUERY_SUGGESTIONS_CAPACITY=5,t.SEARCH_POSTERIOR_QUERY_SUGGESTIONS_CAPACITY=3,t.FILE_CATEGORIES_PAPER=[{category:r.FileCategory.IMAGE,label:s._("Images"),tooltip:s._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},{category:r.FileCategory.DOCUMENT,label:s._("Documents"),tooltip:s._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"txt-small"},{category:r.FileCategory.PDF,label:s._("PDFs"),tooltip:s._("PDF"),icon:"pdf-small"},{category:r.FileCategory.SPREADSHEET,label:s._("Spreadsheets"),tooltip:s._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"numbers-small"},{category:r.FileCategory.PRESENTATION,label:s._("Presentations"),tooltip:s._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"keynote-small"},{category:r.FileCategory.AUDIO,label:s._("Audio"),tooltip:s._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},{category:r.FileCategory.VIDEO,label:s._("Video"),tooltip:s._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},{category:r.FileCategory.FOLDER,label:s._("Folders"),tooltip:s._("Dropbox folders"),icon:"folder-small"},{category:r.FileCategory.PAPER,label:s._("Paper docs"),tooltip:s._("Dropbox Paper docs"),icon:"paper-small"},{category:r.FileCategory.OTHER,label:s._("Other"),tooltip:s._("Other file types"),icon:"unknown-small"}],t.FILE_CATEGORIES_NO_PAPER=t.FILE_CATEGORIES_PAPER.filter(function(e){return e.category!==r.FileCategory.PAPER})}),define("modules/clean/search/single_page/input/component",["require","exports","tslib","external/classnames","react","react-transition-group","spectrum/button","spectrum/icon_form","spectrum/icon_global","modules/clean/filepath","modules/clean/keycode","modules/clean/react/async/loadable","modules/clean/react/no-jquery","modules/clean/react/retrieval_success_banner/util","modules/clean/search/single_page/constants","modules/clean/search/single_page/navigation","modules/clean/search/store_helpers","modules/clean/web_timing_logger","modules/core/browser_detection","modules/core/i18n"],function(e,t,r,s,a,n,o,i,c,l,u,p,h,d,_,m,S,f,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),a=r.__importStar(a),l=r.__importStar(l),g=r.__importStar(g);var v=p.Loadable({loader:function(){return f.waitForTTI().then(function(){return new Promise(function(t,r){e(["modules/clean/search/single_page/input/chips"],t,r)}).then(r.__importStar).then(function(e){return e.SearchChips})})},loading:a.createElement("span",{className:"search-chips"})}),E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasEmptyQuery=function(){return!S.normalize(t.props.query)},t.handleChange=function(e){t.props.setQuery({query:e.target.value})},t.handleFocus=function(){t.props.onSearchEnter(),d.clearBrowseSuccessBannerCounter(),d.clearBrowseSuccessBannerKey(),d.clearBSBExtraData(),t.props.expSearchSuccessBanner&&d.resetSearchResultClickKey()},t.handleBlur=function(){t.hasSuggestions()||t.props.onInputBlur&&t.props.onInputBlur()},t.hasSuggestions=function(){return t.hasQuerySuggestions()||t.hasPeopleSuggestions()},t.hasQuerySuggestions=function(){return t.props.query.length>0&&t.props.querySuggestions&&t.props.querySuggestions.length},t.hasPeopleSuggestions=function(){return t.props.query.length>0&&t.props.peopleSuggestions&&t.props.peopleSuggestions.length},t.getNumOfSuggestions=function(){return t.getNumOfQuerySuggestions()+t.getNumOfPeopleSuggestions()},t.getNumOfQuerySuggestions=function(){return t.hasQuerySuggestions()?t.props.querySuggestions.length:0},t.getNumOfPeopleSuggestions=function(){return t.hasPeopleSuggestions()?t.props.peopleSuggestions.length:0},t.dismissSuggestions=function(){t.dimsissQuerySuggestions(),t.dismissPeopleSuggestions()},t.dimsissQuerySuggestions=function(){t.hasQuerySuggestions()&&t.props.dismissQuerySuggestions&&t.props.setSuggestionHighlightRow&&(t.props.dismissQuerySuggestions({query:t.props.query}),t.props.setSuggestionHighlightRow({index:void 0}))},t.dismissPeopleSuggestions=function(){t.hasPeopleSuggestions()&&t.props.dismissPeopleSuggestions&&t.props.dismissPeopleSuggestions({query:t.props.query})},t.handleSearchExit=function(){t.props.expSearchSuccessBanner&&!d.userIsOptedOutOfRetrievalSuccessBanner()&&d.setSearchSuccessBannerVisible(),m.searchNavigationManager.exit(),t.props.onSearchExit(),t.input&&t.input.blur()},t.handleEscape=function(){t.hasSuggestions()?t.dismissSuggestions():t.hasEmptyQuery()?t.handleSearchExit():(t.props.clear(),t.input&&t.input.focus())},t.handleKeyArrowDown=function(e){if(t.hasSuggestions()&&t.props.setSuggestionHighlightRow){var r=void 0===t.props.suggestionHighlightRow?0:Math.min(t.props.suggestionHighlightRow+1,t.getNumOfSuggestions()-1);t.props.setSuggestionHighlightRow({index:r}),e.preventDefault()}},t.handleKeyArrowUp=function(e){if(t.hasSuggestions()&&t.props.setSuggestionHighlightRow){var r=void 0===t.props.suggestionHighlightRow?t.getNumOfSuggestions()-1:Math.max(t.props.suggestionHighlightRow-1,0);t.props.setSuggestionHighlightRow({index:r}),e.preventDefault()}},t.handleKeyEnter=function(e){if(t.hasSuggestions()&&(t.dismissSuggestions(),void 0!==t.props.suggestionHighlightRow)){var r=t.getNumOfQuerySuggestions();if(t.props.suggestionHighlightRow<r){var s=t.props.querySuggestions[t.props.suggestionHighlightRow];if(!s)return;t.props.setQuery({query:s.text,alwaysTriggerSearch:!0})}else{var s=t.props.peopleSuggestions[t.props.suggestionHighlightRow-r];if(!s)return;t.props.setFilteredAccountId({filteredAccountId:s.dbx_account_id}),t.props.setQuery({query:"",alwaysTriggerSearch:!0})}t.input&&t.input.focus(),e.preventDefault()}},t.handleKeyDown=function(e){switch(e.keyCode){case u.KeyCode.ESC:t.handleEscape();break;case u.KeyCode.DOWN:t.handleKeyArrowDown(e);break;case u.KeyCode.UP:t.handleKeyArrowUp(e);break;case u.KeyCode.ENTER:t.handleKeyEnter(e);break;case u.KeyCode.BACKSPACE:t.input&&0===t.input.selectionStart&&0===t.input.selectionEnd&&(t.props.filteredContact?t.props.setFilteredAccountId({filteredAccountId:void 0}):l.paths_are_equal(t.props.path,"/")||t.props.setPath({path:"/",viewport:"input"}))}},t.handleSubmit=function(e){e.preventDefault(),t.props.onSearch&&t.props.onSearch()},t.handleDocumentClick=function(e){t.props.isActive&&e.srcElement&&(t.hasSuggestions()?h.closestElement(e.srcElement,".search__form")||t.dismissSuggestions():t.hasEmptyQuery()&&(h.closestElement(e.srcElement,".maestro-nav__container")||h.closestElement(e.srcElement,".pagelet-top-menu__container")||h.closestElement(e.srcElement,".maestro-header")&&!h.closestElement(e.srcElement,".search__form"))&&t.handleSearchExit())},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){document.addEventListener("click",this.handleDocumentClick,!1),this.props.autoFocus&&this.input&&(this.input.value="",this.input.focus(),this.input.value=this.props.query)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleDocumentClick,!1)},t.prototype.componentWillUpdate=function(e){var t=this;!e.isActive&&this.props.isActive&&this.input&&setTimeout(function(){return t.input.blur()},5),e.autoFocus&&!this.props.autoFocus&&this.input&&this.input.focus()},Object.defineProperty(t.prototype,"input",{get:function(){return this.props.inputBoxRef&&this.props.inputBoxRef.current},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this.props,t=e.isActive,r=e.query,l=e.filteredContact,u=l?y._("Add search terms to improve your results"):y._("Search");return a.createElement("div",{className:s.default({search__form:!0,"search__form--is-active":t}),role:"combobox","aria-expanded":t,"aria-haspopup":"listbox","aria-owns":"search-view"},a.createElement(n.CSSTransitionGroup,{transitionName:"search__exit-button",transitionEnterTimeout:_.SEARCH_INPUT_ANIMATION_MS,transitionLeaveTimeout:_.SEARCH_INPUT_ANIMATION_MS},t?a.createElement(o.Button,{className:"search__exit-button",onClick:this.handleSearchExit,"aria-label":y._("Exit search"),key:"exit"},a.createElement(i.IconForm,{name:"cancel"})):null),a.createElement("form",{onSubmit:this.handleSubmit,role:"search"},a.createElement("span",{className:"search__icon"},a.createElement(c.IconGlobal,{name:"search-small","aria-hidden":!0})),a.createElement(v,{user:this.props.user,path:this.props.path,deletedFiles:!1,setPath:this.props.setPath,filteredContact:this.props.filteredContact,setFilteredAccountId:this.props.setFilteredAccountId}),a.createElement("input",{ref:this.props.inputBoxRef,"aria-label":y._("Search"),className:s.default("search__input",{"search__input--ios":g.iOS}),maxLength:200,onChange:this.handleChange,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,placeholder:u,type:"text","aria-autocomplete":"list",value:r})))},t.defaultProps={onSearchEnter:function(){},onSearchExit:function(){}},t})(a.PureComponent);t.SearchInputComponent=E}),define("modules/clean/search/single_page/input/wrapper",["require","exports","tslib","react","modules/clean/api_v2/user_client","modules/clean/filepath","modules/clean/react/css","modules/clean/react/retrieval_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/single_page/constants","modules/clean/search/single_page/input/component","modules/clean/search/single_page/navigation","modules/clean/web_timing_logger"],function(e,t,r,s,a,n,o,i,c,l,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),n=r.__importStar(n);var d=new a.UserApiV2Client,_=(function(t){function a(a){var n=t.call(this,a)||this;return n.loadConnectedInput=function(){return r.__awaiter(n,void 0,void 0,function(){var t,a,n,o,u,h,_,m,S,f,g,y,v,E,C,R,w,I,b,x,P,T,A,B,O,H=this;return r.__generator(this,function(D){switch(D.label){case 0:return[4,Promise.all([new Promise(function(t,r){e(["external/react-redux"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/input/connected"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/input/suggestions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/data/store"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/data/action_creators"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/data/selectors/experiments"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/data/selectors/index"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/search/single_page/utils"],t,r)}).then(r.__importStar),d.ns("search").rpc("get_experiment_data",void 0,{subjectUserId:this.props.user.id})])];case 1:return t=D.sent(),a=t[0].Provider,n=t[1].ConnectedSearchInput,o=t[2].ConnectedSearchSuggestions,u=t[3].getStoreForSearch,h=t[4],_=h.clear,m=h.setQuery,S=h.setUser,f=h.setPath,g=h.updateFromUrl,y=h.setExperiments,v=h.setSessionId,E=h.fetchPeopleSuggestions,C=h.fetchQuerySuggestions,R=h.fetchRecentItems,w=t[5],I=w.searchBarExperiments,b=w.isInPeopleFilterExperiment,x=t[6].sessionId,P=t[7].generateRandomId,T=t[8],A=T.user_options,B=T.experiments,O=u(),O.dispatch(S({user:this.props.user,options:A})),O.dispatch(f({path:this.props.path})),O.dispatch(y({experiments:B})),b(O.getState())&&O.dispatch(E({user:this.props.user,query:""})),p.searchNavigationManager.removeListener("update",this.handleUrlUpdate),p.searchNavigationManager.removeListener("exit",this.handleUrlExit),p.searchNavigationManager.addListener("update",function(e){e.query&&!H.props.isActive&&H.props.onSearchEnter(),O.dispatch(g(e))}),p.searchNavigationManager.addListener("exit",function(){c.isInSearchSuccessBannerExperiment(I(O.getState()))&&i.setSearchSuccessBannerVisible(),H.props.onSearchExit(),O.dispatch(_())}),p.searchNavigationManager.load(),x(O.getState())||O.dispatch(v({sessionId:P()})),this.state.query&&O.dispatch(m({query:this.state.query})),c.isInRecentFilesExperiment(I(O.getState()))&&O.dispatch(R()),c.isInPriorQuerySuggestionsExperiment(I(O.getState()))&&O.dispatch(C({query:"",maxResults:l.SEARCH_PRIOR_QUERY_SUGGESTIONS_CAPACITY,variant:I(O.getState()).expQuerySuggestions||void 0})),this.renderInput=function(){return s.createElement(a,{store:O},s.createElement(s.Fragment,null,s.createElement(n,r.__assign({},H.props,{autoFocus:H.state.hasFocus,onInputBlur:H.handleInputBlur})),s.createElement(o,{onFocusInput:H.handleFocusInput})))},[2]}})})},n.handleInputBlur=function(){n.setState({hasFocus:!1})},n.handleFocusInput=function(){n.setState({hasFocus:!0})},n.handleUrlUpdate=function(e){e.query&&(n.props.isActive||n.handleSearchEnter(),
n.handleSetQuery({query:e.query}))},n.handleUrlExit=function(){n.handleSearchExit()},n.handleSearchEnter=function(){n.setState({hasFocus:!0}),n.props.onSearchEnter()},n.handleSearchExit=function(){n.handleSetQuery({query:""}),n.props.onSearchExit()},n.handleSetQuery=function(e){var t=e.query;n.setState({query:t}),h.get_timer("single_page_search").restart()},n.handleSetPath=function(e){var t=e.path;n.setState({path:t})},n.handleClear=function(){n.setState({query:"",path:""})},n.state={hasReduxStoreLoaded:!1,hasFocus:!1,query:"",path:a.path,querySuggestions:void 0,suggestionHighlightRow:-1,filteredContact:void 0,peopleSuggestions:void 0},n}return r.__extends(a,t),a.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(e){switch(e.label){case 0:return p.searchNavigationManager.init(this.props.user),p.searchNavigationManager.addListener("update",this.handleUrlUpdate),p.searchNavigationManager.addListener("exit",this.handleUrlExit),p.searchNavigationManager.load(),0===document.location.pathname.indexOf("/search")?[3,2]:[4,h.waitForTTI()];case 1:e.sent(),e.label=2;case 2:return[4,this.loadConnectedInput()];case 3:return e.sent(),this.setState({hasReduxStoreLoaded:!0}),[2]}})})},a.prototype.componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,function(){var s,a;return r.__generator(this,function(o){switch(o.label){case 0:return!this.state.hasReduxStoreLoaded||this.props.isActive||n.paths_are_equal(t.path,this.props.path)?[3,3]:[4,new Promise(function(t,r){e(["modules/clean/search/single_page/data/store"],t,r)}).then(r.__importStar)];case 1:return s=o.sent().getStoreForSearch,[4,new Promise(function(t,r){e(["modules/clean/search/single_page/data/action_creators"],t,r)}).then(r.__importStar)];case 2:a=o.sent().setPath,s().dispatch(a({path:t.path,viewport:"input"})),o.label=3;case 3:return[2]}})})},a.prototype.render=function(){return this.state.hasReduxStoreLoaded?this.renderInput():s.createElement(u.SearchInputComponent,r.__assign({},this.props,this.state,{setQuery:this.handleSetQuery,setPath:this.handleSetPath,clear:this.handleClear,onSearchEnter:this.handleSearchEnter,onSearchExit:this.handleSearchExit}))},a})(s.Component);t.SearchInput=o.requireCssWithComponent(_,["/static/css/search/input-vfl0LLzT8.css","/static/js/retrieval-components/index.web-vflEwNrla.css"])}),define("modules/clean/search/single_page/navigation",["require","exports","tslib","external/eventemitter3","modules/clean/browse_uri_interface","modules/clean/query_string_helpers","modules/clean/search/single_page/constants","modules/core/browser","modules/core/i18n"],function(e,t,r,s,a,n,o,i,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importDefault(s),t.DESKTOP_FROM_PATHS=["assistant","collab_browse"];var l=(function(e){function s(t,r){var s=e.call(this)||this;return s.lastHistoryMs=0,s.initialPath="",s.setSearchUrl=function(e,t){e!==s.document.location.pathname+s.document.location.search&&(s.returnTo||o.SEARCH_URL_REGEX.test(s.document.location.pathname)||(s.returnTo=s.document.location.pathname+s.document.location.search),t||s.shouldPushHistory()?s.window.history.pushState({},c._("Search results - Dropbox"),e):s.window.history.replaceState({},c._("Search results - Dropbox"),e),s.lastHistoryMs=(new Date).getTime(),s.previousTitle||(s.previousTitle=s.document.title,s.document.title=c._("Search results - Dropbox")))},s.setNonSearchUrl=function(e){s.shouldRedirect(e)?i.redirect(e):(s.window.history.pushState({},s.previousTitle||"",e),s.previousTitle&&(s.document.title=s.previousTitle,s.previousTitle=void 0),s.emit("exit"))},s.handlePopState=function(){o.SEARCH_URL_REGEX.test(s.document.location.pathname)?(s.lastHistoryMs=(new Date).getTime(),s.emit("update",n.parseQueryString(s.document.location.search))):s.shouldRedirect(s.document.location.pathname)?i.reload():s.emit("exit")},s.shouldPushHistory=function(){return(new Date).getTime()-s.lastHistoryMs>=o.SEARCH_HISTORY_DELAY},s.shouldRedirect=function(e){return(!o.HOME_URL_REGEX.test(s.initialPath)||!o.HOME_URL_REGEX.test(e))&&(!o.BROWSE_URL_REGEX.test(s.initialPath)||!o.BROWSE_URL_REGEX.test(e))},s.document=t,s.window=r,s}return r.__extends(s,e),Object.defineProperty(s.prototype,"source",{get:function(){return o.HOME_URL_REGEX.test(this.initialPath)?"home":o.BROWSE_URL_REGEX.test(this.initialPath)?"browse":o.SEARCH_URL_REGEX.test(this.initialPath)?"search":null},enumerable:!0,configurable:!0}),s.prototype.init=function(e){this.user=e,this.initialPath=this.document.location.pathname,this.window.addEventListener("popstate",this.handlePopState)},s.prototype.load=function(){if(o.SEARCH_URL_REGEX.test(this.document.location.pathname)){this.emit("update",n.parseQueryString(this.document.location.search));var e=n.parseQueryString(this.document.location.search);e.search_from&&!o.SEARCH_URL_REGEX.test(e.search_from)&&t.DESKTOP_FROM_PATHS.indexOf(e.search_from)===-1&&(this.returnTo=e.search_from)}},s.prototype.set=function(e,t){e&&(o.SEARCH_URL_REGEX.test(e)?this.setSearchUrl(e,t):this.setNonSearchUrl(e))},s.prototype.exit=function(){o.SEARCH_URL_REGEX.test(this.document.location.pathname)&&(this.returnTo&&!o.SEARCH_URL_REGEX.test(this.returnTo)||(this.returnTo=a.get_browse_root(this.user)),this.set(this.returnTo),this.returnTo=void 0)},s})(s.default);t.SearchNavigationManager=l,t.searchNavigationManager=new l(document,window)});
//# sourceMappingURL=pkg-embedded_app_search.min.js-vflbudRSD.map