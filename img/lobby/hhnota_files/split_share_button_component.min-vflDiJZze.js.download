define(["require","exports","tslib","react","spectrum/button","modules/core/i18n","spectrum/popover","modules/clean/react/app_actions/telemetry_client","modules/clean/static_urls","modules/clean/react/file_viewer/open_button/types","modules/clean/react/file_viewer/constants","modules/clean/react/css","modules/clean/react/extensions/data/types","external/classnames","modules/clean/react/app_actions/education/types","modules/clean/react/app_actions/apis","modules/clean/react/app_actions/education/edu_tooltip_component","modules/clean/react/extensions/tooltips","modules/clean/react/extensions/utils","modules/clean/react/extensions/connect_flow","modules/clean/react/extensions/data/selectors","modules/clean/react/extensions/data/action_creators","external/react-redux","modules/clean/integrations/data/selectors","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/file_viewer_sidebar/buttons/icon","modules/clean/react/extensions/data/store","modules/clean/react/file_viewer/callout_utils"],function(e,t,n,o,r,i,a,s,l,p,c,u,h,d,_,f,g,S,m,v,I,T,y,b,A,E,O,x,P){"use strict";function w(e,t){var n=d.default({"extensions-popover-icon":e.type!==p.OpenButtonAction.INVITE_VIA_EMAIL,"extensions-invite-icon":e.type===p.OpenButtonAction.INVITE_VIA_EMAIL});return o.default.createElement(a.PopoverContentItem,{key:e.text,value:e,className:"app-action-row"},o.default.createElement("div",{className:"app-action-row-content"},o.default.createElement("img",{alt:"",src:l.static_url(t),className:n}),o.default.createElement("span",{className:"app-action-legacy-option-text"},e.text)))}Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o),d=n.__importDefault(d),x.getStore();var N=(function(e){function t(t){var o=e.call(this,t)||this;return o.setActionMenuRef=function(e){o.actionMenuContent=e},o.handleClickShare=function(e){e.preventDefault(),o.props.onShowShare(),o.currentSession&&o.currentSession.event("click_share",{trigger_type:o.props.triggerType}),e.stopPropagation()},o.handleSelectAction=function(e,t){t.preventDefault(),e.handler(),o.currentSession&&o.currentSession.event("select_action",{type:e.type,trigger_type:o.props.triggerType}),t.stopPropagation()},o.handlePreventMouseDown=function(e){e.preventDefault(),o.state.tooltipState===_.TooltipState.BIG_ONBOARDING_TOOLTIP&&(o.markSplitShareTooltipViewed(),o.setState({tooltipState:_.TooltipState.NO_TOOLTIP})),e.stopPropagation()},o.handlePopoverHover=function(){o.currentSession&&o.currentSession.event("popover_trigger_hover",{trigger_type:o.props.triggerType})},o.handleShareHover=function(){o.currentSession&&o.currentSession.event("share_hover",{trigger_type:o.props.triggerType})},o.handlePopoverToggle=function(e){var t=e.isOpen;o.props.onDropdownOpen&&o.props.onDropdownClose&&(t?o.props.onDropdownOpen():o.props.onDropdownClose()),o.currentSession&&o.currentSession.event(t?"open_popover":"close_popover",{trigger_type:o.props.triggerType})},o.handlePresentInZoom=function(e){var t=o.props,n=t.refreshSharingServiceInfo,r=t.sharingServiceInfo,i=t.onPresentInZoom,a=t.landingPageEnabled;r&&n&&i&&v.presentInZoomFlow(e,r,n,i,"split_share_button",a)},o.handleShareInSlack=function(e,t){var n=o.props,r=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,a=n.landingPageEnabled;i&&r&&v.shareInSlackFlow(t,i,r,e,"split_share_button",a)},o.handleShareToTrello=function(e,t){var n=o.props,r=n.refreshSharingServiceInfo,i=n.sharingServiceInfo,a=n.landingPageEnabled;i&&r&&v.shareInTrelloFlow(t,i,r,e,"split_share_button",a)},o.markSplitShareTooltipViewed=function(){f.markTooltipViewed(o.props.user.id,"split_share_edu")},o.state={tooltipState:_.TooltipState.NO_TOOLTIP},o.telemetryClient=s.createTelemetryClient(n.__assign({component:"split-share-btn"},t.context)),o}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.showEduTooltip&&this.setEduTooltip()},t.prototype.setEduTooltip=function(){return n.__awaiter(this,void 0,void 0,function(){var e,t,o;return n.__generator(this,function(n){switch(n.label){case 0:return[4,f.getTooltipHistory(this.props.user.id,["open_with_edu","split_share_edu"])];case 1:return e=n.sent(),t=S.allowedTooltipsForConfig(this.props.extensionsConfig,this.props.file.fq_path?"."+A.file_extension(A.filename(this.props.file.fq_path)):""),o=t.find(function(t){return void 0!==e[t]&&!e[t]}),"split_share_edu"===o&&this.setState({tooltipState:_.TooltipState.BIG_ONBOARDING_TOOLTIP}),[2]}})})},t.prototype.getSplitShareOptions=function(e,t){var n=this,o=this.props,r=o.featureFlags,a=o.onPresentInZoom,s=o.refreshSharingServiceInfo,l=o.sharingServiceInfo,u=[];if(r.expSplitShareBtn&&"ON_SHOW_INVITE"===r.expSplitShareBtn&&u.push({handler:this.props.onShowShare,spriteName:null,text:i._("Invite via email"),type:p.OpenButtonAction.INVITE_VIA_EMAIL,userAction:c.UserAction.InviteViaEmail}),!l)return u;m.isSlackAvailable(l)&&!e.is_dir&&u.push({handler:function(){return n.handleShareInSlack(e,t)},spriteName:null,text:i._("Share in Slack"),type:p.OpenButtonAction.SHARE_TO_SLACK,userAction:c.UserAction.ShareToSlack}),m.isTrelloAvailable(l)&&u.push({handler:function(){return n.handleShareToTrello(e,t)},spriteName:null,text:i._("Add to Trello"),type:p.OpenButtonAction.SHARE_TO_TRELLO,userAction:c.UserAction.ShareToTrello});var h=!(e.type!==E.FileTypes.FILE&&e.file_type!==E.FileTypes.FILE||e.is_cloud_doc||e.is_symlink);return m.isZoomAvailable(l)&&a&&s&&h&&!e.is_dir&&u.push({handler:function(){return n.handlePresentInZoom(t)},spriteName:null,text:i._("Present in Zoom"),type:p.OpenButtonAction.PRESENT_IN_ZOOM,userAction:c.UserAction.PresentInZoom}),u},t.prototype.getButtonVariant=function(){var e=this.props,t=e.isVisible,n=e.variant;return n&&t?n:"invisible"},t.prototype.renderActions=function(){var e=this.props,t=e.user,n=e.file,r=[];return this.getSplitShareOptions(n,t).forEach(function(e){switch(e.type){case p.OpenButtonAction.INVITE_VIA_EMAIL:r.push(w(e,"/static/images/extensions/shared_small-vflTdrLa9.svg"));break;case p.OpenButtonAction.SHARE_TO_SLACK:r.push(w(e,"/static/images/thirdparty/slack_icon_circle-vfl4S6f-q.svg"));break;case p.OpenButtonAction.PRESENT_IN_ZOOM:r.push(w(e,"/static/images/thirdparty/zoom_icon_transparent_background-vflJC8HYC.svg"));break;case p.OpenButtonAction.SHARE_TO_TRELLO:r.push(w(e,"/static/images/thirdparty/trello_icon-vfl-FetdA.svg"))}}),o.default.createElement(a.PopoverContent,{position:"below",attachment:"right"},r)},t.prototype.render=function(){var e=this.props,t=e.file,n=e.context,l=e.isVisible,p=e.shareButtonLabel,c=e.triggerType,u=e.isCollapsed,f=this.props.sharingServiceInfo&&m.shouldShowSplitShare(this.props.featureFlags,this.props.sharingServiceInfo,t);n?this.currentSession=this.telemetryClient.session({ext:s.getPiiSafeExtension(t?"."+A.file_extension(A.filename(t.fq_path)):"")}):delete this.currentSession;var S=d.default({"primary-action-menu__button":c===h.TriggerType.SidebarPrimaryButton,"extensions-inline-share-button":!0}),v=d.default({"primary-action-menu__button":c===h.TriggerType.SidebarPrimaryButton,"action-share":!0}),I=o.default.createElement(r.Button,{"aria-label":p,className:f?S:v,onClick:this.handleClickShare,tabIndex:l?void 0:-1,variant:this.getButtonVariant(),onMouseEnter:this.handleShareHover},p),T=f?o.default.createElement(a.Popover,{className:"extensions-split-share__popover",onClick:this.handlePreventMouseDown,onDoubleClick:this.handlePreventMouseDown,onSelection:this.handleSelectAction,onMenuToggle:this.handlePopoverToggle,closeOnSelection:!0},o.default.createElement(a.PopoverTrigger,null,o.default.createElement(r.Button,{className:d.default("extensions-split-share-menu__trigger",{"extensions-split-share-menu__trigger--collapsed":u}),tagName:"span",tabIndex:l?void 0:-1,variant:this.getButtonVariant(),onMouseEnter:this.handlePopoverHover,"aria-label":i._("Expand share menu")},u?o.default.createElement(O.ButtonIcon,{isPrimary:"primary"===this.getButtonVariant(),name:"share","aria-label":p}):"â–¾")),this.renderActions()):null;return o.default.createElement("div",{className:d.default("extensions-split-share-btn",{"extensions-split-share-btn--invisible":!l,"slack-zoom-available":this.props.sharingServiceInfo&&m.isSlackAvailable(this.props.sharingServiceInfo)&&m.isZoomAvailable(this.props.sharingServiceInfo)}),ref:this.setActionMenuRef},u?null:I,T,this.state.tooltipState!==_.TooltipState.BIG_ONBOARDING_TOOLTIP||P.isPromptCalloutEnabled()?null:o.default.createElement(g.ExtensionsTooltip,{userId:this.props.user.id,targetNode:this.actionMenuContent,logHistory:this.markSplitShareTooltipViewed,title:i._("New ways to share"),message:i._("Now you can send files to Slack or present in Zoom without leaving Dropbox.")}))},t.defaultProps={isVisible:!0,shareButtonLabel:i._("Share"),triggerType:h.TriggerType.PrimaryButton,variant:"secondary"},t})(o.default.Component);t.SplitShareButtonComponent=N;var B=function(e,t){return{extensionsConfig:I.getConfigForFileId(e,t.file.file_id),featureFlags:I.getFeatureFlags(e),sharingServiceInfo:I.getSharingServiceInfoAdapter(e),landingPageEnabled:b.isConnectServiceLandingPagesEnabled(e)}},C={refreshSharingServiceInfo:T.refreshSharingServiceInfoAdapter},k=y.connect(B,C)(N);t.SplitShareButton=u.requireCssWithComponent(k,["/static/css/extensions/index-vflpHxfDW.css","/static/css/app-actions/index.css"])});
//# sourceMappingURL=split_share_button_component.min.js-vflmTEV2p.map