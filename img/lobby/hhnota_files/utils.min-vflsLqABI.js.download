define(["require","exports","tslib","modules/clean/react/file_transfers/lib/api","external/lodash","modules/clean/display_format","modules/clean/react/file_transfers/redux/types","modules/clean/react/file_transfers/constants","modules/clean/filepath","modules/clean/uuid","modules/core/i18n","file-transfers/common/constants","file-transfers/common/types"],function(e,t,n,r,o,a,i,l,s,u,c,f,d){"use strict";function m(e){void 0===e&&(e=8);for(var t=[];t.length<e;)t.push("â€¢");return t.join("")}function p(e){return{recipient:{".tag":"email_address",email_address:e.email}}}function h(e,t){return void 0===t&&(t={}),void 0===t.numDecimalPlaces&&(e<a.SWITCH_UNIT_THRESHOLD*f.BYTES_IN_KILOBYTE?t.numDecimalPlaces=0:e<a.SWITCH_UNIT_THRESHOLD*f.BYTES_IN_MEGABYTE?t.numDecimalPlaces=1:t.numDecimalPlaces=2),a.format_bytes(e,t.numDecimalPlaces,t.includeSpace,t.lazy,t.allowNegative)}function g(e){return l.VALID_EMAIL_REGEX.test(e.email)}function S(e){var t=_(e);t?D(e,t+1):D(e,1)}function _(e){var t=localStorage.getItem(e);return null===t?null:parseInt(t,10)}function v(e){var t=localStorage.getItem(e);return null===t?null:"true"===t}function D(e,t){localStorage.setItem(e,t.toString())}function T(){return null!==localStorage.getItem("dismissedGettingStartedCallout")}function y(){localStorage.setItem("dismissedGettingStartedCallout","true")}function E(e){return null!==sessionStorage.getItem("fileTransferAtLeastOneFileDownloaded:"+e)}function I(e){sessionStorage.setItem("fileTransferAtLeastOneFileDownloaded:"+e,"true")}function F(){return null!==localStorage.getItem("fileTransferEverSetBackground")}function C(){localStorage.setItem("fileTransferEverSetBackground","true")}function A(){return null!==localStorage.getItem("fileTransferHasEverSetLogo")}function w(){localStorage.setItem("fileTransferHasEverSetLogo","true")}function b(e){return L(e.summary_file_names,e.display_file_count)}function L(e,t){return 0===e.length?c._("Transfer with no items",{comment:"title of transfer when there are no files or folders in it"}):t<=1?c._("%(item_name)s",{comment:"Name of the first file or folder in a file transfer"}).format({item_name:e[0]}):c.ungettext("%(item_name)s + %(item_count)d more item","%(item_name)s + %(item_count)d more items",t-1,{comment:"Name of the first file or folder in a file transfer and how many others are in the transfer"}).format({item_name:e[0],item_count:t-1})}function U(e,t){return{id:u.UUID.v4(),isDir:!0,path:e,size:0,source:t,role:i.FileRole.Content,thumbnailUrl:null}}function N(e,t){return void 0===t&&(t=i.FileRole.Content),{id:e.transfer_file_id,isDir:e.obsolete_is_dir,path:e.relative_path,size:e.file_size,source:i.FileSource.Transfer,role:t,thumbnailUrl:e.thumbnail_url||null}}function k(e,t){var n=e.id,r=e.isDir,o=e.name,a=e.bytes;return void 0===t&&(t=i.FileRole.Content),{id:n,isDir:r,path:o,size:a,source:i.FileSource.Dropbox,role:t,thumbnailUrl:null}}function P(e,t){return void 0===t&&(t=i.FileRole.Content),{id:e.id,isDir:0===e.size,path:e.dest?e.dest:e.name,size:e.size,source:i.FileSource.Computer,role:t,thumbnailUrl:null}}function x(e,t){return void 0===t&&(t=i.FileRole.Content),{path:e.name,id:e.name,size:e.size||0,isDir:!1,source:i.FileSource.Computer,thumbnailUrl:null,role:t}}function O(e,t){return void 0===t&&(t={}),n.__assign({id:e.id,isDir:e.isDir,name:e.path,size:e.size,thumbnailUrl:e.thumbnailUrl},t)}function B(e){return e.reduce(function(e,t){return e+t.size},0)}function R(e){return{id:u.UUID.v4(),isDir:!0,path:e.fullPath?e.fullPath.substring(1):e.name,size:0,source:i.FileSource.Computer,role:i.FileRole.Content,thumbnailUrl:null}}function Y(e){return null===z(e)}function z(e){var t;if("dest"in e)t=e.dest;else if("fullPath"in e){if(!e.fullPath)return null;t=e.fullPath,"/"===t.charAt(0)&&(t=e.fullPath.substring(1))}else{if(!("path"in e))throw new Error("file must be either PluploadFile, StateFileInfo, or FileSystemEntry");if(!e.path)return null;t=e.path}var n=t.split("/");return n.length<=1?null:n[0]}function V(e){return e?e:l.NULL_FILE_TRANSFER_KEY}function H(e){return e.isDir&&e.source===i.FileSource.Computer}function M(e,t){void 0===t&&(t={});for(var n=document.getElementsByName("file-downloads-iframe"),r=0,o=Array.from(n);r<o.length;r++){var a=o[r];a&&a.parentNode&&a.parentNode.removeChild(a)}var i=document.createElement("iframe");i.name="file-downloads-iframe",i.src="about:blank",i.setAttribute("style","display: none;"),document.body.appendChild(i);var l=i.contentDocument,s=l.createElement("form");s.action=e,s.method="post",Object.keys(t).forEach(function(e){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t[e],s.appendChild(n)}),l.body.appendChild(s),s.submit()}function K(e,t,o){return n.__awaiter(this,void 0,Promise,function(){var a;return n.__generator(this,function(n){return a=r.downloadFiles(t,e,o),a.then(function(e){var t=e.post_params?JSON.parse(e.post_params):{};M(e.url.toString(),t)}),a.catch(function(e){}),[2,a]})})}function G(e,t){void 0===t&&(t=[]);var r=[],o=[],a=new Set,i=new Set;return t.filter(function(e){return Y(e)}).forEach(function(e){a.add(e.id),i.add(e.path.toLowerCase())}),e.forEach(function(e){var t,l,u=s.split_filename(e.path);if(i.has(e.path.toLowerCase())){if(a.has(e.id))return;var c=1,f=void 0;do f=u.name+" ("+c+")",t=u.ext?f+"."+u.ext:f,c++;while(i.has(t.toLowerCase()));a.add(e.id),i.add(t.toLowerCase()),l=n.__assign({},e,{path:t}),r.push(l)}else Y(e)?(a.add(e.id),i.add(e.path.toLowerCase()),l=n.__assign({},e)):l=n.__assign({},e);o.push(l)}),{files:o,filesRenamed:r}}function W(e,n){return Math.floor((n.getTime()-e.getTime())/t.DAYS_IN_MS)}function j(e,t){var n=W(new Date(e.getFullYear(),e.getMonth(),e.getDate()),new Date(t.getFullYear(),t.getMonth(),t.getDate()));switch(n){case d.ExpirationOption.THREE_DAYS:case d.ExpirationOption.SEVEN_DAYS:case d.ExpirationOption.THIRTY_DAYS:case d.ExpirationOption.NINETY_DAYS:return n;default:return d.ExpirationOption.CUSTOM}}function q(e){switch(e){case i.UpsellVariant.TRY_PROFESSIONAL:return{productName:"Professional",ctaCopy:c._("Try Professional free",{comment:"text on a CTA button or a link for upselling. The CTA asks user to try using Dropbox Professional Individual Plan for free."}),ctaLink:"https://www.dropbox.com/pro/try"};case i.UpsellVariant.BUY_PROFESSIONAL:return{productName:"Professional",ctaCopy:c._("Try Professional",{comment:"text on a CTA button or a link for upselling. The CTA asks user to upgrade to Dropbox Professional Individual Plan."}),ctaLink:"https://www.dropbox.com/buy/professional"};case i.UpsellVariant.TRY_BUSINESS_ADVANCED:return{productName:"Advanced",ctaCopy:c._("Try Business Advanced free",{comment:"text on a CTA button or a link for upselling. The CTA asks user to try using Dropbox Advanced Business Plan for free."}),ctaLink:"https://www.dropbox.com/business/try"};case i.UpsellVariant.CONTACT_ADMIN:return{productName:"Advanced",ctaCopy:c._("Contact admin",{comment:"text on a CTA button or a link for upselling. The CTA asks user to contact their team admin."}),ctaLink:"https://www.dropbox.com/team#members"}}}function J(e){return e.value?e.value[".tag"]:"other"}function X(e){return function(t){return J(t)===e}}function Q(e){return!!e.color_hex&&!e.asset}function Z(e){return!!e.asset&&ie(e.asset)}function $(e){return!!e.asset&&le(e.asset)}function ee(e){return Z(e)?e.asset.value:null}function te(e){return $(e)?e.asset.value:null}function ne(){return u.UUID.v4()}function re(e,t){return t?o.filter(t,function(t){return t.status===e}).length:0}function oe(e,t){if(!e.isDir)throw Error("Can only get children of a directory");return t.filter(function(t){return t.path!==e.path&&t.path.startsWith(e.path+"/")})}function ae(e,t){return e.every(function(e){return t[e.id]&&t[e.id].status===i.UploadStatus.Success})}Object.defineProperty(t,"__esModule",{value:!0}),r=n.__importStar(r),t.constructPasswordDotsString=m,t.contactToFileTransfersEmailRecipient=p,t.formatBytes=h,t.hasValidEmail=g,t.incrementLocalStorageValueForKey=S,t.getLocalStorageNumberValueForKey=_,t.getLocalStorageBooleanValueForKey=v,t.setLocalStorageValueForKey=D,t.viewerDismissedGettingStartedCallout=T,t.onDismissGettingStartedCallout=y,t.hasAtLeastOneFileDownloaded=E,t.markAtLeastOneFileDownloaded=I;t.hasEverSetBackground=F,t.markHasEverSetBackground=C;t.hasEverSetLogo=A,t.markHasEverSetLogo=w,t.generateTransferSummaryTitle=b,t.generateTransferTitle=L,t.createDirectoryStateFileInfo=U,t.transferFileAsStateFileInfo=N,t.chooserFileAsStateFileInfo=k,t.pluploadFileAsStateFileInfo=P,t.fileAsStateFileInfo=x,t.stateFileInfoAsFileInfo=O,t.sumBytes=B,t.fileSystemDirectoryEntryAsStateFileInfo=R,t.isAtRoot=Y,t.getRootDirectory=z,t.getTransferFilesKey=V,t.isLocalDirectory=H,t.downloadFromUrl=M,t.downloadFiles=K,t.renameDuplicateFiles=G,t.DAYS_IN_MS=864e5,t.getDateDiff=W,t.estimateExpirationOption=j,t.getUpsellProps=q;var ie=X("image"),le=X("video");t.isColorBackground=Q,t.isImageBackground=Z,t.isVideoBackground=$,t.getImageBackgroundAsset=ee,t.getVideoBackgroundAsset=te,t.generateTransferTrackingId=ne,t.numWaiting=function(e){return re(i.UploadStatus.Waiting,e)},t.numSuccess=function(e){return re(i.UploadStatus.Success,e)},t.getChildrenFiles=oe,t.areItemsUploaded=ae});
//# sourceMappingURL=utils.min.js-vfloufiCB.map