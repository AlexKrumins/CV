define(["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/react/browse/models","modules/core/i18n","modules/clean/react/snackbar","modules/clean/components/modals/show_modal","modules/clean/react/file_lock/lock_confirm_modal","modules/clean/filepath"],function(e,n,o,t,i,s,r,c,a,l){"use strict";function u(){return s._("Unlocked editing. Any one else with access can edit again.",{comment:"Message shown when unlocking a file for editing from list on web"})}function f(e){return{entries:e.map(function(e){return{path:e.fq_path}})}}function m(e){return e.result.then(function(n){return n.entries&&n.entries[0]&&"success"===n.entries[0][".tag"]?(r.Snackbar.complete(e.onSuccessMsg(n),"file-lock-status"),Promise.resolve()):Promise.reject()}).catch(function(){r.Snackbar.fail(e.onFailMsg,"file-lock-status")})}function d(e,n){return o.__awaiter(this,void 0,void 0,function(){var i,r;return o.__generator(this,function(o){switch(o.label){case 0:return i=new t.UserApiV2Client,r=i.ns("files").rpc("lock_file_batch",f(n),{subjectUserId:e}),[4,m({result:r,onSuccessMsg:function(e){return s._("Editing locked. Now only you can make changes.",{comment:"Message shown when locking a file for editing from list on web"})},onFailMsg:s._("Locking editing failed.",{comment:"Error message shown when locking a file for editing from list on web"})})];case 1:return o.sent(),[2]}})})}function g(e,n){return o.__awaiter(this,void 0,void 0,function(){var i,r;return o.__generator(this,function(o){switch(o.label){case 0:return i=new t.UserApiV2Client,r=i.ns("files").rpc("unlock_file_batch",f(n),{subjectUserId:e}),[4,m({result:r,onSuccessMsg:function(e){return u()},onFailMsg:s._("Unlocking editing failed.",{comment:"Error message shown when unlocking a file for editing from list on web"})})];case 1:return o.sent(),[2]}})})}function h(e,n){return o.__awaiter(this,void 0,void 0,function(){var r,c,a,l;return o.__generator(this,function(o){switch(o.label){case 0:return r=i.File.getFilename(n[0]),c=n[0].lockholder_name,a=new t.UserApiV2Client,l=a.ns("files").rpc("request_unlock_file_batch",f(n),{subjectUserId:e}),[4,m({result:l,onSuccessMsg:function(e){var n=e.entries[0];return n.lock&&n.lock.content&&"unlocked"===n.lock.content[".tag"]?u():s._("Asked %(name)s to unlock %(filename)s",{comment:"Message shown when requesting an unlock of a file from another user on web"}).format({filename:r,name:c})},onFailMsg:s._("Error asking %(name)s to unlock %(filename)s",{comment:"Error message shown when requesting an unlock of a file from another user on web"}).format({filename:r,name:c})})];case 1:return o.sent(),[2]}})})}function _(e,n){c.showModal(a.FileLockConfirmModal({filename:l.filename(n.fq_path),onLock:function(){d(e,[n])}}))}Object.defineProperty(n,"__esModule",{value:!0}),l=o.__importStar(l),n.asyncLockFile=d,n.asyncUnlockFile=g,n.asyncRequestUnlockFile=h,n.showFileLockConfirmModal=_});
//# sourceMappingURL=api.min.js-vflYAfPig.map