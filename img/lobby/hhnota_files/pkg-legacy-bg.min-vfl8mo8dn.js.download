define("modules/clean/animation",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quadraticBezierPointsAtPercent=function(e,t,r,n){return{x:Math.pow(1-n,2)*e.x+2*(1-n)*n*t.x+Math.pow(n,2)*r.x,y:Math.pow(1-n,2)*e.y+2*(1-n)*n*t.y+Math.pow(n,2)*r.y}};var r=(function(){function e(e,t){var r=this;this.start=function(){r.isRunning=!0;var e=r.thunk,t=r.fps,n=-1,o=-1,i=1e3/t,s=function(e,t){var r=Date.now(),n=r-(t||0);return n>i&&(e(),t=r-n%i),o=requestAnimationFrame(function(){return s(e,t)})};n=requestAnimationFrame(function(){return s(e)}),r.cleanup=function(){cancelAnimationFrame(n),cancelAnimationFrame(o)}},this.stop=function(){r.isRunning=!1,r.cleanup()},this.thunk=e,this.fps=t,this.cleanup=function(){},this.isRunning=!1}return e})();t.RenderAtFps=r}),define("modules/clean/invitations",["require","exports","tslib","modules/core/notify","modules/clean/ajax","modules/core/exception","modules/core/i18n"],function(e,t,r,n,o,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),i=r.__importStar(i),t.SendInvitations=function(e,t,r,a,c){if(!(e.trim().split("/[;,s]+/").length&&""!==e.trim()||t&&""!==t.trim()))return void n.Notify.error(s._("Please choose at least one contact."));var l={emails:e,referral_src:a};void 0!==t&&null!==t&&t&&void 0!==r&&null!==r&&(l.fb_ids=t,l.fb_link=r);var u="/send_invite";return o.WebRequest({url:u,type:"POST",data:l,success:function(e){c?c(e.substr(5)):n.Notify.success(e.substr(5))},error:function(e){if(200!==e.status)return n.Notify.error(s._("There was a problem completing this request.")),i.reportStack("The server communicated a status of "+e.status+" when posting to "+u+" with an\n          error message of "+e.statusText,{severity:i.SEVERITY.CRITICAL,tags:[""+e.status]})}}),!1}}),define("modules/clean/react/referrals/referrals_hero",["require","exports","tslib","react","modules/clean/animation"],function(e,t,r,n,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var i=(function(e){function t(t){var n=e.call(this,t)||this;return n.state=r.__assign({actors:[],canvas:null,ctx:null,end:0,fps:60,id:""},n.state),n.drawImage=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var o=new Image;e&&o.addEventListener("load",function(){e.drawImage(o,r,n)},!1),o.src=t},n.rocket=function(e){var t=0,r={x:e.start.x,y:e.start.y},i=new Image,s=0,a="up",c=function(){if(n.state.ctx&&n.state.canvas){n.state.ctx.clearRect(0,0,n.state.canvas.width,n.state.canvas.height);var e=r.x,t=r.y;s===2*n.state.fps&&(a="down"),0===s&&(a="up"),"down"===a?s--:s++,t+=.1*s,n.state.ctx.drawImage(i,e-75,t-75),setTimeout(function(){requestAnimationFrame(c)},1e3/n.state.fps)}},l=function(t){n.state.ctx&&n.state.canvas&&(n.state.ctx.clearRect(0,0,n.state.canvas.width,n.state.canvas.height),t<=n.state.end&&(r=o.quadraticBezierPointsAtPercent({x:e.start.x,y:e.start.y},{x:e.mid.x,y:e.mid.y},{x:e.end.x,y:e.end.y},t/100),r.x=r.x+(2*Math.random()+1),n.state.ctx.drawImage(i,r.x-75,r.y-75)))},u=function(){t+=1.2,t>=n.state.end?setTimeout(function(){return c(),!1},750):(l(t),setTimeout(function(){requestAnimationFrame(u)},1e3/n.state.fps))};i.addEventListener("load",function(){u()},!1),i.src=e.path},n}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this,t={_rocket:this.rocket},r=document.getElementById(this.props.id),n=r&&r.getContext("2d")||null,o=this.props.actors.map(function(e){return JSON.parse(e)});this.setState({actors:o,currentBonus:this.props.currentBonus,maxBonus:this.props.maxBonus,canvas:r,ctx:n,end:this.props.currentBonus/this.props.maxBonus*100,fps:this.props.fps,id:this.props.id,static:this.props.static,staticHero:this.props.staticHero,endState:this.props.endState}),this.props.static?this.drawImage(n,this.props.staticHero,0,0):this.props.currentBonus<this.props.maxBonus?o.map(function(r){t[r.animationFunction]?t[r.animationFunction](r):e.drawImage(n,r.path,r.start.x,r.start.y)}):this.drawImage(n,this.props.endState,0,0)},t.prototype.render=function(){var e={};return!this.state.static&&this.state.currentBonus<this.state.maxBonus&&(e.backgroundImage="url("+this.props.stage+")"),n.default.createElement("canvas",{className:this.props.className,id:this.props.id,height:this.props.height,width:this.props.width,style:e})},t.defaultProps={actors:[],currentBonus:0,maxBonus:32,fps:60,id:"",height:313,width:864},t})(n.default.Component);t.ReferralsHero=i}),define("modules/clean/react/referrals/referrals_tokenizer",["require","exports","tslib","modules/core/i18n","modules/clean/react/button","modules/clean/account/email","modules/clean/contacts/tokenizer","modules/clean/account/email_verify_reasons","modules/clean/invitations","modules/core/notify","react","modules/clean/viewer"],function(e,t,r,n,o,i,s,a,c,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=r.__importStar(i),a=r.__importStar(a),u=r.__importDefault(u);var f=d.Viewer.get_viewer(),p=f.get_users()[0],h=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getTokenizerReference=function(e){t.tokenizerReference=e},t._onClick=function(){var e=t.tokenizerReference.getContacts().filter(function(e){return!e.invalid}).map(function(e){return e.email});return i.EmailVerification.get_for_user(p).verified_or_send_and_show(a.REFER_FRIENDS,c.SendInvitations(e.join(";"),"","","referrals_bulk9",function(e){l.Notify.success(e)}))},t}return r.__extends(t,e),t.prototype.render=function(){return u.default.createElement("div",{className:"tokenizer-container"},u.default.createElement("div",{className:"tokenizer-object"},u.default.createElement(s.ContactsTokenizer,{placeholder:n._("Names or email addresses"),ref:this.getTokenizerReference,user:p,showContactImport:!0,shouldLogContactSearch:!0,context:"referrals"})),u.default.createElement(o.Button,{className:"tokenizer-button",onClick:this._onClick},n._("Send")))},t})(u.default.Component);t.ReferralsTokenizer=h}),define("modules/clean/referral_contact_refresh",["require","exports","tslib","jquery","external/nouislider","modules/clean/ajax","modules/clean/dbmodal","modules/core/exception","modules/core/notify","modules/clean/viewer","modules/core/i18n","modules/clean/invitations","modules/clean/analytics"],function(e,t,r,n,o,i,s,a,c,l,u,d,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),o=r.__importStar(o),i=r.__importStar(i),s=r.__importStar(s),a=r.__importStar(a);var p=(function(){function e(e,t,r,p){var h=this;this.get_selected_emails=function(){var e=n.default("#contact-list input:checked.email"),t=[];return e&&(t=n.default.map(e,function(e){return n.default(e).val()})),t},this.get_selected_fb_contacts=function(){var e=n.default("#contact-list input:checked.fb"),t=[];return e&&(t=n.default.map(e,function(e){return n.default(e).val()})),t},this.show_contact_list_modal=function(){n.default("#contact-list").empty(),n.default("#free-space-slider").hide(),n.default("#select-contacts-submit-button").text(u._("Invite friends")),n.default("#contact-import-spinner").show(),new s.DBModal({element_id:"select-contacts-modal",title:u._("Invite friends and family to Dropbox!")}).show();var e="/contacts/get_imported_checklist";return i.WebProgressRequest({url:e,subject_user:l.Viewer.get_viewer().personal_user,success:function(e,t){n.default("#contact-list").html(e),h.show_contacts(),h.eventHandlers(),h.spaceSlider()},error:function(t){a.reportStack("The server communicated a status of "+t.status+" when retrieving data from "+e,{severity:a.SEVERITY.CRITICAL,tags:[""+t.status]}),h.show_contacts()}})},this.show_contacts=function(){n.default("#contact-import-spinner").hide(),0===n.default(".contact-row").length&&new s.DBModal({element_id:"no-contact-list-modal",title:u._("Oops! No contacts here.")}).show(),l.Viewer.get_viewer().team_id||n.default("#free-space-slider").show(),h.contactRows=n.default("#contact-list .contact-row");for(var e=0,t=h.contactRows.length;e<t;e++){var r=h.contactRows[e];r.search_text=n.default(r).find(".contact-name").first().html()+n.default(r).find(".contact-email").first().html()}h.update_invite_count(),h.select_all(!0),h.select_first(24)},this.select_first=function(e){n.default("#contact-list input.email").not(":disabled").slice(0,e).prop("checked",!0),h.update_invite_count()},this.select_all=function(e){h.selectAllActive=!e&&!h.selectAllActive;var t=h.selectAllActive?u._("Select None"):u._("Select All");if(n.default("#contact-select-all").text(t),!e){var r=n.default("#contact-list input.email:visible").not(":disabled");h.selectAllActive&&(r=r.slice(0,450)),r.each(function(e,t){n.default(t).prop("checked",h.selectAllActive)}),h.update_invite_count()}},this.update_invite_count=function(){var e,t=n.default(".contact-row").removeClass("selected").has("input:checked").addClass("selected"),r=t.length,o=Math.min(r*h.bonusPerReferral,h.maxReferralBonus),i=document.getElementById("free-space-slider-track");if(i&&i.noUiSlider){var s=o||0;i.noUiSlider.set(s);var a=n.default("#free-space-slider-track .noUi-handle");a.css("margin-left",-a.outerWidth()*s/h.maxReferralBonus+"px");var c=s/h.maxReferralBonus*100+"%";a.css("left",c)}n.default("#free-space-slider-track .noUi-handle").text(u._("%(potential_gb)f GB").format({potential_gb:o})),e=r?u.ungettext("Invite %(count)d friend","Invite %(count)d friends",r,{comment:"Button"}).format({count:r}):u._("Invite friends",{comment:"Button"}),n.default("#select-contacts-submit-button").text(e)},this.filter=function(e){if(e!==h.lastSearch&&(null!=h.lastSearch||""!==e)){h.lastSearch=e,(null!=h.lastSearch?h.lastSearch.length:void 0)?n.default("#contact-list .contact-header").hide():n.default("#contact-list .contact-header").show();for(var t=0,r=new RegExp(e.trim().split(/[;,\s]+/).join(".*"),"i"),o=0,i=h.contactRows.length;o<i;o++){var s=h.contactRows[o],a=s.style;s.search_text&&(r.test(s.search_text)?(t+=1,a.display=""):a.display="none")}h.select_all(!0);var c=function(){if(h.lastSearch===e)return f.WebMiscActivityLogger.log("contact_list_search",{search_string:e,rows_shown:t})};setTimeout(c,500),h.update_invite_count()}},this.eventHandlers=function(){return n.default("#contact-filter").on("change",function(e){return h.filter(n.default("#contact-filter").val())}),n.default("#select-contacts-submit-button").on("click",function(){var e=h.get_selected_emails().join(";"),t=h.get_selected_fb_contacts().join(";");d.SendInvitations(e,t,h.fbUrl,h.referralTypeBulk,function(e){c.Notify.success(e)})}),h.selectAllActive=!1,n.default("#contact-select-all").on("click",function(e){e.preventDefault(),h.select_all(!1)}),n.default("#contact-list").on("change",function(){if(h.update_invite_count(),null!=h.lastSearch?h.lastSearch.length:void 0)return f.WebMiscActivityLogger.log("contact_list_search",{search_string:h.lastSearch,clicked:1})})},this.spaceSlider=function(){var e=document.getElementById("free-space-slider-track"),t=h.maxReferralBonus,r=h.bonusPerReferral;e&&(o.create(e,{start:[0],range:{min:[0],max:[t]},step:r,connect:!0}),e.setAttribute("disabled","true")),h.update_invite_count()},this.bonusPerReferral=e,this.maxReferralBonus=t,this.referralTypeBulk=r,this.fbUrl=p}return e})();t.ReferralContactList=p}),define("modules/clean/referral_refresh",["require","exports","tslib","jquery","modules/clean/dbmodal","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/core/exception","modules/core/notify","modules/clean/profile_services/profile_services_constants","modules/clean/social_share_dialog","modules/clean/viewer","modules/core/i18n","modules/clean/analytics","modules/clean/profile_services/profile_services_link","modules/clean/referral_contact_refresh"],function(e,t,r,n,o,i,s,a,c,l,u,d,f,p,h,m){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),o=r.__importStar(o),i=r.__importStar(i),s=r.__importStar(s),a=r.__importStar(a),l=r.__importDefault(l),u=r.__importDefault(u);var _=(function(){function e(e,t,r,_){var v=this;this.fbURL=e,this.referralTypeBulk=t,this.bonusPerReferral=r,this.maxReferralBonus=_,this.eventHandlers=function(){var e=new o.DBModal({element_id:"copy-link-modal"});n.default("#copy-link--button").on("click",function(t){t.preventDefault(),e.show(),n.default("#global-referral-link").select()})},this.facebookShare=function(){new u.default(".facebook-button",function(){p.WebMiscActivityLogger.log("refer_click_facebook_button")})},this.initBulkInvite=function(){var e=new h.ProfileServicesLinkingHandler,t=new m.ReferralContactList(v.bonusPerReferral,v.maxReferralBonus,v.referralTypeBulk,v.fbURL),r=function(e){if(h.ProfileServicesLinkingHandler.show_import_notifications(e),e.success)return e.verified_profile_email?t.show_contact_list_modal():i.EmailVerification.get_for_user(v.user).verified_or_send_and_show(s.REFER_FRIENDS,t.show_contact_list_modal);a.reportStack("There has been an error connecting to "+v.referralTypeBulk+" from /referrals and\n          retrieving contact information.",{severity:a.SEVERITY.NONCRITICAL,tags:[v.referralTypeBulk+" import error"]});var r=f._("There has been an error connecting to %(referral_type)s").format({referral_type:v.referralTypeBulk});return void c.Notify.error(r)};n.default(".import-yahoo-contacts").on("click",function(){return v.user?e.auth_service_with_user(l.default.YAHOO,v.user.id,function(e){return r(e)},"contact-imported-modal"):void 0}),n.default(".import-gmail-contacts").on("click",function(){return v.user?e.auth_service_with_user(l.default.GOOGLE,v.user.id,function(e){return r(e)},"contact-import-modal"):void 0})},this.user=d.Viewer.get_viewer().personal_user,this.eventHandlers(),this.facebookShare(),this.initBulkInvite()}return e})();t.ReferralsPage=_}),define("modules/clean/social_share_dialog",["require","exports","tslib","jquery"],function(e,t,r,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n);var o=(function(){function e(e,t){n.default(e).on("click",function(e){e.preventDefault(),t&&t(),window.open(n.default(this).data("social-href")||n.default(this).attr("href"),"db_share_modal","width=600,height=440,top=400,left=400,resizable,scrollbars=yes,status=1")})}return e})();t.default=o}),define("modules/clean/upsell/targeted_bubble",["require","exports","tslib","jquery","modules/clean/animation","modules/clean/upsell/exception","modules/clean/upsell/upsell_controller"],function(e,t,r,n,o,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importDefault(n),i=r.__importStar(i),s=r.__importDefault(s);var a={left:-20,top:-39},c=(function(){function e(e,t){this.setupControlsAndPositionBubble=this.setupControlsAndPositionBubble.bind(this),this.options=t;try{this._constructor(e)}catch(e){i.reportJsControllerException({err:e,js_controller_options:this.options})}}return e.prototype._constructor=function(e){var t=this;return this.repositioner=null,e.find(".confirm-button, .dismiss-button").toggleClass("small-margin",!this.options.hasImage),this.options.isPreview?void e.addClass("active static"):this.waitForElement(this.options.targetSelector,function(r){return t.setupControlsAndPositionBubble(e,r)})},e.prototype.waitForElement=function(e,t,r){var o=this;void 0===r&&(r=Date.now());var i=n.default(e).first();return i.length>0&&i.is(":visible")?void t(i):setTimeout(function(){return o.waitForElement(e,t,r)},200)},e.prototype.isTargetFixed=function(e){return e.parents().filter(function(){return"fixed"===n.default(this).css("position")}).length>0},e.prototype.setupControlsAndPositionBubble=function(e,t){var r,i,a=this,c=e.find(".targeted-bubble"),l=c.find(".confirm-button").add(t),u=c.find(".dismiss-button");this.options.hasBackdrop&&(r=this.setupAndPositionBackdrop(e,t),l=l.add(r.backdropHole),u=u.add(r.backdrop)),new s.default(l,u,this.options).log_impression(),e.addClass("active");var d=l.add(u);d.on("click",i=function(t){null!=a.repositioner&&a.repositioner.stop(),d.off("click",i),e.removeClass("active"),null!=r&&r.backdrop.remove(),"#"===n.default(t.currentTarget).attr("href")&&t.preventDefault()});var f=t;this.options.hasBackdrop&&(f=r.backdropHole),e.css("zIndex",this._elementZIndex(f)+1);var p=function(){return a.positionBubbleAbsolute(e,c,f)};if(p(),!this.options.hasBackdrop)return this.repositioner=new o.RenderAtFps(p,60),this.repositioner.start()},e.prototype._elementZIndex=function(e){for(;e.length&&e[0]!==document;){var t=e.css("position");if(["absolute","relative","fixed"].includes(t)){var r=parseInt(e.css("zIndex"),10);if(!isNaN(r)&&0!==r)return r}e=e.parent()}return 0},e.prototype._elementDocumentRelativeRect=function(e){var t=e.getBoundingClientRect(),r=window.pageXOffset,n=window.pageYOffset;return{top:t.top+n,left:t.left+r,width:t.width,height:t.height}},e.prototype.positionBubbleAbsolute=function(e,t,r){var o=this;if(this.options.hasBackdrop||(r=n.default(this.options.targetSelector).first()),!document.body.contains(r[0]))return e.removeClass("active"),void(null!=this.repositioner&&this.repositioner.stop());var i=this._elementDocumentRelativeRect(r[0]),s=a.top+i.top+Math.floor(i.height/2),c=e.outerHeight(),l=n.default(window).height();if(s+c-window.pageYOffset>l){var u=s-c-2*a.top;u>0?(s=u,t.addClass("bottom-relative")):t.removeClass("bottom-relative")}else t.removeClass("bottom-relative");var d=(function(){if(o.options.placementLeft){var t=e.outerWidth();return a.left-t+i.left}return-a.left+i.width+i.left})();return e.css({top:s,left:d})},e.prototype.positionBubbleRelative=function(e,t,r){var o=this.options.placementLeft?a.left-t.outerWidth():r.outerWidth()-a.left,i=a.top+Math.floor(r.outerHeight()/2);i+=(parseInt(r.css("top"))||0)+parseInt(r.css("marginTop")),o+=(parseInt(r.css("left"))||0)+parseInt(r.css("marginLeft")),r.wrap(n.default("<div></div>"));var s=r.parent();return s.css({position:"relative",float:r.css("float"),display:r.css("display")}),r.parents().filter(function(){return"hidden"===n.default(this).css("overflow")}).css("overflow","visible"),e.detach().css({top:i,left:o}).appendTo(s)},e.prototype.setupAndPositionBackdrop=function(e,t){n.default(".targeted-bubble-backdrop__hole, .targeted-bubble-backdrop").remove();var r=n.default("<div></div>").addClass("targeted-bubble-backdrop__hole"),o=n.default("<div></div>").addClass("targeted-bubble-backdrop").append(r);n.default("#prompt-silo").append(o);var i=this.options.color||"rgba(0, 0, 0, 0.6)",s=t.offset();return r.css({boxShadow:i+" 0 0 0 30000px, inset 0 0 0 #111",width:t.outerWidth(),height:t.outerHeight(),position:this.isTargetFixed(t)?"fixed":"absolute",cursor:t.css("cursor")}),r.offset(s),{backdrop:o,backdropHole:r}},e})();t.default=c});
//# sourceMappingURL=pkg-legacy-bg.min.js-vfluiX4WH.map