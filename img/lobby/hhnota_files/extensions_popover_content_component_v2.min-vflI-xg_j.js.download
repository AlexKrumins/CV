define(["require","exports","tslib","react","modules/core/i18n","modules/clean/react/css","spectrum/popover","modules/clean/static_urls","modules/clean/react/app_actions/redirect","modules/clean/react/file_viewer/unity/with_unity","modules/clean/react/file_viewer/constants","modules/clean/react/app_actions/byline","modules/clean/react/extensions/unity_and_cloud_editors","modules/clean/react/extensions/common","modules/clean/file_store/utils","spectrum/icon_action","modules/clean/react/extensions/data/helpers","modules/clean/react/extensions/extensions_scaling_modal","modules/clean/react/file_viewer/open_button/types","modules/clean/react/extensions/cloud_docs_compat"],function(e,t,n,o,a,r,i,c,l,s,p,u,d,m,f,_,v,g,E,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=n.__importDefault(o);var h=(function(e){function t(t){var n=e.call(this,t)||this;return n.createAppActionClickHandler=function(e){return function(){var t=n.props,o=t.file,a=t.user,r=t.featureFlags,i=t.telemetryContext,c=t.updateLinkState;if(l.redirectToActionOrShowAuth(a,o,e,r,i,c),"redirect"===e.handler[".tag"])m.logEvent(n.props.currentSession,"select_action",{action_id:e.id,encoded_app_id:e.app_id,menu_version:2});else if("cloud_editor"===e.handler[".tag"]){var s=y.isWopiAction(e)?E.OpenButtonAction.OPEN_WITH:E.OpenButtonAction.OPEN_WITH_CLOUD_DOC;m.logEvent(n.props.currentSession,"select_legacy_action",{type:s})}}},n.wrapperForAction=function(e){return{appAction:e,handler:n.createAppActionClickHandler(e),userAction:p.UserAction.OpenWithAppAction,actionName:e.description}},n.handleImgLoadError=function(){n.props.refreshAppIcons&&n.props.refreshAppIcons({user:n.props.user})},n.renderActionRow=function(e){var t=n.props,a=t.appIcons,r=t.categoryIdToInfos,l=t.bylines,s=t.featureFlags,p=t.currentSession,d=e.icon;void 0!==e.app_id&&(d=a[e.app_id]||d);var f,_=r[e.category];f=d.is_static?c.static_url("/static/images/generic_app_icon-vflIPYT1H.png"):d.url;var v="V1"===s.expMenuScaling?e.description:_.display_name,g="V1"===s.expMenuScaling?_.display_name:e.description,E=o.default.createElement(i.PopoverContentItem,{className:"app-action-row",key:e.id,value:n.wrapperForAction(e)},o.default.createElement("div",null,o.default.createElement("div",{className:"app-action-row-content"},o.default.createElement("img",{className:"app-action-popover-icon",src:f,alt:"",onError:n.handleImgLoadError}),o.default.createElement("div",{className:"app-action-popover-item-info"},v)),o.default.createElement("div",{className:"app-action__inline-value-description"},g)));return o.default.createElement(u.ExtensionsBylineTooltip,{bylines:void 0!==e.app_id?l[e.app_id]:void 0,onDidShow:m.handleShowByline(e.app_id,p)},E)},n.renderDownload=function(e){var t=n.props.telemetryContext;return t&&"previews"===t.surface?o.default.createElement(i.PopoverItemGroup,{className:"app-action-category-group",key:"download"},o.default.createElement(i.PopoverContentItem,{key:"download",value:e,className:"app-action-row"},o.default.createElement("div",{className:"app-action-row-content"},o.default.createElement(_.IconAction,{className:"app-action-popover-icon-svg",name:"download"}),o.default.createElement("span",{className:"app-action-legacy-option-text"},a._("Download"))))):null},n}return n.__extends(t,e),t.prototype.render=function(){var e=this,t=this.props,n=t.user,r=t.file,c=t.appActions,l=t.openOptions,s=t.bylines,p=t.categoryIdToInfos,u=t.featureFlags,f=t.currentSession,_=t.telemetryContext,E=t.updateLinkState,y=m.getOpenOptionsWithLogging(l,f),h=v.partitionOptions(y),A=h.unityOptions,w=h.cloudEditorOptions,N=h.downloadOption,I=v.partitionActions(c),S=I.cloudEditors,x=I.installedActions,O=I.promotedActions,P=O.slice(0,5),C=P.length!==O.length,k="V1"===u.expMenuScaling?a._("APPS"):a._("ACTIONS"),T="V1"===u.expMenuScaling?a._("MORE APPS"):a._("MORE ACTIONS");return o.default.createElement("div",null,o.default.createElement(d.UnityAndCloudEditors,{unityOptions:A,legacyCloudEditorOptions:w,cloudEditorAppActions:S.map(function(t){return e.wrapperForAction(t)}),bylines:s,currentSession:f}),x.length>0&&o.default.createElement(i.PopoverItemGroup,{className:"app-action-category-group",key:"installed-actions"},x.map(function(t){return e.renderActionRow(t)}),o.default.createElement(i.PopoverItemGroupSeparator,{className:"app-action-menu-separator"})),P.length>0&&o.default.createElement(i.PopoverItemGroup,{className:"app-action-category-group",key:"promoted-actions"},o.default.createElement(i.PopoverItemGroupTitle,{className:"app-action-category-title"},0===x.length?k:T),P.map(function(t){return e.renderActionRow(t)}),C&&o.default.createElement(i.PopoverContentItem,{key:a._("Show more"),value:{handler:function(){g.showExtensionsScalingModal(n,r,c,p,u,E,_,f),m.logEvent(f,"select_show_more",{surface:_&&_.surface})}},className:"app-action-row"},o.default.createElement("div",{className:"app-action-row-content"},o.default.createElement("span",{className:"app-action-popover-icon-svg"}),o.default.createElement("span",{className:"app-action-legacy-option-text"},a._("Show more")))),o.default.createElement(i.PopoverItemGroupSeparator,{className:"app-action-menu-separator"})),N&&this.renderDownload(N))},t})(o.default.Component);t.ExtensionsPopoverV2WithUnity=function(e){return f.isBrowseFile(e.file)?o.default.createElement(s.WithUnity,{file:e.file,user:e.user,render:function(t){return o.default.createElement(h,n.__assign({},e,{unityInfo:t}))}}):null},t.ExtensionsPopoverV2NoUnity=r.requireCssWithComponent(h,["/static/css/app_actions/index-vflP_P0Ft.css"])});
//# sourceMappingURL=extensions_popover_content_component_v2.min.js-vflLRjycL.map