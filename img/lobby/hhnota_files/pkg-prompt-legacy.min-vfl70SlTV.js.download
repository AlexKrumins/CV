define("modules/clean/upsell/top_notification",["require","exports","tslib","jquery","modules/clean/top_notif","modules/clean/upsell/exception","modules/clean/upsell/top_notification_common","modules/clean/upsell/upsell_controller"],function(t,i,e,o,n,r,s,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),o=e.__importDefault(o),n=e.__importStar(n),r=e.__importStar(r),s=e.__importStar(s),a=e.__importDefault(a);var p=(function(){function t(t,i){this.options=i;try{this._constructor(t)}catch(t){r.reportJsControllerException({err:t,js_controller_options:this.options})}}return t.prototype._constructor=function(t){var i=this;o.default("#notify-wrapper").addClass("with-top-notification"),s.setTopNotificationClassOnBodyElement(),this.$top_notification_bar=o.default(t);var e=this.$top_notification_bar.find("a:not(.dismiss-button)");this.options.confirmInNewTab&&e.attr("target","_blank"),new a.default(e,this.$top_notification_bar.find(".dismiss-button"),this.options).log_impression(),a.default.register_custom_controller({on_confirm:this._on_acknowledge,on_dismiss:this._on_acknowledge}),this.$top_notification_bar.find("a").on("click",function(t){if(o.default(t.currentTarget).hasClass("top-notification-bar-dismiss")&&t.preventDefault(),!i.options.notDismissable)return n.TopNotificationBar.hide()})},t.prototype.unregister_custom_controller=function(){return a.default.unregister_custom_controller({on_confirm:this._on_acknowledge,on_dismiss:this._on_acknowledge})},t.prototype._on_acknowledge=function(t,i){},t})();i.default=p}),define("modules/clean/upsell/upsell_controller",["require","exports","tslib","jquery","modules/clean/ajax","modules/clean/upsell/exception","modules/clean/upsell/legacy_prompt_event_logging","modules/core/dom","modules/core/uri"],function(t,i,e,o,n,r,s,a,p){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),o=e.__importDefault(o),n=e.__importStar(n),r=e.__importStar(r),a=e.__importStar(a);var u=(function(){function t(i,e,n){var r=this;this._keydown=this._keydown.bind(this),this.dismiss=this.dismiss.bind(this),this.confirm=this.confirm.bind(this),this.post_dismiss=this.post_dismiss.bind(this),this.post_confirm=this.post_confirm.bind(this),this.options=n,i.length>0&&i.one("click",function(t){return r.confirm(t)}),e.length>0&&e.one("click",function(t){var i=o.default(t.target).hasClass("remind-me-later");return r.dismiss(t,i)}),this.options.dismissWithKeys&&o.default(document).on("keydown",this._keydown),t.add_tk_params(i,{addTkParams:this.options.addTkParams,campaignId:this.options.campaignId,versionId:this.options.versionId,campaignLocationTkId:this.options.campaignLocationTkId}),i.add(e).addClass("enabled")}return t.initClass=function(){this.CONFIRM="confirm",this.DISMISS="dismiss",this.LOG_IMPRESSION="log_impression"},t.prototype._keydown=function(t){if(27===t.keyCode||8===t.keyCode&&!a.focus_in_input())return t.preventDefault(),o.default(document).off("keydown",this._keydown),this.dismiss(t)},t.prototype._campaignUrl=function(i,e){var o=(function(){return i===t.CONFIRM?"/prompt/confirm":i===t.DISMISS?"/prompt/dismiss":i===t.LOG_IMPRESSION?"/prompt/log_impression":void 0})();if(this.options&&this.options.campaignId){var n=new p.URI({path:o}).updateQuery({campaign_id:this.options.campaignId});return this.options.versionId&&n.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),i===t.DISMISS&&e&&n.updateQuery({remind_me_later:!0}),n.toString()}},t.prototype._confirmOrDismiss=function(t,i,e,r){var s=this;return"keydown"===t.type||e||(t.stopImmediatePropagation(),t.preventDefault()),n.SilentBackgroundRequest({type:"POST",url:i,subject_user:this.options.activeUserId||this.options.subjectUser,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}}).done(function(i){return"keydown"===t.type||e||t.target.click(),o.default(document).trigger(r,s.options)})},t.prototype.dismiss=function(i,e){var n=this._campaignUrl(t.DISMISS,e);return n&&this._confirmOrDismiss(i,n,!1,"db:prompt:dismiss"),o.default(document).trigger("db:prompt:pre-dismiss",this.options)},t.prototype.confirmUrl=function(t){var i=o.default(t.currentTarget);return(function(){return i.is("button, input")&&"submit"===i.attr("type")?o.default(t.currentTarget).closest("form").attr("action"):i.is("a")?o.default(t.currentTarget).attr("href"):void 0})()||this.options.confirmUrl},t.prototype.confirmInNewTab=function(t){var i=o.default(t.currentTarget),e=(function(){return i.is("button, input")&&"submit"===i.attr("type")?o.default(t.currentTarget).closest("form").attr("target"):i.is("a")?o.default(t.currentTarget).attr("target"):void 0})();return e?"_blank"===e:this.options.confirmInNewTab},t.prototype.confirm=function(i){var e=this._campaignUrl(t.CONFIRM);return e&&this._confirmOrDismiss(i,e,this.confirmInNewTab(i),"db:prompt:confirm"),o.default(document).trigger(s.LEGACY_EVENT_PRE_CONFIRM,this.options)},t.prototype.get_time_since_request_start=function(){if(window.performance&&window.performance.timing&&window.performance.timing.navigationStart)return(new Date).getTime()-window.performance.timing.navigationStart},t.prototype.log_impression=function(){var i=this._campaignUrl(t.LOG_IMPRESSION);if(i)return n.SilentBackgroundRequest({type:"POST",url:i,subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},t.prototype.log_event=function(t){if(this.options&&this.options.campaignId){var i=new p.URI({path:"/prompt/log_event"}).updateQuery({event_name:t,campaign_id:this.options.campaignId});return this.options.versionId&&i.updateQuery({campaign_id:this.options.versionId,version_id:this.options.versionId}),n.SilentBackgroundRequest({type:"POST",url:i.toString(),subject_user:this.options.activeUserId,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})}},t.prototype.post_dismiss=function(){var t=this._dismissUrl();if(t)return n.SilentBackgroundRequest({type:"POST",url:t,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},t.prototype.post_confirm=function(){var t=this._confirmUrl();if(t)return n.SilentBackgroundRequest({type:"POST",url:t,data:{prompt_queried_at_ms:this.options.promptQueriedAtMs,delta_from_request_start_ms:this.get_time_since_request_start(),prompt_parent_request_id:this.options.requestId}})},t.add_tk_params=function(t,i){if(i.addTkParams){if(!i.campaignId||!i.campaignLocationTkId){var e=new Error("Missing campaignId or campaignLocationTkId.");return void r.reportJsControllerException({err:e,js_controller_options:i,severity:r.SEVERITY.NONCRITICAL})}return t.each(function(t,e){var n,r=o.default(e);r.is("a")?n="href":(r=r.closest("form"),n="action");var s=r.attr(n);if(r.length>0&&s){var a=p.URI.parse(s);return a.updateQuery({_tk:i.campaignLocationTkId,_camp:i.versionId||i.campaignId}),r.attr(n,a.toString())}})}},t.register_custom_controller=function(t){var i=t.on_show,e=t.on_confirm,n=t.on_dismiss,r=t.pre_confirm,a=t.pre_dismiss;if(i&&o.default(document).on(s.LEGACY_EVENT_SHOW,i),e&&o.default(document).on(s.LEGACY_EVENT_CONFIRM,e),n&&o.default(document).on(s.LEGACY_EVENT_DISMISS,n),r&&o.default(document).on(s.LEGACY_EVENT_PRE_CONFIRM,r),a)return o.default(document).on(s.LEGACY_EVENT_PRE_DISMISS,a)},t.unregister_custom_controller=function(t){var i=t.on_show,e=t.on_confirm,n=t.on_dismiss,r=t.pre_confirm,a=t.pre_dismiss;if(i&&o.default(document).off(s.LEGACY_EVENT_SHOW,i),e&&o.default(document).off(s.LEGACY_EVENT_CONFIRM,e),n&&o.default(document).off(s.LEGACY_EVENT_DISMISS,n),r&&o.default(document).off(s.LEGACY_EVENT_PRE_CONFIRM,r),a)return o.default(document).off(s.LEGACY_EVENT_PRE_DISMISS,a)},t})();u.initClass(),i.default=u});
//# sourceMappingURL=pkg-prompt-legacy.min.js-vflzKoNvV.map