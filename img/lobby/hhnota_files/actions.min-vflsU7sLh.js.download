define(["require","exports","tslib","modules/clean/api_v2/error","modules/clean/react/snackbar","modules/clean/sharing/shared_folder_invite/data/types","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/clean/react/shared_link_folder/api","modules/core/exception","modules/core/i18n"],function(e,o,n,r,t,i,a,s,c,l,u){"use strict";function d(e,n){new a.FolderShareApiClient({userId:n}).listMountableFoldersAlpha({actions:Object.keys(s.ALPHA_FOLDER_METADATA_PERMISSIONS),show_mounted:!1,get_invite_data:!0}).then(function(n){var r=n.entries,t=r.filter(function(e){return e.permissions&&e.permissions.relinquish_membership&&e.permissions.relinquish_membership.allow});e(o.getFolderInvitesSuccess(t.toList()))}).catch(r.catchApiError(p))}Object.defineProperty(o,"__esModule",{value:!0}),l=n.__importStar(l),u=n.__importStar(u);var f=u.i18n_default_project("sharing")._;o.getFolderInvites=function(e){return function(o){d(o,e),o({type:i.ActionTypes.GET_FOLDER_INVITES})}},o.getFolderInvitesSuccess=function(e){return{type:i.ActionTypes.GET_FOLDER_INVITES_SUCCESS,payload:e}},o.loadFolderContent=function(e){return function(n){var r=o.parseShareTokenFromURL(e.preview_url);c.fetchPage(r).then(function(e){var t=e.entries.filter(function(e){return!e.is_dir}).map(function(e){return e.preview_url});n(o.loadFolderContentSuccess(r.linkKey,t))}),n({type:i.ActionTypes.LOAD_FOLDER_CONTENT,payload:{folder:e}})}},o.loadFolderContentSuccess=function(e,o){return{type:i.ActionTypes.LOAD_FOLDER_CONTENT_SUCCESS,payload:{key:e,previewUrls:o}}},o.unmountFolder=function(e,o){return function(n){var s=o.shared_folder_id,c=new a.FolderShareApiClient({userId:e});t.Snackbar.sync(f("Removing this folder from your Dropbox..."),!1,"remove-folder-notification"),c.relinquishMembership({contentId:s}).then(function(){n({type:i.ActionTypes.UNMOUNT_FOLDER_SUCCESS,payload:{folderId:s}}),t.Snackbar.complete(f("This folder has been removed from your Dropbox."),"remove-folder-notification")}).catch(r.catchApiError(function(e){p(e,"remove-folder-notification")})),n({type:i.ActionTypes.UNMOUNT_FOLDER,payload:{folderId:s}})}},o.mountFolder=function(e,n){return function(s){var c=n.shared_folder_id,l=new a.FolderShareApiClient({userId:e});t.Snackbar.sync(f("Adding this folder to your Dropbox..."),!1,"mount-folder-notification"),l.mount({contentId:c}).then(function(){d(s,e),s(o.mountFolderSuccess(c)),t.Snackbar.complete(f("This folder has successfully been added to your Dropbox."),"mount-folder-notification")}).catch(r.catchApiError(function(e){"insufficient_quota"===(null!=e.error?e.error[".tag"]:void 0)&&null!=(null!=e.error?e.error.space_left:void 0)?t.Snackbar.fail(f("You do not have enough space to add this folder to your Dropbox."),"mount-folder-notification"):p(e,"mount-folder-notification")})),s({type:i.ActionTypes.MOUNT_FOLDER,payload:{folderId:c}})}},o.mountFolderSuccess=function(e){return{type:i.ActionTypes.MOUNT_FOLDER_SUCCESS,payload:{folderId:e}}};var p=function(e,o){void 0===o&&(o="sharing-notification");var n=e.message?e.message.toString():"";l.reportException({err:new Error(n),tags:["product-growth","mirage"]}),t.Snackbar.fail(f("We were unable to complete your request."),o)};o.parseShareTokenFromURL=function(e){var o=e.indexOf("/scl/fo/")+8,n=e.indexOf("?")>0?e.indexOf("?"):e.length,r=e.substring(o,n),t=r.split("/");return{linkKey:t[0],secureHash:t[1],subPath:"",linkType:s.SharedLinkType.Content}}});
//# sourceMappingURL=actions.min.js-vflCYkWjs.map